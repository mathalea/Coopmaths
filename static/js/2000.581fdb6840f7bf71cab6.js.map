{"version":3,"sources":["webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionAncetre.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionCoucherCompas.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionCreation.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionEcarterCompas.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionEcrireTexte.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionGlisser.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionLeverCompas.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionMasquer.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionMasquerInstrument.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionModifierLongueur.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionModifierRayon.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionMontrer.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionMontrerGraduations.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionMontrerInstrument.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionMontrerNombres.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionNommerPoint.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionPause.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionRetourner.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionRotationInstrument.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionRotationObjet.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionTranslationInstrument.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionTranslationObjet.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionZoomInstrument.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/actions/ActionZoomObjet.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/app/IepApp.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/app/IepDoc.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/global/InfoBalise.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/global/constantes.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/global/index.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/iepLoadPromise.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/instruments/Compas.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/instruments/CompasLeve.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/instruments/Crayon.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/instruments/Equerre.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/instruments/InstrumentAncetre.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/instruments/Rapporteur.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/instruments/Regle.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/instruments/Requerre.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/loadMathJax.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Angle.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/AngleDroit.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Arc.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Axe.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/DemiDroite.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Droite.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/DroiteAncetre.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Gabarit.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Imag.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Ligne.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/LigneContinue.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/MarqueSeg.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/MarqueSegment.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/NomPoint.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/ObjetBase.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Point.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Polygone.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Quadrillage.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Repere.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Segment.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/objets/Texte.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+instrumenpoche@7cb0619ab5484_aaffd6680a2e8049d51618026d869658/node_modules/Instrumenpoche/src/types/Vect.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+sesajstools@ac6283ba39b63def_97968278f6d8178a1d5951346cabd7e8/node_modules/sesajstools/dom/index.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+sesajstools@ac6283ba39b63def_97968278f6d8178a1d5951346cabd7e8/node_modules/sesajstools/index.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+sesajstools@ac6283ba39b63def_97968278f6d8178a1d5951346cabd7e8/node_modules/sesajstools/utils/dump.js","webpack://mathalea/./node_modules/.pnpm/framagit.org+Sesamath+sesajstools@ac6283ba39b63def_97968278f6d8178a1d5951346cabd7e8/node_modules/sesajstools/utils/log.js"],"names":["ActionAncetre","doc","tempo","arguments","length","this","Number","isFinite","isReady","prototype","setReady","creegElement","actionVisible","ActionCoucherCompas","execute","immediat","compas","compasLeve","leve","montre","setPosition","x","y","angle","visible","actionSuivante","getInstrumentVisibility","indice","getCompasStatus","ActionCreation","id","objet","vitesse","ob","getElement","objetRemplace","Math","abs","parseFloat","addElement","pushElement","xinit","yinit","creationAnimee","lanceAnimation","finAction","creeg","positionne","g","setAttribute","svg","appendChild","ActionEcarterCompas","ecartement","ec10","ecart","lanceAnimationEcartement","ActionEcrireTexte","couleur","taille","texte","style","couleurFond","opaciteFond","couleurCadre","epaisseurCadre","marge","margeGauche","margeDroite","margeHaut","margeBas","txt","replace","estLatex","estAffichageLatex","traduitCaracteresGrecs","traiteMaths","updateg","charAt","text","includes","strTraduite","split","map","fragment","i","join","console","warn","substr","ch","ch2","bStyletTexte","a","res","prepare","latexString","error","Error","self","then","width","getWidth","prelatex","ex","options","em","containerWidth","display","debug","log","MathJax","tex2svgPromise","html","creegLatex","catch","alert","s","firstChild","cloneNode","document","createElementNS","w","getAttribute","h","svgVa","va","String","rectAff","epc","height","getBBox","removeChild","creeRectangle","indbalise","tspan","ind","indexp","indind","mini","bexp","tailleind","stylespan","sp","debutLigne","an","dy","inf","debexp","debind","hautlig","decblp","decalage","indexOf","createTextNode","min","substring","infoBalise","erreur","operande","exposant","contientBalisesItaliqueOuUnderlineOuFontOuBold","test","coulFond","r","insertBefore","childNodes","ActionGlisser","abscisseFin","pix10","requerre","setAbs","lanceAnimationGlissement","ActionLeverCompas","ActionMasquer","idel","nature","el","getObjectVisibility","ActionMasquerInstrument","instrument","ActionModifierLongueur","longueur","regle","vis","oldg","replaceChild","translate","ActionModificationRayon","rayFin","type","donneRayon","lanceAnimationModificationRayon","ActionMontrer","ActionMontrerGraduations","bmontrer","montreGraduations","ActionMontrerInstrument","ActionMontrerNombres","rapporteur","montreGraduationsExternes","ActionNommerPoint","nomPoint","nom","point","ActionPause","activeIconeContinuer","animationEnCours","ActionRetourner","retourne","ActionRotationInstrument","anglefin","deg10","lanceAnimationRotation","ActionRotationObjet","ActionTranslationInstrument","xfin","yfin","isNaN","lanceAnimationTranslation","ActionTranslationObjet","ActionZoomInstrument","zoomfin","parseInt","zoomfactor","lanceAnimationZoom","ActionZoomObjet","closeAllXMLWindows","iepApp","docs","forEach","windowxml","close","IepApp","Boolean","window","addEventListener","bind","addDoc","xml","autoStart","getElementById","localName","push","iepDoc","flush","parentNode","getDocs","getLastDoc","outils","icons","getIconPlay","teinte","circ","filtre","pol","getIconPause","rect","getIconNextStep","getIconPrevStep","getIconGotoEnd","getIconReset","getIconRestart","path","getIconXml","getId","getAbs","getOrd","ord","getCouleur","coul","getCouleurCadre","getCouleurFond","getEpaisseur","ep","getOpaciteTrait","op","getOpaciteFond","getStyleTrait","st","getStyle","IepDoc","search","codexml","chunks","exec","chdoc","actions","elements","compasRetourne","equerre","crayon","xmldoc","tabact","getElementsByTagName","started","vb","viewBoxElts","xmlViewBox","Object","keys","attr","value","innerHeight","innerWidth","minWidth","minHeight","initialViewBox","indiceActionEnCours","creeActions","t","ev","mousemoveListenerSvg","clientX","clientY","mouseupListener","mouseleaveListener","touches","pageX","pageY","setViewBox","viewBox","some","prop","TypeError","zoomFactor","barreIcones","xbarre","ybarre","zoom","xCenter","yCenter","getViewBox","round","isReadyAll","pasPretes","filter","action","every","whenReady","callback","maxWait","check","Date","now","start","setTimeout","getReadyPromise","Promise","resolve","reject","getHeight","values","n","goFast","delay","nextStep","pause","waitPromise","reset","message","creeElementsGraphiques","initialiseOutils","outil","initialisePosition","recreeOutils","init","creeIcones","montreIcones","play","creeElementsPourIcones","iconReset","iconResetGris","onclick","iconPrevStep","iconPrevStepGris","prevStep","iconPause","iconPauseGris","iconPlay","iconPlayGris","iconContinue","continue","iconRestart","iconRestartGris","restart","iconNextStep","iconNextStepGris","iconGotoEnd","iconGotoEndGris","gotoEnd","iconXML","iconXMLGris","showXml","hauteurBarre","demiLargeurBarre","nbIcones","isDraggingBarre","mousedownListenerBarre","mousemoveListenerBarre","deltax","deltay","xmouse","ymouse","xcapturebarre","ycapturebarre","cursor","dx","xpos","ypos","preventDefault","popup","focus","icones","icone","bvisible","initialise","executeJusque","nbActions","indiceProchaineActionVisible","iconsToShow","concat","indicePrecedenteActionVisible","indaction","couche","montreInstrumentsEtape","indfin","element","findIndex","find","setElement","e","ajouteAction","at","ato","forme","xcrayon","ycrayon","sens","cibles","len","v1","echelle","cible","abscisse_bas_droite","ecartAngle","ordonnee_bas_droite","abscisse_haut_gauche","ordonnee_haut_gauche","xcons","ycons","elt","sep","obj","getAngle","presqueNul","norme","prepareAction","passageActionSuivante","attribute","defs","radialGradiant","markerArrow","filtreEclairageIcone","clair","fonce","rg","stop","marker","pathm","dl","pointLight","fc","open","title","div","createElement","form","body","ta","fontSize","scrollIntoView","select","bold","italic","underline","fontface","svgns","caracteresGrecs","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","kappa","lambda","mu","nu","xi","pi","rho","sigma","tau","phi","chi","psi","omega","Gamma","Delta","Xi","Pi","Sigma","Phi","Chi","Psi","Omega","caracteresSpeciaux","alpha2","plus","moins","fois","divise","petitf","petitebarre","grandebarre","prime","seconde","puceronde","grandC","euler","petitg","petith","Ironde","Lronde","lronde","grandN","Pronde","grandQ","Rronde","grandR","grandZ","Eronde","Fronde","Nronde","flecheG","flecheH","flecheD","flecheB","flecheDG","flecheGD","flecheHB","flecheBH","croissant","decroissant","alaligneadroite","alaligneagauche","doubleflecheG","doubleflecheD","doubleflecheDG","doubleflecheGD","flecheGbarre","flecheDbarre","flecheGcreuse","flecheHcreuse","flecheDcreuse","flecheBcreuse","qqsoit","pourtout","quelquesoit","complement","differentielpartiel","ilexiste","ilnexistepas","vide","nabla","appartienta","nappartientpasa","contient","petitcontient","grandproduit","grandcoproduit","grandesomme","petitebarrefine","moinsouplus","antislash","asterisque","racine","proportionnela","infini","anglespherique","nedivisepas","parallelea","nestpasparallelea","etlogique","oulogique","inter","intersection","union","integrale","doubleintegrale","tripleintegrale","integralecurviligne","integralesurfacique","integralevolumique","egaleasymptotiquea","environdroit","environegala","environ","egalpardefinition","differentde","identiquea","inferieura","superieura","inclusdans","nestpasinclusdans","necontientpas","sommedirecte","differencedirecte","produittensoriel","divisiondirecte","produitdirect","top","perpendiculairea","antecedentde","imagede","angledroitarc","pv","convDegRad","PI","convRadDeg","cos30","cos","sin30","carSpeMin","entries","char","toLowerCase","zero","zeroAngle","mesurePrincDeg","ang","ret","floor","parseXMLDoc","parser","xmlDoc","DOMParser","parseFromString","ActiveXObject","async","loadXML","estInstrument","indiceFinBalise","bal","balf","indf","balisefont","ind2","analyseExposantOuIndice","chaine","trim","indvirg","indparf","indiceParentheseFermante","deb","p","somme","mettre_en_pixels","nbr","borne1","borne2","borne_pix1","borne_pix2","coeff_dir","elimineDoublonsXML","patterns","ligne","pattern","RegExp","remplaceBalises","remplaceCarSpe","newString","accoladeFermante","pdebut","contientBaliseLaTeX","getSvgColor","trad","noir","rouge","vert","bleu","blanc","gris","darkorange","complete","repeat","toString","colineairesMemeSens","u","v","n1","n2","colineaires","indiceVirgule","nb","indpf","k","determiner_graduations","maxi","unite","debut_trace","ceil","LN10","pow","nombre","precision","prec","valeur_approchee","traiteBalise","indfb","ind1","fonte","inddeb","info","necessiteLatex","code","ch1","getMaths","btexte","indv","indv1","indv2","indv3","car","getMathsForName","getTaille","defaut","max","iepLoadPromise","container","HTMLElement","url","location","protocol","fetch","Accept","response","status","statusText","ok","loadXml","strMatched","domain","empty","setStyles","position","overflow","classList","add","margin","padding","addSvg","iepOptions","autostart","resize","border","styleBtn","zIndex","textAlign","left","addZoom","Compas","bretourne","lon","longpointe","d","alp","asin","decbh","li","epm","bg","bd","rayb","styleli","haut","ylh","dlm","transX","transY","scale","ecartfin","pasecart","distecart","timer","setInterval","actionPourEcartement","ec","dis","clearInterval","CompasLeve","f","Crayon","angleInit","lg","demlarg","rx","ry","path1","longmine","Equerre","path2","largeurgauche","InstrumentAncetre","pix","dist","vect","vecteurColineaire","actionPourTranslation","angfin","ang1","ang2","pasdeg","distang","actionPourRotation","pas","senspos","actionPourZoom","z","Rapporteur","graduationExterneVisible","graduationInterneVisible","ray","rayon","rayonInt","gradext","rayInt","gradint","largeurBarre","Regle","graduationVisible","longint","largeur","line","graduations","Requerre","abscisse","longd","larg","pathtrou","fakeEquerre","gequerre","absfin","actionPourGlissement","mathJaxConfig","tex","inlineMath","packages","mtextInheritFont","ignoreHtmlClass","processHtmlClass","loader","load","mathJaxLoadingPromise","loadMathJax","version","config","startup","ready","clearTimeout","timeout","defaultReady","promise","eltScript","crossOrigin","mathJax3BaseUrl","src","loadDelay","Angle","epaisseur","opacite","motif","opaciteRemplissage","direct","v2","xc1","yc1","xmilieu","ymilieu","ang3","a1","a2","u1","sin","u2","xd","yd","xf","yf","remplis","style1","rond","uc","tourne","xc","yc","u3","u4","nbtraits","AngleDroit","xsommet","ysommet","xinter","yinter","sqrt","points","Arc","debut","fin","styleTrait","actionPourAnimation","Axe","pente","gauche","distanceBord","xgrad","xmin","xmax","cadre","droite","bas","nb_grad_x","bord","debut_trace_x","tracer_abscisses","tracer_ordonnees","unite_x","ordo_etiquettes","mettre_x_en_pixels","stylet","debut_trace_y","unite_y","nb_grad_y","abs_etiquettes","ordonnee","mettre_y_en_pixels","DemiDroite","x1","y1","x2","y2","calcule","horsFenetre","xext1","yext1","xext2","yext2","Droite","indicePoint","ya","xb","yb","DroiteAncetre","cray","Gabarit","rayInit","dif","dray","sign","actionPourModificationRayon","Imag","img","Image","owner","onload","own","image","setAttributeNS","Ligne","LigneContinue","xdeb","ydeb","sauveabs","sauveord","MarqueSeg","idSeg","demlong","dec","diam","seg","xmil","ymil","MarqueSegment","NomPoint","xp","yp","ObjetBase","b","Point","Polygone","longcote","Quadrillage","hauteur","tracer_grille","ecart_x","ecart_y","debut_x","debut_y","fin_x","fin_y","pointille","Repere","ygrad","ymin","ymax","grille","axes","etiquettes","clip","rect2","Segment","stylefleche","longFleche","Texte","Vect","normeSouhaitee","norm","kc","ks","atan","hasProp","addText","tag","attrs","txtContent","className","class","lastId","getNewId","styles","paire","key","module","exports","addCss","file","head","links","dejala","href","rel","addJs","cb","callCb","removeEventListener","parent","content","addElementAfter","newElt","nextSibling","addElementBefore","addElementFirstChild","addElementFirstSibling","elementRef","getSize","compatMode","documentElement","clientWidth","clientHeight","Array","fn","specialHtmlChars","object","hasOwnProperty","call","isFunction","arg","isInt","isStringAllowed","isUndefined","pad","undefined","countSlash","str","escapeForHtml","all","formatDate","format","date","pad0","val","capture","formatChar","getDate","getFullYear","getMonth","getHours","getMinutes","getMilliseconds","getSeconds","getTime","getToken","random","isArray","isArrayEmpty","isArrayNotEmpty","isDate","isError","isInArray","ar","isIntPos","strict","isObject","isObjectPlain","isRegExp","isString","isUrlAbsolute","parse","jsonString","JSON","splitAndTrim","delim","stringify","indent","buffer","pile","sepSup","toAscii","string","reduce","acc","toInt","NaN","tools","dump","prefix","innerPrefix","index","toSource","nbp","levels","notice","warning","critical","prefixes","loggers","logLevel","isNode","process","env","isCluster","hasDatePrefix","datePrefix","hasProcessPrefix","processPrefix","NODE_APP_INSTANCE","_log","args","level","logger","ifError","disable","disableDatePrefix","disableProcessPrefix","objToDump","dumped","enable","enableDatePrefix","enableProcessPrefix","setDatePrefix","setLogLevel"],"mappings":"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","file":"js/2000.581fdb6840f7bf71cab6.js","sourcesContent":["/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nexport default ActionAncetre\n/**\n * Action ancetre de toutes les actions de la figure\n * @constructor\n * @param {IepDoc} doc le document contenant les objets\n * @param {string|number} [tempo] Le délai d'attente à la fin de l'action en dixièmes de seconde, sinon on passe directement à l'action suivante.\n */\nfunction ActionAncetre (doc, tempo) {\n  if (arguments.length === 0) return\n  /** @type {IepDoc} */\n  this.doc = doc\n  if (typeof tempo === 'string') tempo = Number(tempo)\n  /** @type {number} */\n  this.tempo = (typeof tempo === 'number' && tempo > 0 && Number.isFinite(tempo)) ? tempo * 100 : null\n  /** @type {boolean} */\n  this.isReady = false // Sera mis à true une fois qu'on est sûr que l'élément est bien chargé et prêt.\n}\n/**\n * Retourne lorsque l'action a été chargé et prête.\n * Est redéfini pour les actions dont le chargement est asynchrone : images et actions\n * d'écriture de texte nécessitant l'utilisation du LaTeX.\n */\nActionAncetre.prototype.setReady = function () {\n  this.isReady = true\n}\n/**\n * Fonction qui n'aura une action que pour les actions de création d'objet et créera l'élément graphique\n * du DOM associé Sera redéfini pour les actions de création d'objet\n */\nActionAncetre.prototype.creegElement = function () {\n}\n/**\n * Retourne true seulement si l'action a une action visible sur la figure.\n * Lors de l'appel de iepDoc.ajouteAction, chaque action se voit attribuer un membre indice\n * qui est son indice dans la liste des actions créées..\n * Renvoie true par défaut.\n * @returns {boolean}\n */\nActionAncetre.prototype.actionVisible = function () {\n  return true\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionCoucherCompas\n/**\n * Action couchant le compas.\n * @extends ActionAncetre\n * @constructor\n * @param {iepDoc} doc\n */\nfunction ActionCoucherCompas (doc, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n}\nActionCoucherCompas.prototype = new ActionAncetre()\n\n/**\n * Fonction couchant le compas et le montrant si immediat est false\n * @param {boolean} immediat\n */\nActionCoucherCompas.prototype.execute = function (immediat) {\n  const compas = this.doc.compas\n  const compasLeve = this.doc.compasLeve\n  if (compas.leve) {\n    compasLeve.montre(false)\n    compas.setPosition(compasLeve.x, compasLeve.y, compasLeve.angle)\n  }\n  if (!immediat && compas.visible) compas.montre(true)\n  compas.leve = false\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionCoucherCompas.prototype.actionVisible = function () {\n  const visible = this.doc.getInstrumentVisibility(this.doc.compas.compas, this.indice - 1)\n  if (!visible) return false\n  else return this.doc.getCompasStatus(this.indice - 1) === 'leve'\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nimport Texte from '../objets/Texte'\nexport default ActionCreation\n/**\n * Action de création de l'objet objet d'id id dans le document doc\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc\n * @param {string} id\n * @param {ObjetBase} objet\n */\nfunction ActionCreation (doc, id, objet, tempo, vitesse) {\n  ActionAncetre.call(this, doc, tempo)\n  /** @type {string} */\n  this.id = id\n  const ob = this.doc.getElement(id, objet.objet)\n  this.objetRemplace = (ob === null) ? null : ob\n  /** @type {ObjetBase} */\n  this.objet = objet\n  // Ci-dessous un parseFloat car dans certains scripts j'ai vu des sens = \"-0.3\"\n  /** @type {number} */\n  this.vitesse = (arguments.length >= 5 && vitesse != null) ? Math.abs(parseFloat(vitesse)) : 8\n  if (this.objetRemplace !== null) this.doc.addElement(this.objet)\n  else this.doc.pushElement(this.objet)\n}\nActionCreation.prototype = new ActionAncetre()\n/**\n * Fonction lançant l'animation de création de l'objet objet si la création de l'objet nécessite une animation\n * et si immediat est à false et sinon affichant immédiatement l'objet\n * @param {boolean} [immediat=false]\n */\nActionCreation.prototype.execute = function (immediat) {\n  // Pour un texte on a mémorisé sa position initiale car il peut avoir été translaté.\n  // et quand on relance la figure il doit remprendre sa place initiale\n\n  if (this.objet instanceof Texte) {\n    this.objet.x = this.objet.xinit\n    this.objet.y = this.objet.yinit\n  }\n  // this.doc.svg.appendChild(this.objet.g);\n  if (this.objetRemplace !== null) {\n    this.objetRemplace.montre(false)\n    // this.doc.svg.replaceChild(this.objet.g,this.objetRemplace.g);\n  }\n  if (this.objet.creationAnimee() && !immediat) {\n    this.objet.lanceAnimation(this.vitesse)\n  } else {\n    this.objet.montre(true)\n    if (immediat) this.objet.finAction()\n    else this.doc.actionSuivante()\n  }\n}\n/**\n * Crée l'élément graphique du DOM associé à une action de création d'objet\n * L'objet est calculé par positionne() et caché\n */\nActionCreation.prototype.creegElement = function () {\n  const doc = this.doc\n  const objet = this.objet\n  objet.creeg()\n  objet.positionne()\n  objet.g.setAttribute('visibility', 'hidden')\n  doc.svg.appendChild(objet.g)\n}\n/** @inheritDoc */\nActionCreation.prototype.actionVisible = function () {\n  return !(this.objet instanceof Texte)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\n\nexport default ActionEcarterCompas\n\n/**\n * Écarte le compas\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc\n * @param ecartement\n * @param tempo\n * @param ec10\n */\nfunction ActionEcarterCompas (doc, ecartement, tempo, ec10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.ecartement = ecartement\n  this.ec10 = (ec10 === null) ? 16 : parseFloat(ec10)\n}\n\nActionEcarterCompas.prototype = new ActionAncetre()\n\nActionEcarterCompas.prototype.execute = function (immediat) {\n  if (!immediat) {\n    this.doc.compas.lanceAnimationEcartement(this.ecartement, this.ec10)\n  } else {\n    this.doc.compas.ecart = this.ecartement\n    this.doc.compas.positionne()\n  }\n}\n\nActionEcarterCompas.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.doc.compas, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { analyseExposantOuIndice, getTaille, getMaths, indiceFinBalise, necessiteLatex, remplaceBalises, remplaceCarSpe, traiteBalise } from '../global'\nimport { caracteresGrecs, svgns } from '../global/constantes'\nimport InfoBalise from '../global/InfoBalise'\nimport ActionAncetre from '../actions/ActionAncetre'\nimport loadMathJax from '../loadMathJax'\n\nexport default ActionEcrireTexte\n\n// Modification version MathJax3 : plus besoin de créer un div auxiliaire (cf rev477 pour la version précédente)\n\n/**\n * Action d'écriture d'un texte. Le texte doit avoir été créé auparavant.\n * @constructor\n * @extends ActionAncetre\n * @param {iepDoc} doc            le document propriétaire\n * @param {string} id             l'id du texte sur lequel écrire\n * @param {string} couleur        la couleur du texte\n * @param {string} taille         la taille du texte\n * @param {string} texte          Le texte à afficher\n * @param {string} style          'texte' si non fourni\n * @param {string} couleurFond\n * @param {number} opaciteFond\n * @param {string} couleurCadre\n * @param {number} epaisseurCadre\n * @param {string} marge          la marge éventuelle\n * @param {string} margeGauche    la marge gauche éventuelle\n * @param {string} margeDroite    la marge droite éventuelle\n * @param {string} margeHaut      la marge haute éventuelle\n * @param {string} margeBas       la marge basse éventuelle\n * @param {string} tempo          le tempo\n */\nfunction ActionEcrireTexte (doc, id, couleur, taille, texte, style, couleurFond,\n  opaciteFond, couleurCadre, epaisseurCadre, marge, margeGauche, margeDroite, margeHaut, margeBas, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.txt = this.doc.getElement(id, 'texte')\n  this.id = id\n  this.couleur = couleur\n  // On remplace dans la taille les lettres O mises par les étourdis à la place de 0\n  this.taille = (taille == null) ? '20' : taille.replace(/O/g, '0')\n  /* @todo voir si on peut pas caster this.taille en number ici avec getTaille (pour imposer un min/max) */\n\n  // Traitement des accents plus nécessaire avec version MathJax 3\n  // this.texte = kernel.remplaceAccentsHtml(kernel.remplaceBalises(kernel.remplaceCarSpe(texte)))\n  this.style = (style === null) ? 'texte' : style\n  this.couleurFond = couleurFond\n  this.opaciteFond = (opaciteFond == null) ? '0.6' : parseFloat(opaciteFond) / 100\n  // Modification version 5.0.2. Causait des problèmes avec explorer\n  // this.couleurCadre = (couleurCadre == null) ? couleur : couleurCadre\n  this.couleurCadre = couleurCadre\n  if ((epaisseurCadre !== null) && (couleurCadre === null)) this.couleurCadre = couleur\n  //\n  this.epaisseurCadre = (epaisseurCadre != null) ? epaisseurCadre : ((couleurCadre == null) ? 0 : 1)\n  this.marge = (marge == null) ? 0 : parseFloat(marge)\n  this.margeGauche = (margeGauche == null) ? 0 : parseFloat(margeGauche)\n  this.margeDroite = (margeDroite == null) ? 0 : parseFloat(margeDroite)\n  this.margeHaut = (margeHaut == null) ? 0 : parseFloat(margeHaut)\n  this.margeBas = (margeBas == null) ? 0 : parseFloat(margeBas)\n  this.texte = texte\n  this.estLatex = this.estAffichageLatex()\n  // si c'est du LaTeX demandé par l'utilisateur on y touche pas\n  if (!this.estLatex) {\n    // mais sinon on fait les remplacements\n    this.texte = remplaceBalises(remplaceCarSpe(this.texte))\n    this.texte = this.traduitCaracteresGrecs(this.texte)\n    // et on regarde si y'a pas besoin de LaTeX quand même\n    this.texte = this.texte.replace(/\\*/g, '×')\n    if (necessiteLatex(texte)) {\n      // faut mettre les $ pour que prepare charge MathJax (il les vire avant de filer la string à MathJax)\n      this.texte = '$' + this.traiteMaths(this.texte) + '$'\n      this.estLatex = true\n    }\n  }\n  // console.log(`constructeur ActionEcrireTexte avec \\n${texte}\\n =>\\n ${this.texte}`)\n}\n\nActionEcrireTexte.prototype = new ActionAncetre()\n/**\n * Action écrivant le contenu du texte sur la figure\n * @param {Boolean} immediat\n * @returns {undefined}\n */\nActionEcrireTexte.prototype.execute = function (immediat) {\n  if (this.txt != null) { // Pour éviter les erreurs des auteurs\n    this.angle = 0 // Car on peut dans la version js faire tourner un texte\n    const txt = this.txt\n    txt.couleur = this.couleur\n    txt.taille = this.taille\n    txt.texte = this.texte\n    txt.couleurFond = this.couleurFond\n    txt.couleurCadre = this.couleurCadre\n    txt.epaisseurCadre = this.epaisseurCadre\n    txt.updateg(this.g)\n    txt.positionne()\n  }\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n\n/**\n * Retourne true si l'affichage de texte utilise le LaTeX de façon délibérée\n * en encadrant alors le code LaTeX par deux caractères $\n * @returns {boolean}\n */\nActionEcrireTexte.prototype.estAffichageLatex = function () {\n  return ((this.texte.charAt(0) === '$') && (this.texte.charAt(this.texte.length - 1) === '$'))\n}\n\n/**\n * Fonction remplaçant les codes du type £...£ représentant des caractères grecs\n * par les caractères UTF8 correspondants\n * @param {string} ch\n * @returns {string}\n */\nActionEcrireTexte.prototype.traduitCaracteresGrecs = function (text) {\n  if (!text.includes('£')) return text\n  // on éclate la chaîne sur £ et on regarde les morceaux impair (0 est celui qui précède le premier £)\n  // Attention, par rapport au traitement précédent qui passaient toutes les regex £pattern£,\n  // avec ce fonctionnement si jamais on a un nb impair de £,\n  // le dernier morceau va se retrouver fermé avec le £ manquant\n  // 'bla bla £pi£ bla bla £portnawak' => 'bla bla π bla bla £portnawak£'\n  const strTraduite = text.split('£').map((fragment, i) => {\n    // si impair, faut regarder si c'est un caractère connu\n    if (i % 2) return caracteresGrecs[fragment] || `£${fragment}£`\n    return fragment\n  }).join('')\n  // on vire le dernier £ si on l'a ajouté\n  if ((text.length - text.replace(/£/g, '').length) % 2) {\n    console.warn(`Il y a un nombre impair de £ dans cette chaîne : ${text}`)\n    return strTraduite.substr(0, strTraduite.length - 1)\n  }\n  return strTraduite\n}\n/**\n * Fonction traitant la chaîne ch pour la transcrire en code LaTeX\n * Renvoie la chaîne LaTeX correspondante.\n * Si la chaîne contient des balises <br>, un tableau LaTeX est utilisé pour rendre le contenu\n * @param {string} ch la chaîne à traiter\n * @returns {string} la chaîne LaTeX correpondante une fois ch traduite\n */\nActionEcrireTexte.prototype.traiteMaths = function (ch) {\n  let i\n  const ch2 = ch\n  const bStyletTexte = this.style === 'texte'\n  // On recherche les codes <br> et on remplace les lignes par une matrice\n  // avant c'était new RegExp('<br>|</br>', 'gi'),\n  // donc on laisse le cas </br> complètement invalide en html,\n  // mais on gère le bon qui est <br/> ou <br />\n  const a = ch2.split(/<\\/?br *\\/?>/gi)\n  // if (a.length <= 1) return traiteAccents(getMaths(ch, bStyletTexte)) // True pour mode texte par défaut\n  // Modif version MathJax 3\n  if (a.length <= 1) return getMaths(ch, bStyletTexte) // True pour mode texte par défaut\n  let res = '\\\\begin{array}{l}'\n  for (i = 0; i < a.length; i++) {\n    if (i !== 0) res += '\\\\\\\\'\n    // Modif version MathJax 3\n    // res += traiteAccents(getMaths(a[i], bStyletTexte)) // true pour mode texte par défaut\n    res += getMaths(a[i], bStyletTexte) // true pour mode texte par défaut\n  }\n  res += '\\\\end{array}'\n  return res\n}\n\n/**\n * Fonction appelée lors de l'appel de iepDoc.creeActions()\n * Si l'écriture du texte ne nécessite pas l'emploi du LaTeX, on crée l'élément grapique qui sera\n * démasqué quand l'action sera exécutée\n * Sinon, on charge mathjax si besoin et on demande à MathJax via sa pile d'appels\n * de traiter le texte pour en faire du svg et appeler setReady quand ce sera terminé\n */\nActionEcrireTexte.prototype.prepare = function () {\n  let latexString\n  if (this.estLatex) {\n    latexString = this.texte.replace(/^\\$(.*)\\$$/, '$1')\n    if (!latexString) {\n      console.error(Error('texte latex mais pas enveloppé de $, ignoré'), this.texte)\n      this.estLatex = false\n    }\n  }\n  if (this.estLatex) {\n    const self = this\n    loadMathJax().then(() => {\n      /* global MathJax */\n      const width = self.doc.getWidth()\n      // const taille = getTaille(self) - 2\n      const taille = self.taille\n      const ch = self.prelatex() + latexString\n      // self.ex = taille / 2\n      self.ex = taille * 0.45\n      const options = {\n        em: taille,\n        ex: self.ex,\n        containerWidth: width,\n        display: false\n      }\n      if (self.doc.debug) console.log('On passe à MathJax la string', ch)\n      return MathJax.tex2svgPromise(ch, options)\n    }).then((html) => {\n      // MathJax retourne du html avec un svg dedans, du genre\n      // <mjx-container …><svg xmlns=\"http://www.w3.org/2000/svg\" …>…</svg></mjx-container>\n      // console.log('MathJax retourne ce svg', html)\n      self.html = html\n      self.creegLatex()\n      self.setReady()\n    }).catch(error => {\n      console.error(error)\n      alert('Pb Mathjax, impossible d’afficher le LaTeX correctement')\n    })\n  } else {\n    this.creeg()\n    this.setReady()\n  }\n}\n\n/**\n * Retourne l'en-tête à rajouter pour que, dans le cas d'utilisation du\n * LaTeX, l'affichage soit de la bonne couleur.\n */\nActionEcrireTexte.prototype.prelatex = function () {\n  return '\\\\color{' + this.couleur + '}'\n}\n\n/**\n * Fonction appelée par prepare() qui récupère l'élement svg représentant\n * la formule dans la propriété html (car y'a un conteneur html <mjx-container>)\n * Rajoute les éléments graphiques correspondant à un cadre si une couleur de fond\n * et un cadre ont été demandés\n */\nActionEcrireTexte.prototype.creegLatex = function () {\n  try {\n    const s = this.html.firstChild\n    // clonage profond du svg créé par MathJax dans le html,\n    // ça vire les attributs non standard qu'il ajoute (<g data-mml-node=\"…\" par ex)\n    const svg = s.cloneNode(true)\n    // on wrap le svg dans un tag g\n    const g = document.createElementNS(svgns, 'g')\n    g.appendChild(svg)\n\n    // on lui ajoute les attributs imposés par l'action courante, MathJax donne des attributs width et height à ses svg\n    const w = parseFloat(s.getAttribute('width')) * this.ex\n    const h = parseFloat(s.getAttribute('height')) * this.ex\n    const svgVa = svg.style['vertical-align']\n    const va = (svgVa ? parseFloat(svgVa) || 1 : 1) * this.ex\n    svg.setAttribute('width', w + 'px')\n    svg.setAttribute('height', h + 'px')\n    svg.style['vertical-align'] = `${va}px`\n    svg.setAttribute('x', '0')\n    const taille = getTaille(this)\n    svg.setAttribute('y', String(-taille)) // Différent de MathGraph32\n    g.setAttribute('visibility', 'hidden') // A revoir version MathJax 3\n    // g.setAttribute(\"id\",this.id)\n    if ((this.couleurFond !== null) || (this.couleurCadre !== null)) {\n      g.setAttribute('visibility', 'hidden')\n      this.doc.svg.appendChild(g)\n      this.rectAff = {}\n      const epc = parseFloat(this.epaisseurCadre)\n      const { x, y, width, height } = g.getBBox()\n      this.rectAff.height = height + 2 * epc + 4 + 2 * this.marge + this.margeHaut + this.margeBas\n      this.rectAff.width = width + 2 * epc + 2 + 2 * this.marge + this.margeGauche + this.margeDroite\n      this.rectAff.x = x - epc - 1 - this.marge - this.margeGauche\n      this.rectAff.y = y - epc - 1 - this.marge - this.margeHaut\n      g.setAttribute('visibility', 'visible')\n      this.doc.svg.removeChild(g)\n      this.creeRectangle(g, (this.couleurFond == null) ? 'white' : this.couleurFond)\n    }\n    // et on affecte ça à la propriété g\n    this.g = g\n  } catch (error) {\n    console.error('Erreur dans ActionEcrireTexte.creegLatex (on remplace par un <g> vide) :', error)\n    this.g = document.createElementNS(svgns, 'g') // Crée un g vide en cas de problème\n  }\n}\n\n/**\n * Retourne l'élément graphique associé dans le cas où l'affichage n'utilise pas le LaTeX\n * Avant appel, this.text doit voir été affecté\n */\nActionEcrireTexte.prototype.creeg = function () {\n  let indbalise, tspan, ch, ch2, style, txt, ind, indexp, indind, mini, bexp, tailleind, stylespan,\n    y, sp, i, debutLigne, an\n  let dy = 0 // Le baselineshift de chaque tspan\n  const inf = '<' // Equivalent du symbole <\n  const debexp = '£e('\n  const debind = '£i('\n  const g = document.createElementNS(svgns, 'g')\n  const taille = getTaille(this)\n  const hautlig = taille + 2\n  let decblp = 0 // Décalage vers le bas de la ligne précédente\n  const decalage = taille * 0.4 // Décalage vers le bas ou le haut en cas d'indice ou d'exposant\n\n  if (this.texte !== '') {\n    txt = document.createElementNS(svgns, 'text')\n    txt.setAttribute('pointer-events', 'none')\n    txt.setAttribute('x', 0)\n    txt.setAttribute('y', 0)\n    style = 'text-anchor:left;font-size:' + taille + 'px;' + 'fill:' + this.couleur + ';'\n    txt.setAttribute('style', style)\n    // On remplace les espaces par des espaces insécables\n    ch2 = this.texte.replace(/ /g, '\\u00A0')\n    // Affecter une longueur ne peut être efficace que pour du texte simpel sans balise\n    if ((this.texte.indexOf(inf) === -1) && (this.texte.indexOf(debexp) === -1) && (this.texte.indexOf(debind) === -1) &&\n      (this.texte.indexOf('<br>') === -1)) {\n      txt.appendChild(document.createTextNode(ch2))\n    } else {\n      sp = ch2.split(/<br>/gi)\n      y = -hautlig\n      for (i = 0; i < sp.length; i++) {\n        debutLigne = true\n        ch = sp[i]\n        while (ch !== '') {\n          indbalise = ch.indexOf(inf)\n          indexp = ch.indexOf(debexp)\n          indind = ch.indexOf(debind)\n          if (debutLigne) y += hautlig + decblp\n          if (indexp !== -1) y += decalage\n          if ((indbalise === -1) && (indexp === -1) && (indind === -1)) {\n            // txt.appendChild(document.createTextNode(this.texte))\n            tspan = document.createElementNS(svgns, 'tspan')\n            tspan.setAttribute('pointer-events', 'none')\n            tspan.setAttribute('dy', dy)\n            if (debutLigne) {\n              tspan.setAttribute('x', 0)\n              tspan.setAttribute('y', y)\n              debutLigne = false\n            }\n            dy = 0 // On est revenu au niveau 0\n            tspan.appendChild(document.createTextNode(ch))\n            txt.appendChild(tspan)\n            break\n          } else {\n            while ((ch.indexOf(inf) !== -1) || (ch.indexOf(debexp) !== -1) ||\n                    (ch.indexOf(debind) !== -1)) {\n              indbalise = ch.indexOf(inf)\n              indexp = ch.indexOf(debexp)\n              indind = ch.indexOf(debind)\n              if (indbalise === -1) {\n                if (indexp === -1) mini = indind\n                else mini = (indind === -1) ? indexp : Math.min(indind, indexp)\n              } else {\n                if (indexp === -1) mini = (indind === -1) ? indbalise : Math.min(indbalise, indind)\n                else {\n                  if (indind === -1) mini = Math.min(indbalise, indexp)\n                  else mini = Math.min(indbalise, indind, indexp)\n                }\n              }\n              if (mini > 0) { // Il y a du texte avant les balises\n                tspan = document.createElementNS(svgns, 'tspan')\n                tspan.setAttribute('pointer-events', 'none')\n                tspan.setAttribute('dy', dy)\n                if (debutLigne) {\n                  tspan.setAttribute('x', 0)\n                  tspan.setAttribute('y', y)\n                  debutLigne = false\n                }\n                dy = 0 // On est revenu au niveau 0\n                tspan.appendChild(document.createTextNode(ch.substring(0, mini)))\n                txt.appendChild(tspan)\n                ch = ch.substring(mini)\n              } else {\n                if (indbalise === 0) {\n                  const infoBalise = new InfoBalise(false, false, false, this.couleur, '', taille)\n                  ind = indiceFinBalise(ch)\n                  if (ind === -1) traiteBalise(ch, infoBalise, txt, debutLigne, y)\n                  else traiteBalise(ch.substring(0, ind), infoBalise, txt, debutLigne, y)\n                  debutLigne = false\n                  if (ind !== -1) ch = ch.substring(ind); else ch = ''\n                  dy = 0 // On est revenu au niveau 0\n                } else { // mini est égal à 0\n                  bexp = mini === indexp\n                  an = analyseExposantOuIndice(ch)\n                  tspan = document.createElementNS(svgns, 'tspan')\n                  tspan.setAttribute('pointer-events', 'none')\n                  tspan.setAttribute('dy', dy + 'px')\n                  if (debutLigne) {\n                    tspan.setAttribute('x', 0)\n                    tspan.setAttribute('y', y)\n                    debutLigne = false\n                  }\n                  if (an.erreur) tspan.appendChild(document.createTextNode(ch))\n                  else {\n                    tspan.appendChild(document.createTextNode(an.operande))\n                    txt.appendChild(tspan)\n                    tspan = document.createElementNS(svgns, 'tspan')\n                    tspan.setAttribute('pointer-events', 'none')\n                    tspan.appendChild(document.createTextNode(an.exposant))\n                    dy = decalage\n                    if (bexp) dy = -dy\n                    else decblp = dy\n                    tspan.setAttribute('dy', dy + 'px')\n                    tailleind = taille * 0.6\n                    stylespan = 'font-size:' + tailleind + 'px;'\n                    tspan.setAttribute('style', stylespan)\n                    txt.appendChild(tspan)\n                    dy = -dy // Car sinon la suite sera décalée aussi en hauteur\n                  }\n                  ch = an.texte\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    g.appendChild(txt)\n  }\n  g.setAttribute('visibility', 'hidden')\n  // g.setAttribute(\"id\",this.id)\n  if ((this.couleurFond != null) || (this.couleurCadre != null)) {\n    g.setAttribute('visibility', 'hidden')\n    this.doc.svg.appendChild(g)\n    this.rectAff = {}\n    const epc = parseFloat(this.epaisseurCadre)\n    this.rectAff.height = g.getBBox().height + 2 * epc + 3 + 2 * this.marge + this.margeHaut + this.margeBas\n    this.rectAff.width = g.getBBox().width + 2 * epc + 2 + 2 * this.marge + this.margeGauche + this.margeDroite\n    this.rectAff.x = g.getBBox().x - epc - 1 - this.marge - this.margeGauche\n    this.rectAff.y = g.getBBox().y - epc - 1 - this.marge - this.margeHaut\n    g.setAttribute('visibility', 'visible')\n    this.doc.svg.removeChild(g)\n    this.creeRectangle(g, (this.couleurFond == null) ? 'white' : this.couleurFond)\n  }\n  this.g = g\n}\n\n/**\n * Renvoie true si la chaîne ch contient des balises &lt;u\\> ou \\<i\\>\n * @param {string} ch\n * @returns {boolean}\n */\nActionEcrireTexte.prototype.contientBalisesItaliqueOuUnderlineOuFontOuBold = function (ch) {\n  return (/<(u|b|i|font[^>]+)>/gi).test(ch)\n}\n\n/**\n * Fonction appelée dans le cas où l'affihcage de texte a une couleur de fond ou doit être encadrée.\n * Elle rajoute le rectangle au g élément avant l'affichage correspondant au texte (de façon à pouvoir\n * le cas échéant effacer le fond avant l'affichage du texte)\n * @param {SVGGElement} g l'élément g qui contient l'affichage de texte (<g> normal ou <svg> dans le cas du LaTeX)\n */\nActionEcrireTexte.prototype.creeRectangle = function (g, coulFond) {\n  const r = document.createElementNS(svgns, 'rect')\n  const style = 'stroke-width:' + this.epaisseurCadre + 'px;' + 'stroke:' + this.couleurCadre + ';' +\n    'fill:' + coulFond + ';fill-opacity:' + this.opaciteFond + ';'\n  r.setAttribute('style', style)\n  r.setAttribute('x', this.rectAff.x)\n  r.setAttribute('y', this.rectAff.y)\n  r.setAttribute('width', this.rectAff.width)\n  r.setAttribute('height', this.rectAff.height)\n  r.setAttribute('pointer-events', 'none')\n  g.insertBefore(r, g.childNodes[0])\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionGlisser\n/**\n * Action faisant glisser l'équerre de la règle équerre\n * @constructor\n * @extends ActionAncetre\n * @param {IepDoc} doc le document propriétaire\n * @param {int} abscisseFin l'abscisse de fin de déplacement\n * @param {string} tempo le tempo en dixième de seconde (ou null)\n * @param {string} pix10 le nombre de pixels de déplacement à chaque dixième de seconde\n */\nfunction ActionGlisser (doc, abscisseFin, tempo, pix10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.abscisseFin = parseFloat(abscisseFin)\n  this.pix10 = (pix10 === null) ? 8 : String(Math.abs(pix10))\n}\nActionGlisser.prototype = new ActionAncetre()\n/**\n * Fonction lançant une animation de glissement de la règle équerre sauf si immediat est true\n * @param {boolean} [immediat=false]\n */\nActionGlisser.prototype.execute = function (immediat) {\n  if (!immediat) this.doc.requerre.lanceAnimationGlissement(this.abscisseFin, this.pix10)\n  else {\n    this.doc.requerre.setAbs(this.abscisseFin)\n    this.doc.requerre.positionne()\n    // this.doc.actionSuivante(immediat);\n  }\n}\n/** @inheritDoc */\nActionGlisser.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.doc.requerre, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nimport CompasLeve from '../instruments/CompasLeve'\nexport default ActionLeverCompas\n/**\n * Action levant le compas\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n */\nfunction ActionLeverCompas (doc, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n}\nActionLeverCompas.prototype = new ActionAncetre()\n\n/**\n * Fonction cachant le compas normal et créant un compas couché qui est ensuite affiché\n * si le compas est visible\n * @param {string} immediat true dans le cas d'une exécution sans passage à l'action suivante\n */\nActionLeverCompas.prototype.execute = function (immediat) {\n  const compas = this.doc.compas\n  if (compas.visible) {\n    compas.montre(false)\n    compas.visible = true // Car a été modifié par montre()\n  }\n  this.doc.compasLeve = new CompasLeve(this.doc, compas.x, compas.y,\n    compas.angle, compas.ecart)\n  if (!immediat && compas.visible) this.doc.compasLeve.montre(true)\n  compas.leve = true\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionLeverCompas.prototype.actionVisible = function () {\n  const visible = this.doc.getInstrumentVisibility(this.doc.compas, this.indice - 1)\n  if (!visible) return false\n  else return this.doc.getCompasStatus(this.indice - 1) === 'couche'\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionMasquer\n/**\n * Action masquant un objet.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {ObjetBase} objet l'objet à masquer\n */\nfunction ActionMasquer (doc, idel, nature, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.objet = this.doc.getElement(idel, nature)\n}\nActionMasquer.prototype = new ActionAncetre()\n/**\n * Fonction exécutant le masque de l'objet objet\n * @param {boolean} immediat true en cas d'exécution immédiate sans passage\n * à l'action suivante\n */\nActionMasquer.prototype.execute = function (immediat) {\n  const el = this.objet\n  if (el != null) el.montre(false)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMasquer.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionMasquerInstrument\n/**\n * Action masquant un instrument.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {InstrumentAncetre} instrument l'instrument à masquer\n */\nfunction ActionMasquerInstrument (doc, instrument, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n}\nActionMasquerInstrument.prototype = new ActionAncetre()\n/**\n * Fonction exécutant l'action et masquanf l'instrument instrument\n * @param {boolean} [immediat=false]\n */\nActionMasquerInstrument.prototype.execute = function (immediat) {\n  const compas = this.doc.compas\n  this.instrument.montre(false)\n  if (compas.leve) this.doc.compasLeve.montre(false)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMasquerInstrument.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionModifierLongueur\n/*\n * Action modifiant la longueur d'un instrument.\n * Pour le moment seulement implémenté pour la règle.\n */\n\n/**\n * Action modifiant la longueur d'un instrument.\n * Pour le moment seulement implémenté pour la règle.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} Le document propriétaire\n * @param {InstrumentAncetre} instrument L'istrument sur lequel a lieu l'action\n * @param {string} longueur La nouvelle longueur\n * @param {string} tempo Le tempo de temporisation\n */\nfunction ActionModifierLongueur (doc, instrument, longueur, tempo) {\n  ActionAncetre.call(this, doc, tempo) // null car action immédiate\n  this.instrument = instrument\n  this.longueur = longueur\n}\nActionModifierLongueur.prototype = new ActionAncetre()\n/**\n * Fonction exécutant l'action et modifiant la longueur de l'instrument\n * @param {boolean} immediat true si l'action est immdiate et on ne passe\n * pas ensuite à l'action suivante\n */\nActionModifierLongueur.prototype.execute = function (immediat) {\n  if (this.instrument === this.doc.regle) {\n    const vis = this.instrument.visible\n    this.instrument.longueur = this.longueur\n    const oldg = this.instrument.g\n    this.instrument.creeg()\n    this.instrument.g.setAttribute('visibility', vis ? 'visible' : 'hidden')\n    this.doc.svg.replaceChild(this.instrument.g, oldg)\n    this.instrument.translate(this.instrument.x, this.instrument.y)\n  }\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionModifierLongueur.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\r\n * Visualiseur InstrumenPoche en Javascript et SVG\r\n * @author Yves Biton <yves.biton@sesamath.net>\r\n * @licence AGPL-3.0-or-later\r\n */\r\nimport ActionAncetre from '../actions/ActionAncetre'\r\nexport default ActionModificationRayon\r\n\r\n/**\r\n * Action modifiant le rayon d'un arc de cercle.\r\n * A ma connaissance n'a été utilisé que pour l'objet Gabarit\r\n * @param {IepDoc} doc\r\n * @param {string} idel L'id de l'objet dont il faut modifier le rayon\r\n * @param {string} rayFin Le rayon à la fin de l'animation\r\n * @param {string} type le type de l'objet\r\n * @param {string} tempo Le tempo de temporisation\r\n * @param {string} pix10 Le nombre de pixels pour la translation par dixième de seconde. Peut être null\r\n * @constructor\r\n */\r\nfunction ActionModificationRayon (doc, idel, rayFin, type, tempo, pix10) {\r\n  ActionAncetre.call(this, doc, tempo)\r\n  this.rayFin = parseFloat(rayFin)\r\n  this.pix10 = (pix10 == null) ? 8 : parseFloat(pix10)\r\n  this.type = type\r\n  this.objet = this.doc.getElement(idel, type)\r\n}\r\nActionModificationRayon.prototype = new ActionAncetre()\r\n\r\n/**\r\n * Fonction lançant la translation de objet sauf si immediat est false\r\n * @param {boolean} [immediat=false]\r\n */\r\nActionModificationRayon.prototype.execute = function (immediat) {\r\n  const objet = this.objet\r\n  if (objet == null) {\r\n    this.doc.actionSuivante(immediat)\r\n    return\r\n  }\r\n  if (!immediat) objet.lanceAnimationModificationRayon(this.rayFin, this.pix10)\r\n  else {\r\n    objet.donneRayon(this.rayFin)\r\n  }\r\n}\r\n/** @inheritDoc */\r\nActionModificationRayon.prototype.actionVisible = function () {\r\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\r\n}\r\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionMontrer\n/**\n * Action montrant un objet.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {ObjetBase} objet l'objet à démasquer\n */\nfunction ActionMontrer (doc, idel, nature, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.objet = this.doc.getElement(idel, nature)\n}\nActionMontrer.prototype = new ActionAncetre()\n/**\n * Fonction démasquant l'élément graphique de l'objet objet\n * @param {boolean} [immediat=false]\n */\nActionMontrer.prototype.execute = function (immediat) {\n  const el = this.objet\n  if (el !== null) el.montre(true)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMontrer.prototype.actionVisible = function () {\n  return !this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionMontrerGraduations\n/**\n * Action montrant ou masquant les graduations de l'instrument instrument\n * Attention : Pour la rèle, cette action s'exerce sur la graduation\n * et pour le rapporteur, sur la graduation interne\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {InstrumentAncetre} instrument l'instrument possédant les graduations\n * @param {boolean} bmontrer true pour montrer les graduations, false pour les cacher\n * @param {number} tempo\n */\nfunction ActionMontrerGraduations (doc, instrument, bmontrer, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n  this.bmontrer = bmontrer\n}\nActionMontrerGraduations.prototype = new ActionAncetre()\n/**\n * Fonction exécutant l'action donc montrant ou masquant les graduations de instrument\n * @param {boolean} immediat Si true,pas de passage à l'action suivante\n */\nActionMontrerGraduations.prototype.execute = function (immediat) {\n  this.instrument.montreGraduations(this.bmontrer)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMontrerGraduations.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionMontrerInstrument\n/**\n * Action montrant un instrument.\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {InstrumentAncetre} instrument l'instrument à montrer\n */\nfunction ActionMontrerInstrument (doc, instrument, x, y, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.x = (x === null) ? null : parseFloat(x)\n  this.y = (y === null) ? null : parseFloat(y)\n  this.instrument = instrument\n}\nActionMontrerInstrument.prototype = new ActionAncetre()\n/**\n * Fonction montrant l'instrument instrument\n * @param {boolean} immediat si rrue on ne passe pas à l'action suivante\n */\nActionMontrerInstrument.prototype.execute = function (immediat) {\n  const compas = this.doc.compas\n  if ((this.x !== null) && (this.y !== null)) this.instrument.translate(this.x, this.y)\n  if ((this.instrument === compas) && !immediat) {\n    if (!compas.leve) compas.montre(true)\n    else this.doc.compasLeve.montre(true)\n    compas.visible = true\n  } else this.instrument.montre(true)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMontrerInstrument.prototype.actionVisible = function () {\n  return !this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionMontrerNombres\n// Cette action agit sur les graduations externes du rapporteur\n/**\n * Action montrant changeant le statut des gradiations externes du rapporteur\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {boolean} bmontrer true si on montre les graduations, false sinon\n * @param {number} tempo\n */\nfunction ActionMontrerNombres (doc, bmontrer, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.bmontrer = bmontrer\n}\nActionMontrerNombres.prototype = new ActionAncetre()\n/**\n * Exécution de l'action changeant le statut des gradiations externes du rapporteur\n * @param {boolean} immediat si true on ne passe pas à l'action suivante\n */\nActionMontrerNombres.prototype.execute = function (immediat) {\n  this.doc.rapporteur.montreGraduationsExternes(this.bmontrer)\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionMontrerNombres.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.doc.rapporteur, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { getTaille } from '../global'\nimport ActionAncetre from '../actions/ActionAncetre'\nimport loadMathJax from '../loadMathJax'\n\n// Modification version MathJax3 : plus besoin de créer un div auxiliaire (cf rev477 pour la version précédente)\n\nexport default ActionNommerPoint\n\n/**\n * Action donnant un nom à un point\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le doculent propriétaire\n * @param {NomPoint} objet  l'objet représentant le nom\n * @param {string} tempo le tempk en dixièmes de seconde (ou null)\n */\nfunction ActionNommerPoint (doc, objet, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n  this.nomPoint = objet\n}\nActionNommerPoint.prototype = new ActionAncetre()\n\n/**\n * Appelée par creeActions, précharge Mathjax si besoin et prépare son div de rendu\n */\nActionNommerPoint.prototype.prepare = function () {\n  if (this.nomPoint.estLatex) {\n    const self = this\n    const width = this.doc.getWidth()\n    const taille = getTaille(this.nomPoint) - 2\n    const ch = this.nomPoint.nom.substring(1)\n    this.ex = taille / 2\n    const options = {\n      em: taille,\n      ex: this.ex,\n      containerWidth: width,\n      display: false\n    }\n    /* global MathJax */\n    if (this.doc.debug) console.log('chargement MathJax dans ActionNommerPoint')\n    loadMathJax()\n      .then(() => MathJax.tex2svgPromise(ch, options))\n      .then((html) => {\n        // html est ici du svg, mais on l'ajoute d'abord dans nomPoint.html\n        self.nomPoint.html = html\n        // et creegLatex va le récupérer pour affecter les bons attributs et mettre ça dans nomPoint.g\n        self.nomPoint.creegLatex()\n        self.setReady()\n      }).catch(error => {\n        console.error(error)\n        alert('Pb Mathjax, impossible d’afficher le point en LaTeX')\n      })\n  } else {\n    this.nomPoint.creeg()\n    this.setReady()\n  }\n}\n\n/**\n * Exécutant de l'action donnant un nom au point\n * @param {boolean} immediat Si true pas de passage à l'action suivante\n */\nActionNommerPoint.prototype.execute = function (immediat) {\n  // if ((this.nomPoint.objet === \"point\") && !this.nomPoint.nomCree) {\n  if (this.nomPoint.objet === 'point') {\n    // this.nomPoint.creeg()\n    this.nomPoint.positionne()\n    const point = this.nomPoint.point\n    if (point.nom !== null) {\n      this.doc.svg.replaceChild(this.nomPoint.g, point.nom.g)\n    } else {\n      this.doc.svg.appendChild(this.nomPoint.g)\n    }\n    point.nom = this.nomPoint\n  }\n  this.nomPoint.g.setAttribute('visibility', 'visible')\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n\n/** @inheritDoc */\nActionNommerPoint.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.nomPoint.point, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionPause\n/**\n * Action faisant une pause dans l'animation de la figure\n * Pour continuer l'action  l'utilisation doit cliquer sur le bouton rouge dans\n * la barre d'icônes\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {string} tempo le tempo de temporisation (ou null)\n */\nfunction ActionPause (doc, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n}\nActionPause.prototype = new ActionAncetre()\n/**\n * Exécute l'action en suspendant l'animation en cours.\n * Pour continuer, l'utilisateur doit cliquer sur le bouton roouge.\n * @param {boolean} [immediat=false]\n */\nActionPause.prototype.execute = function (immediat) {\n  if (!immediat) {\n    this.doc.activeIconeContinuer()\n    this.doc.animationEnCours = false\n  }\n}\n/** @inheritDoc */\nActionPause.prototype.actionVisible = function () {\n  return false\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionRetourner\n/**\n * Action de retournement du compas\n * @extends ActionAncetre\n * @constructor\n * @param {iepDoc} doc\n * @param {number} tempo\n */\nfunction ActionRetourner (doc, tempo) {\n  ActionAncetre.call(this, doc, tempo)\n}\nActionRetourner.prototype = new ActionAncetre()\n\n/**\n * Exécution de l'action de retournement du compas\n * @param {boolean} immediat Si true on ne passe pas à l'action suivante\n */\nActionRetourner.prototype.execute = function (immediat) {\n  this.doc.compas.retourne()\n  if (!immediat) this.doc.actionSuivante(immediat)\n}\n/** @inheritDoc */\nActionRetourner.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.doc.compas, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionRotationInstrument\n/**\n * Action de rotation d'un instrument\n * A noter que le paramètre correspondant à la vitesse s'appelle sens\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {InstrumentAncetre} instrument l'instrument à tourner\n * @param {string} anglefin l'angle de fin\n * @param {string} tempo  le tempo de temporisation (ou null)\n * @param {string} deg10 le nombre de degrés à tourner à chaque dizième de seconde\n * ou null( sera alors de 8)\n */\nfunction ActionRotationInstrument (doc, instrument, anglefin, tempo, deg10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n  this.anglefin = parseFloat(anglefin)\n  this.deg10 = (deg10 == null) ? 8 : Math.abs(parseFloat(deg10))\n}\n\nActionRotationInstrument.prototype = new ActionAncetre()\n/**\n * Fonction lançant l'animation de rotation de l'instrument si immediat est false\n * @param {boolean} immediat\n */\nActionRotationInstrument.prototype.execute = function (immediat) {\n  if (!immediat) this.instrument.lanceAnimationRotation(this.anglefin, this.deg10)\n  else {\n    this.instrument.angle = this.anglefin\n    this.instrument.positionne()\n    if (!immediat) this.doc.actionSuivante(immediat)\n  }\n}\n/** @inheritDoc */\nActionRotationInstrument.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionRotationObjet\n/**\n * Action de rotation d'un objet\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document proprétaire\n * @param {string} idel l'id de l'objet à faire tourner\n * @param {string} anglefin l'angle de fin de rotation\n * @param {string} type le type de l'objet à faire tourner \"image\"\n * ou \"texte\" (la possibilité de tourner un texte n'était pas présnete\n * dans la version Flash)\n * car seules les images ont des objets que l'on peut faire tourner)\n * @param {string} tempo  le tempo de temporisation (peut être null)\n * @param {string} deg10 Le pas d'incrémentation de l'angle par dixième de seconde\n * Vaudra 8 si  null\n */\nfunction ActionRotationObjet (doc, idel, anglefin, type, tempo, deg10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.anglefin = parseFloat(anglefin)\n  this.deg10 = (deg10 == null) ? 8 : Math.abs(parseFloat(deg10))\n  this.objet = this.doc.getElement(idel, type)\n}\nActionRotationObjet.prototype = new ActionAncetre()\n\n/**\n * Fonction lançant l'animation de l'objet seulement si immediat est false;\n * @param {boolean} immediat\n */\nActionRotationObjet.prototype.execute = function (immediat) {\n  const objet = this.objet\n  if (objet == null) {\n    if (!immediat) this.doc.actionSuivante(immediat)\n    return\n  }\n  if (!immediat) objet.lanceAnimationRotation(this.anglefin, this.deg10, this.tempo)\n  else {\n    objet.angle = this.anglefin\n    objet.positionne()\n    // this.doc.actionSuivante(immediat);\n  }\n}\n/** @inheritDoc */\nActionRotationObjet.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionTranslationInstrument\n/**\n * Action de translation d'un instrument\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {InstrumentAncetre} instrument l'instrument à translater\n * @param {string} xfin l'abscisse de fin de translation\n * @param {string} yfin l'ordonnée de fin de translation\n * @param {number} tempo le tempo (peut être null)\n * @param {number} pix10 Le nombre de pixels par dixième de seconde pour la translation\n * Sera\n */\nfunction ActionTranslationInstrument (doc, instrument, xfin, yfin, tempo, pix10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n  this.xfin = parseFloat(xfin)\n  this.yfin = parseFloat(yfin)\n  this.pix10 = (pix10 == null) ? 8 : parseFloat(pix10)\n}\nActionTranslationInstrument.prototype = new ActionAncetre()\n\nActionTranslationInstrument.prototype.execute = function (immediat) {\n  if (isNaN(this.xfin) || isNaN(this.yfin)) this.doc.actionSuivante(immediat)\n  else {\n    if (immediat) this.instrument.translate(this.xfin, this.yfin)\n    else this.instrument.lanceAnimationTranslation(this.xfin, this.yfin, this.pix10)\n  }\n}\n/** @inheritDoc */\nActionTranslationInstrument.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionTranslationObjet\n/**\n * Action translatant un objet\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc\n * @param {string} idel L'id de l'objet à translater\n * @param {string} xfin l'abscisse de fin de translation\n * @param {string} yfin L'ordonnée de fin de translation\n * @param {string} type le type de l'objet\n * @param {string} tempo Le tempo de temporisation\n * @param {string} pix10 Le nombre de pixels pour la translation par dixième de seconde. Peut être null\n */\nfunction ActionTranslationObjet (doc, idel, xfin, yfin, type, tempo, pix10) {\n  ActionAncetre.call(this, doc, tempo)\n  this.xfin = parseFloat(xfin)\n  this.yfin = parseFloat(yfin)\n  this.pix10 = (pix10 == null) ? 8 : parseFloat(pix10)\n  this.type = type\n  this.objet = this.doc.getElement(idel, type)\n}\nActionTranslationObjet.prototype = new ActionAncetre()\n\n/**\n * Fonction lançant la translation de objet sauf si immediat est false\n * @param {boolean} [immediat=false]\n */\nActionTranslationObjet.prototype.execute = function (immediat) {\n  const objet = this.objet\n  if (objet == null) {\n    this.doc.actionSuivante(immediat)\n    return\n  }\n  if (!immediat) objet.lanceAnimationTranslation(this.xfin, this.yfin, this.pix10)\n  else {\n    objet.translate(this.xfin, this.yfin)\n  }\n}\n/** @inheritDoc */\nActionTranslationObjet.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionZoomInstrument\n/**\n * Action zoomant sur un instrument\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc\n * @param {InstrumentAncetre} instrument\n * @param {string} zoomfin Le zoom de fin (de 0 à 100)\n * @param {string} tempo Le tempo de factorisation\n * @param {string} vitesse Facteur de rapidité de l'animation\n */\nfunction ActionZoomInstrument (doc, instrument, zoomfin, tempo, vitesse) {\n  ActionAncetre.call(this, doc, tempo)\n  this.instrument = instrument\n  this.zoomfin = parseFloat(zoomfin) / 100\n  this.vitesse = parseInt(vitesse)\n}\nActionZoomInstrument.prototype = new ActionAncetre()\n\nActionZoomInstrument.prototype.execute = function (immediat) {\n  if (!immediat) this.instrument.lanceAnimationZoom(this.zoomfin, this.vitesse)\n  else {\n    this.instrument.zoomfactor = this.zoomfin\n    this.instrument.positionne()\n    // this.doc.actionSuivante(immediat);\n  }\n}\n/** @inheritDoc */\nActionZoomInstrument.prototype.actionVisible = function () {\n  return this.doc.getInstrumentVisibility(this.instrument, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ActionAncetre from '../actions/ActionAncetre'\nexport default ActionZoomObjet\n/**\n * Action zoomant sur un objet\n * @extends ActionAncetre\n * @constructor\n * @param {IepDoc} doc Le document propriétaire\n * @param {Stirng} idel\n * @param {string} zoomfin L'id de l'objet sur lequel on zoome\n * @param {string} type Le type de l'objet\n * @param {string} tempo Le tempo de factorisation\n * @param {string} vitesse Facteur de vitesse pour l'animation\n */\nfunction ActionZoomObjet (doc, idel, zoomfin, type, tempo, vitesse) {\n  ActionAncetre.call(this, doc, tempo)\n  this.objet = this.doc.getElement(idel, type)\n  this.zoomfin = parseFloat(zoomfin) / 100\n  this.vitesse = vitesse\n  this.type = type\n}\nActionZoomObjet.prototype = new ActionAncetre()\n/**\n * Fonction lançant l'animation de zoom de l'objet sauf si immediat est false\n * @param {boolean} [immediat=false]\n */\nActionZoomObjet.prototype.execute = function (immediat) {\n  const objet = this.objet\n  if (objet == null) {\n    this.doc.actionSuivante(immediat)\n    return\n  }\n  if (!immediat) objet.lanceAnimationZoom(this.zoomfin, this.vitesse)\n  else {\n    objet.zoomfactor = this.zoomfin\n    objet.positionne()\n    // this.doc.actionSuivante(immediat);\n  }\n}\n/** @inheritDoc */\nActionZoomObjet.prototype.actionVisible = function () {\n  return this.doc.getObjectVisibility(this.objet, this.indice - 1)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport IepDoc from './IepDoc'\nexport default IepApp\n\n/**\n * Provoque la fermeture des éventuelles fenêtres popup (à priori onglets du navigateur)\n * contenant le code XML d'une figure (obtenues en cliquant sur l'icône XML)\n * Appelé à la fermeture d'une fenêtre contenant un lecteur\n * @private\n */\nfunction closeAllXMLWindows (iepApp) {\n  iepApp.docs.forEach(doc => {\n    if (doc.windowxml) doc.windowxml.close()\n  })\n}\n\n/**\n * Lecteur d'animations, qui peut gérer plusieurs figures instrumenPoche dans des svg différents\n * @param {Object} [options]\n * @param {boolean} [options.debug] passer true pour avoir des infos de debug en console\n * @constructor\n */\nfunction IepApp (options) {\n  this.debug = Boolean(options && options.debug)\n  if (this.debug) console.log('Mode debug activé')\n  this.docs = []\n  window.addEventListener('unload', closeAllXMLWindows.bind(null, this))\n}\n\n/**\n * Ajoute une animation au lecteur\n * @param {string|Element} svg Le svg (l'élément du dom ou son id) dans lequel va se jouer l'animation\n * @param {string} xml La chaîne XML du script de l'animation\n * @param {boolean} [autoStart=true] Passer false pour ne pas démarrer l'animation dès le chargement\n */\nIepApp.prototype.addDoc = function addDoc (svg, xml, autoStart = true) {\n  if (typeof svg === 'string') svg = document.getElementById(svg)\n  if (!svg) return new Error('svg manquant')\n  if (svg.localName !== 'svg') return new Error('svg incorrect')\n  const options = {\n    autoStart,\n    debug: this.debug\n  }\n  const doc = new IepDoc(svg, xml, options)\n  this.docs.push(doc)\n  svg.iepDoc = doc // Pour que les boutons accèdent au document.\n  return doc\n}\n\n/**\n * Supprime toutes les animations passées au lecteur\n */\nIepApp.prototype.flush = function flush () {\n  // on ferme les fenêtres xml éventuelles\n  this.closeAllXMLWindows()\n  // on vire tous les svg du dom\n  this.docs.forEach(({ svg }) => {\n    if (svg.parentNode) svg.parentNode.removeChild(svg)\n    else console.error('le svg', svg, 'n’a pas de parentNode')\n  })\n  // et on vire les docs de iepApp\n  this.docs = []\n}\n\n/**\n * Retourne les animations du lecteur\n * @return {IepDoc[]}\n */\nIepApp.prototype.getDocs = function getDocs () {\n  return this.docs\n}\n/**\n * Retourne la dernière animation ajoutée (null si addDoc n'a pas été appelé, depuis sa création ou le dernier flush)\n * @return {IepDoc}\n */\nIepApp.prototype.getLastDoc = function getLastDoc () {\n  const length = this.docs.length\n  if (!length) return null\n  return this.docs[length - 1]\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { elimineDoublonsXML, estInstrument, getSvgColor, parseXMLDoc } from '../global'\nimport { svgns } from '../global/constantes'\nimport Vect from '../types/Vect'\nimport Compas from '../instruments/Compas'\nimport Equerre from '../instruments/Equerre'\nimport Rapporteur from '../instruments/Rapporteur'\nimport Regle from '../instruments/Regle'\nimport Requerre from '../instruments/Requerre'\nimport Crayon from '../instruments/Crayon'\nimport ActionCoucherCompas from '../actions/ActionCoucherCompas'\nimport ActionCreation from '../actions/ActionCreation'\nimport ActionEcarterCompas from '../actions/ActionEcarterCompas'\nimport ActionEcrireTexte from '../actions/ActionEcrireTexte'\nimport ActionGlisser from '../actions/ActionGlisser'\nimport ActionLeverCompas from '../actions/ActionLeverCompas'\nimport ActionMasquer from '../actions/ActionMasquer'\nimport ActionMasquerInstrument from '../actions/ActionMasquerInstrument'\nimport ActionModifierLongueur from '../actions/ActionModifierLongueur'\nimport ActionMontrer from '../actions/ActionMontrer'\nimport ActionMontrerGraduations from '../actions/ActionMontrerGraduations'\nimport ActionMontrerInstrument from '../actions/ActionMontrerInstrument'\nimport ActionMontrerNombres from '../actions/ActionMontrerNombres'\nimport ActionNommerPoint from '../actions/ActionNommerPoint'\nimport ActionPause from '../actions/ActionPause'\nimport ActionRotationInstrument from '../actions/ActionRotationInstrument'\nimport ActionRetourner from '../actions/ActionRetourner'\nimport ActionRotationObjet from '../actions/ActionRotationObjet'\nimport ActionTranslationInstrument from '../actions/ActionTranslationInstrument'\nimport ActionTranslationObjet from '../actions/ActionTranslationObjet'\nimport ActionZoomInstrument from '../actions/ActionZoomInstrument'\nimport ActionZoomObjet from '../actions/ActionZoomObjet'\nimport ActionModifierRayon from '../actions/ActionModifierRayon'\nimport Angle from '../objets/Angle'\nimport AngleDroit from '../objets/AngleDroit'\nimport Arc from '../objets/Arc'\nimport Gabarit from '../objets/Gabarit'\nimport Axe from '../objets/Axe'\nimport DemiDroite from '../objets/DemiDroite'\nimport Droite from '../objets/Droite'\nimport Imag from '../objets/Imag'\nimport LigneContinue from '../objets/LigneContinue'\nimport MarqueSegment from '../objets/MarqueSegment'\nimport MarqueSeg from '../objets/MarqueSeg'\nimport NomPoint from '../objets/NomPoint'\nimport Point from '../objets/Point'\nimport Polygone from '../objets/Polygone'\nimport Quadrillage from '../objets/Quadrillage'\nimport Repere from '../objets/Repere'\nimport Segment from '../objets/Segment'\nimport Texte from '../objets/Texte'\n\nexport default IepDoc\n\n// la liste des outils\nconst outils = ['compas', 'equerre', 'rapporteur', 'regle', 'requerre', 'crayon']\n// la liste des icones\nconst icons = ['Reset', 'PrevStep', 'Pause', 'Play', 'Restart', 'NextStep', 'GotoEnd', 'XML']\n\nconst defaultWidth = 800\nconst defaultHeight = 600\n\n/**\n * Retourne une promesse qui sera résolue dans delay (ms)\n * @private\n * @param {number} delay\n * @return {Promise<undefined>}\n */\nconst waitPromise = (delay) => {\n  return new Promise((resolve) => {\n    setTimeout(() => resolve(), delay)\n  })\n}\n\n// des fonctions pour construire du svg (hors prototype car indépendantes de lui)\n\n/**\n * Retourne le svg de l'icône play de la figure\n * Si teinte == \"fonce\", la couleur bleu foncée est employée\n * Si \"teinte == \"clair\", la couleur gris clair est employée\n * @private\n * @param {number} x l'abscisse de l'icône relative à la barre d'icônes\n * @param {number} y l'ordonnée de l'icône relative à la barre d'icônes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconPlay (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icône\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '-5,8 8,0 -5,-8')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne le svg de l'icône pause de la figure\n * Si teinte == \"fonce\", la couleur bleu foncée est employée\n * Si \"teinte == \"clair\", la couleur gris clair est employée\n * @private\n * @param {number} x l'abscisse de l'icône relative à la barre d'icônes\n * @param {number} y l'ordonnée de l'icône relative à la barre d'icônes\n * @param {string} teinte \"fonce\" ou \"clair\"\n */\nfunction getIconPause (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icône\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  let rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', -6)\n  rect.setAttribute('y', -7)\n  rect.setAttribute('width', 3)\n  rect.setAttribute('height', 14)\n  rect.setAttribute('style', 'stroke:white;fill:white;')\n  rect.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(rect)\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', 2)\n  rect.setAttribute('y', -7)\n  rect.setAttribute('width', 3)\n  rect.setAttribute('height', 14)\n  rect.setAttribute('style', 'stroke:white;fill:white;')\n  rect.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(rect)\n  // svg.setAttribute(\"transform\",\"translate(16,16)\");\n  return svg\n}\n\n/**\n * retourne l'icône stepNext de la figure\n * Si teinte == \"fonce\", la couleur bleu foncée est employée\n * Si \"teinte == \"clair\", la couleur gris clair est employée\n * @private\n * @param {number} x l'abscisse de l'icône relative à la barre d'icônes\n * @param {number} y l'ordonnée de l'icône relative à la barre d'icônes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconNextStep (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icône\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', 5)\n  rect.setAttribute('y', -6)\n  rect.setAttribute('width', 3)\n  rect.setAttribute('height', 12)\n  rect.setAttribute('style', 'stroke:white;fill:white;')\n  rect.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(rect)\n  const pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '-7,6 2,0 -7,-6')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne l'icône stepPrev de la figure\n * Si teinte == \"fonce\", la couleur bleu foncée est employée\n * Si \"teinte == \"clair\", la couleur gris clair est employée\n * @private\n * @param {number} x l'abscisse de l'icône relative à la barre d'icônes\n * @param {number} y l'ordonnée de l'icône relative à la barre d'icônes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconPrevStep (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icône\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', -7)\n  rect.setAttribute('y', -6)\n  rect.setAttribute('width', 3)\n  rect.setAttribute('height', 12)\n  rect.setAttribute('style', 'stroke:white;fill:white;')\n  rect.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(rect)\n  const pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '7,6 -2,0 7,-6')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne le svg de l'icône goEnd de la figure\n * Si teinte == \"fonce\", la couleur bleu foncée est employée\n * Si \"teinte == \"clair\", la couleur gris clair est employée\n * @private\n * @param {number} x l'abscisse de l'icône relative à la barre d'icônes\n * @param {number} y l'ordonnée de l'icône relative à la barre d'icônes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconGotoEnd (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icône\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  let pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '-6,7 1,0 -6,-7')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '3,7 10,0 3,-7')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne l'icône goBegin de la figure\n * Si teinte == \"fonce\", la couleur bleu foncée est employée\n * Si \"teinte == \"clair\", la couleur gris clair est employée\n * @private\n * @param {number} x l'abscisse de l'icône relative à la barre d'icônes\n * @param {number} y l'ordonnée de l'icône relative à la barre d'icônes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconReset (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icône\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  let pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '6,7 -1,0 6,-7')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  pol = document.createElementNS(svgns, 'polygon')\n  pol.setAttribute('points', '-3,7 -10,0 -3,-7')\n  pol.setAttribute('style', 'stroke:white;fill:white;')\n  pol.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(pol)\n  return svg\n}\n\n/**\n * Retourne le svg de l'icône restart de la figure\n * Si teinte == \"fonce\", la couleur bleu foncée est employée\n * Si \"teinte == \"clair\", la couleur gris clair est employée\n * @private\n * @param {number} x l'abscisse de l'icône relative à la barre d'icônes\n * @param {number} y l'ordonnée de l'icône relative à la barre d'icônes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconRestart (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icône\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const path = document.createElementNS(svgns, 'path')\n  path.setAttribute('d', 'M 0 -8 A 8 8 -90 1 1 -8 0')\n  path.setAttribute('style', 'stroke:white;stroke-width:3;fill:none;')\n  path.setAttribute('marker-end', 'url(#markerarrow')\n  path.setAttribute('transform', 'translate(16,16)')\n  svg.appendChild(path)\n  return svg\n}\n\n/**\n * Retourne le svg de l'icône XML de la figure\n * Si teinte == \"fonce\", la couleur bleu foncée est employée\n * Si \"teinte == \"clair\", la couleur gris clair est employée\n * @private\n * @param {number} x l'abscisse de l'icône relative à la barre d'icônes\n * @param {number} y l'ordonnée de l'icône relative à la barre d'icônes\n * @param {string} teinte \"fonce\" ou \"clair\"\n * @returns {SVGElement}\n */\nfunction getIconXml (x, y, teinte) {\n  const svg = document.createElementNS(svgns, 'svg')\n  svg.setAttribute('x', x)\n  svg.setAttribute('y', y)\n  svg.setAttribute('width', 32)\n  svg.setAttribute('height', 32)\n  const circ = document.createElementNS(svgns, 'circle')\n  // le cercle entourant l'icône\n  svg.appendChild(circ)\n  circ.setAttribute('cx', 16)\n  circ.setAttribute('cy', 16)\n  circ.setAttribute('r', 15)\n  const filtre = (teinte === 'fonce') ? 'filtrebleu' : 'filtregris'\n  circ.setAttribute('style', 'stroke:none;' + 'fill:url(#radial' + teinte + '); filter:url(#' + filtre + ');')\n  const text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('XML'))\n  text.setAttribute('x', 16)\n  text.setAttribute('y', 21)\n  text.setAttribute('style', 'font-family:Arial;font-size:9pt;fill:white;text-anchor:middle')\n  svg.appendChild(text)\n  return svg\n}\n\n// fonctions pour récupérer des attributs\n\n/**\n * Retourne l'attribut id d'une action\n * @private\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getId (el) {\n  return el.getAttribute('id')\n}\n\n/**\n * Retourne l'attribut abscisse de trait d'une action\n * @private\n * @param {Element} el un des elements retourné par this.xmldoc.getElementsByTagName(\"action\")\n * @returns {string}\n */\nfunction getAbs (el) {\n  return el.getAttribute('abscisse')\n}\n\n/**\n * Retourne l'attribut ordonnée de trait d'une action\n * @private\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getOrd (el) {\n  const ord = el.getAttribute('ordonnee')\n  return (ord === null) ? el.getAttribute('ordonnée') : ord\n}\n\n/**\n * Retourne l'attribut couleur d'une action\n * @private\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {SvgColor} (si l'élément n'avait pas l'attribut couleur ce sera black)\n */\nfunction getCouleur (el) {\n  const coul = el.getAttribute('couleur')\n  return coul ? getSvgColor(coul) : 'black'\n}\n/**\n * Retourne l'attribut couleur_cadre de l'action\n * @private\n * @param {Element} el\n * @return {null|SvgColor}\n */\nfunction getCouleurCadre (el) {\n  const coul = el.getAttribute('couleur_cadre')\n  return coul ? getSvgColor(coul) : null\n}\n\n/**\n * Retourne l'attribut couleur_fond d'une action\n * @private\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {SvgColor|null}\n */\nfunction getCouleurFond (el) {\n  const coul = el.getAttribute('couleur_fond')\n  return coul ? getSvgColor(coul) : null\n}\n\n/**\n * Retourne l'attribut épaisseur d'une action (1 si y'en avait pas)\n * @private\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getEpaisseur (el) {\n  const ep = el.getAttribute('epaisseur')\n  return (ep === null || parseInt(ep) === 0) ? '1' : ep\n}\n\n/**\n * Retourne l'attribut opacité de trait d'une action (100 si y'en avait pas)\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string} opacité ('100' par défaut)\n */\nfunction getOpaciteTrait (el) {\n  const op = el.getAttribute('opacite')\n  return (op === null) ? '100' : op\n}\n\n/**\n * Retourne l'attribut opacité de fond d'une action\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getOpaciteFond (el) {\n  const op = el.getAttribute('opacite')\n  if (op === null) return '50'\n  return op\n}\n\n/**\n * Retourne l'attribut le style de trait d'une action\n * @private\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getStyleTrait (el) {\n  const st = el.getAttribute('pointille')\n  return (st == null) ? 'continu' : st\n}\n\n/**\n * Retourne l'attribut style de flèce d'une action\n * @private\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nfunction getStyle (el) {\n  const st = el.getAttribute('style')\n  return (st == null) ? 'normal' : st\n}\n\n/**\n * Animation InstrumenPoche (avec son svg associé)\n * @constructor\n * @param {SVGElement} svg  Le SVG contenant la figure\n * @param {string} xml La chaîne contenant le code XML décrivant la figure.\n * @param {Object} [options]\n * @param {boolean} [options.debug=false] passer true pour avoir des infos de debug en console\n * @param {boolean} [options.autoStart=false] passer true pour démarrer l'animation dès le chargement\n */\nfunction IepDoc (svg, xml, options) {\n  /**\n   * L'élément svg du DOM\n   * @type {SVGElement}\n   */\n  this.svg = svg\n  // pour la compatibilité ascendante, on traite le 3e argument booléen comme autostart\n  if (typeof options === 'boolean') {\n    /** @type {boolean} */\n    this.autoStart = options\n    options = {}\n  } else {\n    if (typeof options !== 'object') options = {}\n    this.autoStart = Boolean(options.autoStart)\n  }\n  /** @type {boolean} */\n  this.debug = Boolean(options.debug)\n  /**\n   * Pointera sur la fenêtre contenant le code xml\n   * @type {Window}\n   */\n  this.windowxml = null\n  let ch = xml\n  // On ajoute l'en-tête xml si elle a été ommise.\n  if (ch.search(/<?xml/gi) === -1) ch = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' + ch\n  // On élimine les <action_ suivis de chiffres\n  ch = ch.replace(/<action[_]\\d*/gi, '<action')\n  // On élimine les remarques html\n  ch = ch.replace(/<!--.*-->/g, '')\n  // On corrige les oublis d'espaces et les -- dans les attributs\n  ch = ch.replace(/(=\"[^\"]*\")([^ ])/g, '$1 $2').replace(/--/g, '')\n  // On corrige les éventuels << ou >>\n  ch = ch.replace(/<</g, '<').replace(/>>/g, '>')\n  // Certains auteurs ont mis des <actiontempo= sans espace ou autre\n  ch = ch.replace(/<action(\\w)/gi, '<action $1')\n  // Les commentaires peuvent un attribut texte ce qui pose des problèmes dans elimineDoublonsXML\n  // On les remplace par un attribut texteCommentaire\n  ch = ch.replace(/<commentaire\\s*texte\\s*=/gi, '<commentaire texteCommentaire =')\n  // On corrige les attributs en doublon\n  ch = elimineDoublonsXML(ch)\n  // On élimine l'en-tête qui contient parfois des caractères bizarres\n  /**\n   * La string xml du doc\n   * @type {string}\n   */\n  this.codexml = ch // Mémorisé pour pouvoir être affiche quand on clique sur le bouton XML\n  // (on veut la version avant le nettoyage qui suit pour conserver la déclaration xml et les attributs du tag INSTRUMENPOCHE)\n\n  // on corrige le tag ouvrant et fermant, parfois folklorique dans les scripts existants\n  // Pas de > dans la recherche sur le tag fermant car certains auteurs se sont trompés sur la balise de fin\n  const chunks = (/<\\s*INSTRUMENPOCHE[^>]*>(.*)<\\s*\\/INSTRUMENPOCHE/si).exec(ch)\n  if (!chunks) throw Error('script xml invalide')\n  /**\n   * Le doc xml sans l'en-tête <?xml …> et avec les tags INSTRUMENPOCHE ouvrant / fermant nettoyés\n   * @type {string}\n   */\n  this.chdoc = '<INSTRUMENPOCHE>' + chunks[1] + '</INSTRUMENPOCHE>'\n\n  /**\n   * La liste des actions (initialisée par creeActions)\n   * @type {ActionCreation[]}\n   * @private\n   */\n  this.actions = [] // Un tableau qui contiendra toutes les actions de la figure.\n  /**\n   * Une liste des éléments graphiques de type objet graphique traités par la figure.\n   * Chaque élément sera identifié par un n° d'id et par son type.\n   * Lorsqu'un élément de même id et de même nature qu'un élément déjà existant est créé,\n   * lors de l'exécution de l'action de création, son élément graphique remplacera celui\n   * de l'élement déjà existant dans le DOM du svg de la figure\n   * @type {ObjetBase[]}\n   * @private\n   */\n  this.elements = []\n  /** @type {boolean} */\n  this.compasRetourne = false\n  // On crée les instruments dès le début car certains objet créés ont besoin de connaître\n  // l'état des instruments lors de leur création\n  /**\n   * @type {CompasLeve}\n   * @private\n   */\n  this.compasLeve = null\n  /**\n   * @type {Compas}\n   * @private\n   */\n  this.compas = new Compas(this)\n  /**\n   * @type {Equerre}\n   * @private\n   */\n  this.equerre = new Equerre(this)\n  /**\n   * @type {Rapporteur}\n   * @private\n   */\n  this.rapporteur = new Rapporteur(this)\n  /**\n   * @type {Regle}\n   * @private\n   */\n  this.regle = new Regle(this)\n  /**\n   * @type {Requerre}\n   * @private\n   */\n  this.requerre = new Requerre(this)\n  /**\n   * @type {Crayon}\n   * @private\n   */\n  this.crayon = new Crayon(this)\n  /**\n   * Le script xml parsé\n   * @type {XMLDocument}\n   */\n  this.xmldoc = parseXMLDoc(this.chdoc)\n  /**\n   * Liste des éléments action du xml\n   * @type {Element[]}\n   * @private\n   */\n  this.tabact = this.xmldoc.getElementsByTagName('action')\n  /** @type {boolean} */\n  this.started = false\n  /** @type {boolean} */\n  this.animationEnCours = true // Sera mis à false pour le pas à pas\n\n  // viewBox, on regarde si on trouve un tag <viewBox> dans le xml,\n  // si oui on prend les valeurs qu'il précise (si elles sont valides)\n  // sinon nos valeurs par défaut\n  const vb = {\n    x: 0,\n    y: 0,\n    width: defaultWidth,\n    height: defaultHeight\n  }\n  // à propos de viewbox & viewport\n  // https://la-cascade.io/comprendre-svg-viewbox-et-viewport/\n  // https://developer.mozilla.org/fr/docs/Web/SVG/Attribute/viewBox\n  // https://la-cascade.io/comprendre-svg-viewbox/\n  // https://la-cascade.io/comprendre-svg-preserveaspectratio/\n  const viewBoxElts = this.xmldoc.getElementsByTagName('viewBox')\n  if (viewBoxElts && viewBoxElts.length) {\n    if (viewBoxElts.length > 1) console.error(Error('Il y a plusieurs tags viewBox dans le script, on prend le premier'), viewBoxElts)\n    const xmlViewBox = viewBoxElts[0]\n    // et pour chaque attribut on regarde si il est précisé\n    Object.keys(vb).forEach(attr => {\n      const value = Number(xmlViewBox.getAttribute(attr))\n      // pour x & y on tolère les négatifs, mais pas pour width et height\n      if (Number.isFinite(value) && (attr.length < 2 || value > 0)) vb[attr] = value\n    })\n  }\n  // sur un écran très large, on réduit la largeur initiale du div conteneur pour essayer de tout faire rentrer dans l'écran\n  // (sinon avec le preserveAspectRatio et 98% en largeur et hauteur, ça aligne le svg sur largeur et ajoute du scroll vertical)\n  if (\n    window.innerHeight > vb.height * 0.6 && // tout pourrait rentrer en hauteur (avec un zoom de 0.6 ça reste acceptable)\n    (vb.width / vb.height) < (window.innerWidth / window.innerHeight) // l'écran est plus large (en format) que l'animation\n  ) {\n    // on réduit le div parent en largeur pour que l'animation puisse rentrer entièrement à l'écran,\n    // et éviter de trop l'agrandir en largeur\n    // try/catch au cas où parentNode serait pas très catholique\n    try {\n      svg.parentNode.style.width = (window.innerHeight / vb.height * vb.width) + 'px'\n    } catch (error) {\n      console.error(error)\n    }\n  }\n  // on ajoute une taille minimale au conteneur (qui fera apparaître des ascenseur si on réduit trop)\n  try {\n    svg.parentNode.style.minWidth = (vb.width / 2) + 'px'\n    svg.parentNode.style.minHeight = (vb.height / 2) + 'px'\n  } catch (error) {\n    console.error(error)\n  }\n  // on mémorise le viewBox initial\n  this.initialViewBox = vb\n  svg.setAttribute('viewBox', `${vb.x} ${vb.y} ${vb.width} ${vb.height}`)\n  svg.setAttribute('preserveAspectRatio', 'xMinYMin meet')\n\n  /**\n   * indice de la première action qui sera exécutée\n   * @type {number}\n   */\n  this.indiceActionEnCours = 0\n  this.creeActions()\n\n  // Les événements souris pour pouvoir gérer les déplacements de la barre d'icônes\n  const t = this\n  svg.addEventListener('mousemove', function (ev) { t.mousemoveListenerSvg(ev, ev.clientX, ev.clientY) }, false)\n  svg.addEventListener('mouseup', function () { t.mouseupListener() }, false)\n  svg.addEventListener('mouseleave', function () { t.mouseleaveListener() }, false)\n  svg.addEventListener('touchmove', function (ev) { t.mousemoveListenerSvg(ev, ev.touches[0].pageX, ev.touches[0].pageY) }, false)\n  svg.addEventListener('touchend', function () { t.mouseupListener() }, false)\n  svg.addEventListener('touchcancel', function () { t.mouseupListener() }, false)\n  svg.addEventListener('touchleave', function () { t.mouseleaveListener() }, false)\n  if (this.debug) console.log('iepDoc instancié :', this)\n}\n\n/**\n * Change la viewBox du svg\n * @param {Object} viewBox\n * @param {number} viewBox.x\n * @param {number} viewBox.y\n * @param {number} viewBox.width\n * @param {number} viewBox.height\n * @throws {TypeError} s'il manque l'une des 4 propriétés\n */\nIepDoc.prototype.setViewBox = function setViewBox (viewBox) {\n  if (typeof viewBox !== 'object' || Object.keys(this.initialViewBox).some(prop => !Number.isFinite(viewBox[prop]))) {\n    throw TypeError('paramètre invalide (il faut passer un objet { x: number, y: number, width: number, height: number })')\n  }\n  const { x, y, width, height } = viewBox\n  // on limite le zoom, mais on ne throw pas d'erreur (sinon à force de cliquer sur + on arrive à descendre sous les 10 et ça génère un rapport bugsnag)\n  if (width < 10 || height < 10) return console.error(Error('width et height doivent être supérieur à 10'))\n  // facteur de zoom absolu\n  const zoomFactor = this.initialViewBox.width / width\n  this.svg.setAttribute('viewBox', `${x} ${y} ${width} ${height}`)\n  this.barreIcones.setAttribute('transform', `translate(${x + this.xbarre / zoomFactor}, ${y + this.ybarre / zoomFactor}) scale(${1 / zoomFactor})`)\n}\n\n/**\n * Zoom (in ou out) dans le svg\n * @param {number} zoomFactor Facteur de zoom relatif à l'état actuel (1.5 grossi de 50%, et 0.8 réduit de 20%), sauf pour 1 où l'animation est remise dans son état initial (du chargement)\n * @param {number} [xCenter] Abscisse du centre du zoom (si non fourni ce sera le milieu de l'affichage actuel)\n * @param {number} [yCenter] Ordonnée du centre du zoom (si non fourni ce sera le milieu de l'affichage actuel)\n */\nIepDoc.prototype.zoom = function zoom (zoomFactor, xCenter, yCenter) {\n  if (typeof zoomFactor !== 'number' || zoomFactor < 1e-6 || zoomFactor > 1e6) throw Error(`zoomFactor invalide : ${typeof zoomFactor} ${zoomFactor}`)\n  // on reset si on passe un zoomFactor de 1\n  if (zoomFactor === 1) return this.setViewBox(this.initialViewBox)\n  // sinon faut faire des calculs\n  let { x, y, width, height } = this.getViewBox()\n  if (!Number.isFinite(xCenter)) xCenter = x + width / 2\n  if (!Number.isFinite(yCenter)) yCenter = y + height / 2\n  width = Math.round(width / zoomFactor)\n  height = Math.round(height / zoomFactor)\n  x = xCenter - width / 2\n  y = yCenter - height / 2\n  this.setViewBox({ x, y, width, height })\n}\n\n/**\n * Retourne true seulement si tous les objets de la figure sont bien chargés\n * @returns {boolean}\n */\nIepDoc.prototype.isReadyAll = function isReadyAll () {\n  if (this.debug) {\n    const pasPretes = this.actions.filter(action => !action.isReady)\n    if (pasPretes.length) console.log(`${pasPretes.length} actions pas encore prêtes (sur ${this.actions.length})`)\n    else console.log(`Les ${this.actions.length} actions sont prêtes`)\n  }\n  return this.actions.every(action => action.isReady)\n}\n\n/**\n * Rappellera callback quand tout sera prêt ou qu'on aura attendu maxWait ms\n * @param {function} callback Sera appelée avec une erreur si maxWait est atteint\n * @param {number} maxWait délai max à attendre, en s\n */\nIepDoc.prototype.whenReady = function whenReady (callback, maxWait = 30) {\n  const wait = () => setTimeout(check, 100)\n  const check = () => {\n    // on teste toutes les 100ms, jusqu'à ce que ce soit prêt ou que maxWait soit atteint\n    if (this.isReadyAll()) return callback()\n    if ((Date.now() - start) < maxWait * 1000) return wait()\n    callback(Error(`Après ${maxWait}s d’attente l’animation n’est pas prête, échec du chargement…`))\n  }\n  const start = Date.now()\n  check()\n}\n\n/**\n * Retourne une promesse qui sera résolue quand le doc sera prêt ou qu'on aura attendu maxWait (dans ce cas rejet avec l'erreur)\n * @param {number} maxWait délai max à attendre, en s\n * @return {Promise<undefined>}\n */\nIepDoc.prototype.getReadyPromise = function getReadyPromise (maxWait = 30) {\n  if (this.isReadyAll()) return Promise.resolve()\n  return new Promise((resolve, reject) => {\n    this.whenReady((error) => {\n      if (error) reject(error)\n      else resolve(this)\n    }, maxWait)\n  })\n}\n\n/**\n * Retourne la largeur en pixel du svg (dans son système de coordonnées, pas ce qu'il occupe à l'écran)\n * @return {number}\n */\nIepDoc.prototype.getWidth = function getWidth () {\n  return this.getViewBox().width\n}\n/**\n * Retourne la hauteur en pixel du svg (dans son système de coordonnées, pas ce qu'il occupe à l'écran)\n * @return {number}\n */\nIepDoc.prototype.getHeight = function getHeight () {\n  return this.getViewBox().height\n}\n/**\n * Retourne les 4 valeurs de la viewBox du svg (toutes en number).\n * Si y'a pas de viewBox ou une viewBox invalide ça impose la viewBox par défaut (et retourne ses valeurs)\n * @return {{x: number, width: number, y: number, height: number}}\n */\nIepDoc.prototype.getViewBox = function getViewBox () {\n  try {\n    const viewBox = this.svg.getAttribute('viewBox')\n    if (viewBox) {\n      // on cast en Number et vérifie qu'on a aucun NaN\n      const values = viewBox.split(' ').map(Number).filter(n => !Number.isNaN(n))\n      if (values.length === 4) {\n        const [x, y, width, height] = values\n        // on vérifie quand même que width et height sont valides\n        if (width > 0 && height > 0) return { x, y, width, height }\n      }\n    }\n    console.error(Error('viewBox invalide'), viewBox)\n  } catch (error) {\n    console.error(error)\n  }\n  // on rectifie les conneries pour que ce qu'on retourne corresponde à la réalité\n  this.svg.setAttribute('viewBox', `0 0 ${defaultWidth} ${defaultHeight}`)\n  return {\n    x: 0,\n    y: 0,\n    width: defaultWidth,\n    height: defaultHeight\n  }\n}\n\n/**\n * Retourne au début et joue l'animation en accéléré (pas à pas avec delay ms entre chaque pas)\n * @param delay\n * @param callback\n */\nIepDoc.prototype.goFast = function goFast (delay = 100, callback) {\n  const self = this\n  const nextStep = () => {\n    self.nextStep()\n    if (self.indiceActionEnCours < self.actions.length) {\n      setTimeout(() => nextStep(), delay)\n    } else if (callback) {\n      callback()\n    }\n  }\n  this.getReadyPromise().then(() => {\n    if (self.animationEnCours) {\n      self.pause()\n      return waitPromise(500)\n    }\n    return Promise.resolve()\n  }).then(() => {\n    self.reset()\n    nextStep()\n  }).catch(error => {\n    console.error(error)\n    alert(error.message)\n  })\n}\n\n/**\n * Crée tous les éléments graphiques des aactions de création de la figure.\n * Seules les actions de créations d'objets ont une fonction creegElement faisant quelquechose\n * @private\n */\nIepDoc.prototype.creeElementsGraphiques = function creeElementsGraphiques () {\n  this.actions.forEach(action => action.creegElement())\n}\n\n/**\n * Réinitilise la position de tous les instruments et les cache\n * @private\n */\nIepDoc.prototype.initialiseOutils = function initialiseOutils () {\n  outils.forEach(outil => {\n    this[outil].initialisePosition()\n    this[outil].montre(false)\n  })\n  this.compas.leve = false\n}\n\n/**\n * Retire du DOM les éléments graphiques des outils et les recrée de façon à ce que les outils\n * soient dans le DOM après les éléments graphiques des objets de la figure.\n * @private\n */\nIepDoc.prototype.recreeOutils = function recreeOutils () {\n  outils.forEach(outil => {\n    this[outil].updateg()\n    this[outil].montre(false)\n  })\n  this.compasLeve = null\n}\n\n/**\n * Fonction lancée après le chargement complet de la figure.\n * Toutes les actions de création d'objet de la figure créent leur propre élément graphique dans le DOM du svg\n * qu'elles stockent dans une variable this.g. Ces éléments sont initialeùent tous cachés.\n * Ensuite on recrée dans le DOM les éléments graphiques des outils pour qu'ils soient situés après les objets créés.\n * Puis on crée les icônes et on les initialise à leur état initial  pour le démarrage de la figure.\n * @private\n */\nIepDoc.prototype.init = function init () {\n  this.started = true\n  this.creeElementsGraphiques()\n  this.recreeOutils()\n  this.creeIcones()\n  if (this.autoStart) {\n    this.montreIcones(['Pause'])\n    this.play()\n  } else {\n    this.montreIcones(['Play'])\n  }\n}\n\n/**\n * Crée les icônes de la figure.\n * @private\n */\nIepDoc.prototype.creeIcones = function creeIcones () {\n  // Toutes les images seront contenues dans un g element appelé barreIcones\n  const nbIcones = 8\n  const t = this\n  this.barreIcones = document.createElementNS(svgns, 'g')\n  this.creeElementsPourIcones()\n  // reset\n  this.iconReset = getIconReset(0, 0, 'fonce')\n  this.iconResetGris = getIconReset(0, 0, 'clair')\n  this.iconReset.onclick = this.reset.bind(this)\n  this.barreIcones.appendChild(this.iconReset)\n  this.barreIcones.appendChild(this.iconResetGris)\n  // prevStep\n  this.iconPrevStep = getIconPrevStep(32, 0, 'fonce')\n  this.iconPrevStepGris = getIconPrevStep(32, 0, 'clair')\n  this.iconPrevStep.onclick = function () { t.prevStep() }\n  this.barreIcones.appendChild(this.iconPrevStep)\n  this.barreIcones.appendChild(this.iconPrevStepGris)\n  // pause\n  this.iconPause = getIconPause(64, 0, 'fonce')\n  this.iconPauseGris = getIconPause(64, 0, 'clair')\n  this.iconPause.onclick = this.pause.bind(this)\n  this.barreIcones.appendChild(this.iconPause)\n  this.barreIcones.appendChild(this.iconPauseGris)\n  // play\n  this.iconPlay = getIconPlay(96, 0, 'fonce')\n  this.iconPlayGris = getIconPlay(96, 0, 'clair')\n  this.iconPlay.onclick = this.play.bind(this)\n  this.barreIcones.appendChild(this.iconPlay)\n  // continue, icône rouge à activer quand on rencontre une pause\n  // Cette icône ne sera visible et active que quand on rencontre une action de pause\n  this.iconContinue = getIconPlay(96, 0, 'rouge')\n  this.iconContinue.setAttribute('visibility', 'hidden')\n  this.iconContinue.onclick = this.continue.bind(this)\n  this.barreIcones.appendChild(this.iconContinue)\n  this.barreIcones.appendChild(this.iconPlayGris)\n  // restart\n  this.iconRestart = getIconRestart(128, 0, 'fonce')\n  this.iconRestartGris = getIconRestart(128, 0, 'clair')\n  this.iconRestart.onclick = this.restart.bind(this)\n  this.barreIcones.appendChild(this.iconRestart)\n  this.barreIcones.appendChild(this.iconRestartGris)\n  // nextStep\n  this.iconNextStep = getIconNextStep(160, 0, 'fonce')\n  this.iconNextStepGris = getIconNextStep(160, 0, 'clair')\n  this.iconNextStep.onclick = function () { t.nextStep() }\n  this.barreIcones.appendChild(this.iconNextStep)\n  this.barreIcones.appendChild(this.iconNextStepGris)\n  // gotoEnd\n  this.iconGotoEnd = getIconGotoEnd(192, 0, 'fonce')\n  this.iconGotoEndGris = getIconGotoEnd(192, 0, 'clair')\n  this.iconGotoEnd.onclick = function () { t.gotoEnd() }\n  this.barreIcones.appendChild(this.iconGotoEnd)\n  this.barreIcones.appendChild(this.iconGotoEndGris)\n  // xml\n  this.iconXML = getIconXml(224, 0, 'fonce')\n  this.iconXMLGris = getIconXml(224, 0, 'clair')\n  this.iconXML.onclick = function () { t.showXml() }\n  this.barreIcones.appendChild(this.iconXML)\n  this.barreIcones.appendChild(this.iconXMLGris)\n\n  this.hauteurBarre = 32\n  this.demiLargeurBarre = nbIcones * 16\n  // this.xbarre et this.ybarre contiennent les coordonnées initiales de la barre d'outils dans le SVG\n  this.xbarre = 50 // pas trop à gauche à cause des boutons de zoom éventuels\n  this.ybarre = 4\n  this.barreIcones.setAttribute('transform', `translate(${this.xbarre}, ${this.ybarre})`)\n  this.svg.appendChild(this.barreIcones)\n  // Ajout des listeners de souris sur la barre d'icônes (pour gérer son déplacement)\n  this.isDraggingBarre = false // flag mis à true au mousedown|touch et lu au move\n  this.barreIcones.addEventListener('mousedown', function (ev) { t.mousedownListenerBarre(ev.clientX, ev.clientY) }, false)\n  this.barreIcones.addEventListener('mousemove', function (ev) { t.mousemoveListenerBarre(ev.clientX, ev.clientY) }, false)\n  // C'est le SVG qui gère les événements mouseup\n  this.barreIcones.addEventListener('touchstart', function (ev) { t.mousedownListenerBarre(ev.touches[0].pageX, ev.touches[0].pageY) }, false)\n  this.barreIcones.addEventListener('touchmove', this.mousemoveListenerBarre.bind(this), false)\n  // C'est le svg qui gère les événements touhcancel et touchend\n  // this.barreIcones.addEventListener(\"touchcancel\",function() {t.onmouseupbarre()},false);\n  // Initialisation de la position relative de la barre d'outils\n  // this.deltax et this.deltay contiendront de décalage relatif de la barre d'outils par rapport\n  // à sa position initiale lorsqu'on la fait glisser.\n  this.deltax = 0\n  this.deltay = 0\n}\n\n/**\n * Fonction appelée quand on clique ou fait un appui tactile sur la barre d'icônes de la figure\n * @param {number} xmouse l'abscisse du point cliqué par la souris\n * @param {number} ymouse l'ordonnée du point cliqué par la souris\n * @private\n */\nIepDoc.prototype.mousedownListenerBarre = function mousedownListenerBarre (xmouse, ymouse) {\n  if (this.animationEnCours) return\n  this.isDraggingBarre = true\n  this.xcapturebarre = xmouse\n  this.ycapturebarre = ymouse\n}\n\n/**\n * Fonction appelée au survol de la barre d'icônes par la souris ou du pointeur tactive\n * @private\n */\nIepDoc.prototype.mousemoveListenerBarre = function mousemoveListenerBarre () {\n  if (this.animationEnCours) {\n    this.barreIcones.style.cursor = 'default'\n    this.isDraggingBarre = false\n  } else {\n    this.barreIcones.style.cursor = 'pointer'\n  }\n}\n\n/**\n * Appelé au survol du svg par la souris ou au déplacement d'un pointeur tactile\n * @private\n * @param {event} ev\n * @param {number} xmouse l'abscisse pointée par la souris\n * @param {number} ymouse l'ordonnée pointée par la souris\n */\nIepDoc.prototype.mousemoveListenerSvg = function mousemoveListenerSvg (ev, xmouse, ymouse) {\n  if (this.isDraggingBarre) {\n    const w = this.getWidth()\n    const h = this.getHeight()\n    const dx = xmouse - this.xcapturebarre\n    const dy = ymouse - this.ycapturebarre\n    const deltax = this.deltax + dx\n    const deltay = this.deltay + dy\n    const xpos = this.xbarre + deltax\n    const ypos = this.ybarre + deltay\n    if ((xpos <= w - 2 * this.demiLargeurBarre) && (xpos >= 0) &&\n            (ypos >= 0) && (ypos <= h - this.hauteurBarre)) {\n      this.barreIcones.setAttribute('transform', 'translate(' + xpos + ',' + ypos + ')')\n      this.deltax = deltax\n      this.deltay = deltay\n      this.xcapturebarre = xmouse\n      this.ycapturebarre = ymouse\n    }\n    ev.preventDefault() // Pour éviter que des éléments texte soient sélectionnés en bougeant la souris\n  }\n  // ev.preventDefault(); // Pour éviter que des éléments texte soient sélectionnés en bougeant la souris\n  // Abandonné car alors on e peut pls zoomer ou dézoomer sur périphérique mobile\n}\n\n/**\n * Fonction appelée lorsque le bouton de la souris est relâché sur le svg\n * @private\n */\nIepDoc.prototype.mouseupListener = function mouseupListener () {\n  this.isDraggingBarre = false\n}\n\n/**\n * Fonction appelée quand on relâche le bouton de la souris sur la figure\n * @private\n */\nIepDoc.prototype.mouseleaveListener = function mouseleaveListener () {\n  this.isDraggingBarre = false\n}\n\n/**\n * Ouvre une fenêtre (ou onglet) affichant le code XML de la figure\n */\nIepDoc.prototype.showXml = function showXml () {\n  if (this.windowxml == null) this.windowxml = this.popup()\n  else this.windowxml.focus()\n}\n\n/**\n * Montre les icones passées en argument et grise les autres\n * @param {string[]} icones\n */\nIepDoc.prototype.montreIcones = function montreIcones (icones) {\n  icons.forEach(icone => {\n    const bvisible = icones.includes(icone)\n    const nom = 'icon' + icone\n    if (this[nom]) {\n      this[nom].setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n      this[nom + 'Gris'].setAttribute('visibility', bvisible ? 'hidden' : 'visible')\n    } else {\n      console.error(`L’icone ${nom} n’existe pas`)\n    }\n  })\n}\n\n/**\n * Active l'icône rouge Continuer et désactive les autres\n * @private\n */\nIepDoc.prototype.activeIconeContinuer = function activeIconeContinuer () {\n  this.montreIcones(['XML'])\n  // et on vire le play gris pour mettre continuer à sa place\n  this.iconPlayGris.setAttribute('visibility', 'hidden')\n  this.iconContinue.setAttribute('visibility', 'visible')\n}\n\n/**\n * Saute à la fin de l'animation\n */\nIepDoc.prototype.gotoEnd = function gotoEnd () {\n  this.animationEnCours = false\n  this.initialise()\n  this.montreIcones(['Reset', 'PrevStep', 'Restart', 'XML'])\n  this.executeJusque(this.actions.length - 1)\n  this.indiceActionEnCours = this.actions.length\n}\n\n/**\n * Lance la lecture de l'animation\n */\nIepDoc.prototype.play = function play () {\n  this.animationEnCours = true\n  this.montreIcones(['Pause'])\n  if (this.actions[this.indiceActionEnCours]) {\n    this.actions[this.indiceActionEnCours].execute(false)\n  } else {\n    console.error(Error(`Pas d'action ${this.indiceActionEnCours}`), this.actions)\n  }\n}\n\n/**\n * Reprend la lecture de l'animation (après une action de pause contenue dans l'animation, pas un clic sur pause, ≠ play)\n */\nIepDoc.prototype.continue = function continueAnimation () {\n  if (this.indiceActionEnCours === this.actions.length) {\n    this.gotoEnd()\n    return\n  }\n  this.iconContinue.setAttribute('visibility', 'hidden')\n  this.montreIcones(['Pause'])\n  this.animationEnCours = true\n  this.indiceActionEnCours++\n  if (this.actions[this.indiceActionEnCours]) {\n    this.actions[this.indiceActionEnCours].execute(false)\n  } else {\n    console.error(Error(`Pas d'action ${this.indiceActionEnCours}`), this.actions)\n  }\n}\n\n/**\n * Réinitialise l'animation (la remet au début en mode pause, utiliser restart pour rejouer du début), et son zoom\n */\nIepDoc.prototype.reset = function reset () {\n  this.animationEnCours = false\n  this.initialise()\n  this.montreIcones(['Play', 'NextStep', 'GotoEnd', 'XML'])\n  this.indiceActionEnCours = 0\n  this.zoom(1)\n}\n\n/**\n * Redémarre l'animation à partir du début\n */\nIepDoc.prototype.restart = function restart () {\n  if (this.animationEnCours) {\n    this.animationEnCours = false\n    // on attend un peu pour que l'animation en cours se termine ? pourquoi 100ms ?\n    setTimeout(this.restart.bind(this), 100)\n    return\n  }\n  this.initialise()\n  this.indiceActionEnCours = 0\n  this.zoom(1)\n  this.play()\n}\n\n/**\n * Met la lecture de l'animation en pause\n */\nIepDoc.prototype.pause = function pause () {\n  this.animationEnCours = false\n  // On laisse 500ms pour finir l'animation en cours.\n  setTimeout(() => this.montreIcones(['Reset', 'PrevStep', 'Play', 'Restart', 'NextStep', 'GotoEnd', 'XML']), 500)\n}\n\n/**\n * Passe au pas suivant (en mode pas à pas)\n */\nIepDoc.prototype.nextStep = function nextStep () {\n  const nbActions = this.actions.length\n  this.animationEnCours = false\n  if (this.indiceActionEnCours < nbActions) {\n    if (this.actions[this.indiceActionEnCours].actionVisible()) this.indiceActionEnCours++\n    else this.indiceActionEnCours = this.indiceProchaineActionVisible(this.indiceActionEnCours) + 1\n    this.executeJusque(this.indiceActionEnCours - 1)\n  }\n  const derniereAction = this.indiceActionEnCours === this.actions.length\n  const iconsToShow = ['Reset', 'PrevStep', 'Restart', 'XML']\n  if (derniereAction) this.montreIcones(iconsToShow)\n  else this.montreIcones(iconsToShow.concat(['NextStep', 'GotoEnd', 'Play']))\n}\n\n/**\n * Passe au pas précédent (en mode pas à pas)\n */\nIepDoc.prototype.prevStep = function prevStep () {\n  this.animationEnCours = false\n  // this.indiceActionEnCours--;\n  this.indiceActionEnCours = this.indicePrecedenteActionVisible(this.indiceActionEnCours - 1)\n  if (this.indiceActionEnCours > 0) this.executeJusque(this.indiceActionEnCours - 1)\n  const iconsToShow = ['Play', 'NextStep', 'GotoEnd', 'XML']\n  const premiereAction = this.indiceActionEnCours === 0\n  if (premiereAction) this.montreIcones(iconsToShow)\n  else this.montreIcones(iconsToShow.concat(['Reset', 'PrevStep']))\n}\n\n/**\n * Réinitialise l'animation :\n * - cache tous les éléments graphiques de la figure,\n * - réinitialise tous les outils\n * - réinitialise la position de tous les objets ou instruments qui peuvent être translatés, tournés ou zoomés (points et images)\n * @private\n */\nIepDoc.prototype.initialise = function initialise () {\n  let i, el\n  const svg = this.svg\n  for (i = 0; i < svg.childNodes.length; i++) {\n    el = svg.childNodes[i]\n    if (el !== this.barreIcones) {\n      try { // Pour compatibilité avec explorer\n        svg.childNodes[i].setAttribute('visibility', 'hidden')\n      } catch (error) {\n        console.error(error)\n      }\n    }\n  }\n  for (i = 0; i < this.actions.length; i++) {\n    const action = this.actions[i]\n    if (action instanceof ActionCreation) action.objet.initialisePosition()\n  }\n  this.initialiseOutils()\n}\n\n/**\n * Retourne la visibilité de l'instrument après l'exécution de l'action d'indice indaction\n * @private\n * @param {InstrumentAncetre} instrument\n * @param {number} indaction\n * @returns {boolean}\n */\nIepDoc.prototype.getInstrumentVisibility = function getInstrumentVisibility (instrument, indaction) {\n  if (indaction === -1) return false\n  let action\n  let visible = false\n  for (let i = 0; i <= indaction; i++) {\n    action = this.actions[i]\n    if (action instanceof ActionMontrerInstrument) {\n      if (action.instrument === instrument) visible = true\n    } else if (action instanceof ActionMasquerInstrument) {\n      if (action.instrument === instrument) visible = false\n    }\n  }\n  return visible\n}\n\n/**\n * Retourne la visibilité de l'objet après l'exécution de l'action d'indice indaction\n * @private\n * @param {ObjetBase} objet\n * @param {number} indaction\n * @returns {boolean}\n */\nIepDoc.prototype.getObjectVisibility = function getObjectVisibility (objet, indaction) {\n  if (indaction === -1) return false\n  let action\n  let visible = false\n  for (let i = 0; i <= indaction; i++) {\n    action = this.actions[i]\n    if (action instanceof ActionMontrer) {\n      if (action.objet === objet) visible = true\n    } else if (action instanceof ActionMasquer) {\n      if (action.objet === objet) visible = false\n    }\n  }\n  return visible\n}\n\n/**\n * Fonction donnant l'état du compas (levé ou couché) après l'exécution\n * de l'action d'indice indaction.\n * Si le compas est couché, renvoie \"couche\", s'il est leve, renvoie \"leve\"\n * @private\n * @param {number} indaction\n * @returns {string}\n */\nIepDoc.prototype.getCompasStatus = function getCompasStatus (indaction) {\n  if (indaction === -1) return 'couche'\n  let couche = true\n  let action\n  for (let i = 0; i <= indaction; i++) {\n    action = this.actions[i]\n    if (action instanceof ActionCoucherCompas) {\n      couche = true\n    } else if (action instanceof ActionLeverCompas) {\n      couche = false\n    }\n  }\n  return couche ? 'couche' : 'leve'\n}\n\n/**\n * Retourne l'indice de la prochaine action qui aura une action visible sur la figure\n * à partir de l'indice ind\n * Si aucune action visible ne figure après ind, renvoie this.actions.length\n * @private\n * @param {number} ind\n * @returns {number}\n */\nIepDoc.prototype.indiceProchaineActionVisible = function indiceProchaineActionVisible (ind) {\n  if (ind >= this.actions.length) return this.actions.length - 1\n  for (let i = ind; i < this.actions.length; i++) {\n    if (this.actions[i].actionVisible()) return i\n  }\n  return this.actions.length - 1\n}\n\n/**\n * Retourne l'indice de la précédene action qui aura une action visible sur la figure\n * à partir de l'indice ind\n * Si aucune action visible ne figure avant ind, renvoie 0\n * @private\n * @param {number} ind\n * @returns {number}\n */\nIepDoc.prototype.indicePrecedenteActionVisible = function indicePrecedenteActionVisible (ind) {\n  if (ind < 0) return 0\n  if (ind === this.actions.length) ind--\n  for (let i = ind; i >= 0; i--) {\n    if (this.actions[i].actionVisible()) return i\n  }\n  return 0\n}\n\n/**\n * Fonction montrant les instruments à leur étape de visibilité à l'étape n\n * @private\n * @param {number} n indice de la dernière action exécutée\n */\nIepDoc.prototype.montreInstrumentsEtape = function montreInstrumentsEtape (n) {\n  let visible = this.getInstrumentVisibility(this.compas, n)\n  if (this.compas.leve) this.compasLeve.montre(visible)\n  else this.compas.montre(visible)\n  visible = this.getInstrumentVisibility(this.crayon, n)\n  this.crayon.montre(visible)\n  visible = this.getInstrumentVisibility(this.equerre, n)\n  this.equerre.montre(visible)\n  visible = this.getInstrumentVisibility(this.rapporteur, n)\n  this.rapporteur.montre(visible)\n  visible = this.getInstrumentVisibility(this.regle, n)\n  this.regle.montre(visible)\n  visible = this.getInstrumentVisibility(this.requerre, n)\n  this.requerre.montre(visible)\n}\n\n/**\n * Exécute sans animation toutes les actions de la figure jusqu'à l'indice indfin compris\n * @private\n * @param {number} indfin\n */\nIepDoc.prototype.executeJusque = function executeJusque (indfin) {\n  if (indfin >= this.actions.length) return\n  this.initialise()\n  this.initialiseOutils()\n  this.animationEnCours = false\n  for (let i = 0; i <= indfin; i++) {\n    this.actions[i].execute(true) // true pour que l'exécution soit immédiate\n  }\n  this.montreInstrumentsEtape(indfin)\n}\n\n/**\n * Ajoute un élément, s'il y a déjà un élément avec cet id et cet objet on le remplace\n * @private\n * @param {ObjetBase} element\n */\nIepDoc.prototype.addElement = function addElement (element) {\n  const i = this.elements.findIndex(el => el.id === element.id && el.objet === element.objet)\n  if (i !== -1) this.elements[i] = element\n  else this.elements.push(element)\n}\n\n/**\n * Fonction appelée dans le cas où on est sûr que la liste doc.elements ne contient pas\n * déjà un élément de même id et de même nature que element\n * @private\n * @param {ObjetBase} element\n * @throws {Error} si y'en avait un\n */\nIepDoc.prototype.pushElement = function pushElement (element) {\n  if (this.elements.some(el => el.id === element.id && el.objet === element.objet)) throw Error(`Il y a déjà un élément ${element.id} désignant le même objet`)\n  this.elements.push(element)\n}\n\n/**\n * Retourne l'objet de elements d'id égale à id s'il y en a une et sinon null\n * Attention : Le quadrillage est le seul objet a ne pas avoir d'id et il ne peut y en avoir qu'un par figure\n * @private\n * @param {string} id\n * @param {string} nature\n * @returns {ObjetBase|null}\n */\nIepDoc.prototype.getElement = function getElement (id, nature) {\n  const found = this.elements.find(el => {\n    if (el.objet === nature) {\n      if (nature === 'quadrillage') return true // on regarde pas l'id dans ce cas\n      return el.id === id\n    }\n    return false\n  })\n  // found peut être undefined, on veut retourner null dans ce cas\n  return found || null\n}\n\n/**\n * Remplaçe l'élément d'id id par e s'il y en a un, sinon retourne false\n * S'il n'y a pas délément d'id id renvoie false\n * @private\n * @param {string} id\n * @param {ObjetBase} e\n * @returns {boolean}\n */\nIepDoc.prototype.setElement = function setElement (id, e) {\n  const i = this.elements.findIndex(el => el.id === id)\n  if (i !== -1) {\n    this.elements[i] = e\n    return true\n  }\n  return false\n}\n\n/**\n * Ajoute l'action à la liste\n * @private\n * @private\n * @param {ActionCreation} action\n */\nIepDoc.prototype.ajouteAction = function ajouteAction (action) {\n  // On donne à action un indice pour qu'elle sache quelle est son rang dans la liste\n  // Elle pourra alors indiquer si son action sur la figure est visible ou non\n  action.indice = this.actions.length\n  this.actions.push(action)\n}\n\n/**\n * Crée toutes les actions de la figure\n * @private\n * @param {number} ind\n */\nIepDoc.prototype.creeActions = function creeActions () {\n  let ind, el, at, ato, objet, action, forme, xcrayon, ycrayon, id,\n    angle, sens, vitesse, abs, ord, cibles, tempo, len, ecart, v1, echelle, point, cible\n  for (ind = 0; ind < this.tabact.length; ind++) {\n    el = this.tabact[ind]\n    id = getId(el)\n    at = el.getAttribute('mouvement')\n    tempo = el.getAttribute('tempo')\n    try {\n      let abscisse_bas_droite, ecartAngle // faut éviter de déclarer dans un case directement, on le fait dans le bloc parent (eslint no-case-declarations)\n      switch (at) {\n        case 'creer':\n          ato = el.getAttribute('objet')\n          // Si on a déjà créé un objet avec le même id c'est une erreur et on saute la création\n          if (this.getElement(id, ato) !== null) {\n            console.error(`L'id ${id} existe déjà, action creer ignorée`, ato)\n            break\n          }\n\n          if (ato != null) {\n            switch (ato) {\n              case 'point':\n                objet = new Point(this, id, parseFloat(getAbs(el)), parseFloat(getOrd(el)),\n                  getCouleur(el), getEpaisseur(el))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'angle':\n                objet = new Angle(this, id, getAbs(el), getOrd(el), el.getAttribute('rayon'),\n                  el.getAttribute('angle1'), el.getAttribute('angle2'), getCouleur(el), getEpaisseur(el),\n                  getOpaciteFond(el), el.getAttribute('forme'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'angle_droit':\n                objet = new AngleDroit(this, id, el.getAttribute('abscisse_sommet'), el.getAttribute('ordonnee_sommet'),\n                  el.getAttribute('abscisse_inter'), el.getAttribute('ordonnee_inter'), getCouleur(el), getEpaisseur(el))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'longueur':\n                objet = new MarqueSegment(this, id, getAbs(el), getOrd(el),\n                  getCouleur(el), getEpaisseur(el),\n                  el.getAttribute('forme'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'marque':\n                objet = new MarqueSeg(this, id, el.getAttribute('idSeg'),\n                  getCouleur(el), getEpaisseur(el),\n                  el.getAttribute('forme'), el.getAttribute('rayon'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'texte':\n                objet = new Texte(this, id, getAbs(el), getOrd(el), getCouleur(el), el.getAttribute('taille'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'repere':\n                objet = new Repere(this, el.getAttribute('hauteur'), el.getAttribute('largeur'),\n                  el.getAttribute('haut'), el.getAttribute('gauche'), el.getAttribute('Xgrad'),\n                  el.getAttribute('Ygrad'), el.getAttribute('Xmin'), el.getAttribute('Xmax'),\n                  el.getAttribute('Ymin'), el.getAttribute('Ymax'), getCouleur(el),\n                  el.getAttribute('grille'), el.getAttribute('axes'), el.getAttribute('etiquettes'))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'quadrillage':\n                abscisse_bas_droite = el.getAttribute('abscisse_bas_droite')\n                if (abscisse_bas_droite != null) { // Syntaxe non documentée dans la doc\n                  abscisse_bas_droite = parseFloat(abscisse_bas_droite) / 30\n                  const ordonnee_bas_droite = parseFloat(el.getAttribute('ordonnee_bas_droite')) / 30\n                  const abscisse_haut_gauche = parseFloat(el.getAttribute('abscisse_haut_gauche')) / 30\n                  const ordonnee_haut_gauche = parseFloat(el.getAttribute('ordonnee_haut_gauche')) / 30\n                  objet = new Quadrillage(\n                    this,\n                    el.getAttribute('quadrillage'),\n                    String(ordonnee_bas_droite - ordonnee_haut_gauche),\n                    String(abscisse_bas_droite - abscisse_haut_gauche),\n                    ordonnee_haut_gauche,\n                    abscisse_haut_gauche,\n                    getCouleur(el)\n                  )\n                  action = new ActionCreation(this, 'quadrillageIEP', objet, tempo)\n                } else {\n                  objet = new Quadrillage(this, el.getAttribute('quadrillage'), el.getAttribute('hauteur'),\n                    el.getAttribute('largeur'), el.getAttribute('haut'), el.getAttribute('gauche'), getCouleur(el))\n                }\n                action = new ActionCreation(this, 'quadrillageIEP', objet, tempo)\n                break\n\n              case 'axe':\n                objet = new Axe(this, el.getAttribute('pente'), el.getAttribute('largeur'),\n                  el.getAttribute('haut'), el.getAttribute('gauche'), el.getAttribute('distanceBord'),\n                  el.getAttribute('Xgrad'), el.getAttribute('Xmin'), el.getAttribute('Xmax'), getCouleur(el))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              case 'gabarit':\n                ecartAngle = el.getAttribute('ecart_angle')\n                if (ecartAngle === null) ecartAngle = '-30'\n                objet = new Gabarit(this, id, el.getAttribute('abscisse'), el.getAttribute('ordonnee'), el.getAttribute('rayon'),\n                  ecartAngle, getCouleur(el), getEpaisseur(el), getCouleurFond(el), getOpaciteTrait(el))\n                action = new ActionCreation(this, id, objet, tempo)\n                break\n\n              default:\n                // Pour ce que j'aurais oublié d'implémenter\n                console.error(`objet ${objet} inconnu => création ignorée`)\n                action = null\n            }\n\n            if (action) {\n              this.ajouteAction(action)\n              action.setReady()\n            }\n          }\n          break\n        case 'montrer':\n          ato = el.getAttribute('objet')\n          if (estInstrument(ato)) {\n            abs = el.getAttribute('abscisse')\n            ord = el.getAttribute('ordonnee')\n            action = new ActionMontrerInstrument(this, this[ato], abs, ord, tempo)\n            if (((ato === 'crayon') || (ato === 'compas')) && (abs != null) && (ord != null)) this[ato].translate(parseFloat(abs), parseFloat(ord))\n          } else action = new ActionMontrer(this, id, ato, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'masquer':\n          ato = el.getAttribute('objet')\n          if (estInstrument(ato)) action = new ActionMasquerInstrument(this, this[ato], tempo)\n          else action = new ActionMasquer(this, id, ato, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'tracer':\n          ato = el.getAttribute('objet')\n          cible = el.getAttribute('cible')\n          if (cible != null) {\n            objet = this.getElement(cible, 'point') // Le point vers lequel on veut translater l'objet\n            abs = objet.xcons\n            ord = objet.ycons\n          } else {\n            abs = parseFloat(getAbs(el))\n            ord = parseFloat(getOrd(el))\n          }\n          switch (ato) {\n            case 'crayon':\n              forme = el.getAttribute('forme')\n              xcrayon = this.crayon.x\n              ycrayon = this.crayon.y\n              id = getId(el)\n              switch (forme) {\n                case null: // Cas d'un segment\n                  if (isNaN(abs) || isNaN(ord)) { // Cas d'une forme libre pas déclarée\n                    objet = new LigneContinue(this, id, this.crayon.x, this.crayon.y, el.getAttribute('abscisses'),\n                      el.getAttribute('ordonnees'), getCouleur(el), getEpaisseur(el), getOpaciteTrait(el),\n                      getStyleTrait(el), getStyle(el))\n                    len = objet.abs.length\n                    this.crayon.translate(objet.abs[len - 1], objet.ord[len - 1])\n                  } else {\n                    objet = new Segment(this, id, xcrayon, ycrayon, abs, ord, getCouleur(el),\n                      getEpaisseur(el), getOpaciteTrait(el), getStyleTrait(el), getStyle(el))\n                    this.crayon.translate(abs, ord)\n                  }\n                  break\n                case 'droite': // Cas d'une droite\n                  if (isNaN(abs) || isNaN(ord)) break\n                  objet = new Droite(this, id, xcrayon, ycrayon, abs, ord, getCouleur(el),\n                    getEpaisseur(el), getOpaciteTrait(el), getStyleTrait(el), getStyle(el))\n                  this.crayon.translate(abs, ord)\n                  break\n                case 'demidroite': // Cas d'une demi-droite\n                  if (isNaN(abs) || isNaN(ord)) break\n                  objet = new DemiDroite(this, id, xcrayon, ycrayon, abs, ord, getCouleur(el),\n                    getEpaisseur(el), getOpaciteTrait(el), getStyleTrait(el), getStyle(el))\n                  this.crayon.translate(abs, ord)\n                  break\n                case 'polygone':\n                  cibles = el.getAttribute('cibles')\n                  if (cibles === null) {\n                    objet = new Polygone(this, id, el.getAttribute('abscisses'),\n                      el.getAttribute('ordonnees'), getCouleur(el), getEpaisseur(el),\n                      getCouleurFond(el), el.getAttribute('opacite'))\n                  } else {\n                    let abs = ''\n                    let ord = ''\n                    cibles.split(',').forEach((elt, i) => {\n                      const sep = (i === 0) ? '' : ','\n                      const obj = this.getElement(elt, 'point')\n                      abs += sep + obj.xcons\n                      ord += sep + obj.ycons\n                    })\n                    objet = new Polygone(this, id, abs, ord,\n                      getCouleur(el), getEpaisseur(el),\n                      getCouleurFond(el), el.getAttribute('opacite'))\n                  }\n                  len = objet.abs.length\n                  this.crayon.translate(objet.abs[len - 1], objet.ord[len - 1])\n                  break\n                case 'libre':\n                  objet = new LigneContinue(this, id, this.crayon.x, this.crayon.y, el.getAttribute('abscisses'),\n                    el.getAttribute('ordonnees'), getCouleur(el), getEpaisseur(el), getOpaciteTrait(el),\n                    getStyleTrait(el), getStyle(el))\n                  len = objet.abs.length\n                  this.crayon.translate(objet.abs[len - 1], objet.ord[len - 1])\n              }\n              vitesse = el.getAttribute('vitesse')\n              if (vitesse == null) vitesse = '4'\n              action = new ActionCreation(this, getId(el), objet, tempo, vitesse)\n              this.ajouteAction(action)\n              action.setReady()\n              break\n            case 'trait':\n              vitesse = el.getAttribute('vitesse')\n              if (vitesse === null) vitesse = 10000 // Instantané si vitesse pas précisé\n              objet = new Segment(this, id, el.getAttribute('abscisse1'), el.getAttribute('ordonnee1'),\n                el.getAttribute('abscisse2'), el.getAttribute('ordonnee2'), getCouleur(el),\n                getEpaisseur(el), getOpaciteTrait(el), getStyleTrait(el), getStyle(el))\n              action = new ActionCreation(this, getId(el), objet, tempo, vitesse) // Pas d'animation pour les traits\n              this.ajouteAction(action)\n              action.setReady()\n              break\n            case 'compas':\n              objet = new Arc(this, id, this.compas.x, this.compas.y, this.compas.ecart,\n                this.getAngle(el, 'debut'), this.getAngle(el, 'fin'), getCouleur(el), getEpaisseur(el), getOpaciteTrait(el),\n                getStyleTrait(el))\n              vitesse = el.getAttribute('sens')\n              if (vitesse == null) vitesse = '8'\n              action = new ActionCreation(this, getId(el), objet, tempo, vitesse)\n              this.ajouteAction(action)\n              action.setReady()\n              break\n            case 'angle_droit': // Certains scripts utilisent tracer au lieu de créer pour les angles droits ...\n              objet = new AngleDroit(this, id, el.getAttribute('abscisse_sommet'), el.getAttribute('ordonnee_sommet'),\n                el.getAttribute('abscisse_inter'), el.getAttribute('ordonnee_inter'), getCouleur(el), getEpaisseur(el))\n              action = new ActionCreation(this, getId(el), objet, tempo, vitesse)\n              this.ajouteAction(action)\n              action.setReady()\n              break\n          }\n          break\n        case 'rotation':\n          ato = el.getAttribute('objet')\n          sens = el.getAttribute('sens')\n          if (estInstrument(ato)) {\n            cible = el.getAttribute('cible')\n            // Au cas ou un auteur a mis à la fois un attribut cible et un attribut angle,\n            // C'est l'attribut angle qui semble l'emporter (constaté par des tests).\n            if ((cible != null) && (el.getAttribute('angle') === null)) {\n              objet = this.getElement(cible, 'point') // Le point vers lequel on veut translater l'objet\n              abs = objet.xcons\n              ord = objet.ycons\n              v1 = new Vect(this[ato].x, this[ato].y, abs, ord)\n              if (v1.presqueNul()) angle = 0\n              else angle = -v1.angle()\n            } else {\n              if (ato === 'compas') angle = this.getAngle(el, 'angle')\n              else angle = el.getAttribute('angle')\n            }\n            action = new ActionRotationInstrument(this, this[ato], angle, tempo, sens)\n          } else {\n            // On vérifie que l'action est cohérente (que l'objet cible existe)\n            if (this.getElement(id, ato) === null) action = null\n            else {\n              angle = el.getAttribute('angle')\n              action = new ActionRotationObjet(this, id, angle, ato, tempo, sens)\n            }\n          }\n          if (action !== null) {\n            this.ajouteAction(action)\n            action.setReady()\n          }\n          break\n        case 'translation':\n          ato = el.getAttribute('objet')\n          cible = el.getAttribute('cible')\n          // Au cas où on a spécifié abscisse et ordonnée et cible, cible aa priorité\n          if (cible != null) {\n            objet = this.getElement(cible, 'point') // Le point vers lequel on veut translater l'objet\n            abs = objet.xcons\n            ord = objet.ycons\n          } else {\n            abs = parseFloat(getAbs(el))\n            ord = parseFloat(getOrd(el))\n          }\n          vitesse = el.getAttribute('vitesse')\n          if (estInstrument(ato)) {\n            this[ato].x = abs\n            this[ato].y = ord\n            action = new ActionTranslationInstrument(this, this[ato], abs, ord, tempo, vitesse)\n          } else {\n            // On vérifie que l'action est cohérente\n            if (this.getElement(id, ato) === null) action = null\n            else {\n              // Dans le cas où on translate un point il faut modifier ses champs xcons et ycons\n              // pour que tout objet ultérieur l'utilisant comme cible soit correctement initialisé\n              if (ato === 'point') {\n                point = this.getElement(id, 'point')\n                point.xcons = abs\n                point.ycons = ord\n              }\n              action = new ActionTranslationObjet(this, id, abs, ord, ato, tempo, vitesse)\n            }\n          }\n          if (action !== null) {\n            this.ajouteAction(action)\n            if ((ato === 'crayon') || (ato === 'compas')) { this[ato].translate(abs, ord) }\n            action.setReady()\n          }\n          break\n        case 'zoom':\n          ato = el.getAttribute('objet')\n          vitesse = el.getAttribute('vitesse')\n          if (estInstrument(ato)) {\n            echelle = el.getAttribute('echelle')\n            this[ato].zoomfactor = parseFloat(echelle) / 100\n            action = new ActionZoomInstrument(this, this[ato], echelle, tempo, vitesse)\n          } else {\n            // On ne peut zoomer que sur un texte ou une image\n            if ((ato === 'texte' || (ato === 'image'))) action = new ActionZoomObjet(this, id, el.getAttribute('echelle'), ato, tempo, vitesse)\n            else action = null\n          }\n          if (action !== null) {\n            this.ajouteAction(action)\n            action.setReady()\n          }\n          break\n        case 'ecarter':\n          cible = el.getAttribute('cible')\n          if (cible != null) {\n            objet = this.getElement(cible, 'point') // Le point vers lequel on veut translater l'objet\n            v1 = new Vect(this.compas.x, this.compas.y, objet.xcons, objet.ycons)\n            ecart = v1.norme()\n          } else ecart = parseFloat(el.getAttribute('ecart')) * this.compas.zoomfactor\n          this.compas.ecart = ecart\n          action = new ActionEcarterCompas(this, ecart, tempo, el.getAttribute('vitesse'))\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'lever':\n          action = new ActionLeverCompas(this, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'coucher':\n          action = new ActionCoucherCompas(this, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n\n        case 'masquer_nombres':\n          action = new ActionMontrerNombres(this, false, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'montrer_nombres':\n          action = new ActionMontrerNombres(this, true, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'graduations':\n          ato = el.getAttribute('objet')\n          action = new ActionMontrerGraduations(this, this[ato], true, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'vide':\n          ato = el.getAttribute('objet')\n          action = new ActionMontrerGraduations(this, this[ato], false, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'retourner':\n          this.compasRetourne = !this.compasRetourne\n          action = new ActionRetourner(this, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'glisser':\n          action = new ActionGlisser(this, el.getAttribute('abscisse'), tempo, el.getAttribute('vitesse'))\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'chargement':\n          // Attention, pour l'image, pas d'appel de creeAction(ind+1)\n          // car c'est une fonction de callBack qui s'en charge une fois l'image chargée\n          objet = new Imag(this, id, el.getAttribute('url'))\n          objet.prepareAction()\n          // Pas de action.setReady car il faut attendre que la figure soit chargée\n          break\n        case 'ecrire': // Texte\n          action = new ActionEcrireTexte(\n            this,\n            id,\n            getCouleur(el),\n            el.getAttribute('taille'),\n            el.getAttribute('texte'),\n            el.getAttribute('style'),\n            getCouleurFond(el),\n            el.getAttribute('opacite_fond'),\n            getCouleurCadre(el),\n            el.getAttribute('epaisseur_cadre'),\n            el.getAttribute('marge'),\n            el.getAttribute('marge_gauche'),\n            el.getAttribute('marge_droite'),\n            el.getAttribute('marge_haut'),\n            el.getAttribute('marge_bas'),\n            tempo\n          )\n          this.ajouteAction(action)\n          action.prepare()\n          break\n        case 'nommer':\n          // on regarde si le point à nommer a été créé sinon erreur de script\n          if (this.getElement(id, 'point') !== null) {\n            // Dans certains script on nommait un point avec une chaîne vide ce qui n'a pas de sens.\n            const nomPoint = el.getAttribute('nom')\n            if (nomPoint !== '') {\n              objet = new NomPoint(this, id, getAbs(el), getOrd(el),\n                nomPoint, getCouleur(el))\n              action = new ActionNommerPoint(this, objet, tempo)\n              this.ajouteAction(action)\n              action.prepare()\n            }\n          }\n          break\n        case 'pause':\n          action = new ActionPause(this, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n        case 'modifier_longueur':\n          ato = el.getAttribute('objet')\n          action = new ActionModifierLongueur(this, this[ato], el.getAttribute('longueur'), tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n          // Modification du rayon d'un gabarit\n        case 'modifier_rayon':\n          ato = el.getAttribute('objet')\n          action = new ActionModifierRayon(this, id, el.getAttribute('rayon'), ato, tempo)\n          this.ajouteAction(action)\n          action.setReady()\n          break\n      }\n    } catch (error) {\n      console.error(error)\n      // On ne fait rien si xml incorrect\n    }\n  }\n  // Une fois les actions créées on attend que les éléments asynchrones soient prêts pour continuer\n  this.getReadyPromise()\n    .then(this.init.bind(this))\n    .catch(error => {\n      console.error(error)\n      window.alert(error.message)\n    })\n}\n\n/**\n * Si immediat est true, les actions sont exécutées immédiatement, sans animation et sans temporisation\n * @private\n * @param {boolean} immediat\n */\nIepDoc.prototype.execute = function execute (immediat) {\n  this.indiceActionEnCours = 0\n  this.actions[0].execute(immediat)\n}\n\n/**\n * Fonction appelée lorsqu'une action a été exécutée pour passer à l'exécution suivante.\n * Si immediat est true, on retourne sans rien faire\n * Si animationECours en false, on revient sans rien faire (pour arrêter une animation en cours)\n * Si l'action.tempo n'est pas nul, on attend action.tempo millièmes de seconde avant de passer à l'action suivante\n * indiceActionEnCours est l'indice de la prochaine action à exécuter\n * @private\n * @param {boolean} [immediat=false]\n */\nIepDoc.prototype.actionSuivante = function actionSuivante (immediat) {\n  immediat = Boolean(immediat)\n  if (!this.animationEnCours && !immediat) {\n    // if (this.indiceActionEnCours != this.actions.length-1) this.indiceActionEnCours++;\n    return\n  } // Pas de passage à l'action suivante pour le mode pas à pas.\n  const action = this.actions[this.indiceActionEnCours]\n  if ((action.tempo === null) || immediat) {\n    this.passageActionSuivante(immediat)\n  } else {\n    setTimeout(this.passageActionSuivante.bind(this, immediat), action.tempo)\n  }\n}\n\n/**\n * Fonction appelée par actionSuivante pour passer à l'action suivante\n * indiceActionEnCours est l'indice de la prochaine action à exécuter\n * @private\n * @param {boolean} [immediat=false]\n */\nIepDoc.prototype.passageActionSuivante = function passageActionSuivante (immediat) {\n  // IL peut arriver qu'on arrive ici alors qu'on a cliqué pour arrêter une animation, cliqué rapidement\n  // pour aller à la fin alors que l'animation n'était pas finie...\n  if (this.indiceActionEnCours >= this.actions.length) return\n  if (this.indiceActionEnCours !== this.actions.length - 1) {\n    this.indiceActionEnCours++\n    this.actions[this.indiceActionEnCours].execute(immediat)\n  } else {\n    this.indiceActionEnCours++\n    this.montreIcones(['Reset', 'PrevStep', 'Restart', 'XML'])\n    this.animationEnCours = false\n  }\n}\n\n/**\n * Retourne l'attribut angle d'une action\n * @private\n * @param {Element} el element retourné par this.xmldoc.getElementsByTagName(\"action\")[]\n * @returns {string}\n */\nIepDoc.prototype.getAngle = function getAngle (el, attribute) {\n  const a = el.getAttribute(attribute)\n  if (a == null) return null\n  if (this.compasRetourne) return String(parseFloat(a) + 180)\n  return a\n}\n\n/**\n * Fonction rajoutant dans le svg parent des définitions defs qui serot utilisées\n * plusieurs fois dans les icônes (radialGradiant et marker pour la flèche de l'icône restart.\n * On les mets dans le svg barreIcones pour qu'il ne soient pas effacés lors de initialise()\n * @private\n */\nIepDoc.prototype.creeElementsPourIcones = function creeElementsPourIcones () {\n  let defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.radialGradiant('#9999FF', '#000099', 'radialfonce'))\n  this.svg.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.radialGradiant('#CCCCCC', '#666666', 'radialclair'))\n  this.svg.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.radialGradiant('#FF9999', '#FF0000', 'radialrouge'))\n  this.svg.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.markerArrow('markerarrow'))\n  this.barreIcones.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.filtreEclairageIcone('filtrebleu'))\n  this.barreIcones.appendChild(defs)\n  defs = document.createElementNS(svgns, 'defs')\n  defs.appendChild(this.filtreEclairageIcone('filtregris'))\n  this.barreIcones.appendChild(defs)\n}\n\n/**\n * Retourne un radialGradiant utilisé pour le dessin des icônes\n * @param {string} clair la couleur claire de gradiant\n * @param {string} fonce  la couleur focée du gradiant\n * @param {string} id l'id du gradiant\n * @private\n * @returns {SVGRadialGradientElement}\n */\nIepDoc.prototype.radialGradiant = function radialGradiant (clair, fonce, id) {\n  const rg = document.createElementNS(svgns, 'radialGradient')\n  rg.setAttribute('id', id)\n  let stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '0%')\n  stop.setAttribute('style', 'stop-color:' + fonce + ';')\n  rg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '80%')\n  stop.setAttribute('style', 'stop-color:' + clair + ';')\n  rg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '100%')\n  stop.setAttribute('style', 'stop-color:' + fonce + ';')\n  rg.appendChild(stop)\n  return rg\n}\n\n/**\n * Retourne un marker qui sera utilisé pour la flèche de l'icône restart\n * @private\n * @param {string} id L'id du marker\n * @returns {SVGMarkerElement}\n */\nIepDoc.prototype.markerArrow = function markerArrow (id) {\n  const marker = document.createElementNS(svgns, 'marker')\n  marker.setAttribute('id', id)\n  marker.setAttribute('markerWidth', '4')\n  marker.setAttribute('markerHeight', '4')\n  marker.setAttribute('refX', '0')\n  marker.setAttribute('refY', '2')\n  marker.setAttribute('orient', 'auto')\n  const pathm = document.createElementNS(svgns, 'path')\n  pathm.setAttribute('d', 'M 0 0 2 2 0 4 Z')\n  pathm.setAttribute('style', 'fill:white;')\n  marker.appendChild(pathm)\n  return marker\n}\n\n/**\n * Foncion renvoyant un filtre qui sera utilisé pour donner un aspect de relief aux icônes\n * creeElementsPourIcones\n * @private\n * @param {string} id L'id du filtre\n * @returns {SVGFilterElement}\n */\nIepDoc.prototype.filtreEclairageIcone = function filtreEclairageIcone (id) {\n  const filter = document.createElementNS(svgns, 'filter')\n  filter.setAttribute('x', '0')\n  filter.setAttribute('y', '0')\n  filter.setAttribute('width', '100%')\n  filter.setAttribute('height', '100%')\n  filter.setAttribute('color-interpolation-filters', 'sRGB')\n  const dl = document.createElementNS(svgns, 'feDiffuseLighting')\n  dl.setAttribute('lighting-color', 'white')\n  dl.setAttribute('surfaceScale', '1')\n  dl.setAttribute('diffuseConstant', '1.2')\n  dl.setAttribute('in', 'SourceGraphic')\n  dl.setAttribute('result', 'diffOut')\n  const pointLight = document.createElementNS(svgns, 'fePointLight')\n  pointLight.setAttribute('x', '5')\n  pointLight.setAttribute('y', '5')\n  pointLight.setAttribute('z', '15')\n  dl.appendChild(pointLight)\n  filter.appendChild(dl)\n  const fc = document.createElementNS(svgns, 'feComposite')\n  fc.setAttribute('in', 'SourceGraphic')\n  fc.setAttribute('in2', 'diffOut')\n  fc.setAttribute('operator', 'arithmetic')\n  fc.setAttribute('k1', '1')\n  fc.setAttribute('k2', '0')\n  fc.setAttribute('k3', '0')\n  fc.setAttribute('k4', '0')\n  filter.appendChild(fc)\n  filter.setAttribute('id', id)\n  return filter\n}\n\n/**\n * Retourne une fenêtre contenant le code XML de la figure\n * @private\n * @return {Window}\n */\nIepDoc.prototype.popup = function popup () {\n  // ouvre une fenetre sans barre d'etat, ni d'ascenceur\n  const w = window.open('', 'popup', 'width=700,height=450,toolbar=no,scrollbars=no,resizable=yes')\n  w.iepDoc = this\n  const doc = w.document\n  doc.title = 'Code Xml de la figure'\n  const div = doc.createElement('div')\n  const form = doc.createElement('form')\n  div.appendChild(form)\n  div.setAttribute('align', 'center')\n  doc.body.appendChild(div)\n  const ta = doc.createElement('textarea')\n  form.appendChild(ta)\n  ta.setAttribute('cols', 80)\n  ta.setAttribute('rows', 25)\n  ta.setAttribute('readonly', true)\n  ta.style.fontSize = '13px'\n  ta.scrollIntoView()\n  // Si le script ne comporte pas de retours à la ligne (une seule ligne), on en rajoute\n  let ch = this.codexml\n  ch = ch.replace(/>\\s*</g, '>\\n<')\n  ta.appendChild(document.createTextNode(ch))\n  ta.select()\n  // w.onbeforeunload = function(){this.iepDoc.windowxml = null;};\n  const iepDoc = this\n  w.addEventListener('unload', () => { iepDoc.windowxml = null })\n  return w\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\n\n/**\n * Informations sur un texte contenant des balises <b> ou <i> ou <u> ou <font> (ou un mélange)\n * Utilisé dans l'objet ActionEcrireTexte.\n * @constructor\n * @param {boolean} bold\n * @param {boolean} italic\n * @param {boolean} underline\n * @param {boolean} couleur\n * @param {boolean} fontface\n * @param {boolean} taille\n */\nfunction InfoBalise (bold, italic, underline, couleur, fontface, taille) {\n  this.bold = bold\n  this.italic = italic\n  this.underline = underline\n  this.couleur = couleur\n  this.fontface = fontface\n  this.taille = taille\n}\n\nexport default InfoBalise\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\n\n/**\n * Le namespace svg\n * @type {string}\n */\nexport const svgns = 'http://www.w3.org/2000/svg'\n/**\n * Liste des caractères grecs (alpha: 'α', beta…)\n * @type {Object}\n */\nexport const caracteresGrecs = {\n  alpha: 'α',\n  beta: 'β',\n  gamma: 'γ',\n  delta: 'δ',\n  epsilon: 'ε',\n  zeta: 'ζ',\n  eta: 'η',\n  theta: 'θ',\n  kappa: 'κ',\n  lambda: 'λ',\n  mu: 'μ',\n  nu: 'ν',\n  xi: 'ξ',\n  pi: 'π',\n  rho: 'ρ',\n  sigma: 'σ',\n  tau: 'τ',\n  phi: 'φ',\n  chi: 'χ', // c'est bien le χ minuscule (ressemble à sa majuscule mais en plus bas)\n  psi: 'ψ',\n  omega: 'ω',\n  Gamma: 'Γ',\n  Delta: 'Δ',\n  Xi: 'Ξ',\n  Pi: 'Π',\n  Sigma: 'Σ',\n  Phi: 'Φ',\n  Chi: 'Χ',\n  Psi: 'Ψ',\n  Omega: 'Ω'\n}\n/**\n * Les caractères spéciaux qui seront remplacés par leur caractère UTF8 (nom => char)\n * pour utilisation sous la forme £nom£ dans un texte\n * @type {object}\n */\nexport const caracteresSpeciaux = {\n  alpha2: 'α', // quel intérêt ? £alpha£ est déjà remplacé par le même caractère via caracteresGrecs\n  plus: '+',\n  moins: '-',\n  fois: '×',\n  divise: '÷',\n  petitf: 'f',\n  petitebarre: '–',\n  grandebarre: '—',\n  prime: \"'\",\n  seconde: '\"',\n  puceronde: '•',\n  grandC: 'ℂ',\n  euler: 'ℂ',\n  petitg: 'ℊ',\n  petith: 'ℏ',\n  Ironde: 'ℑ',\n  Lronde: 'ℒ',\n  lronde: 'ℓ',\n  grandN: 'ℕ',\n  Pronde: '℘',\n  grandQ: 'ℚ',\n  Rronde: 'ℜ',\n  grandR: 'ℝ',\n  grandZ: 'ℤ',\n  Eronde: 'ℰ',\n  Fronde: 'ℱ',\n  Nronde: 'ℵ',\n  flecheG: '←',\n  flecheH: '↑',\n  flecheD: '→',\n  flecheB: '↓',\n  flecheDG: '↔',\n  flecheGD: '↔',\n  flecheHB: '↕',\n  flecheBH: '↕',\n  croissant: '↗',\n  decroissant: '↘',\n  alaligneadroite: '↳',\n  alaligneagauche: '↵',\n  doubleflecheG: '⇐',\n  doubleflecheD: '⇒',\n  doubleflecheDG: '⇔',\n  doubleflecheGD: '⇔',\n  flecheGbarre: '⇤',\n  flecheDbarre: '⇥',\n  flecheGcreuse: '⇦',\n  flecheHcreuse: '⇧',\n  flecheDcreuse: '⇨',\n  flecheBcreuse: '⇩',\n  qqsoit: '∀',\n  pourtout: '∀',\n  quelquesoit: '∀',\n  complement: '∁',\n  differentielpartiel: '∂',\n  ilexiste: '∃',\n  ilnexistepas: '∄',\n  vide: '∅',\n  nabla: '∇',\n  appartienta: '∈',\n  nappartientpasa: '∉',\n  contient: '∋',\n  petitcontient: '∍',\n  grandproduit: '∏',\n  grandcoproduit: '∐',\n  grandesomme: '∑',\n  petitebarrefine: '−',\n  moinsouplus: '∓',\n  antislash: '\\\\',\n  asterisque: '∗',\n  racine: '√',\n  proportionnela: '∝',\n  infini: '∞',\n  angle: '∡',\n  anglespherique: '∢',\n  // divise: '∣', // faudrait savoir ! déjà défini plus haut comme ÷\n  nedivisepas: '∤',\n  parallelea: '//',\n  nestpasparallelea: '∦',\n  etlogique: '∧',\n  oulogique: '∨',\n  inter: '∩',\n  intersection: '∩',\n  union: '∪',\n  integrale: '∫',\n  doubleintegrale: '∬',\n  tripleintegrale: '∭',\n  integralecurviligne: '∮',\n  integralesurfacique: '∯',\n  integralevolumique: '∰',\n  egaleasymptotiquea: '≃',\n  environdroit: '≃',\n  environegala: '≅',\n  environ: '≈',\n  egalpardefinition: '≝',\n  differentde: '≠',\n  identiquea: '≡',\n  inferieura: '≤',\n  superieura: '≥',\n  inclusdans: '⊂',\n  // contient: '⊃', doublon avec ∋ défini plus haut\n  nestpasinclusdans: '⊄',\n  necontientpas: '⊅',\n  sommedirecte: '⊕',\n  differencedirecte: '⊖',\n  produittensoriel: '⊗',\n  divisiondirecte: '⊘',\n  produitdirect: '⊙',\n  top: '⊤',\n  perpendiculairea: '⊥',\n  antecedentde: '⊶',\n  imagede: '⊷',\n  angledroitarc: '⊾',\n  point: '⋅',\n  pv: ';'\n}\n\n/**\n * π/180\n * @type {number}\n */\nexport const convDegRad = Math.PI / 180\n/**\n * 180/π\n * @type {number}\n */\nexport const convRadDeg = 180 / Math.PI\n/**\n * Valeur de cos(30°)\n * @type {number}\n */\nexport const cos30 = Math.cos(30 * convDegRad)\n/**\n * Valeur de sin(30°)\n * @type {number}\n */\nexport const sin30 = 0.5\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { caracteresSpeciaux, svgns } from './constantes'\nimport InfoBalise from './InfoBalise'\n\n// y'en a bcp trop pour tous les revoir (surtout qu'ils sont pas si problématiques,\n// même si on pourrait écrire tout ça plus simplement avec des regex)\n/* eslint-disable no-unreachable-loop */\n/**\n * idem caracteresSpeciaux mais avec toutes les propriétés en minuscules\n * (remplaceCarSpe veut faire une comparaison insensible à la casse, on lui mâche ici le travail)\n * @private\n * @type {object}\n */\nconst carSpeMin = {}\nObject.entries(caracteresSpeciaux).forEach(([nom, char]) => {\n  carSpeMin[nom.toLowerCase()] = char\n})\n\n/**\n * Retourne true si le nombre x a une valeur absolue inférieue à 10^-9\n * @param {number} x\n * @returns {boolean}\n */\nexport const zero = (x) => Math.abs(x) < 1e-9\n/**\n * Retourne true si la valeur absolue de a est inférieure à 10^-7\n * Utilisé pour tester si un angle est quasi nul.\n * @param {number} a\n * @returns {boolean}\n */\nexport const zeroAngle = (a) => Math.abs(a) < 1e-7\n/**\n * Retourne la mesure principale en degrés de l'angle dont ang est une mesure\n * @param {number} ang\n * @returns {number}\n */\nexport function mesurePrincDeg (ang) {\n  const q = Math.floor((ang + 180) / 360)\n  let ret = ang - 360 * q\n  if (ret === -180) ret = 180\n  return ret\n}\n/**\n * Fonction servant à parser un fichier xml contenu dans la chaîne txt\n * @param {string} txt\n * @returns {DOMParser}\n */\nexport function parseXMLDoc (txt) {\n  let parser, xmlDoc\n  if (window.DOMParser) {\n    parser = new DOMParser()\n    xmlDoc = parser.parseFromString(txt, 'text/xml')\n  } else if (window.ActiveXObject) {\n    // Internet Explorer\n    /* global ActiveXObject */\n    xmlDoc = new ActiveXObject('Microsoft.XMLDOM')\n    xmlDoc.async = false\n    xmlDoc.loadXML(txt)\n  } else {\n    console.error(Error('Votre navigateur ne peut pas analyser du XML, impossible d’utiliser instrumenpoche'))\n  }\n  return xmlDoc\n}\n\n/**\n * Retourne true si ch contient le nom d'un instrument.\n * @param {string} ch\n * @returns {boolean}\n */\nexport const estInstrument = (ch) => ['compas', 'compasLeve', 'crayon', 'equerre', 'rapporteur', 'regle', 'requerre'].includes(ch)\n\n/**\n * Fonction appelée pour une chaîne qui commence par un caractère de balise ouvrante.\n * Avant appel la chaîne doit commencer par une balise ouvrante\n * Renvoie -1 s'il n'y a pas de balise fermante correspondante\n * @param {string} ch\n * @returns {int} Renvoie l'indice du dernier caractère de la balise fermante correspondante\n * augmentée de 1\n */\nexport function indiceFinBalise (ch) {\n  let bal, balf, indf\n  let balisefont = false\n  if (ch.indexOf('<font') === 0) {\n    balf = '</font>'\n    balisefont = true\n  } else {\n    indf = ch.indexOf('>')\n    if (indf === -1) return ch.length // Erreur\n    bal = ch.substring(0, indf + 1)\n    balf = bal.substring(0, 1) + '/' + bal.substring(1)\n  }\n  const ind = ch.indexOf(balf)\n  if (ind === -1) {\n    // Il arrive que des gens oublient de fermer une baise font et en ouvrent une autre\n    if (balisefont) {\n      const ind2 = ch.indexOf('<font', 5)\n      if (ind2 !== -1) return ind2\n    }\n    return -1\n  } else {\n    // Incorrect. Balise de fn oubliée ?\n    return ind + balf.length\n  }\n}\n\n/**\n * Fonction analysant une chaîne commençant par £e( ou £i(\n * et renvoyant un objet formé de l'opérande et de l'exposant (ou indice)\n * @param {string} chaine\n * @return {{erreur: boolean, operande: string, exposant: string, texte: string}}\n */\nexport function analyseExposantOuIndice (chaine) {\n  const ch = chaine.trim()\n  const res = {}\n  const indvirg = ch.indexOf(',')\n  const indparf = ch.indexOf(')')\n  res.erreur = (indvirg === -1) || (indparf === -1)\n  if (res.erreur) {\n    res.texte = ''\n    return res\n  }\n  res.operande = ch.substring(3, indvirg)\n  res.exposant = ch.substring(indvirg + 1, indparf)\n  res.texte = ch.substring(indparf + 1)\n  return res\n}\n\n/**\n * Fonction appelée dans le cas ou pDebut est l'indice dans chaine d'une\n * parenthèse ouvrante et renvoyant l'indice de la parenthèse\n * fermante correspondante dans la chaîne.\n * @return {number}\n */\nfunction indiceParentheseFermante (chaine, deb) {\n  let p\n  let ch\n  let somme = 1\n  p = deb + 1\n  while (p < chaine.length) {\n    ch = chaine.charAt(p)\n    if (ch === '(') { somme++ } else {\n      if (ch === ')') { somme-- }\n    }\n    if (somme === 0) break\n    p++\n  }\n  if (somme === 0) {\n    return p\n  }\n  // On renvoie -1 si pas trouvé\n  return -1\n}\n\n/**\n * Retourne true si char est un chiffre\n * @param {string} char\n * @returns {boolean}\n */\nexport const estUnChiffre = (char) => typeof char === 'string' && char.length === 1 && /[0-9]/.test(char)\n\n// Fonctions reprises depuis le code source de InstrumentPoche en flash\nexport function valeur_approchee (nombre, precision) {\n  const prec = Math.pow(10, precision)\n  return Math.round(nombre / prec) * prec\n}\n\n/**\n * Fonction reprise à partir du code de la version Flash et servant pour les\n * repères et quadrillages\n * @param {number} nbr\n * @param {number} borne1\n * @param {number} borne2\n * @param {number} borne_pix1\n * @param {number} borne_pix2\n * @returns {number}\n */\nexport function mettre_en_pixels (nbr, borne1, borne2, borne_pix1, borne_pix2) {\n  const coeff_dir = (borne_pix1 - borne_pix2) / (borne1 - borne2)\n  const ordo_orig = borne_pix1 - coeff_dir * borne1\n  return coeff_dir * nbr + ordo_orig\n}\n\n/** Fonctions éléminant dans le code XML contenu dans la chaîne ch les attributs\n * en doublon en ne gardant que le premier\n * @param {string} ch\n * @returns {string} / La chaîne avec les doublons d'attribut supprimés.\n */\nexport function elimineDoublonsXML (ch) {\n  let res = ''\n  const patterns = ['objet', 'mouvement', 'vitesse', 'tempo', 'abscisse', 'ordonnee', 'id', 'couleur', 'pointille', 'echelle',\n    'angle', 'cible', 'texte', 'ecrire', 'rotation', 'translation', 'epaisseur', 'opacite', 'masquer', 'montrer',\n    'crayon', 'equerre', 'regle', 'compas', 'reglequerre', 'sens', 'hauteur', 'largeur', 'haut', 'gauche',\n    'Xmin', 'Ymin', 'Xmax', 'yMax', 'Xgrad', 'Ygrad', 'image', 'police', 'taille',\n    'ordonnee_bas_droite', 'abscisse_bas_droite', 'ordonnee_haut_gauche', 'abscisse_haut_gauche']\n  ch.split(/<action/gi).forEach((ligne, i) => {\n    patterns.forEach(pattern => {\n      const r = new RegExp(' ' + pattern + '[^\\\\w ]*= *\"[\\\\w]*\"', 'i')\n      const a = ligne.search(r)\n      if (a !== -1) {\n        const b = ligne.substring(a + 1).search(r)\n        if (b !== -1) ligne = ligne.replace(r, '')\n      }\n    })\n    res += (i === 0) ? ligne : '<action' + ligne\n  })\n  return res\n}\n\n/**\n * Fonction remplaçant dans la chaîne ch les accents écrits en code html par leur caractère utf8\n * @param {string} ch La chaîne à traiter\n * @returns {string} : La chaîne avec les caractères remplacès\n */\n\n/*\nremplaceAccentsHtml: function (ch) {\n  const t1 = ['&agrave;', '&acirc;', '&aelig;', '&egrave;', '&eacute;', '&ecirc;', '&icirc;', '&ocirc;',\n    '&ouml;', '&oslash;', '&Oslash;', '&ugrave;', '&ucirc;', '&apos;']\n  const t2 = ['à', 'â', 'æ', 'è', 'é', 'ê', 'î', 'ô',\n    'ö', 'ø', 'Ø', 'ù', 'û', \"'\"]\n  let i\n  for (i = 0; i < t1.length; i++) {\n    ch = ch.replace(new RegExp(t1[i], 'g'), t2[i])\n  }\n  return ch\n},\n*/\n/**\n * Fonction remplaçant dans la chaîne ch toutes les balises écrites avec des caractères spéciaux £\n * par des balises normales du type <...>\n * @param {string} ch La chaîne à traiter contenant les balises spéciales\n * @returns {string} : La chaîne avec les balises normales\n */\nexport function remplaceBalises (ch) {\n  // Certains auteurs ont utilisé les codes £lt; et £gt;\n  // Inutile car quand on parse avec getAttribute pour avoir le texte le balises sont déjà remplacées\n  /*\n  ch = ch.replace(/£lt;/gi,\"£lt£\");\n  ch = ch.replace(/£gt;/gi,\"£gt£\");\n  */\n  // Par contre si elles ont déjà été remplacées et utilisaient des majuscules il faut mettre des minuscules\n  ch = ch.replace(/<B>/g, '<b>')\n  ch = ch.replace(/<\\/B>/g, '</b>')\n  ch = ch.replace(/<I>/g, '<i>')\n  ch = ch.replace(/<\\/I>/g, '</i>')\n  ch = ch.replace(/<U>/g, '<u>')\n  ch = ch.replace(/<\\/U>/g, '</u>')\n\n  ch = ch.replace(/£lt£i£gt£/gi, '<i>')\n  ch = ch.replace(/£i£/gi, '<i>')\n  ch = ch.replace(/£lt£\\/i£gt£/gi, '</i>')\n  ch = ch.replace(/£\\/i£/gi, '</i>')\n  ch = ch.replace(/£lt£b£gt£/gi, '<b>')\n  ch = ch.replace(/£b£/gi, '<b>')\n  ch = ch.replace(/£lt£\\/b£gt£/gi, '</b>')\n  ch = ch.replace(/£\\/b£/gi, '</b>')\n  ch = ch.replace(/£lt£u£gt£/gi, '<u>')\n  ch = ch.replace(/£u£/gi, '<u>')\n  ch = ch.replace(/£lt£\\/u£gt£/gi, '</u>')\n  ch = ch.replace(/£\\/u£/gi, '</u>')\n  ch = ch.replace(/£lt£br£gt£/gi, '<br>')\n  ch = ch.replace(/£lt£br\\/£gt£/gi, '<br>')\n  ch = ch.replace(/£br£/gi, '<br>')\n  ch = ch.replace(/£br\\/£/gi, '<br>')\n  ch = ch.replace(/£lt£font/gi, '<font')\n  ch = ch.replace(/£lt£\\/font£gt£/gi, '</font>')\n  // Remplacement de balises exotiques utilisées par certains\n  ch = ch.replace(/£lt£bold£gt£/gi, '<b>')\n  ch = ch.replace(/£lt£\\/bold£gt£/gi, '</b>')\n  // remplacement des £lt£ et £gt£ utiliséscomme caractères\n  ch = ch.replace(/£lt£/gi, '<')\n  ch = ch.replace(/£gt£/gi, '>')\n  ch = ch.replace(/£inferieurstrict£/gi, '<')\n  ch = ch.replace(/£superieurstrict£/gi, '>')\n  // Remplacement des guillemets\n  ch = ch.replace(/£guillemet£/gi, '\"')\n  return ch\n}\n\n/**\n * Retourne une chaîne où les caractères spéciaux de Flash de ch sont remplacés par\n * le caractère UTF8 correspondant\n * @param {string} ch La chaîne à traiter\n */\nexport function remplaceCarSpe (ch) {\n  if (!ch.includes('£')) return ch\n  // on éclate la chaîne sur £ et on regarde les morceaux impair (0 est celui qui précède le premier £)\n  // attention, si jamais y'a un nombre impair de £ faut pas ajouter de dernier £\n  const newString = ch.split('£').map((fragment, i) => {\n    if (i % 2) {\n      // impair, faut regarder si c'est une propriété connue (sans tenir compte de la casse)\n      const nom = fragment.toLowerCase()\n      return carSpeMin[nom] || `£${fragment}£`\n    }\n    return fragment\n  }).join('')\n  if ((ch.length - ch.replace(/£/g, '').length) % 2) {\n    console.warn(`Il y a un nombre impair de £ dans cette chaîne : ${ch}`)\n    return newString.substr(0, newString.length - 1)\n  }\n  return newString\n  /* pour mémoire, avant on avait une boucle sur la centaine de caractères spéciaux avec regex+replace à chaque fois, avec :\n  Object.entries(caracteresSpeciaux).forEach(([nom, char]) => {\n    const search = '£' + nom + '£'\n    if (ch.includes(search)) ch = ch.replace(new RegExp(cha, 'gi'), char)\n  })\n  return ch */\n}\n\n/**\n * Retourne l'idice dans la chaîne chaine de l'accolade fermante\n * correspondant à l'accolade ouvrante dont l'indice dans la chaîne est pdebut\n * Avant appel,l le caractère d'indice pdebut de la chaîne ch doit contenir\n * une parenthèse ouvrante.\n * @private\n */\nfunction accoladeFermante (chaine, pdebut) {\n  let p, ch, somme\n\n  somme = 1\n  p = pdebut + 1\n  while (p < chaine.length) {\n    ch = chaine.charAt(p)\n    if (ch === '{') { somme++ } else {\n      if (ch === '}') { somme-- }\n    }\n    if (somme === 0) break\n    p++\n  }\n  if (somme === 0) {\n    return p\n  } else {\n    return -1\n  } // On renvoie -1 si pas trouvé\n}\n\n/**\n * Retourne true si ch conteint une balise LaTeX : fraction, racine carrée,\n * puissance, indice, chapeau, parenthèses, crochets, valeur abolue, norme,\n * vecteur ou texte\n * @param {string} ch\n * @returns {Boolean}\n */\nexport function contientBaliseLaTeX (ch) {\n  return (ch.indexOf('\\\\frac') !== -1) || (ch.indexOf('\\\\sqrt') !== -1) ||\n    (ch.indexOf('}^{') !== -1) || (ch.indexOf('}_{') !== -1) ||\n    (ch.indexOf('\\\\widehat{') !== -1) || (ch.indexOf('\\\\left[') !== -1) ||\n    (ch.indexOf('\\\\left(') !== -1) || (ch.indexOf('\\\\left|') !== -1) ||\n    (ch.indexOf('\\\\left\\\\|') !== -1) || (ch.indexOf('\\\\overrightarrow{') !== -1) ||\n    (ch.indexOf('\\\\text{') !== -1)\n}\n\n/**\n * Une couleur css (sous sa forme #xxxxxx ou un nom de couleur black|red|…)\n * @typedef SvgColor\n * @type {string}\n */\n/**\n * Retourne une chaîne de caractères représentant la couleur correspondant au contenu de ch (qui peut être une couleur au format Flash ou déjà une couleur css)\n * @param {string} ch\n * @returns {SvgColor}\n */\nexport function getSvgColor (ch) {\n  const trad = {\n    noir: 'black',\n    rouge: 'red',\n    vert: 'green',\n    bleu: 'blue',\n    blanc: 'white',\n    gris: 'grey',\n    darkorange: 'maroon'\n  }\n  if (ch === '0') return 'black'\n  if (trad[ch]) return trad[ch]\n\n  // complète avec des 0 à gauche\n  const complete = (s) => s.length < 7 ? '#' + '0'.repeat(6 - s.length) + s : s.substr(-6)\n\n  // faut parser la chaîne\n  if (/^#/.test(ch)) {\n    if (ch.length === 7) return ch\n    // #f03 => #ff0033\n    if (ch.length === 4) return `#${ch[1]}${ch[1]}${ch[2]}${ch[2]}${ch[3]}${ch[3]}`\n    // ça c'est pas très catholique (ni orthodoxe)\n    console.error(Error(`couleur ${ch} invalide, on va tronquer ou compléter avec des 0`))\n    return complete(ch.substring(1))\n  }\n  if (/^0x/.test(ch)) {\n    return complete(ch.substring(2))\n  }\n  if (/^[0-9]/.test(ch)) {\n    return complete(parseFloat(ch).toString(16))\n  }\n  // Sinon on suppose que c'est un nom de couleur (ou une couleur valide, comme rvb(r,v,b) ou …\n  // cf https://developer.mozilla.org/fr/docs/Web/CSS/color\n  return ch\n}\n\n/**\n * Retourne true si les vecteurs u et v sont quasi colinéaires\n * @param {Vect} u\n * @param {Vect} v\n * @returns {boolean}\n */\nexport function colineaires (u, v) {\n  const n1 = u.norme()\n  const n2 = v.norme()\n  if (zero(n1) || zero(n2)) return true\n  return zero((u.x * v.y - u.y * v.x) / n1 / n2)\n}\n\n/**\n * Retourne true si les vecteurs u et v sont quasi colinéaires\n * de même sens\n * @param {Vect} u\n * @param {Vect} v\n * @returns {boolean}\n */\nexport const colineairesMemeSens = (u, v) => colineaires(u, v) && (u.x * v.x + u.y * v.y >= 0)\n\n/**\n * Retourne l'indice de la nb ième virgule dans la chaîne ch\n * à partir de l'indice deb en sauta,t le contenu des parenthèses\n * @param {string} chaine\n * @param {number} deb\n * @param {number} nb\n * @returns {number}\n */\nexport function indiceVirgule (chaine, deb, nb) {\n  let ch, indpf\n  let k = 0\n  let p = deb\n  while (p < chaine.length) {\n    ch = chaine.charAt(p)\n    if (ch === '(') {\n      indpf = indiceParentheseFermante(chaine, p)\n      if (indpf === -1) {\n        return -1\n      }\n      p = indpf\n    } else {\n      if (ch === ',') k++\n      if (k === nb) return p\n    }\n    p++\n  }\n  return -1\n}\n\n/**\n * Cette fonction permet de trouver les meilleures graduations a afficher pour un repere.\n * Elle retourne la plus petite de ces graduations, afin que des nombres \"ronds\" soient affichés.\n * Fonction reprise à partir du code de la version Flash et servant pour les\n * repères et quadrillages\n * @param {number} mini\n * @param {number} maxi\n * @param {number} unite\n * @returns {number}\n */\nexport function determiner_graduations (mini, maxi, unite) {\n  let debut_trace\n  // lorsque 0 est entre les bornes, on part de 0 et on cherche le début du tracé\n  if (maxi * mini < 0) {\n    debut_trace = -Math.floor(-mini / unite) * unite\n  } else if (Math.ceil(Math.log(Math.abs(mini)) / Math.LN10) !== Math.ceil(Math.log(Math.abs(maxi)) / Math.LN10)) {\n    // en cas de puissance de 10 entre les bornes, on prend\n    if (mini < 0) {\n      debut_trace = -Math.pow(10, Math.floor(Math.log(Math.abs(mini)) / Math.LN10))\n    } else {\n      debut_trace = Math.pow(10, Math.ceil(Math.log(Math.abs(mini)) / Math.LN10))\n    }\n    debut_trace = debut_trace - Math.floor((debut_trace - mini) / unite) * unite\n  } else {\n    // dans tous les autres cas, on fait ce qu'on peut\n    debut_trace = valeur_approchee(mini, Math.floor(Math.log(unite) / Math.LN10))\n    if (debut_trace < mini) {\n      debut_trace += unite\n    }\n  }\n  return debut_trace\n}\n\n/**\n * Fonction récursive appelée lorsque l'affichage de texte n'utilise pas le LaTeX\n * Elle traite les balises u, i, b et font pour ajouter à txt (qui est élément\n * graphique svg text des tspans correspondants.\n * @param {String} : La chaîne contenant le texte avec balises éventuelles\n * @param {InfoBalise} infoBalise un objet qui contient les caractéristiques du texte, à savoir\n * bold ou non, italique ou non, souligné ou non, couleur et fonte utilisée\n * @param {svg.text} txt L'élément text de svg auquel seront rajoutés les tspan créés\n * @param {Boolean} debutLigne true si l'affichage du prochain tspan doit se faire en début de ligne\n * @param {number} y le paramètre y du prochain tspan à créer\n */\nexport function traiteBalise (ch, infoBalise, txt, debutLigne, y) {\n  if (ch === '') return\n  let stylespan, indfb, ind1, ind2, fonte, couleur, taille, inddeb, info\n  const ind = ch.search(/<b>|<i>|<u>|<font/)\n  const tspan = document.createElementNS(svgns, 'tspan')\n  tspan.setAttribute('pointer-events', 'none')\n  if ((ind === -1) || (ind > 0)) { // Il y a du texte\n    stylespan = ''\n    // if (infoBalise.couleur !== \"\") stylespan += \"fill:\" + infoBalise.couleur+\";\";\n    if (infoBalise.couleur) stylespan += 'fill:' + infoBalise.couleur + ';'\n    if (infoBalise.bold) stylespan += 'font-weight:bold;'\n    if (infoBalise.italic) stylespan += 'font-style:italic;'\n    if (infoBalise.underline) stylespan += 'text-decoration:underline;'\n    if (infoBalise.fontface !== '') {\n      stylespan += 'font-family:' + infoBalise.fontface + ';'\n    } else {\n      stylespan += 'font-family: \"Times New Roman\", Times, serif;'\n    }\n    stylespan += 'font-size:' + infoBalise.taille + 'px;'\n    tspan.setAttribute('style', stylespan)\n    if (debutLigne) {\n      tspan.setAttribute('x', 0)\n      debutLigne = false\n    }\n    tspan.setAttribute('y', y)\n    const ch2 = (ind === -1) ? ch : ch.substring(0, ind)\n    tspan.appendChild(document.createTextNode(ch2))\n    txt.appendChild(tspan)\n    if (ind > 0) traiteBalise(ch.substring(ind), infoBalise, txt, debutLigne, y)\n    // else ch = \"\";\n  } else {\n    if (ch.indexOf('<b>') === 0) { // Balise bold\n      info = new InfoBalise(true, infoBalise.italic, infoBalise.underline, infoBalise.couleur, infoBalise.fontface)\n      indfb = indiceFinBalise(ch)\n      if (indfb === -1) {\n        traiteBalise(ch.substring(3), info, txt, debutLigne, y)\n      } else {\n        traiteBalise(ch.substring(3, indfb - 4), info, txt, debutLigne, y)\n      }\n    } else {\n      if (ch.indexOf('<i>') === 0) { // Balise italique\n        info = new InfoBalise(infoBalise.bold, true, infoBalise.underline, infoBalise.couleur, infoBalise.fontface)\n        indfb = indiceFinBalise(ch)\n        if (indfb === -1) {\n          traiteBalise(ch.substring(3), info, txt, debutLigne, y)\n        } else {\n          traiteBalise(ch.substring(3, indfb - 4), info, txt, debutLigne, y)\n        }\n      } else {\n        if (ch.indexOf('<u>') === 0) { // Balise souigné\n          info = new InfoBalise(infoBalise.bold, infoBalise.italic, true, infoBalise.couleur, infoBalise.fontface)\n          indfb = indiceFinBalise(ch)\n          if (indfb === -1) {\n            traiteBalise(ch.substring(3), info, txt, debutLigne, y)\n          } else {\n            traiteBalise(ch.substring(3, indfb - 4), info, txt, debutLigne, y)\n          }\n        } else {\n          if (ch.indexOf('<font') === 0) {\n            indfb = indiceFinBalise(ch)\n            if (indfb === -1) indfb = ch.length\n            ind1 = ch.indexOf('face=\"')\n            if (ind1 !== -1) {\n              ind2 = ch.indexOf('\"', ind1 + 6)\n              if (ind2 !== -1) { fonte = ch.substring(ind1 + 6, ind2) } else fonte = ''\n            } else {\n              fonte = ''\n            }\n            couleur = ''\n            ind1 = ch.indexOf('couleur=\"')\n            if (ind1 !== -1) {\n              ind2 = ch.indexOf('\"', ind1 + 9)\n              if (ind2 !== -1) {\n                couleur = getSvgColor(ch.substring(ind1 + 9, ind2))\n              }\n            } else {\n              ind1 = ch.indexOf('color=\"')\n              if (ind1 !== -1) {\n                ind2 = ch.indexOf('\"', ind1 + 7)\n                if (ind2 !== -1) {\n                  couleur = getSvgColor(ch.substring(ind1 + 7, ind2))\n                }\n              }\n            }\n            ind1 = ch.indexOf('size=\"')\n            if (ind1 !== -1) {\n              ind2 = ch.indexOf('\"', ind1 + 6)\n              if (ind2 !== -1) { taille = ch.substring(ind1 + 6, ind2) } else taille = infoBalise.taille\n            }\n\n            info = new InfoBalise(infoBalise.bold, infoBalise.italic, infoBalise.underline, couleur, fonte, taille)\n            inddeb = ch.indexOf('>') // Recherche du > de la balise <font>\n            if ((/<\\/font>/i).test(ch)) {\n              traiteBalise(ch.substring(inddeb + 1, indfb - 7), info, txt, debutLigne, y)\n            } else {\n              traiteBalise(ch.substring(inddeb + 1), info, txt, debutLigne, y)\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * Retourne true si la chaîne ch contient des codes spéciaux de maths en flash\n * sauf les £e() et £i() simples.\n * Si les arguments de £e() ou £i() contiennent des appels à des balises ou d'autres\n * appels à £e() et £i() renvoie true car alors il faut utiliser le LaTeX pour représenter la formule.\n * Si expind est true on cherche aussi les puissances et indices\n * @param {string} ch\n * @returns {Boolean}\n */\nexport function necessiteLatex (ch) {\n  // Les codes e (exposant) et i (idice) ne nécessitent pas l'utilisation de MathJax\n  if (['a', 'c', 'd', 'f', 'g', 'n', 'p', 'r', 's', 'u', 'v'].some(code => ch.includes(`£${code}(`))) return true\n  // Si la formule contient des puissances ou des indices utilisant elle-mêmes des balises\n  // puissances, indices ou font il faut passer par le LaTeX donc on renvoie true\n  let ind, indparf, s\n  let ch1 = ch\n  while ((ind = ch1.search(/£e\\(|£i\\(/g)) !== -1) {\n    indparf = indiceParentheseFermante(ch1, ind + 3)\n    if (indparf === -1) indparf = ch1.length\n    s = ch1.substring(ind, indparf)\n    if (s.search(/£e\\(|£i\\(£lt£font/g) !== -1) return true\n    if (indparf === ch1.length) {\n      return false\n    } else {\n      ch1 = s.substring(indparf + 1)\n    }\n  }\n  ch1 = ch\n  // Si la formule contient des balise font contenant des indices ou exposants\n  // il faut aussi passer par le LaTeX donc on renvoie true\n  while ((ind = ch1.search(/£lt£font/g)) !== -1) {\n    indparf = indiceFinBalise(ch1.substring(ind))\n    if (indparf === -1) {\n      indparf = ch1.length\n    } else {\n      indparf += ind\n    }\n    s = ch1.substring(ind, indparf)\n    if (s.search(/£e\\(|£i\\(/g) !== -1) return true\n    if (indparf === ch1.length) {\n      return false\n    } else {\n      ch1 = s.substring(indparf + 1)\n    }\n  }\n  return false\n}\n\n/**\n * Fonction récursive renvoyant une chaîne LaTeX représentant la chaîne contenue dans s\n * @param {string} s la chaîne à traiter (qui représente une ligne dans le cas de plusieurs lignes)\n * @param {boolean} btexte Si true, le contenu renvoyé est encadré par une balise \\text\n */\nexport function getMaths (s, btexte) {\n  let ind, indpf, indv, ind1, ind2, inddeb, ch2, couleur, ret, indv1, indv2, indv3, car\n  const ch = s\n  if (ch === '') return ''\n  // Traitement des balises Font\n  // On ne traite que les changements de couleur\n  while ((ind = ch.indexOf('<font')) !== -1) {\n    couleur = null\n    ch2 = ch.substring(ind)\n    indpf = indiceFinBalise(ch2)\n    ind1 = ch2.indexOf('couleur=\"')\n    if (ind1 !== -1) {\n      ind2 = ch2.indexOf('\"', ind1 + 9)\n      if (ind2 !== -1) couleur = getSvgColor(ch2.substring(ind1 + 9, ind2))\n    } else {\n      ind1 = ch2.indexOf('color=\"')\n      if (ind1 !== -1) {\n        ind2 = ch2.indexOf('\"', ind1 + 7)\n        if (ind2 !== -1) couleur = getSvgColor(ch2.substring(ind1 + 7, ind2))\n      }\n    }\n    if (couleur != null) { // On ne traite que les changements de couleur\n      inddeb = ind + ch2.indexOf('>') + 1 // Pointe sur le début concerné par la balise <font\n      if (indpf === -1) {\n        return getMaths(ch.substring(0, ind) + '\\\\textcolor{' + couleur + '}{' +\n          ch.substring(inddeb) + '}', btexte)\n      } else {\n        indpf += ind\n        return getMaths(ch.substring(0, ind) + '\\\\textcolor{' + couleur + '}{' +\n          ch.substring(inddeb, indpf - 7) + '}' + ch.substring(indpf), btexte)\n      }\n    } else {\n      inddeb = ind + ch2.indexOf('>') + 1\n      if (indpf === -1) {\n        return getMaths(ch.substring(0, ind) + ch.substring(inddeb), btexte)\n      } else {\n        indpf += ind\n        return getMaths(ch.substring(0, ind) + ch.substring(inddeb, indpf - 7) +\n          ch.substring(indpf), btexte)\n      }\n    }\n  }\n  // Traitement des caractères par code hexadécimal\n  while ((ind = ch.indexOf('£u(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(ch.substring(0, ind), btexte) + '\\\\unicode{x' + ch.substring(ind + 3, indpf) +\n      '}' + getMaths(ch.substring(indpf + 1), btexte)\n  }\n  // Traitement des fractions\n  while ((ind = ch.indexOf('£f(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la première virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    /* Modification version MathJax3 pour que les quotients utilisent display style sinon trop petits\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\frac{' +\n      getMaths(ch.substring(ind + 3, indv), false) + '}{' +\n      getMaths(ch.substring(indv + 1, indpf), false) + '}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n      */\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\displaystyle{\\\\frac{' +\n      getMaths(ch.substring(ind + 3, indv), false) + '}{' +\n      getMaths(ch.substring(indv + 1, indpf), false) + '}}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des racines carrées\n  while ((ind = ch.indexOf('£r(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\sqrt{' +\n      getMaths(ch.substring(ind + 3, indpf), false) +\n      '}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des codes d'angle\n  while ((ind = ch.indexOf('£a(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) +\n      '\\\\widehat{' + getMaths(ch.substring(ind + 3, indpf), true) + '}' +\n      getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des intégrales\n  while ((ind = ch.indexOf('£g(')) !== -1) {\n    indv1 = indiceVirgule(ch, ind + 3, 1) // Recherche de la première virgule\n    indv2 = indiceVirgule(ch, ind + 3, 2) // Recherche de la première virgule\n    indv3 = indiceVirgule(ch, ind + 3, 3) // Recherche de la première virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\int_{' +\n      getMaths(ch.substring(indv2 + 1, indv3), false) + '}^{' +\n      getMaths(ch.substring(indv3 + 1, indpf), false) +\n      '}' + getMaths(ch.substring(ind + 3, indv1), false) +\n      ' d' + getMaths(ch.substring(indv1 + 1, indv2), false) +\n      getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des crochets\n  while ((ind = ch.indexOf('£c(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(ch.substring(0, ind), btexte) + '\\\\left[' + getMaths(ch.substring(ind + 3, indpf), btexte) +\n      '\\\\right]' + getMaths(ch.substring(indpf + 1), btexte)\n  }\n  // Traitement des parenthèses\n  while ((ind = ch.indexOf('£p(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\left(' + getMaths(ch.substring(ind + 3, indpf), btexte) +\n      '\\\\right)' + getMaths(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des valeurs absolues\n  while ((ind = ch.indexOf('£d(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\left|' + getMaths(ch.substring(ind + 3, indpf), false) +\n      '\\\\right|' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des normes\n  while ((ind = ch.indexOf('£n(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\left\\\\|' + getMaths(ch.substring(ind + 3, indpf), false) +\n      '\\\\right\\\\|' + getMaths(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des indices\n  while ((ind = ch.indexOf('£i(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la première virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '{' + getMaths(ch.substring(ind + 3, indv), false) + '}_{' +\n      getMaths(ch.substring(indv + 1, indpf), false) + '}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des exposants\n  while ((ind = ch.indexOf('£e(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la première virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '{' + getMaths(ch.substring(ind + 3, indv), false) + '}^{' +\n      getMaths(ch.substring(indv + 1, indpf), false) + '}' + getMaths(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des vecteurs\n  while ((ind = ch.indexOf('£v(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMaths(getMaths(ch.substring(0, ind), btexte) + '\\\\overrightarrow{' + getMaths(ch.substring(ind + 3, indpf), false) +\n      '}' + getMaths(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des balises <u>\n  while ((ind = ch.indexOf('<u>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return ch\n    } else {\n      indpf += ind\n    }\n    return getMaths(ch.substring(0, ind), btexte) + '\\\\underline{' + getMaths(ch.substring(ind + 3, indpf - 4), true) +\n      '}' + getMaths(ch.substring(indpf), btexte)\n  }\n  // Traitement des balises <i>\n  while ((ind = ch.indexOf('<i>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return getMaths(ch.substring(0, ind), btexte) +\n        '\\\\textit{' + getMaths(ch.substring(ind + 3), false) + '}'\n    } else {\n      indpf += ind\n      return getMaths(ch.substring(0, ind), btexte) + '\\\\textit{' +\n        getMaths(ch.substring(ind + 3, indpf - 4), false) + '}' +\n        getMaths(ch.substring(indpf), btexte)\n    }\n  }\n  // Traitement des balises <b>\n  while ((ind = ch.indexOf('<b>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return getMaths(ch.substring(0, ind), btexte) +\n        '\\\\textbf{' + getMaths(ch.substring(ind + 3), false) + '}'\n    } else {\n      indpf += ind\n      return getMaths(ch.substring(0, ind), btexte) + '\\\\textbf{' +\n        getMaths(ch.substring(ind + 3, indpf - 4), false) + '}' +\n        getMaths(ch.substring(indpf), btexte)\n    }\n  }\n  if (btexte) {\n    car = ch.charAt(0)\n    // if ((car === \")\") || (car === \",\") || (car === \"}\")) return ch;\n    if ((car === ')') || (car === ',') || (car === '}')) {\n      return car + getMaths(ch.substring(1), btexte)\n    } else {\n      // Même si on et en mode texte, on peut avoir au début de ch une balise \\textcolor incomplète\n      if (contientBaliseLaTeX(ch)) {\n        return ch\n      } else {\n        // Il faut sauter les balises \\\\textcolor en tenant compte que certaines ne sont pas fermées.\n        ind = ch.indexOf('\\\\textcolor{')\n        if (ind !== -1) {\n          ret = ''\n          ch2 = ch\n          while ((ind = ch2.indexOf('\\\\textcolor{')) !== -1) {\n            ind1 = ch2.indexOf('}{')\n            indpf = accoladeFermante(ch2, ind1 + 1)\n            if (indpf === -1) {\n              if (ind === 0) {\n                if (ind1 + 2 !== ch2.length) {\n                  ret += ch2.substring(0, ind1 + 2) + '\\\\text{' + ch2.substring(ind1 + 2) + '}'\n                } else {\n                  ret += ch2\n                }\n                ch2 = ''\n              } else {\n                if (ind1 + 2 !== ch2.length) {\n                  ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2) +\n                    '\\\\text{' + ch2.substring(ind1 + 2) + '}'\n                } else {\n                  ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2)\n                }\n                ch2 = ''\n              }\n            } else {\n              if (ind === 0) {\n                ret += ch2.substring(0, indpf + 1)\n                if (indpf < ch2.length - 1) {\n                  ch2 = ch2.substring(indpf + 1)\n                } else {\n                  ch2 = ''\n                }\n              } else {\n                ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2) +\n                  '\\\\text{' + ch2.substring(ind1 + 2, indpf + 1) + '}'\n                if (indpf < ch2.length - 1) {\n                  ch2 = ch2.substring(indpf + 1)\n                } else {\n                  ch2 = ''\n                }\n              }\n            }\n          }\n          if (ch2 === '') {\n            return ret\n          } else {\n            return ret + '\\\\text{' + ch2 + '}'\n          }\n        } else {\n          // Si la chaîne commence par une parenthèse fermante, une accolade fermante ou une virgule\n          //  il s'agit d'une formule en cours et pas de mode texte\n          // Si le texte commence par des espaces, pour qu'ils soient pris en compte, on rajoute des espaces\n          // insécables en mode maths\n          let deb = 0\n          let k = 0\n          while (ch.charAt(k) === ' ') {\n            deb++\n            k++\n          }\n          return '~'.repeat(deb) + '\\\\text{' + ch.substring(k) + '}'\n        }\n      }\n    }\n  } else {\n    return ch\n  }\n}\n\n/**\n * Fonction récursive renvoyant une chaîne LaTeX représentant la chaîne contenue dans s\n * Utilisée pour les noms devant utiliser le LaTeX pour être affichés\n * @param {string} s la chaîne à traiter (qui représente une ligne dans le cas de plusieurs lignes)\n * @param {boolean} btexte Si true, le contenut renvoyé est encadré par une balise \\text Test\n */\nexport function getMathsForName (s, btexte) {\n  let ind, indpf, indv, ind1, ind2, inddeb, ch2, couleur, ret, car\n  let ch = s\n  if (ch === '') return ''\n  // Traitement des balises Font\n  // On ne traite que les changements de couleur\n  while ((ind = ch.indexOf('<font')) !== -1) {\n    couleur = null\n    ch2 = ch.substring(ind)\n    indpf = indiceFinBalise(ch2)\n    ind1 = ch2.indexOf('couleur=\"')\n    if (ind1 !== -1) {\n      ind2 = ch2.indexOf('\"', ind1 + 9)\n      if (ind2 !== -1) couleur = getSvgColor(ch2.substring(ind1 + 9, ind2))\n    } else {\n      ind1 = ch2.indexOf('color=\"')\n      if (ind1 !== -1) {\n        ind2 = ch2.indexOf('\"', ind1 + 7)\n        if (ind2 !== -1) couleur = getSvgColor(ch2.substring(ind1 + 7, ind2))\n      }\n    }\n    if (couleur !== null) { // On ne traite que les changements de couleur\n      inddeb = ind + ch2.indexOf('>') + 1 // Pointe sur le début concerné par la balise <font\n      if (indpf === -1) {\n        return getMathsForName(ch.substring(0, ind) + '\\\\textcolor{' + couleur + '}{' +\n          ch.substring(inddeb) + '}', btexte)\n      } else {\n        indpf += ind\n        return getMathsForName(ch.substring(0, ind) + '\\\\textcolor{' + couleur + '}{' +\n          ch.substring(inddeb, indpf - 7) + '}' + ch.substring(indpf), btexte)\n      }\n    } else {\n      inddeb = ind + ch2.indexOf('>') + 1\n      if (indpf === -1) {\n        return getMathsForName(ch.substring(0, ind) + ch.substring(inddeb), btexte)\n      } else {\n        indpf += ind\n        return getMathsForName(ch.substring(0, ind) + ch.substring(inddeb, indpf - 7) +\n          ch.substring(indpf), btexte)\n      }\n    }\n  }\n  // Traitement des caractères par code hexadécimal\n  while ((ind = ch.indexOf('£u(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(ch.substring(0, ind), btexte) + '\\\\unicode{x' + ch.substring(ind + 3, indpf) +\n      '}' + getMathsForName(ch.substring(indpf + 1), btexte)\n  }\n  // Traitement des racines carrées\n  while ((ind = ch.indexOf('£r(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '\\\\sqrt{' +\n      getMathsForName(ch.substring(ind + 3, indpf), false) +\n      '}' + getMathsForName(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des valeurs absolues\n  while ((ind = ch.indexOf('£d(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '\\\\left|' + getMathsForName(ch.substring(ind + 3, indpf), false) +\n      '\\\\right|' + getMathsForName(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des normes\n  while ((ind = ch.indexOf('£n(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '\\\\left\\\\|' + getMathsForName(ch.substring(ind + 3, indpf), false) +\n      '\\\\right\\\\|' + getMathsForName(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des indices\n  while ((ind = ch.indexOf('£i(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la première virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    // rrue car il s'agit d'un nom : getMathsForName(ch.substring(ind+3,indv),true)\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '{' + getMathsForName(ch.substring(ind + 3, indv), true) + '}_{' +\n      getMathsForName(ch.substring(indv + 1, indpf), false) + '}' + getMathsForName(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des exposants\n  while ((ind = ch.indexOf('£e(')) !== -1) {\n    indv = indiceVirgule(ch, ind + 3, 1) // Recherche de la première virgule\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if ((indv === -1) || (indpf === -1) || (indv > indpf)) return ch\n    // true car il s'agit d'un affichage de nom : getMathsForName(ch.substring(ind+3,indv),true)\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '{' + getMathsForName(ch.substring(ind + 3, indv), true) + '}^{' +\n      getMathsForName(ch.substring(indv + 1, indpf), false) + '}' + getMathsForName(ch.substring(indpf + 1), btexte))\n  }\n  // Traitement des vecteurs\n  while ((ind = ch.indexOf('£v(')) !== -1) {\n    indpf = indiceParentheseFermante(ch, ind + 2)\n    if (indpf === -1) return ch\n    return getMathsForName(getMathsForName(ch.substring(0, ind), btexte) + '\\\\overrightarrow{' + getMathsForName(ch.substring(ind + 3, indpf), false) +\n      '}' + getMathsForName(ch.substring(indpf + 1), btexte), btexte)\n  }\n  // Traitement des balises <u>\n  while ((ind = ch.indexOf('<u>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return ch\n    } else {\n      indpf += ind\n    }\n    return getMathsForName(ch.substring(0, ind), btexte) + '\\\\underline{' + getMathsForName(ch.substring(ind + 3, indpf - 4), true) +\n      '}' + getMathsForName(ch.substring(indpf), btexte)\n  }\n  // Traitement des balises <i>\n  while ((ind = ch.indexOf('<i>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return getMathsForName(ch.substring(0, ind), btexte) +\n        '\\\\textit{' + getMathsForName(ch.substring(ind + 3), false) + '}'\n    } else {\n      indpf += ind\n      return getMathsForName(ch.substring(0, ind), btexte) + '\\\\textit{' +\n        getMathsForName(ch.substring(ind + 3, indpf - 4), false) + '}' +\n        getMathsForName(ch.substring(indpf), btexte)\n    }\n  }\n  // Traitement des balises <b>\n  while ((ind = ch.indexOf('<b>')) !== -1) {\n    indpf = indiceFinBalise(ch.substring(ind))\n    if (indpf === -1) {\n      return getMathsForName(ch.substring(0, ind), btexte) +\n        '\\\\textbf{' + getMathsForName(ch.substring(ind + 3), false) + '}'\n    } else {\n      indpf += ind\n      return getMathsForName(ch.substring(0, ind), btexte) + '\\\\textbf{' +\n        getMathsForName(ch.substring(ind + 3, indpf - 4), false) + '}' +\n        getMathsForName(ch.substring(indpf), btexte)\n    }\n  }\n  if (btexte) {\n    // Même si on et en mode texte, on peut avoir au début de ch une balise \\textcolor incomplète\n    if (contientBaliseLaTeX(ch)) {\n      return ch\n    } else {\n      // Il faut sauter les balises \\\\textcolor en tenant compte que certaines ne sont pas fermées.\n      ind = ch.indexOf('\\\\textcolor{')\n      if (ind !== -1) {\n        ret = ''\n        ch2 = ch\n        while ((ind = ch2.indexOf('\\\\textcolor{')) !== -1) {\n          ind1 = ch2.indexOf('}{')\n          indpf = accoladeFermante(ch2, ind1 + 1)\n          if (indpf === -1) {\n            if (ind === 0) {\n              if (ind1 + 2 !== ch2.length) {\n                ret += ch2.substring(0, ind1 + 2) + '\\\\text{' + ch2.substring(ind1 + 2) + '}'\n              } else {\n                ret += ch2\n              }\n              ch2 = ''\n            } else {\n              if (ind1 + 2 !== ch2.length) {\n                ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2) +\n                  '\\\\text{' + ch2.substring(ind1 + 2) + '}'\n              } else {\n                ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2)\n              }\n              ch2 = ''\n            }\n          } else {\n            if (ind === 0) {\n              ret += ch2.substring(0, indpf + 1)\n              if (indpf < ch2.length - 1) {\n                ch2 = ch2.substring(indpf + 1)\n              } else {\n                ch2 = ''\n              }\n            } else {\n              ret += '\\\\text{' + ch2.substring(0, ind) + '}' + ch2.substring(ind, ind1 + 2) +\n                '\\\\text{' + ch2.substring(ind1 + 2, indpf + 1) + '}'\n              if (indpf < ch2.length - 1) {\n                ch2 = ch2.substring(indpf + 1)\n              } else {\n                ch2 = ''\n              }\n            }\n          }\n        }\n        if (ch2 === '') {\n          return ret\n        } else {\n          return ret + '\\\\text{' + ch2 + '}'\n        }\n      } else {\n        // Si la chaîne commence par une parenthèse fermante, une accolade fermante ou une virgule\n        //  il s'agit d'une formule en cours et pas de mode texte\n        car = ch.charAt(0)\n        if ((car === ')') || (car === ',') || (car === '}')) {\n          return ch\n        } else {\n          // Si on est en modetexte et que la chaîne commence par des espaces, pour qu'ils soient pris en compte\n          // on va, pour ces espaces, rester en mode maths et les remplacer par des ~ pour avoir des espaces insécables.\n          let deb = ''\n          while (ch.indexOf(' ') === 0) {\n            deb += '~'\n            ch = ch.substring(1)\n          }\n          return deb + '\\\\text{' + ch + '}'\n        }\n      }\n    }\n  } else {\n    return ch\n  }\n}\n\n/**\n * Retourne obj.taille sous forme d'un number garanti entre min et max,\n * renverra options.defaut si y'a un pb (obj.taille pas un nb dans l'intervalle)\n * @param {Object} obj\n * @param {Object} [options]\n * @param {Object} [options.defaut=20] La valeur qui sera renvoyée si obj.taille n'est pas un entier entre min et max\n * @param {Object} [options.min=5] La taille min acceptable\n * @param {Object} [options.max=199] La taille max acceptable\n * @return {number}\n */\nexport function getTaille (obj, options = {}) {\n  if (!obj || typeof obj !== 'object') throw Error('objet invalide')\n  const defaut = options.defaut || 20\n  const min = options.min || 5\n  const max = options.max || 199 // dans devServer/fixture/0.xml on a une taille de 60\n  if (typeof defaut !== 'number' || typeof min !== 'number' || typeof max !== 'number') throw Error('options invalides')\n  const taille = Number(obj.taille)\n  if (isNaN(taille)) {\n    console.error(Error(`taille invalide (${obj.taille}) => ${defaut}`))\n    return defaut\n  }\n  if (taille < min) {\n    console.error(Error(`taille trop petite (${obj.taille} < ${min}) => ${defaut}`))\n    return defaut\n  }\n  if (taille > max) {\n    console.error(Error(`taille trop grande (${obj.taille} > ${max}) => ${defaut}`))\n    return defaut\n  }\n  return taille\n}\n","/* Loader qui retourne une promesse\n *\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Association Sésamath\n * @licence AGPL-3.0-or-later\n */\nimport IepApp from './app/IepApp'\nimport { addElement, empty, setStyles } from 'sesajstools/dom'\n\nimport '../styles/iep.css'\n\n// pour avoir un singleton sur l'appli\nlet iepApp\n\n// à propos de viewbox & viewport\n// https://la-cascade.io/comprendre-svg-viewbox-et-viewport/\n// https://developer.mozilla.org/fr/docs/Web/SVG/Attribute/viewBox\n// https://la-cascade.io/comprendre-svg-viewbox/\n// https://la-cascade.io/comprendre-svg-preserveaspectratio/\n// attention aussi à svg.style.width qui prend le pas sur svg.width\n// c'est le constructeur IepDoc qui va set le viewBox\n\n// il y a eu une version avec du resize auto dans le commit 8a3db59\n// https://framagit.org/Sesamath/instrumenpoche/-/blob/8a3db5973b1e517316e63d0790f14d7a8abe0cfe/sources/iepLoaderPromise.js\n// (voir aussi cette version pour l'usage de https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver sur le svg)\n// ça donnait des résultats rigolos par ex avec http://localhost:8081/#xml1 (après avoir lancé `pnpm start`)\n// et ça montre qu'il y a plein d'animations iep existantes avec du monde caché hors du viewport\n// Il y a aussi parfois la règle qui sort du cadre, et on ne veut pas réduire l'animation pour la voir en entier.\n// => on abandonne cette idée de resize auto d'après svg.getBBox()\n\n/**\n * @typedef iepLoadOptions\n * @property {boolean} [autostart=true] Passer false pour que l'animation ne démarre pas dès son chargement\n * @property {boolean} [debug=false] Passer true pour voir passer les infos de debug en console\n * @property {boolean} [zoom=false] Passer true pour ajouter les boutons de zoom (dans le parent du svg)\n */\n\n/**\n * Charge une animation iep et retourne une promesse\n * @module\n * @param {HTMLElement} container\n * @param {string} xml Le script xml ou son url (absolue !)\n * @param {iepLoadOptions} [options]\n * @return {Promise<IepApp>}\n */\nexport default function iepLoadPromise (container, xml, options) {\n  if (typeof options !== 'object') options = {}\n\n  return Promise.resolve().then(() => {\n    if (typeof window === 'undefined' || !window.document) throw Error('iepLoad doit être utilisé dans un navigateur')\n    if (typeof container === 'string') container = document.getElementById(container)\n    if (!(container instanceof HTMLElement)) throw Error('Conteneur html manquant')\n    if (typeof xml !== 'string') throw Error('Script xml manquant')\n    if (/^http/.test(xml)) return loadXml(xml)\n    return xml\n  }).then(xml => {\n    if (!xml || !/<INSTRUMENPOCHE/.test(xml)) throw Error('Ce n’est pas un script instrumenpoche valide')\n    // Il y a bcp de scripts existants contenant des images en http://*.sesamath.net/…\n    // pour ceux-là on passe en https\n    if (window.location.protocol === 'https:') {\n      xml = xml.replace(/http:\\/\\/([a-z]+.sesamath.net)/g, (strMatched, domain) => `https://${domain}`)\n    }\n    // tant pis pour les autres, ça se chargera pas…\n\n    // on ne fixe plus de taille (ni div ni svg, le svg va s'adapter)\n    // const width = options.width || container.offsetWidth || 800\n    // const height = options.height || width * 0.75 || 600\n\n    // On réinitialise le conteneur\n    empty(container)\n    // que l'on positionne (pour que le absolute des enfants se fasse par rapport à lui), avec d'éventuels scroll\n    // (Il y avait avant 'font-weight': 'normal', 'font-family': '\"Times New Roman\", Times, serif' qui a été viré pour utilisation MathJax 3\n    setStyles(container, { position: 'relative', overflow: 'auto' })\n\n    const svg = addSvg(container)\n    const iepOptions = {}\n    if (options.debug) iepOptions.debug = true\n    if (!iepApp) iepApp = new IepApp(iepOptions)\n    const autostart = typeof options.autostart === 'boolean' ? options.autostart : true\n    iepApp.addDoc(svg, xml, autostart)\n    // il faut ajouter le zoom après le script iep, car il utilise la viewBox mise par IepDoc sur le svg\n    if (options.zoom) addZoom(svg)\n    return iepApp\n  })\n}\n\n/**\n * Retourne le svg créé avec les bonnes options\n * @private\n * @param {HTMLElement} container\n * @return {SVGElement} le svg\n */\nfunction addSvg (container) {\n  // pour créer le svg, addElement marche pas (il reste à 0 de hauteur), il faut passer par createElementNS\n  // et surtout pas mettre de https sur le ns !\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n  // faut éviter d'utiliser la propriété className avec du svg (https://developer.mozilla.org/fr/docs/Web/API/Element/className#Notes)\n  // mais y'a pas de pb avec https://developer.mozilla.org/fr/docs/Web/API/Element/classList\n  svg.classList.add('svgIep')\n  container.appendChild(svg)\n\n  // au resize du conteneur faut resize le svg, mais l'événement resize n'existe que sur window\n  // (y'a bien Resize Observer mais c'est pas encore dans la spec, trop frais)\n  // => on met le svg en 100% et il suivra le div tout seul (c'est IepDoc qui fixe la viewBox)\n  // et on a plus besoin de listener sur le resize\n  setStyles(svg, {\n    margin: 0,\n    padding: 0,\n    // avec 100% on a des pbs de clignotement des ascenseurs, à 98% jamais d'ascenseur… et ça ajoute un peu de marge, pas plus mal\n    width: '98%',\n    height: '98%'\n  })\n\n  return svg\n}\n\n/**\n * Ajoute les boutons de zoom\n * @private\n * @param {HTMLElement} svg\n * @return {Promise<HTMLElement>}\n */\nfunction addZoom (svg) {\n  const container = svg.parentNode\n  // on le rend resizable (cf https://developer.mozilla.org/en-US/docs/Web/CSS/resize et https://caniuse.com/#feat=css-resize)\n  container.style.resize = 'both'\n  container.style.padding = '0'\n  container.style.border = '1px solid black'\n\n  const styleBtn = {\n    position: 'absolute',\n    zIndex: 99,\n    textAlign: 'center',\n    padding: 0,\n    width: '2.5em',\n    height: '1.8em',\n    left: '0.1em'\n  }\n  const buttonZoomIn = addElement(container, 'button', { style: { ...styleBtn, top: '0.1em' } }, '+')\n  buttonZoomIn.addEventListener('click', () => svg.iepDoc.zoom(1.1), false)\n  const buttonZoomOut = addElement(container, 'button', { style: { ...styleBtn, top: '2em' } }, '-')\n  buttonZoomOut.addEventListener('click', () => svg.iepDoc.zoom(0.9), false)\n  // const buttonZoomNone = addElement(container, 'button', { style: { ...styleBtn, top: '4em' } }, '=')\n  // buttonZoomNone.addEventListener('click', () => svg.iepDoc.zoom(1), false)\n}\n\n// à priori plus besoin\n// function getSize (elt) {\n//   const st = getComputedStyle(elt)\n//   const width = Math.max(100, parseInt(st.width, 10) || 800)\n//   const height = Math.max(0.5 * width, parseInt(st.height, 10) || 600)\n//   return { width, height }\n// }\n\nfunction loadXml (url) {\n  // faut charger le xml externe, on check que c'est faisable\n  if (window.location.protocol === 'https:' && url.substr(0, 5) === 'http:') {\n    return Promise.reject(Error(`Impossible de charger ici un script externe qui n’est pas en https (${url})`))\n  }\n  return fetch(url, { Accept: 'text/xml' }).catch(error => {\n    // on catch les erreurs réseau (pas de réseau, pb de cross domain, etc.)\n    // pour renvoyer une erreur plus compréhensible\n    console.error(error)\n    throw Error(`Impossible de récupérer le xml ${url}`)\n  }).then(response => {\n    const { status, statusText, ok } = response\n    if (status > 399) throw Error(`Impossible de récupérer le xml ${url} (erreur ${status} ${statusText})`)\n    if (!ok) throw Error(`Impossible de récupérer le xml ${url}`)\n    return response.text()\n  }).then(xml => {\n    if (!xml || !/<INSTRUMENPOCHE/.test(xml)) throw Error(`L’url ${url} ne retourne pas de script instrumenpoche en xml`)\n    return xml\n  })\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport InstrumentAncetre from './InstrumentAncetre'\nexport default Compas\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Objet Compas contenu dans une animation InstrumenPche\n * @param {IepDoc} doc le document propriétaire\n * la variable this.leve contient true si une action ActionLeverCompas a été\n * précédemment exécutée. Dans ce as c'est un autre objet iep.compasLeve qui sera créé\n * La variable this.bretourne contient true si une action ActionRetourner a été\n * exécutée précdemment.\n * et utilisé dans la figure.\n */\nfunction Compas (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.ecart = 0\n  this.bretourne = false\n  this.leve = false\n  this.lon = 185 // Longueur intérieure des deux branches des compas\n  this.longpointe = 18\n  const d = this.lon + this.longpointe\n  this.alp = Math.asin(this.ecart / (2 * d)) / Math.PI * 180 // Le demi-angle que font les deux branches du compas\n  this.decbh = 30 // Décalage vers le bas de la partie haute\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle, 1)\n  // Ajout de d'élément graphique représentnant le compas dans le SVG contenant la figure\n  doc.svg.appendChild(this.g)\n}\nCompas.prototype = new InstrumentAncetre()\n/**\n * Fonction initialisant la position du compas\n */\nCompas.prototype.initialisePosition = function () {\n  InstrumentAncetre.prototype.initialisePosition.call(this)\n  this.ecart = 0\n  this.positionne()\n}\n/**\n * Crée l'élément graphique représentant le compas\n * @returns {SVGElement}\n */\nCompas.prototype.creeg = function () {\n  let li, p, path, circ\n  const lon = this.lon // Longueur intérieure des deux branches des compas\n  const longpointe = this.longpointe // Longueur de la pointe et de la mine\n  const ep = 7 // Epaisseur des branches\n  const retb = 20 // Retrait du bouton de gauche sur la branche;\n  const rayb = 6 // Le rayon des boutons\n  const epm = 3.5 // Epaisseur de la mine\n  const dlb = 3 // la demi-largeur basse de la partie fixe\n  const dlm = 12 // La demi-largeur moyenne de la partie fixe\n  const ylm = 24 // L'ordonnée correspondante\n  const ylm2 = 35 // Ordonnée de la partie moyenne haute\n  const dlh = 6 // La demi-largeur haute de la partie fixe\n  const ylh = 50 // L'ordonnée correspondante\n  const dltop = 3 // La demi-largeur de la partie supérieure du châpeau\n  const ytop = 70 // L'ordonnée correspondante\n  const g = document.createElementNS(svgns, 'g')\n  this.bg = document.createElementNS(svgns, 'g') // La branche de gauche\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', 0)\n  li.setAttribute('y1', 0)\n  li.setAttribute('x2', 0)\n  li.setAttribute('y2', -longpointe)\n  li.setAttribute('style', 'stroke: black; stroke-width:1.5;')\n  this.bg.appendChild(li)\n  p = document.createElementNS(svgns, 'path')\n  path = 'M0 ' + String(-longpointe) + 'L 0 ' + String(-longpointe - lon) + ' ' +\n          String(-ep) + ' ' + String(-longpointe - lon) + ' ' + String(-ep) + ' ' +\n          String(-longpointe) + 'Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  this.bg.appendChild(p)\n  // On rajoute le bouton de gauche\n  circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', -ep / 2)\n  circ.setAttribute('cy', -longpointe - retb)\n  circ.setAttribute('r', rayb)\n  circ.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  this.bg.appendChild(circ)\n  circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', -ep / 2)\n  circ.setAttribute('cy', -longpointe - retb)\n  circ.setAttribute('r', 2)\n  circ.setAttribute('style', 'stroke:black;stroke-width:1; fill: silver; fill-opacity: 1')\n  this.bg.appendChild(circ)\n  g.appendChild(this.bg)\n  // La branche de droite\n  this.bd = document.createElementNS(svgns, 'g') // La branche de gauche\n  // La mine\n  p = document.createElementNS(svgns, 'path')\n  path = 'M 0 0 L0' + ' ' + String(-longpointe) + ' ' + epm + ' ' + String(-longpointe - epm) + ' ' +\n          epm + ' ' + String(-epm - 3) + 'Z'\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: blck; fill-opacity: 1')\n  p.setAttribute('d', path)\n  this.bd.appendChild(p)\n  p = document.createElementNS(svgns, 'path')\n  path = 'M0 ' + String(-longpointe) + 'L 0 ' + String(-longpointe - lon) + ' ' +\n          ep + ' ' + String(-longpointe - lon) + ' ' + ep + ' ' +\n          String(-longpointe) + 'Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  this.bd.appendChild(p)\n  // Le petit bout de bouton à droite\n  p = document.createElementNS(svgns, 'path')\n  const rayx = rayb / 4 * 3\n  const rayy = rayb / 2\n  path = 'M' + ep + ' ' + String(-longpointe - retb + rayx) + 'A ' + rayx + ' ' + rayy + ' -90 0 0 ' +\n       ep + ' ' + String(-longpointe - retb - rayx) + 'Z'\n  p.setAttribute('style', 'stroke:black;stroke-width:1; fill: silver; fill-opacity: 1')\n  p.setAttribute('d', path)\n  this.bd.appendChild(p)\n  // Ligne en biais sur la branche droite\n  const styleli = 'stroke: black; stroke-width:1;'\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', 0)\n  li.setAttribute('y1', -100)\n  li.setAttribute('x2', ep)\n  li.setAttribute('y2', -100 + ep)\n  li.setAttribute('style', styleli)\n  this.bd.appendChild(li)\n  // Autres lignes branche de droite\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', 0)\n  li.setAttribute('y1', -50)\n  li.setAttribute('x2', ep)\n  li.setAttribute('y2', -50)\n  li.setAttribute('style', styleli)\n  this.bd.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', ep / 2)\n  li.setAttribute('y1', -50)\n  li.setAttribute('x2', ep / 2)\n  li.setAttribute('y2', -73)\n  li.setAttribute('style', styleli)\n  this.bd.appendChild(li)\n  // Le bouton vu de côté\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', ep)\n  rect.setAttribute('y', -68)\n  rect.setAttribute('width', 4)\n  rect.setAttribute('height', 12)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  this.bd.appendChild(rect)\n  g.appendChild(this.bd)\n  // La partie fixe du haut\n  this.haut = document.createElementNS(svgns, 'g')\n  p = document.createElementNS(svgns, 'path')\n  path = 'M 0 0 L' + dlb + ' 0 ' + dlm + ' ' + String(-ylm) + ' ' + dlm + ' ' + String(-ylm2) +\n          'A' + String(ylh - ylm2) + ' ' + String(dlm - dlh) + ' -90 0 1 ' + dlh + ' ' + String(-ylh) +\n          'L' + dltop + ' ' + String(-ytop) + ' ' + String(-dltop) + ' ' + String(-ytop) +\n          'L' + String(-dlh) + ' ' + String(-ylh) + 'A' + String(ylh - ylm2) + ' ' + String(dlm - dlh) +\n          ' 90 0 1 ' + String(-dlm) + ' ' + String(-ylm2) + ' L ' +\n          String(-dlm) + ' ' + String(-ylm) + ' ' + String(-dlb) + ' 0Z'\n\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1')\n  // this.haut.setAttribute(\"transform\",\"translate(0,30)\");\n  this.haut.appendChild(p)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', dlh)\n  li.setAttribute('y1', -ylh)\n  li.setAttribute('x2', -dlh)\n  li.setAttribute('y2', -ylh)\n  li.setAttribute('style', 'stroke: black; stroke-width:1;')\n  this.haut.appendChild(li)\n  // On ajoute le logo Sesamath\n  const text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('Sésamath'))\n  text.setAttribute('x', 0)\n  text.setAttribute('y', 0)\n  text.setAttribute('style', 'font-family: Arial;font-size: 5pt;fill: white')\n  text.setAttribute('transform', 'rotate(-90) translate(4,2.5)')\n  this.haut.appendChild(text)\n\n  // On rajoute les deux petits ronds blancs (rivets) à chaque branche\n  circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', -ep + 1)\n  circ.setAttribute('cy', -this.decbh)\n  circ.setAttribute('r', 3)\n  circ.setAttribute('style', 'stroke:black;stroke-width:1; fill: white; fill-opacity: 1')\n  this.haut.appendChild(circ)\n  circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', ep - 1)\n  circ.setAttribute('cy', -this.decbh)\n  circ.setAttribute('r', 3)\n  circ.setAttribute('style', 'stroke:black;stroke-width:1; fill: white; fill-opacity: 1')\n  this.haut.appendChild(circ)\n\n  g.appendChild(this.haut)\n  this.g = g\n}\n/**\n * Fonction calculant les éléments graphiques du compas et modifiant le svg element\n * en conséquence.\n * @param {number} x l'abscisse de la point du compas\n * @param {number} y l'ordonnée de la pointe du compas\n * @param {number} angle l'angle en degrés que fait le compas avec l'horizontale\n * @param {number} zoomfactor le zoom initialisé au départ à 1 et qui peut être\n * modifié par une action ActionZoomInstrument\n */\nCompas.prototype.setPosition = function (x, y, angle, zoomfactor) {\n  let zoom\n  if (arguments.length >= 4) {\n    zoom = zoomfactor\n    this.zoomfactor = zoom\n  } else {\n    zoom = this.zoomfactor\n  }\n  this.x = x\n  this.y = y\n  this.angle = angle\n  const d = this.lon + this.longpointe\n  // Le demi-angle que font les deux branches du compas\n  let nb = this.ecart / (2 * d * zoom)\n  if (nb > 1) nb = 1 // Si on demande un écartement de compas irréaliste ...\n  this.alp = Math.asin(nb) / Math.PI * 180\n  if (isNaN(this.alp)) {\n    console.error(Error('dans compas.setPosition on a alp qui est NaN'))\n    if (this.doc.debug) console.log(`avec x=${x}, y=${y}, angle=${angle} et zoom=${zoom} on a d=${d} et ecart=${this.ecart} asin(${this.ecart}/${2 * d * zoom}/π*180) donne NaN`)\n  } else {\n    this.bg.setAttribute('transform', `rotate(${this.alp})`)\n    this.bd.setAttribute('transform', `translate(${this.ecart / zoom}, 0) rotate(${-this.alp})`)\n    const ang = this.alp / 180 * Math.PI\n    const transX = this.ecart / 2 / zoom\n    const transY = (-d) * Math.cos(ang) + this.decbh\n    this.haut.setAttribute('transform', `translate(${transX},${transY})`)\n    const scale = this.bretourne ? `scale(${zoom},${-zoom})` : `scale(${zoom})`\n    this.g.setAttribute('transform', `${scale} translate(${x / zoom},${y / zoom}) rotate(${angle})`)\n  }\n}\n/**\n * Fonction utilisée pour mettre le compas en position retournée par rapport\n * à la position précédente.\n */\nCompas.prototype.retourne = function () {\n  this.bretourne = !this.bretourne\n  this.setPosition(this.x, this.y, this.angle)\n}\n/**\n * Fonction recalculant les éléments du Compas et mettant en conséquence à jour\n * l'élément graphique qui le représente.\n */\nCompas.prototype.positionne = function () {\n  InstrumentAncetre.prototype.positionne.call(this)\n  if (this.leve && (this.doc.compasLeve != null)) InstrumentAncetre.prototype.positionne.call(this.doc.compasLeve)\n}\n/**\n * Fonction translatant le compas au point de coordonnées (x;y)\n * @param {number} x l'abscisse du point de destination\n * @param {number} y l'ordonnée du point de destination\n */\nCompas.prototype.translate = function (x, y) {\n  InstrumentAncetre.prototype.translate.call(this, x, y)\n  if (this.leve && (this.doc.compasLeve != null)) InstrumentAncetre.prototype.translate.call(this.doc.compasLeve, x, y)\n}\n/**\n * Fonction lançant une animation d'écartement de compas pour une action ActionEcaterCompas\n * @param {number} ecart l la valeur de l'écartement final (en unités de longueur)\n * @param {number} ec10 le pas d'incrémentation pour l'écart à chaque dixième de seconde\n */\nCompas.prototype.lanceAnimationEcartement = function (ecart, ec10) {\n  this.ecartfin = parseFloat(ecart)\n  // Dans la version JavaScript on pourra rajouter un paramètre donnant le pas\n  // d'écartement par dixième de seconde\n  this.pasecart = ec10 / 4\n  this.pasecart *= (ecart >= this.ecart) ? 1 : -1 // 1 pour le sens direct svg\n  this.distecart = Math.abs(ecart - this.ecart)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourEcartement() }, 25)\n}\n// On poursuit l'animation tant que la distance entre la position actuelle et la psoition de fin\n// est inférieure à la distance précédente\n/**\n * Fonction appelée par un timer lors d'une aniamtion d'écartement de compas\n * On poursuit l'animation tant que la distance entre la position actuelle et\n * la position de fin de n réaugmente pas\n */\nCompas.prototype.actionPourEcartement = function () {\n  const ec = this.ecart + this.pasecart\n  const dis = Math.abs(ec - this.ecartfin)\n  if ((dis > this.distecart) || !this.doc.animationEnCours) {\n    this.ecart = this.ecartfin\n    this.setPosition(this.x, this.y, this.angle)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.distecart = dis\n    this.ecart = ec\n    this.setPosition(this.x, this.y, this.angle)\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport InstrumentAncetre from './InstrumentAncetre'\nexport default CompasLeve\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Classe représentant le compas vu du dessus.\n * Attention : Contrairement au compas normal, le compas levé doit être reconstruit à  chaque fois\n * que son écartement est modifié.\n */\nfunction CompasLeve (doc, x, y, angle, ecart) {\n  InstrumentAncetre.call(this, doc)\n  const oldg = (doc.compasLeve == null) ? null : doc.compasLeve.g\n  this.x = x\n  this.y = y\n  this.angle = angle\n  this.ecart = ecart\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(x, y, angle)\n  if (oldg == null) doc.svg.appendChild(this.g)\n  else doc.svg.replaceChild(this.g, oldg)\n}\nCompasLeve.prototype = new InstrumentAncetre()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant le compas\n * levé dans le DOM du svg contenant la figure.\n */\nCompasLeve.prototype.creeg = function () {\n  let rect, li, p\n  const ep = 7 // Epaisseur des branches. La même que dans compas.\n  const longpointe = 8 // Longueur de la pointe et des mines\n  const ecart = this.ecart\n\n  const g = document.createElementNS(svgns, 'g')\n  if (this.ecart > 2 * longpointe) {\n    rect = document.createElementNS(svgns, 'rect')\n    rect.setAttribute('x', longpointe)\n    rect.setAttribute('y', -ep / 2)\n    rect.setAttribute('width', this.ecart - 2 * longpointe)\n    rect.setAttribute('height', ep)\n    rect.setAttribute('rx', 1)\n    rect.setAttribute('ry', 1)\n    rect.setAttribute('style', 'stroke:black;stroke-width:0.5;fill:silver;fill-opacity:1')\n    g.appendChild(rect)\n  }\n  p = document.createElementNS(svgns, 'path')\n  p.setAttribute('d', 'M0 0 L' + longpointe + ' 1 ' + longpointe + ' -1Z')\n  p.setAttribute('style', 'stroke:black;stroke-width:0.5;fill:black;fill-opacity:1')\n  g.appendChild(p)\n  const d = ecart - 2 * longpointe\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', longpointe)\n  li.setAttribute('y1', 0)\n  li.setAttribute('x2', longpointe + d / 8)\n  li.setAttribute('y2', 0)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  p = document.createElementNS(svgns, 'path')\n  const e = String(ecart - longpointe)\n  p.setAttribute('d', 'M' + ecart + ' 0 L' + e + ' 1.5 ' + e + ' -1.5Z')\n  p.setAttribute('style', 'stroke:black;stroke-width:0.5;fill:black;fill-opacity:1')\n  g.appendChild(p)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', e)\n  li.setAttribute('y1', 0)\n  li.setAttribute('x2', String(ecart - longpointe - d / 8))\n  li.setAttribute('y2', 0)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  let f = String(ecart - longpointe - d / 8 - 2)\n  li.setAttribute('x1', f)\n  li.setAttribute('y1', -ep / 2)\n  li.setAttribute('x2', f)\n  li.setAttribute('y2', ep / 2)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  f = String(ecart - longpointe - d / 3 - 2)\n  li.setAttribute('x1', f)\n  li.setAttribute('y1', -ep / 2)\n  li.setAttribute('x2', f)\n  li.setAttribute('y2', ep / 2)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  // Les boutons vus en perspective\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', String(longpointe + d / 8 - 5))\n  rect.setAttribute('y', String(-ep))\n  rect.setAttribute('width', 8)\n  rect.setAttribute('height', 3)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  g.appendChild(rect)\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', String(ecart - longpointe - d / 8 - 4))\n  rect.setAttribute('y', String(-ep))\n  rect.setAttribute('width', 8)\n  rect.setAttribute('height', 3)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  g.appendChild(rect)\n\n  // Le dessus\n  const dl = 12 // Demi-largeur de la partie centrale grise\n  const dh = 4 // Demi-hauteur de la partie centrale grise\n  p = document.createElementNS(svgns, 'path')\n  const path = 'M' + String(ecart / 2 + dl) + ' ' + String(-dh) + ' A ' + String(dl) +\n          ' 2 180 0 0 ' + String(ecart / 2 - dl) + ' ' + String(-dh) + 'A' +\n          String(dh) + ' 2 90 0 1 ' + String(ecart / 2 - dl) + ' ' + String(dh) + 'A' +\n          String(dl) + ' 2 0 0 0 ' + String(ecart / 2 + dl) + ' ' + String(dh) + 'A' +\n          String(dh) + ' 2 -90 0 1 ' + String(ecart / 2 + dl) + ' ' + String(-dh)\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1')\n  g.appendChild(p)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', String(ecart / 2 + dl))\n  li.setAttribute('y1', -ep / 2)\n  li.setAttribute('x2', String(ecart / 2 - dl))\n  li.setAttribute('y2', ep / 2)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', String(ecart / 2 - dl))\n  li.setAttribute('y1', -ep / 2)\n  li.setAttribute('x2', String(ecart / 2 + dl))\n  li.setAttribute('y2', ep / 2)\n  li.setAttribute('style', 'stroke: black; stroke-width:0.5;')\n  g.appendChild(li)\n  const circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', String(ecart / 2))\n  circ.setAttribute('cy', 0)\n  circ.setAttribute('r', 5)\n  circ.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1')\n  g.appendChild(circ)\n  // Les boutons vus en perspective\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', String(longpointe + d / 8 - 5))\n  rect.setAttribute('y', String(-ep))\n  rect.setAttribute('width', 7)\n  rect.setAttribute('height', 3)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  g.appendChild(rect)\n  rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', String(ecart - longpointe - d / 8 - 4))\n  rect.setAttribute('y', String(-ep))\n  rect.setAttribute('width', 7)\n  rect.setAttribute('height', 3)\n  rect.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1')\n  g.appendChild(rect)\n  this.g = g\n}\n/**\n * Fonction mettant le svg element représentant le compas levé à la position (x,y)\n * avec un angle avce l'horizontale égal à angle\n * @param {number} x\n * @param {number} y\n * @param {number} angle\n */\nCompasLeve.prototype.setPosition = function (x, y, angle) {\n  this.x = x\n  this.y = y\n  this.angle = angle\n  this.g.setAttribute('transform', 'translate(' + x + ',' + y + ') rotate(' + angle + ')')\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport InstrumentAncetre from './InstrumentAncetre'\nexport default Crayon\n/**\n * Classe représentant le crayon de la figure.\n * (this.x,this.y) sont les coordonnées de la pointe de la mine\n * this.angle est l'angle du corps du crayon par rapport à l'horizontale.\n * @constructor\n * @extends InstrumentAncetre\n * @param {IepDoc} doc le document propriétaire de la figure\n */\nfunction Crayon (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.angle = this.angleInit()\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\nCrayon.prototype = new InstrumentAncetre()\n\n/**\n * extends iep.instruementAncetre\n */\nCrayon.prototype.angleInit = function () {\n  return -40\n}\n/**\n * Fonction mettant dans this.g l'élément graphique représentant le crayon\n * dans le DOM du svg de la figure\n */\nCrayon.prototype.creeg = function () {\n  let defs, p, path, lg, stop\n  const lon = 97 // La longueur totale (sans le demi-cercle final)\n  const longpointe = 15 // La longueur de la mine\n  const demlarg = 4.5 // La demi-largeur du crayon\n  const longmine = 3\n  const demlargmine = longmine / longpointe * demlarg\n\n  const g = document.createElementNS(svgns, 'g')\n  // On crée un gradiant linéaire pour la mine\n  // Il est nécessaire d'englober le gradient dans un defs pour pouvoir l'utiliser via url(#grad) plus tard\n  defs = document.createElementNS(svgns, 'defs')\n  lg = document.createElementNS(svgns, 'linearGradient')\n  lg.setAttribute('id', 'gradpointe')\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '0%')\n  stop.setAttribute('style', 'stop-color: #f00000;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '50%')\n  stop.setAttribute('style', 'stop-color: #eeb444;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '100%')\n  stop.setAttribute('style', 'stop-color: #f00000')\n  lg.appendChild(stop)\n  lg.setAttribute('x1', '0%')\n  lg.setAttribute('y1', '0%')\n  lg.setAttribute('x2', '0%')\n  lg.setAttribute('y2', '100%')\n  defs.appendChild(lg)\n  g.appendChild(defs)\n  // Un autre gradiant pour le corps du crayon\n  defs = document.createElementNS(svgns, 'defs')\n  lg = document.createElementNS(svgns, 'linearGradient')\n  lg.setAttribute('id', 'gradcorps')\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '0%')\n  stop.setAttribute('style', 'stop-color: #810216;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '25%')\n  stop.setAttribute('style', 'stop-color: #c64f00;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '50%')\n  stop.setAttribute('style', 'stop-color: #ab4a36')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '75%')\n  stop.setAttribute('style', 'stop-color: #c64f00;')\n  lg.appendChild(stop)\n  stop = document.createElementNS(svgns, 'stop')\n  stop.setAttribute('offset', '100%')\n  stop.setAttribute('style', 'stop-colr: #810216;')\n  lg.appendChild(stop)\n  lg.setAttribute('x1', '0%')\n  lg.setAttribute('y1', '0%')\n  lg.setAttribute('x2', '0%')\n  lg.setAttribute('y2', '100%')\n  defs.appendChild(lg)\n  g.appendChild(defs)\n\n  // D'abord la mine\n  p = document.createElementNS(svgns, 'path')\n  const rx = demlarg / 3\n  const ry = rx * 3 / 4\n  const path1 = 'A' + rx + ' ' + ry + ' -90 0 0 ' +\n          longpointe + ' ' + String(rx) + 'A' + rx + ' ' + ry + ' -90 0 1 ' +\n          +longpointe + ' ' + String(-rx) + 'A' + rx + ' ' + ry + ' -90 0 0 ' +\n          +longpointe + ' ' + String(-demlarg)\n  path = 'M 0 0 L' + longpointe + ' ' + demlarg + path1 + 'Z'\n\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black; stroke-width:0.5; fill: url(#gradpointe); fill-opacity: 1;')\n  g.appendChild(p)\n  // La pointe noire\n  p = document.createElementNS(svgns, 'path')\n  path = 'M 0 0 L ' + longmine + ' ' + demlargmine + ' ' + longmine + ' ' +\n          String(-demlargmine) + 'Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black; stroke-width:0.5; fill: black; fill-opacity: 1;')\n  g.appendChild(p)\n  // Le corps du crayon\n  p = document.createElementNS(svgns, 'path')\n  path = 'M ' + longpointe + ' ' + demlarg + path1 + ' L ' + lon + ' ' + String(-demlarg) +\n          ' L ' + lon + ' ' + String(demlarg) + 'Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black; stroke-width:0.5; fill: url(#gradcorps); fill-opacity: 1;')\n  g.appendChild(p)\n  // Le cercle bleu du bout\n  const circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('r', demlarg)\n  circ.setAttribute('cx', lon)\n  circ.setAttribute('cy', 0)\n  circ.setAttribute('style', 'stroke:blue; stroke-width:0.5; fill: blue; fill-opacity: 1;')\n  g.appendChild(circ)\n  this.g = g\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport InstrumentAncetre from './InstrumentAncetre'\nexport default Equerre\n/**\n * Objet représentant l'équerre de la figure.\n * @constructor\n * @extends InstrumentAncetre\n * (this.x,this.y)  sont les coordonnées du sommet de l'équerre\n * this.angle est l'angle que fait l'équerre avec l'horizontale.\n * @param {IepDoc} doc le document propriétaire de la figure\n */\nfunction Equerre (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\nEquerre.prototype = new InstrumentAncetre()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'équerre\n * dans le DOM du svg qui contient la figure\n * @returns {g}\n */\nEquerre.prototype.creeg = function () {\n  let p, path\n  const largeur = 131\n  const hauteur = 223\n  const largeurbas = 31\n  const largeurgauche = 24\n  const largeurint = 61\n  const hauteurint = largeurint * hauteur / largeur\n  const largeurbande = 16 // pour la partie plus claire en bas et à gauche.\n  const h = hauteur / largeur * (largeur - largeurbande) // Hauteur basse de la partie plus claire\n  const l = largeur / hauteur * (hauteur - largeurbande)\n\n  const g = document.createElementNS(svgns, 'g')\n  // D'abord le pourtour\n  p = document.createElementNS(svgns, 'path')\n  // Pourtour exterieur\n  path = 'M 0 0 L ' + largeur + ' 0 L 0 ' + String(-hauteur) + ' Z'\n  // Pourtout intérieur qui doit être parcouru dans l'autre sens pour le remplissage\n  const path2 = 'M ' + largeurgauche + ' ' + String(-largeurbas) + ' L ' + largeurgauche + ' ' +\n          String(-largeurbas - hauteurint) + ' L ' + String(largeurgauche + largeurint) +\n          ' ' + String(-largeurbas) + ' Z'\n  path += path2\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:black;stroke-width:0.75; fill: #c6cbe8; fill-opacity: 0.5')\n  g.appendChild(p)\n  // On repasse l'intérieur pour laisser une bande plus claire sur les côtés\n  p = document.createElementNS(svgns, 'path')\n  path = 'M ' + largeurbande + ' ' + String(-largeurbande) + ' L ' + l + ' ' +\n          String(-largeurbande) + ' L ' + largeurbande + ' ' + (-h) + ' Z'\n  path += path2\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke-width:0; fill: #c6cbe8; fill-opacity: 0.5')\n  g.appendChild(p)\n  // On rajoute le texte Sesamath dans la barre du bas\n  const text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('Sésamath'))\n  text.setAttribute('x', largeurgauche)\n  text.setAttribute('y', -largeurbande / 2 - 5)\n  text.setAttribute('style', 'font-family: Arial;font-size: 8pt;font-weight:bold;fill: maroon')\n  g.appendChild(text)\n  this.g = g\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport * as kernel from '../global'\nimport Vect from '../types/Vect'\nexport default InstrumentAncetre\n/**\n * Classe ancêtre de tous les instruments.\n * Contient deux membres this.x et this.y contenant les coordonnées de l'instrument\n * un membre this.angle contenant l'angle de l'instrument avec l'ohorizontale\n * et un membre this.zoomfactor contenant le facteur d'agrandissement de l'instrument.\n * @constructor\n * @param {IepDoc} doc le document contenant la figure et les instruments\n */\nfunction InstrumentAncetre (doc) {\n  this.doc = doc\n  this.x = 200\n  this.y = 400\n  this.angle = 0 // Sera modifié au départ seulement pour le crayon\n  this.zoomfactor = 1\n  this.visible = false\n}\n/**\n * Fonction mettant l'instrument en position visible et montrant l'élement\n * graphique le représentant dans le DOM du svg de la figure\n * @param {boolean} bvisible\n */\nInstrumentAncetre.prototype.montre = function (bvisible) {\n  this.visible = bvisible\n  this.g.setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n}\n/**\n * Fonction retirant du DOM du svg de la figure l'élément graphique représentant\n * l'instrument, le recréant et le rajoutant ensuite de façon que l'instrument\n * soit après les éléments graphiques représentant les objets de la figure et ne\n * soit pas recouvert par eux.\n * @returns {undefined}\n */\nInstrumentAncetre.prototype.updateg = function () {\n  this.initialisePosition()\n  this.doc.svg.removeChild(this.g)\n  this.doc.svg.appendChild(this.g)\n}\n/**\n * Fonction amenant l'instruemnt aux coordonnées (x,y) sans changer l'angle\n * ni le rapport de zoom.\n * @param {number} x La nouvelle abscisse\n * @param {number} y La nouvelle ordonnée\n * @returns {undefined}\n */\nInstrumentAncetre.prototype.translate = function (x, y) {\n  this.setPosition(x, y, this.angle, this.zoomfactor)\n}\n/**\n * Fonction envoayan l'angle initial de l'instruement.\n * Sera redéfini pour le crayon à -40°\n * @returns {number}\n */\nInstrumentAncetre.prototype.angleInit = function () {\n  return 0\n}\n/**\n * Fonction modifiant la position relative du g element représentant l'instrument\n * dans le svg de la figure pour qu'i soit à la bonne position, bon angle et bon zoom\n * Sera redéfini pour le compas et le compas levé.\n * @param {number} x\n * @param {number} y\n * @param {number} angle\n * @param {number} zoomfactor\n */\nInstrumentAncetre.prototype.setPosition = function (x, y, angle, zoomfactor) {\n  let zoom\n  this.x = x\n  this.y = y\n  this.angle = angle\n  if (arguments.length >= 4) {\n    zoom = zoomfactor\n    this.zoomfactor = zoom\n  } else zoom = this.zoomfactor\n  this.g.setAttribute('transform', 'scale(' + zoom + ') translate(' +\n    String(x / zoom) + ',' + String(y / zoom) + ') rotate(' + angle + ')')\n}\n/**\n * Fonction initialisant la position de l'instrument\n */\nInstrumentAncetre.prototype.initialisePosition = function () {\n  this.setPosition(200, 400, this.angleInit(), 1)\n}\n/**\n * Fonction lançant une animation de l'instrument par translation\n * @param {number} xfin l'abscisse de l'instrument à la fin de la translation\n * @param {number} yfin l'ordonnée de l'instrument à la fin de la translation\n * @param {number} pix Le nombre de pixels de la translation à chaque dixième de seconde\n */\nInstrumentAncetre.prototype.lanceAnimationTranslation = function (xfin, yfin, pix10) {\n  this.xfin = xfin\n  this.yfin = yfin\n  this.pix = Math.abs(pix10 / 2) // Dans la version JavaScript on quadruple la fréquence\n  // en divisant le pas par 4\n  // (en fait on corrige par car la rapidité semble double de celle annoncée dans le mode d'emploi)\n  const v = new Vect(this.x, this.y, xfin, yfin)\n  this.dist = v.norme() // La distance entre la position actuelle et la position finale\n  if (this.dist === 0) {\n    this.doc.actionSuivante()\n    return\n  }\n  this.vect = v.vecteurColineaire(this.pix)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourTranslation() }, 25)\n}\n// On poursuit l'animation tant que la distance entre la position actuelle et la psoition de fin\n// est inférieure à la distance précédente\n/**\n * Fonction appelée par un timer lors de l'animation de translation de l'instrument\n */\nInstrumentAncetre.prototype.actionPourTranslation = function () {\n  const x = this.x + this.vect.x\n  const y = this.y + this.vect.y\n  const u = new Vect(x, y, this.xfin, this.yfin)\n  const d = u.norme()\n  if ((d > this.dist) || !this.doc.animationEnCours) {\n    this.setPosition(this.xfin, this.yfin, this.angle)\n    if (this === this.doc.compas) {\n      if ((this.doc.compasLeve != null) && (this.doc.compasLeve.visible)) { this.doc.compasLeve.setPosition(this.xfin, this.yfin, this.angle) }\n    }\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.dist = d\n    this.setPosition(x, y, this.angle)\n    if (this === this.doc.compas) {\n      if ((this.doc.compasLeve != null) && (this.doc.compasLeve.visible)) { this.doc.compasLeve.setPosition(x, y, this.angle) }\n    }\n  }\n}\n/**\n * Fonction lançant une animation de l'instrument par rotation\n * @param {number} l'angle de fin de l'objet avec l'horizontale après la rotation\n * @param {number} deg10 le nombre de degrés dont on tounre à chaque\n * dixième de seconde\n */\nInstrumentAncetre.prototype.lanceAnimationRotation = function (angfin, deg10) {\n  // Il faut choisir le déplacement \"le plus court\"\n  const ang1 = kernel.mesurePrincDeg(this.angle)\n  let ang2 = kernel.mesurePrincDeg(angfin)\n  if (Math.abs(ang2 - ang1) > 180) {\n    if (ang2 > ang1) ang2 = ang2 - 360\n    else ang2 = ang2 + 360\n  }\n  this.anglefin = ang2\n  this.angle = ang1\n  // Contraiement à ce qui est dit dans la doc d'instrumenpoche il semble que le pas par défaut soit de 16 °\n  // et même un peu plus\n  this.pasdeg = deg10 / 3 // Dans la version JavaScript on quadruple la fréquence\n  // En divisant le pas par 4\n  // Mais en fait par deux pour compatibilité observée\n  this.pasdeg *= (ang2 >= ang1) ? 1 : -1 // 1 pour le sens direct svg;\n  this.distang = Math.abs(ang2 - this.angle)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourRotation() }, 25)\n}\n/**\n * Fonction appelée par un timer lors de l'animation de rotation de l'instrument\n */\nInstrumentAncetre.prototype.actionPourRotation = function () {\n  const ang = parseFloat(this.angle) + parseFloat(this.pasdeg)\n  const dis = Math.abs(ang - this.anglefin)\n  if ((dis > this.distang) || !this.doc.animationEnCours) {\n    this.setPosition(this.x, this.y, this.anglefin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.distang = dis\n    this.setPosition(this.x, this.y, ang)\n  }\n}\n/**\n * Fonction lançant une animation de l'instrument par zoom\n * @param {number} zoomfin le zoom final quand l'animation est finie\n * @param {number} vitesse paramètre représentant la vitesse d'animation\n */\nInstrumentAncetre.prototype.lanceAnimationZoom = function (zoomfin, vitesse) {\n  this.zoomfin = zoomfin\n  this.vitesse = parseInt(vitesse)\n  this.pas = this.vitesse * 0.05 * (this.zoomfin - this.zoomfactor) // On augmente\n  // par défaut de 5% de vitesse tous les dixièmes de seconde\n  this.senspos = (this.pas >= 0)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourZoom() }, 100)\n}\n/**\n * Fonction appelée par un timer lors de l'animation de zoom de l'instrument\n */\nInstrumentAncetre.prototype.actionPourZoom = function () {\n  const z = this.zoomfactor + this.pas\n  if (this.doc.animationEnCours && ((this.senspos && (z < this.zoomfin)) || (!this.senspos && (z > this.zoomfin)))) { this.setPosition(this.x, this.y, this.angle, z) } else {\n    this.zoomfactor = this.zoomfin\n    this.positionne()\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  }\n}\n/**\n * Fonction recalculant l'élément graphique représentant l'instrument et\n * remettant son élément grapique en accord avec cette position\n */\nInstrumentAncetre.prototype.positionne = function () {\n  this.setPosition(this.x, this.y, this.angle, this.zoomfactor)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport InstrumentAncetre from './InstrumentAncetre'\nexport default Rapporteur\n\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Classe représentant le rapporteur de la figure.\n * @param {IepDoc} doc\n */\nfunction Rapporteur (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.graduationExterneVisible = true\n  this.graduationInterneVisible = true\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\n\nRapporteur.prototype = new InstrumentAncetre()\n\n/**\n * Fonction mettant dans this.g l'élément graphique représentant le rapporteur dans\n * le DOM du svg de la figure\n */\nRapporteur.prototype.creeg = function () {\n  let path, p, li, i, text\n  const hauteurPolice = 10\n  const hauteurPoliceInterne = 9\n  const largeurBarre = '13'\n  const ray = 156\n  const rayon = String(ray) // Le rayon extérieur\n  const rayInt = 89\n  const rayonInt = String(rayInt) // Le rayon intérieur\n  const raytraitint = '116' // Le rayon du trait interne\n  const rayonMire = '7'\n  const g = document.createElementNS(svgns, 'g')\n  p = document.createElementNS(svgns, 'path')\n  // Le pourtour\n  path = 'M ' + rayon + ' 0 A ' + rayon + ' ' + rayon + ' 0 0 0 -' + rayon + ' 0 L ' +\n          '-' + rayon + ' ' + largeurBarre + ' L ' + rayon + ' ' + largeurBarre +\n          ' L ' + rayon + ' 0'\n  // L'intérieur qui doit être tacé dans l'autre sens\n  path += 'M 0 0 L -' + rayonInt + ' 0 A ' + rayonInt + ' ' + rayonInt + ' 0 0 1 ' +\n          rayonInt + ' 0 Z'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke:#999999;stroke-width:1; fill: #c6cbe8; fill-opacity: 0.5')\n  g.appendChild(p)\n  // La mire\n  p = document.createElementNS(svgns, 'path')\n  path = 'M ' + rayonMire + ' 0 A ' + rayonMire + ' ' + rayonMire + ' 0 0 0 ' +\n          '-' + rayonMire + ' 0 M 0 0 L 0 -' + rayonMire\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke: #666666;stroke-width:1; fill: none')\n  g.appendChild(p)\n  // Les graduations externes\n  for (i = 0; i <= 180; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('x1', rayon)\n    li.setAttribute('y1', 0)\n    li.setAttribute('x2', i % 10 === 0 ? ray - 20 : (i % 5 === 0 ? ray - 10 : ray - 5))\n    li.setAttribute('y2', 0)\n    li.setAttribute('transform', 'rotate(-' + i + ')')\n    li.setAttribute('style', 'stroke: #333333;stroke-width:0.7;')\n    g.appendChild(li)\n  }\n  // Les nombres de la graduation externe\n  this.gradext = document.createElementNS(svgns, 'g')\n  for (i = 0; i <= 180; i++) {\n    if (i % 10 === 0) {\n      text = document.createElementNS(svgns, 'text')\n      text.setAttribute('pointer-events', 'none')\n      text.appendChild(document.createTextNode(i))\n      text.setAttribute('x', 0)\n      text.setAttribute('y', 0)\n      text.setAttribute('style', 'font-family: arial;font-size: ' + hauteurPolice +\n              'px;text-anchor: middle; fill: black')\n      text.setAttribute('transform', ' scale(-1) rotate(' + String(-i - 90) + ') translate(0,' +\n              String(-ray + 22 + hauteurPolice) + ')')\n      this.gradext.appendChild(text)\n    }\n  }\n  g.appendChild(this.gradext)\n  // On rajoute le trait interne séparat les graduatiosn externes et internes\n  const dep = ray - 26 - hauteurPolice\n  p = document.createElementNS(svgns, 'path')\n  path = 'M ' + String(dep) + ' 0 L ' + raytraitint + ' 0 A ' +\n          raytraitint + ' ' + raytraitint + ' 0 0 0 -' + raytraitint + ' 0 L ' +\n          String(-dep) + ' 0'\n  p.setAttribute('d', path)\n  p.setAttribute('style', 'stroke: #666666;stroke-width:1; fill: none')\n  g.appendChild(p)\n  // On rajoute les graduatiions internes\n  for (i = 0; i <= 18; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('x1', rayInt)\n    li.setAttribute('y1', 0)\n    li.setAttribute('x2', rayInt + 10)\n    li.setAttribute('y2', 0)\n    li.setAttribute('transform', 'rotate(-' + String(10 * i) + ')')\n    li.setAttribute('style', 'stroke: #333333;stroke-width:0.7;')\n    g.appendChild(li)\n  }\n  // Les nombres de la graduation interne\n  this.gradint = document.createElementNS(svgns, 'g')\n  for (i = 0; i <= 18; i++) {\n    text = document.createElementNS(svgns, 'text')\n    text.setAttribute('pointer-events', 'none')\n    text.appendChild(document.createTextNode(180 - 10 * i))\n    text.setAttribute('x', 0)\n    text.setAttribute('y', 0)\n    text.setAttribute('style', 'font-family: arial;font-size: ' + hauteurPoliceInterne +\n              'px;text-anchor: middle; fill: black')\n    text.setAttribute('transform', 'scale(-1) rotate(' + String(-10 * i - 90) + ') translate(0,' +\n              String(-rayInt - 14) + ')')\n    // text.setAttribute(\"transform\", \"rotate(\" + String(-10*i+1) + \")\");\n    this.gradint.appendChild(text)\n  }\n  g.appendChild(this.gradint)\n  // On matérialise le centre par un petit rond (n'existait pas).\n  const circ = document.createElementNS(svgns, 'circle')\n  circ.setAttribute('cx', 0)\n  circ.setAttribute('cy', 0)\n  circ.setAttribute('r', 2)\n  circ.setAttribute('style', 'stroke: black; stroke-width: 1;fill: none')\n  g.appendChild(circ)\n  // On rajoute le texte Sesamath dans la barre du bas\n  text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('Sésamath'))\n  text.setAttribute('x', 0)\n  text.setAttribute('y', largeurBarre - 2)\n  text.setAttribute('style', 'font-family: sans-serif;font-size: 7pt;font-weight:bold;text-anchor: middle; fill: maroon')\n  g.appendChild(text)\n  this.g = g\n}\n\n/**\n * Fonction montrant ou affichant les nombres de la graduation externe\n * @param {boolean} [bvisible=false] Nombres affichés si true\n */\nRapporteur.prototype.montreGraduations = function (bvisible) {\n  this.graduationInterneVisible = true\n  if (this.visible) this.gradint.setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n}\n\n/**\n * Fonction montrant ou affichant les nombres de la graduation interne du rapporteur\n * @param {boolean} [bvisible=false]Nombres affichés si true\n */\nRapporteur.prototype.montreGraduationsExternes = function (bvisible) {\n  this.graduationExterneVisible = true\n  if (this.visible) this.gradext.setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n}\n\n/**\n * Fonction mettant le rapporteur en position visible ou caché suivant la\n * valeur de bvisible\n * @param {boolean} [bvisible=false]\n */\nRapporteur.prototype.montre = function (bvisible) {\n  InstrumentAncetre.prototype.montre.call(this, bvisible)\n  if (bvisible) {\n    this.gradint.setAttribute('visibility', this.graduationInterneVisible ? 'visible' : 'hidden')\n    this.gradext.setAttribute('visibility', this.graduationExterneVisible ? 'visible' : 'hidden')\n  } else {\n    this.gradint.setAttribute('visibility', 'hidden')\n    this.gradext.setAttribute('visibility', 'hidden')\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport InstrumentAncetre from './InstrumentAncetre'\nexport default Regle\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Classe représentant la règle de la figure\n * @param {IepDoc} doc le document propriétaire de la figure\n */\nfunction Regle (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.x = 100\n  this.y = 400\n  this.angle = 0\n  this.longueur = 15 // Longueur en cm. Peut être modifier par actionModifierLongueur\n  // 30 pixels par cm\n  this.graduationVisible = true\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\nRegle.prototype = new InstrumentAncetre()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant la règle\n * dans le DOM du svg de la figure\n */\nRegle.prototype.creeg = function () {\n  let li, text\n  const hauteurPolice = 9\n  const longint = this.longueur * 30 + 15\n  const larg = 57\n  const largeur = String(larg)\n  const ray = 6 // Rayon de courbure des coins\n  const rayon = String(ray)\n  const g = document.createElementNS(svgns, 'g')\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('x', -rayon - 1)\n  rect.setAttribute('y', 0)\n  rect.setAttribute('width', String(longint + ray + 1))\n  rect.setAttribute('height', largeur)\n  rect.setAttribute('rx', rayon)\n  rect.setAttribute('ry', rayon)\n  rect.setAttribute('style', 'stroke:#999999;stroke-width:2; fill: #c6cbe8; fill-opacity: 0.5;')\n  g.appendChild(rect)\n  const line = document.createElementNS(svgns, 'line')\n  line.setAttribute('x1', -rayon)\n  line.setAttribute('y1', 27)\n  line.setAttribute('x2', longint)\n  line.setAttribute('y2', 27)\n  line.setAttribute('style', 'stroke:#999999;stroke-width:2;')\n  g.appendChild(line)\n  // On crée les graduations\n  this.graduations = document.createElementNS(svgns, 'g')\n  for (let i = 0; i <= this.longueur * 10; i++) {\n    li = document.createElementNS(svgns, 'line')\n    const x = 3 * i\n    li.setAttribute('x1', x)\n    li.setAttribute('y1', 0)\n    li.setAttribute('x2', x)\n    li.setAttribute('y2', i % 10 === 0 ? 12 : (i % 5 === 0 ? 9 : 6))\n    if (i % 10 === 0) {\n      text = document.createElementNS(svgns, 'text')\n      text.setAttribute('pointer-events', 'none')\n      text.appendChild(document.createTextNode(String(i / 10)))\n      text.setAttribute('x', x)\n      text.setAttribute('y', 12 + hauteurPolice)\n      text.setAttribute('style', 'font-family: monospace;font-size: ' + hauteurPolice + 'pt;text-anchor:middle')\n      this.graduations.appendChild(text)\n    }\n    li.setAttribute('style', 'stroke:black;stroke-width:0.7;')\n    this.graduations.appendChild(li)\n  }\n  // On rajoute le texte Sesamath\n  text = document.createElementNS(svgns, 'text')\n  text.setAttribute('pointer-events', 'none')\n  text.appendChild(document.createTextNode('Sésamath'))\n  text.setAttribute('x', longint / 2 - ray - 3)\n  text.setAttribute('y', largeur - 5)\n  text.setAttribute('style', 'font-family: Arial;font-size: 8pt;font-weight:bold;fill: maroon;text-anchor:middle;')\n  g.appendChild(text)\n  g.appendChild(this.graduations)\n  this.g = g\n}\n/**\n * Fonction mettant les graduations de la règle en mode visible\n * et les endnt visibles dans le svg si l'instrument y est visible\n * @param {boolean} bvisible\n */\nRegle.prototype.montreGraduations = function (bvisible) {\n  this.graduationVisible = bvisible\n  this.graduations.setAttribute('visibility', this.visible ? (bvisible ? 'visible' : 'hidden') : 'hidden')\n}\n/**\n * Fonction montrant la régle ou la cachant suivant la valeur de bvisible\n * @param {boolean} bvisible\n */\nRegle.prototype.montre = function (bvisible) {\n  InstrumentAncetre.prototype.montre.call(this, bvisible)\n  if (bvisible) { this.graduations.setAttribute('visibility', this.graduationVisible ? 'visble' : 'hidden') } else {\n    this.graduations.setAttribute('visibility', 'hidden')\n  }\n}\n/**\n * Fonction initialisant la position de la règle.\n * Si la longueur de la règle a été modifiée il faut la réinitialiser\n */\nRegle.prototype.initialisePosition = function () {\n  if (this.longueur !== 15) {\n    this.longueur = 15\n    const vis = this.visible\n    const oldg = this.g\n    this.creeg()\n    this.g.setAttribute('visibility', vis ? 'visible' : 'hidden')\n    this.doc.svg.replaceChild(this.g, oldg)\n  }\n  InstrumentAncetre.prototype.initialisePosition.call(this)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport InstrumentAncetre from './InstrumentAncetre'\nimport Equerre from '../instruments/Equerre'\nexport default Requerre\n/**\n * @constructor\n * @extends InstrumentAncetre\n * Classe représentant la régle-equerre dans la figure InstrumenPoche\n * @param {IepDoc} doc le document propriétaire de la figure\n */\nfunction Requerre (doc) {\n  InstrumentAncetre.call(this, doc)\n  this.x = 200\n  this.y = 400\n  this.angle = 0\n  this.zoomfactor = 1\n  this.abscisse = 0 // L'abscisse au coin de l'équerre sur la règle\n  this.creeg()\n  this.g.setAttribute('visibility', 'hidden')\n  this.setPosition(this.x, this.y, this.angle)\n  doc.svg.appendChild(this.g)\n}\nRequerre.prototype = new InstrumentAncetre()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant la règle-équerre\n * dans le DOM du svg de la figure\n */\nRequerre.prototype.creeg = function () {\n  let p, path\n  const longd = 172 // Longueur de la partie droite à partir de l'origine\n  const longg = 256 // Longueur de la partie gauche à partir de l'origine\n  const larg = 57 // La largeur\n  const ray = 5 // Rayon de courbure des coins\n  const largeurbande = 16 // Largeur des bandes plus claires\n  const dectroud = 20\n  const dectroub = 15\n  const raytrou = 6\n  const style = 'stroke:#999999;stroke-width:2; fill: #c6cbe8; fill-opacity: 0.5'\n\n  // Ici on ne peut pas faire un rectangle aux bords arrondis si on veut le petit cercle\n  // ajouré en bas et à droite\n\n  const g = document.createElementNS(svgns, 'g')\n  p = document.createElementNS(svgns, 'path')\n  path = 'M 0 0 L ' + String(longd - ray) + ' 0 A ' +\n          ray + ' ' + ray + ' 0 0 1 ' + String(longd) + ' ' + ray +\n          ' L ' + String(longd) + ' ' + String(larg - ray) + ' A ' +\n          ray + ' ' + ray + ' 90 0 1 ' + String(longd - ray) + ' ' + String(larg) +\n          ' L ' + String(-longg + ray) + ' ' + larg + ' A ' + ray + ' ' + ray + ' 180 0 1 ' + '-' + longg + ' ' +\n          String(larg - ray) + ' L ' + String(-longg) + ' ' + ray + ' A ' + ray + ' ' + ray +\n          ' -90 0 1 ' + String(-longg + ray) + ' 0Z'\n  // On rajoute le trou parcouru dans le sens inverse pour qu'il ne soit pas rempli\n  // Forcément deux demi-cercles. Un cercle entier ne semble pas possible.\n  const ytrou = larg - dectroub\n  const pathtrou = 'M' + String(longd - dectroud + raytrou) + ' ' + ytrou + 'A ' +\n          raytrou + ' ' + raytrou + ' 180 0 0 ' + String(longd - dectroud - raytrou) + ' ' + String(ytrou) +\n          'A ' + raytrou + ' ' + raytrou + ' 180 0 0 ' + String(longd - dectroud + raytrou) + ' ' + String(ytrou)\n\n  path += pathtrou\n  p.setAttribute('d', path)\n  p.setAttribute('style', style)\n  g.appendChild(p)\n  // On rajoute l'intérieur pour les bords soient plus clairs\n  p = document.createElementNS(svgns, 'path')\n  path = 'M' + String(longd) + ' ' + String(largeurbande) + 'L' +\n          String(longd) + ' ' + String(larg - ray) + ' A ' +\n          ray + ' ' + ray + ' 90 0 1 ' + String(longd - ray) + ' ' + String(larg) +\n          ' L ' + String(-longg + ray) + ' ' + larg + ' A ' + ray + ' ' + ray + ' 180 0 1 ' + '-' + longg + ' ' +\n          String(larg - ray) + ' L ' + String(-longg) + ' ' + String(largeurbande) + 'Z' + pathtrou\n  p.setAttribute('d', path)\n  p.setAttribute('style', style)\n  g.appendChild(p)\n  // Un trait de rappel pour l'origine\n  const line = document.createElementNS(svgns, 'line')\n  line.setAttribute('x1', 0)\n  line.setAttribute('y1', 8)\n  line.setAttribute('x2', 0)\n  line.setAttribute('y2', 0)\n  line.setAttribute('style', 'stroke: black')\n  g.appendChild(line)\n  // on utilise Equerre.prototype.creeg pour récupérer le svg d'une equerre,\n  // sans passer par un new Equerre car on veut juste le svg\n  // => on lui file un objet vide pour son this\n  const fakeEquerre = {}\n  Equerre.prototype.creeg.call(fakeEquerre)\n  this.gequerre = fakeEquerre.g\n  this.gequerre.setAttribute('transform', 'scale(0.7)')\n  g.appendChild(this.gequerre)\n  this.setAbs(this.abscisse)\n  this.g = g\n}\n/**\n * Fonction faisant glisser l'équerre sur la règle jusqu'à l'abscisse abs\n * L'abscisse 0 est représentée par le petit trait sur la règle\n * @param {number} abs\n */\nRequerre.prototype.setAbs = function (abs) {\n  this.abscisse = abs\n  this.gequerre.setAttribute('transform', 'translate(' + abs + ',0)')\n}\n/**\n * Fonction lançant une animation de glissement de l'équerre sur la règle\n * La règle équerre est le seul instrument à voir un mouvement autre que translation et rotation : Le glissement.\n * @param {number} absfin l'abscisse de l'équerre à la fin du glissement\n * @param {number} pix10 le nombre de pixels dont gilsse l'équerre\n * à chaque dixième de seconde.\n */\nRequerre.prototype.lanceAnimationGlissement = function (absfin, pix10) {\n  this.absfin = absfin\n  this.pix = (absfin >= this.abscisse) ? pix10 / 4 : -pix10 / 4 // Dans la version JavaScript on quadruple la fréquence\n  this.dist = Math.abs(absfin - this.abscisse)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourGlissement() }, 25)\n}\n/**\n * Fonction appelée par un timer lors de l'aniamtion de glissement de l'équerre\n * sur la règle\n */\nRequerre.prototype.actionPourGlissement = function () {\n  const abs = this.abscisse + this.pix\n  const dis = Math.abs(this.absfin - abs)\n  if ((dis > this.dist) || !this.doc.animationEnCours) {\n    this.setAbs(this.absfin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.dist = dis\n    this.setAbs(abs)\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Association Sésamath\n * @licence AGPL-3.0-or-later\n */\n'use strict'\n\nconst loadDelay = 60 // en s\n\n// On charge le même MathJax que mathgraph32\nconst mathJaxUrl = 'https://www.mathgraph32.org/js/MathJax3/es5/tex-svg.js'\n\n/* la config, on avait en v2 le js\nhttps://www.mathgraph32.org/ftp/js/MathJax/MathJax.js?config=TeX-AMS-MML_SVG-full\navec la config :\n MathJax.Hub.Config({\n  tex2jax: {\n    inlineMath: [\n      ['$', '$'],\n      ['\\\\(', '\\\\)']\n    ]\n  },\n  SVG: {\n    mtextFontInherit: false\n  },\n  jax: ['input/TeX', 'output/SVG'],\n  TeX: {\n    extensions: ['color.js']\n  },\n  messageStyle: 'none'\n})\nqui donne, via https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html\ncette conf v3\n */\nconst mathJaxConfig = {\n  tex: {\n    inlineMath: [\n      ['$', '$'],\n      ['\\\\(', '\\\\)']\n    ],\n    // packages: {'[+]': ['noerrors', 'color']}\n    packages: { '[+]': ['color'] }\n  },\n  svg: {\n    // cf http://docs.mathjax.org/en/latest/options/output/svg.html#the-configuration-block\n    mtextInheritFont: true\n  },\n  options: {\n    ignoreHtmlClass: 'tex2jax_ignore',\n    processHtmlClass: 'tex2jax_process'\n  },\n  loader: {\n    // la conversion donnait ça\n    // load: ['input/tex', 'output/svg']\n    // mais ça marchait pas, c'est bcp mieux avec\n    load: ['[tex]/noerrors', '[tex]/color']\n  }\n}\n\n// si on fait deux appels très rapprochés à loadMathJax,\n// on peut se retrouver dans le cas où le 2e retourne Promise.resolve() alors que MathJax n'est pas encore ready\nlet mathJaxLoadingPromise\n\n/**\n * Charge mathjax dans le <head> de la page courante\n * (appelé par le prepare de ActionEcrireTexte et ActionNommerPoint,\n * donc déclenche le chargement dès que le tableau des actions est construit,\n * seulement si l'une des actions a besoin de Mathjax)\n * @return {Promise}\n */\nexport default function loadMathJax () {\n  // si on a déjà été appelé y'a rien à faire (c'est peut-être encore en cours ou déjà résolu)\n  if (mathJaxLoadingPromise) return mathJaxLoadingPromise\n\n  // faut le charger\n  mathJaxLoadingPromise = new Promise((resolve, reject) => {\n    // si qqun d'autre a déjà chargé MathJax (iep dans un nœud j3p précédent par ex),\n    // pas la peine de le refaire si c'est la bonne version\n    if (typeof MathJax === 'object' && /^3\\./.test(MathJax.version)) {\n      // on force notre config, au cas où qqun l'aurait configuré différemment\n      // cf http://docs.mathjax.org/en/latest/web/configuration.html#configuring-mathjax-after-it-is-loaded\n      MathJax.config = mathJaxConfig\n      // c'est tout bon\n      return resolve()\n    }\n\n    // faut charger MathJax\n    window.MathJax = mathJaxConfig\n    /* global MathJax */\n    // on ajoute la résolution de la promesse quand il sera prêt\n    // cf http://docs.mathjax.org/en/latest/web/configuration.html#performing-actions-during-startup\n    MathJax.startup = {\n      ready: () => {\n        // on vire le timeout\n        clearTimeout(timeout)\n        MathJax.startup.defaultReady()\n        MathJax.startup.promise.then(() => {\n          // on résoud la promesse que retourne loadMathJax maintenant que MathJax est ready\n          resolve()\n        })\n      } // ready\n    } // window.MathJax.startup\n\n    // chargement mathjax\n    const eltScript = document.createElement('script')\n    eltScript.type = 'text/javascript'\n    // sinon ff râle avec du :\n    // La demande d’accès aux cookies ou au stockage sur « https://cdn.jsdelivr.net/npm/mathjax@3/es5/input/tex/extensions/noerrors.js » a été bloquée parce que nous bloquons toutes les demandes d’accès au stockage par des sites tiers et que le blocage de contenu est activé.\n    // ce qui est curieux car il n'y a aucune demande…\n    eltScript.crossOrigin = 'anonymous'\n    const url = window.mathJax3BaseUrl\n      ? `${window.mathJax3BaseUrl}es5/tex-svg.js`\n      : mathJaxUrl\n    eltScript.src = url\n    const head = document.getElementsByTagName('head')[0]\n    head.appendChild(eltScript)\n    // on ajoute un timeout de chargement\n    const timeout = setTimeout(() => {\n      reject(Error(`Mathjax non chargé après ${loadDelay}s d’attente (${url})`))\n    }, loadDelay * 1000)\n  })\n\n  return mathJaxLoadingPromise\n} // loadMathJax\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { mesurePrincDeg, zeroAngle } from '../global'\nimport { convDegRad, svgns } from '../global/constantes'\nimport Ligne from '../objets/Ligne'\nimport Vect from '../types/Vect'\nexport default Angle\n/**\n * Classe représentant une marque d'angle sur la figure\n * @extends ObjetBase\n * @constructor\n * @param {number} x  : abscisse du centre\n * @param {number} y ordonnée du centre\n * @param {number} ray le rayon\n * @param {number} ang1 angle de départ (en degrés)\n * @param {number} ang2 angle de fin (en degrés)\n * @param {string} couleur la couleur\n * @param {string} epaisseur épaisseur du trait\n * @param {string} opacite chaine de caractère pour l'opacité (0 à 100)\n * @param {string} motif ; chaîne de caractères. Si elle commence par plein la marque doit être remplie.\n * Si elle finit par un, deux ou trois slashes, elle a des traits de marque\n * d'angle (autant que de /)\n */\nfunction Angle (doc, id, x, y, ray, ang1, ang2, couleur, epaisseur, opacite, motif) {\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  this.ray = parseFloat(ray)\n  this.ang1 = parseFloat(ang1)\n  this.ang2 = parseFloat(ang2)\n  this.motif = (motif == null) ? 'simple' : motif\n  // Pas d'opacité pour le trait\n  Ligne.call(this, doc, id, couleur, epaisseur, 1)\n  this.opaciteRemplissage = (opacite == null) ? 0.7 : parseFloat(opacite) / 100\n  this.objet = 'angle'\n}\nAngle.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nAngle.prototype.creeg = function () {\n  let direct, path, line, v2, xc1, yc1, xmilieu, ymilieu, ang2, ang3\n  const demilong = 5 // Demi-longueur des traits de marque\n  const motif = this.motif\n  const ray = this.ray\n  const a1 = this.ang1\n  const a2 = this.ang2\n  const d = a2 - a1\n  const ang = mesurePrincDeg(d)\n  // var direct = (ang>0) && !iep.zeroAngle(d+180); // Direct dans le sens du repère du svg\n  if (zeroAngle(Math.abs(d) - 180)) direct = (this.ang1 <= this.ang2)\n  else direct = ang > 0\n  const u1 = (new Vect(this.x, this.y, this.x + Math.cos(a1 * convDegRad), this.y + Math.sin(a1 * convDegRad)))\n    .vecteurColineaire(ray)\n  const u2 = (new Vect(this.x, this.y, this.x + Math.cos(a2 * convDegRad), this.y + Math.sin(a2 * convDegRad)))\n    .vecteurColineaire(ray)\n  // Début de l'arc\n  let xd = this.x + u1.x\n  let yd = this.y + u1.y\n  // Fin de l'arc\n  let xf = this.x + u2.x\n  let yf = this.y + u2.y\n  const g = document.createElementNS(svgns, 'g')\n  let p = document.createElementNS(svgns, 'path')\n  const remplis = (motif.indexOf('plein') !== -1) ? this.couleur : 'none'\n  if (remplis !== 'none') {\n    path = 'M' + this.x + ' ' + this.y + 'L' + xd + ' ' + yd + 'A' + ray + ' ' + ray + ' ' +\n            this.ang1 + ' 0 ' + (direct ? '1 ' : '0 ') + xf + ' ' + yf + ' Z'\n  } else {\n    path = 'M' + xd + ' ' + yd + 'A' + ray + ' ' + ray + ' ' +\n            this.ang1 + ' 0 ' + (direct ? '1 ' : '0 ') + xf + ' ' + yf\n  }\n\n  p.setAttribute('d', path)\n  const style1 = 'stroke:' + this.couleur + ';stroke-width:' + this.epaisseur + ';'\n  const style = style1 + 'fill:' + remplis + ';fill-opacity:' + this.opaciteRemplissage + ';'\n  p.setAttribute('style', style)\n  g.appendChild(p)\n  const rond = (motif.indexOf('O') !== -1)\n  const uc = u1.tourne(ang / 2) // Vecteur du centre vers le milieu de l'arc\n  const xc = this.x + uc.x // Abscisse du centre de l'arc\n  const yc = this.y + uc.y // Ordonnée du centre de l'arc\n  if (rond) {\n    const circ = document.createElementNS(svgns, 'circle')\n    circ.setAttribute('r', 5) // Rayon de 5 pixels pour le petir rond de marque\n    circ.setAttribute('cx', xc)\n    circ.setAttribute('cy', yc)\n    circ.setAttribute('style', style1 + 'fill:none;')\n    g.appendChild(circ)\n  }\n  // On regarde s'il y a un, deux ou trois arcs de cercle à tracer\n  const n = (motif.indexOf('triple') !== -1) ? 2 : ((motif.indexOf('double') !== -1) ? 1 : 0)\n  for (let i = 1; i <= n; i++) {\n    p = document.createElementNS(svgns, 'path')\n    const r = ray - i * 5\n    const u3 = u1.vecteurColineaire(r)\n    const u4 = u2.vecteurColineaire(r)\n    xd = this.x + u3.x\n    yd = this.y + u3.y\n    xf = this.x + u4.x\n    yf = this.y + u4.y\n    path = 'M' + xd + ' ' + yd + 'A' + r + ' ' + r + ' ' +\n          this.ang1 + ' 0 ' + (direct ? '1 ' : '0 ') + xf + ' ' + yf\n    p.setAttribute('d', path)\n    p.setAttribute('style', style1 + 'fill:none;')\n    g.appendChild(p)\n  }\n  // On rajoute les éventuels traits (de 1 à 3)\n  const nbtraits = (motif.indexOf('///') !== -1) ? 3 : ((motif.indexOf('//') !== -1) ? 2 : ((motif.indexOf('/') !== -1) ? 1 : 0))\n  if (nbtraits === 0) {\n    this.g = g\n    return\n  }\n  const n1 = n + 1\n  const v = uc.vecteurColineaire(1) // Vecteur de longueur 1\n  switch (nbtraits) {\n    case 1 :\n      xmilieu = this.x + v.x * ray\n      ymilieu = this.y + v.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xmilieu - v.x * demilong * n1)\n      line.setAttribute('y1', ymilieu - v.y * demilong * n1)\n      line.setAttribute('x2', xmilieu + v.x * demilong)\n      line.setAttribute('y2', ymilieu + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      break\n    case 2 :\n      ang2 = ang / 6\n      ang3 = 6\n      if (Math.abs(ang2) >= Math.abs(ang3)) ang2 = ang3\n      v2 = v.tourne(ang2)\n      xc1 = this.x + v2.x * ray\n      yc1 = this.y + v2.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xc1 - v.x * demilong * n1)\n      line.setAttribute('y1', yc1 - v.y * demilong * n1)\n      line.setAttribute('x2', xc1 + v.x * demilong)\n      line.setAttribute('y2', yc1 + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      v2 = v.tourne(-ang2)\n      xc1 = this.x + v2.x * ray\n      yc1 = this.y + v2.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xc1 - v.x * demilong * n1)\n      line.setAttribute('y1', yc1 - v.y * demilong * n1)\n      line.setAttribute('x2', xc1 + v.x * demilong)\n      line.setAttribute('y2', yc1 + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      break\n    case 3 :\n      xmilieu = this.x + v.x * ray\n      ymilieu = this.y + v.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xmilieu - v.x * demilong * n1)\n      line.setAttribute('y1', ymilieu - v.y * demilong * n1)\n      line.setAttribute('x2', xmilieu + v.x * demilong)\n      line.setAttribute('y2', ymilieu + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      ang2 = ang / 4\n      ang3 = 9\n      if (Math.abs(ang2) >= Math.abs(ang3)) ang2 = ang3\n      v2 = v.tourne(ang2)\n      xc1 = this.x + v2.x * ray\n      yc1 = this.y + v2.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xc1 - v.x * demilong * n1)\n      line.setAttribute('y1', yc1 - v.y * demilong * n1)\n      line.setAttribute('x2', xc1 + v.x * demilong)\n      line.setAttribute('y2', yc1 + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      v2 = v.tourne(-ang2)\n      xc1 = this.x + v2.x * ray\n      yc1 = this.y + v2.y * ray\n      line = document.createElementNS(svgns, 'line')\n      line.setAttribute('x1', xc1 - v.x * demilong * n1)\n      line.setAttribute('y1', yc1 - v.y * demilong * n1)\n      line.setAttribute('x2', xc1 + v.x * demilong)\n      line.setAttribute('y2', yc1 + v.y * demilong)\n      line.setAttribute('style', style)\n      g.appendChild(line)\n      break\n  }\n  this.g = g\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport Ligne from '../objets/Ligne'\nimport Vect from '../types/Vect'\nexport default AngleDroit\n/**\n * Classe représentant une marque d'angle droit de la figure\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le document propiétaire de la figure\n * @param {string} id id de l'objet dans le xml de la figure\n * @param {number} xsommet absisse du sommet de l'angle droit\n * @param {number} ysommet ordonnée du sommet de l'angle droit\n * @param {number} xinter abscisse du sommet de la marque d'angle\n * @param {number} yinter ordonnée du sommet de la marque d'angle\n * @param {SvgColor} couleur couleur de la marque\n * @param {number} epaisseur\n */\nfunction AngleDroit (doc, id, xsommet, ysommet, xinter, yinter, couleur, epaisseur) {\n  this.xsommet = parseFloat(xsommet)\n  this.ysommet = parseFloat(ysommet)\n  this.xinter = parseFloat(xinter)\n  this.yinter = parseFloat(yinter)\n  Ligne.call(this, doc, id, couleur, epaisseur, 100)\n  this.objet = 'angle_droit'\n}\nAngleDroit.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nAngleDroit.prototype.creeg = function () {\n  let v1 = new Vect(this.xsommet, this.ysommet, this.xinter, this.yinter)\n  const n = v1.norme()\n  v1 = v1.vecteurColineaire(n / Math.sqrt(2))\n  v1 = v1.tourne(45)\n  const v2 = v1.tourne(-90)\n  const p = document.createElementNS(svgns, 'polyline')\n  const points = String(this.xsommet + v1.x) + ' ' + String(this.ysommet + v1.y) + ' ' +\n    this.xsommet + ' ' + this.ysommet + ' ' + String(this.xsommet + v2.x) + ' ' + String(this.ysommet + v2.y)\n  p.setAttribute('points', points)\n  p.setAttribute('style', this.style + 'fill:none;')\n  this.g = p\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { convDegRad, svgns } from '../global/constantes'\nimport Ligne from '../objets/Ligne'\nimport CompasLeve from '../instruments/CompasLeve'\nimport Vect from '../types/Vect'\nexport default Arc\n/**\n * Classe arc de cercle (servant aussi à tracer les cercles)\n * extends iep.objetBase\n * @constructor\n * @param {number} x abscisse du centre\n * @param {number} y Ordonnée du centre\n * @param {number} ray Le rayon\n * @param {number} debut L'angle de début de tracé\n * @param {number} fin L'angle de fin de tracé\n * @param {SvgColor} couleur La couleur\n * @param {number} epaisseur L'épaisseur du trait\n * @param {number} opacite L'opacité du tracé\n * @param {string} styleTrait \"tiret\" pour avoir des pointillés\n * Si debut < angle, l'arc est tracé dans le sens des ailluilles d'une montre, sinon dans le sens inverse\n */\n// Important : l'objet graphque (g element) sera initialisé avec comme centre l'origine\nfunction Arc (doc, id, x, y, ray, debut, fin, couleur, epaisseur, opacite, styleTrait) {\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  this.ray = parseFloat(ray)\n  this.debut = parseFloat(debut)\n  this.fin = parseFloat(fin)\n  Ligne.call(this, doc, id, couleur, epaisseur, opacite, styleTrait)\n}\nArc.prototype = new Ligne()\n\nArc.prototype.creeg = function () {\n  const deb = this.debut\n  const fin = this.fin\n  const ray = this.ray\n  const sens = (deb < fin) ? '1' : '0' // 1 pour le sens des aiguilles d'une montre (direct pour le SVG)\n  const ecart = Math.abs(fin - deb)\n  const g = document.createElementNS(svgns, 'g')\n  if (ecart >= 359.9) { // Cas d'un cercle ou presque\n    const circ = document.createElementNS(svgns, 'circle')\n    circ.setAttribute('r', ray)\n    circ.setAttribute('cx', 0)\n    circ.setAttribute('cy', 0)\n    circ.setAttribute('style', this.style + ';fill:none;')\n    g.appendChild(circ)\n  } else {\n    const p = document.createElementNS(svgns, 'path')\n    const u1 = new Vect(Math.cos(deb * convDegRad) * ray, Math.sin(deb * convDegRad) * ray)\n    const u2 = new Vect(Math.cos(fin * convDegRad) * ray, Math.sin(fin * convDegRad) * ray)\n    const xdeb = u1.x\n    const ydeb = u1.y\n    const xfin = u2.x\n    const yfin = u2.y\n    const path = 'M' + xdeb + ' ' + ydeb + 'A' + ray + ' ' + ray + ' ' + deb + ' ' +\n      ((ecart > 180) ? '1' : '0') + ' ' + sens + ' ' + xfin + ' ' + yfin\n    p.setAttribute('d', path)\n    p.setAttribute('style', this.style + ';fill:none')\n    g.appendChild(p)\n  }\n  g.setAttribute('transform', 'translate(' + this.x + ',' + this.y + ')')\n  // g.setAttribute(\"id\",this.id);\n  g.setAttribute('visibility', 'hidden')\n  this.g = g\n}\n\nArc.prototype.creationAnimee = function () {\n  return true\n}\nArc.prototype.lanceAnimation = function (vitesse) {\n  const compas = this.doc.compas\n  if (this.doc.compasLeve == null) {\n    this.doc.compasLeve = new CompasLeve(this.doc, compas.x, compas.y,\n      compas.angle, compas.ecart)\n  }\n  const compasLeve = this.doc.compasLeve\n  this.ray = this.doc.compas.ecart // Le rayon ne peut etre connu qu'au mancement de l'animation\n  this.angfin = this.fin\n  this.pasdeg = vitesse / 2 // Dans la version JavaScript on quadruple la fréquence mais on la double par rapport aux autres animations\n  this.pasdeg *= (this.fin >= this.debut) ? 1 : -1 // 1 pour le sens direct svg;\n  this.distang = Math.abs(this.fin - this.debut)\n  this.fin = this.debut\n  compas.setPosition(this.x, this.y, this.debut)\n  compasLeve.setPosition(this.x, this.y, this.debut)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourAnimation() }, 25)\n}\nArc.prototype.actionPourAnimation = function () {\n  const compas = this.doc.compas\n  const compasLeve = this.doc.compasLeve\n  this.fin += this.pasdeg\n  const dis = Math.abs(this.angfin - this.fin)\n  if ((dis > this.distang) || !this.doc.animationEnCours) {\n    this.fin = this.angfin\n    this.updateg()\n    // compas.setPosition(this.x,this.y,this.fin);\n    this.finAction()\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.distang = dis\n    this.updateg()\n    compas.setPosition(this.x, this.y, this.fin)\n    if (compasLeve !== null) compasLeve.setPosition(this.x, this.y, this.fin)\n  }\n}\n\nArc.prototype.finAction = function () {\n  this.doc.compas.setPosition(this.x, this.y, this.fin)\n  if (this.doc.compasLeve !== null) this.doc.compasLeve.setPosition(this.x, this.y, this.fin)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport * as kernel from '../global'\nimport { svgns } from '../global/constantes'\nimport ObjetBase from '../objets/ObjetBase'\nexport default Axe\n/**\n * Classe représentant un axe dans une figure InstrumenPoche\n * Repris à partir du code Flash\n * @extends ObjetBase\n * @constructor\n * @param {ie.iepDoc} doc le document propriétaire\n * @param {string} pente \"horizontal\" pour un axe horizontal, sinon vertical\n * @param {string} largeur\n * @param {string} haut\n * @param {string} gauche\n * @param {string} distanceBord\n * @param {string} xgrad\n * @param {string} xmin\n * @param {string} xmax\n * @param {string} couleur la couleur de l'axe\n */\nfunction Axe (doc, pente, largeur, haut, gauche, distanceBord, xgrad, xmin, xmax, couleur) {\n  ObjetBase.call(this, doc, 'axeIEP', couleur) // Le repère aura pour Id axeIEP\n  this.pente = (pente == null) ? 'horizontal' : pente\n  this.largeur = largeur\n  this.haut = (haut == null) ? 0 : parseFloat(haut)\n  this.gauche = (gauche == null) ? 0 : parseFloat(gauche)\n  this.distanceBord = parseFloat(distanceBord)\n  this.xgrad = xgrad\n  this.xmin = xmin\n  this.xmax = xmax\n  this.cadre = {}\n  this.cadre.gauche = this.gauche * 30 // 30 px pour 1 cm\n  this.cadre.haut = this.haut * 30\n  this.width = 30 * largeur\n  this.cadre.droite = this.gauche + this.width\n  this.cadre.bas = this.haut + this.width\n}\nAxe.prototype = new ObjetBase()\n\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nAxe.prototype.creeg = function () {\n  let li, nb_grad_x, bord, debut_trace_x\n  this.g = document.createElementNS(svgns, 'g')\n  const style = 'stroke:black;stroke-width:1;'\n  // Si besoin, on trace des graduations pour les abscisses\n  if (this.pente === 'horizontal' && (this.xmax - this.xmin) > this.xgrad) {\n    // nombre de graduations qui apparaitront\n    nb_grad_x = Math.floor((this.xmax - this.xmin) / this.xgrad)\n    /*\n     determination de l'ordonnée de l'axe horizontal\n     */\n    bord = this.distanceBord * 30\n\n    /*\n     FIN ETIQUETTES\n     */\n\n    /*\n     DETERMINATION ABSCISSES\n     */\n    debut_trace_x = kernel.determiner_graduations(this.xmin, this.xmax, this.xgrad)\n\n    this.tracer_abscisses(debut_trace_x, this.xgrad, nb_grad_x, bord)\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', this.cadre.gauche)\n    li.setAttribute('y1', bord)\n    li.setAttribute('x2', this.cadre.droite)\n    li.setAttribute('y2', bord)\n    this.g.appendChild(li)\n    /*\n     FIN ABSCISSES\n     */\n  } else if ((this.xmax - this.xmin) > this.xgrad) {\n    // nombre de graduations qui apparaitront\n    nb_grad_x = Math.floor((this.xmax - this.xmin) / this.xgrad)\n    /*\n     determination de l'ordonnée de l'axe horizontal\n     */\n    bord = Number(this.distanceBord) * 30\n\n    /*\n     FIN ETIQUETTES\n     */\n\n    /*\n     DETERMINATION ABSCISSES\n     */\n    debut_trace_x = kernel.determiner_graduations(this.xmin, this.xmax, this.xgrad)\n\n    this.tracer_ordonnees(debut_trace_x, this.xgrad, nb_grad_x, bord)\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', bord)\n    li.setAttribute('y1', this.cadre.bas)\n    li.setAttribute('x2', bord)\n    li.setAttribute('y2', this.cadre.haut)\n    this.g.appendChild(li)\n\n    /*\n     FIN ABSCISSES\n     */\n  }\n}\n/**\n * Fonction reprise du code Flash, utiilisée dans creeg()\n */\nAxe.prototype.tracer_abscisses = function (debut_trace_x, unite_x, nb_grad_x, ordo_etiquettes) {\n  let li, txt, abscisse, i\n  const tailleEtiquettes = 12 // Taille de la police utilisée pour les étiquettes\n  const style = 'stroke:black;stroke-width:1.5;'\n\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('style', style)\n  li.setAttribute('x1', this.cadre.gauche)\n  li.setAttribute('y1', ordo_etiquettes)\n  li.setAttribute('x2', this.cadre.droite)\n  li.setAttribute('y2', ordo_etiquettes)\n  this.g.appendChild(li)\n  for (i = 0; i <= nb_grad_x; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    abscisse = this.mettre_x_en_pixels(debut_trace_x + i * unite_x)\n    li.setAttribute('x1', abscisse)\n    li.setAttribute('y1', String(ordo_etiquettes - 5))\n    li.setAttribute('x2', abscisse)\n    li.setAttribute('y2', String(ordo_etiquettes + 5))\n    this.g.appendChild(li)\n    txt = document.createElementNS(svgns, 'text')\n    txt.setAttribute('x', abscisse)\n    txt.setAttribute('y', ordo_etiquettes + tailleEtiquettes + 5)\n    const stylet = 'text-anchor:left;font-size:' + tailleEtiquettes + 'px;' + 'fill:' + this.couleur + ';'\n    txt.setAttribute('style', stylet)\n    txt.appendChild(document.createTextNode(String(debut_trace_x + i * unite_x)))\n    this.g.appendChild(txt)\n  }\n}\n/**\n * Fonction reprise du code Flash, utiilisée dans creeg()\n */\nAxe.prototype.tracer_ordonnees = function (debut_trace_y, unite_y, nb_grad_y, abs_etiquettes) {\n  let li, txt, i\n  const tailleEtiquettes = 12 // Taille de la police utilisée pour les étiquettes\n  const style = 'stroke:black;stroke-width:1.5;'\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('style', style)\n  li.setAttribute('x1', abs_etiquettes)\n  li.setAttribute('y1', this.cadre.haut)\n  li.setAttribute('x2', abs_etiquettes)\n  li.setAttribute('y2', this.cadre.bas)\n  this.g.appendChild(li)\n  for (i = 0; i <= nb_grad_y; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    const ordonnee = this.mettre_y_en_pixels(debut_trace_y + i * unite_y)\n    li.setAttribute('x1', String(abs_etiquettes - 5))\n    li.setAttribute('y1', ordonnee)\n    li.setAttribute('x2', String(abs_etiquettes + 5))\n    li.setAttribute('y2', ordonnee)\n    this.g.appendChild(li)\n    txt = document.createElementNS(svgns, 'text')\n    txt.setAttribute('x', abs_etiquettes + 10)\n    txt.setAttribute('y', ordonnee + 2)\n    const stylet = 'text-anchor:left;font-size:' + tailleEtiquettes + 'px;' + 'fill:' + this.couleur + ';'\n    txt.setAttribute('style', stylet)\n    txt.appendChild(document.createTextNode(String(debut_trace_y + i * unite_y)))\n    this.g.appendChild(txt)\n  }\n}\n/**\n * Fonction utilisée dans iep.axe\n * @param {number} nbr\n * @returns {number}\n */\nAxe.prototype.mettre_x_en_pixels = function (nbr) {\n  return kernel.mettre_en_pixels(nbr, this.xmin, this.xmax, this.cadre.gauche, this.cadre.droite)\n}\n/**\n * Fonction utilisée dans iep.axe\n * @param {number} nbr\n * @returns {number}\n */\nAxe.prototype.mettre_y_en_pixels = function (nbr) {\n  return kernel.mettre_en_pixels(nbr, this.xmax, this.xmin, this.cadre.haut, this.cadre.bas)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport * as kernel from '../global'\nimport Droite from '../objets/Droite'\nimport Vect from '../types/Vect'\nexport default DemiDroite\n\n/**\n * Classe représentant une demi-droite dans la figure InstrumenPoche\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le document propriétaire de la figure\n * @param {string} id id de l'objet dans le fichier XML\n * @param {number} x1 abscisse du premier point\n * @param {number} y1 ordonnée du premier point\n * @param {number} x2 abscisse du second point\n * @param {number} y2 ordonnée du premier point\n * @param {string} couleur couelur de la demi-droite\n * @param {string} epaisseur Epaisseur du trait\n * @param {string} opacite Opacité du trait\n * @param {string} styleTrait \"tiret\" pour avoir des pointillés\n */\nfunction DemiDroite (doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait) {\n  Droite.call(this, doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait)\n}\nDemiDroite.prototype = new Droite()\n// Inutile de redéfinir creeg()\n/**\n * Fonction calculant les coordonnées des points à la limite de la figure\n * (xext1,yext1) et (xext2,yext2) pour le tracé réel\n */\nDemiDroite.prototype.calcule = function () {\n  Droite.prototype.calcule.call(this)\n  const v1 = new Vect(this.x1, this.y1, this.x2, this.y2) // Vecteur directeur de la demi-droite\n  // Si la droite est hors-fenêtre, la demi-droite l'est aussi\n  if (this.horsFenetre) return\n  // Dans IEP l'origine est toujours dans la fenêtre\n  const u = new Vect(this.x1, this.y1, this.xext1, this.yext1)\n  if (u.presqueNul()) {\n    const v = new Vect(this.x1, this.y1, this.xext2, this.yext2)\n    if (kernel.colineairesMemeSens(v, v1)) {\n      this.xext1 = this.x1\n      this.yext1 = this.y1\n    } else {\n      this.xext2 = this.xext1\n      this.yext2 = this.yext1\n      this.xext1 = this.x1\n      this.yext1 = this.y1\n    }\n  } else {\n    if (kernel.colineairesMemeSens(u, v1)) {\n      this.xext2 = this.xext1\n      this.yext2 = this.yext1\n      this.xext1 = this.x1\n      this.yext1 = this.y1\n    } else {\n      this.xext1 = this.x1\n      this.yext1 = this.y1\n    }\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport DroiteAncetre from '../objets/DroiteAncetre'\nexport default Droite\n/**\n * Classe représentant une droite donnée par les coordonnées de ses deux points\n * @constructor\n * @extends ObjetBase\n * @param {number} x1 Abscisse du premier point\n * @param {number} y1 Ordonnée du deuième point\n * @param {number} x2 Abscisse du deuxième point\n * @param {number} y2 Ordonnée du deuxième point\n * @param {string} couleur La couleur\n * @param {string} epaisseur L'épaisseur de trait\n * @param {string} opacite L'opacité du tracé\n * @param {string} styleTrait \"tiret\" pour un trait pointillé\n */\nfunction Droite (doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait) {\n  DroiteAncetre.call(this, doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait)\n}\nDroite.prototype = new DroiteAncetre()\n\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nDroite.prototype.creeg = function () {\n  this.calcule()\n  if (!this.horsFenetre) {\n    const li = document.createElementNS(svgns, 'line')\n    li.setAttribute('x1', this.xext1)\n    li.setAttribute('y1', this.yext1)\n    li.setAttribute('x2', this.xext2)\n    li.setAttribute('y2', this.yext2)\n    li.setAttribute('style', this.style)\n    this.g = li\n  } else {\n    this.g = document.createElementNS(svgns, 'g')\n  }\n  this.g.setAttribute('visibility', 'hidden')\n  // this.g.setAttribute(\"id\",this.id);\n}\n/**\n * Calcul des coordonnées des points d'intersection de la droite avec les bords de la fenêtre\n * Si la droite est hors de la fenêtre, this.horsFenetre est mis à false, sinon true\n * Au retour, (this.xext1, this.yext1) et (this.xext2, this.yext2) sont les coodonnées des points au bord\n */\nDroite.prototype.calcule = function () {\n  const { x1, y1, x2, y2 } = this\n  if ((x1 === x2) && (y1 === y2)) {\n    this.horsFenetre = true\n    return\n  }\n  this.horsFenetre = false\n  const width = this.doc.getWidth()\n  const height = this.doc.getHeight()\n  if (x1 === x2) {\n    this.xext1 = x1\n    this.yext1 = 0\n    this.xext2 = x1\n    this.yext2 = height\n    if ((x1 < 0) || (x1 > width)) {\n      this.horsFenetre = true\n      return\n    }\n    this.xext1 = x1\n    this.yext1 = 0\n    this.xext2 = x1\n    this.yext2 = height\n    return\n  }\n  if (y1 === y2) {\n    this.xext1 = 0\n    this.yext1 = y1\n    this.xext2 = width\n    this.yext2 = y1\n    if ((y1 < 0) || (y1 > height)) {\n      this.horsFenetre = true\n      return\n    }\n    this.xext1 = 0\n    this.yext1 = y1\n    this.xext2 = width\n    this.yext2 = y1\n    return\n  }\n  let indicePoint = 0\n  const a = (y2 - y1) / (x2 - x1)\n  const xa = 0\n  const ya = this.y1 + a * (xa - x1)\n  if ((ya >= 0) && (ya <= height)) {\n    indicePoint++\n    this.xext1 = xa\n    this.yext1 = ya\n  }\n  const xb = width\n  const yb = a * (xb - x1) + y1\n  if ((yb >= 0) && (yb <= height)) {\n    indicePoint++\n    if (indicePoint === 1) {\n      this.xext1 = xb\n      this.yext1 = yb\n    } else {\n      this.xext2 = xb\n      this.yext2 = yb\n      return\n    }\n  }\n  const yc = 0\n  const xc = (yc - y1) / a + x1\n  if ((xc > 0) && (xc < width)) {\n    indicePoint++\n    if (indicePoint === 1) {\n      this.xext1 = xc\n      this.yext1 = yc\n    } else {\n      this.xext2 = xc\n      this.yext2 = yc\n      return\n    }\n  }\n  const yd = height\n  const xd = (yd - y1) / a + x1\n  if ((xd > 0) && (xd <= width)) {\n    indicePoint++\n    if (indicePoint === 2) {\n      this.xext2 = xd\n      this.yext2 = yd\n    } else {\n      this.horsFenetre = true\n    }\n  } else this.horsFenetre = true\n  if (this.horsFenetre) {\n    this.xext1 = 0\n    this.yext1 = ya\n    this.xext2 = xb\n    this.yext2 = yb\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { zero } from '../global'\nimport { svgns } from '../global/constantes'\nimport Ligne from '../objets/Ligne'\nimport Vect from '../types/Vect'\nexport default DroiteAncetre\n/**\n * La classe représentant l'ancêtre des droites, segments, demi-droites\n * @extends ObjetBase\n * @constructor\n * @param {number} x1 Abscisse du premier point\n * @param {number} y1 Ordonnée du deuième point\n * @param {number} x2 Abscisse du deuxième point\n * @param {number} y2 Ordonnée du deuxième point\n * @param {SvgColor} couleur La couleur\n * @param {number} epaisseur L'épaisseur de trait\n * @param {number} opacite L'opacité du tracé\n * @param {string} styleTrait \"tiret\" pour un trait pointillé\n * @param {boolean} vecteur Si true une flèche est tracée\n */\nfunction DroiteAncetre (doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait) {\n  this.x1 = parseFloat(x1)\n  this.y1 = parseFloat(y1)\n  this.x2 = parseFloat(x2)\n  this.y2 = parseFloat(y2)\n  Ligne.call(this, doc, id, couleur, epaisseur, opacite, styleTrait)\n}\nDroiteAncetre.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nDroiteAncetre.prototype.creeg = function () {\n  const g = document.createElementNS(svgns, 'g')\n  const li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', this.x1)\n  li.setAttribute('y1', this.y1)\n  li.setAttribute('x2', this.x2)\n  li.setAttribute('y2', this.y2)\n  li.setAttribute('style', this.style)\n  g.appendChild(li)\n  g.setAttribute('visibility', 'hidden')\n  // g.setAttribute(\"id\",this.id);\n  this.g = g\n}\n\nDroiteAncetre.prototype.creationAnimee = function () {\n  return true\n}\nDroiteAncetre.prototype.lanceAnimation = function (vitesse) {\n  this.vitesse = vitesse / 4\n  const v = new Vect(this.x1, this.y1, this.x2, this.y2)\n  this.dist = v.norme() // La distance entre la position actuelle et la position finale\n  if (zero(this.dist)) {\n    this.doc.actionSuivante()\n    return\n  }\n  this.vect = v.vecteurColineaire(this.vitesse * 1.8) //* 1.8 car dans la réalité c'est plus rapide\n  this.xfin = this.x2\n  this.yfin = this.y2\n  this.x2 = this.x1\n  this.y2 = this.y1\n  const cray = this.doc.crayon\n  cray.setPosition(this.x1, this.y1, cray.angle)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourAnimation(t) }, 25)\n}\nDroiteAncetre.prototype.actionPourAnimation = function () {\n  this.x2 += this.vect.x\n  this.y2 += this.vect.y\n  const u = new Vect(this.x1, this.y1, this.x2, this.y2)\n  const d = u.norme()\n  const cray = this.doc.crayon\n  if ((d > this.dist) || !this.doc.animationEnCours) {\n    this.x2 = this.xfin\n    this.y2 = this.yfin\n    this.finAction()\n    this.updateg()\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    cray.translate(this.x2, this.y2)\n    this.updateg()\n  }\n}\n/**\n * extends iep.objetBase.prototype.finAction\n */\nDroiteAncetre.prototype.finAction = function () {\n  this.doc.crayon.translate(this.x2, this.y2)\n}\n","/*\r\n * Visualiseur InstrumenPoche en Javascript et SVG\r\n * @author Yves Biton <yves.biton@sesamath.net>\r\n * @licence AGPL-3.0-or-later\r\n */\r\nimport { convDegRad, svgns } from '../global/constantes'\r\nimport Ligne from '../objets/Ligne'\r\nimport Vect from '../types/Vect'\r\nexport default Gabarit\r\n\r\n/**\r\n * Classe Gabarit de cercle (servant aussi à tracer les cercles)\r\n * L'objet gabarit va hériter de cet objet (secteur circulaire)\r\n * extends iep.objetBase\r\n * @constructor\r\n * @param {number} x abscisse du centre\r\n * @param {number} y Ordonnée du centre\r\n * @param {number} ray Le rayon\r\n * @param {number} debut L'angle de début de tracé\r\n * @param {number} fin L'angle de fin de tracé\r\n * @param {SvgColor} couleur La couleur\r\n * @param {number} epaisseur L'épaisseur du trait\r\n * @param {number} opacite L'opacité du tracé\r\n * @param {string} styleTrait \"tiret\" pour avoir des pointillés\r\n * Si debut < angle, l'arc est tracé dans le sens des ailluilles d'une montre, sinon dans le sens inverse\r\n */\r\n// Important : l'objet graphique (g element) sera initialisé avec comme centre l'origine\r\nfunction Gabarit (doc, id, x, y, ray, ecartAngle, couleur, epaisseur, couleurFond, opacite) {\r\n  Ligne.call(this, doc, id, couleur, epaisseur, opacite, 'continu')\r\n  this.x = parseFloat(x)\r\n  this.y = parseFloat(y)\r\n  this.ray = (ray === null) ? 10 : parseFloat(ray)\r\n  this.ecartAngle = parseFloat(ecartAngle)\r\n  this.couleur = couleur\r\n  this.couleurFond = (couleurFond === null) ? couleur : couleurFond\r\n  this.angle = 0 // On peut appliquer une rotation à cet objet\r\n  this.objet = 'gabarit'\r\n}\r\n\r\nGabarit.prototype = new Ligne()\r\n\r\n// Le gabarit n'a pas d'animation quand on le crée contrairement à l'arc de cercle\r\nGabarit.prototype.creationAnimee = function () {\r\n  return false\r\n}\r\n\r\nGabarit.prototype.creeg = function () {\r\n  const fin = this.ecartAngle\r\n  const ray = this.ray\r\n  const sens = (fin >= 0) ? '1' : '0' // 1 pour le sens des aiguilles d'une montre (direct pour le SVG)\r\n  const ecart = Math.abs(fin)\r\n  const g = document.createElementNS(svgns, 'g')\r\n\r\n  const p = document.createElementNS(svgns, 'path')\r\n  const u2 = new Vect(Math.cos(fin * convDegRad) * ray, Math.sin(fin * convDegRad) * ray)\r\n  const xdeb = ray\r\n  const ydeb = 0\r\n  const xfin = u2.x\r\n  const yfin = u2.y\r\n  const path = 'M 0 0 L ' + xdeb + ' ' + ydeb + ' A ' + ray + ' ' + ray + ' 0 ' +\r\n    ((ecart > 180) ? '1' : '0') + ' ' + sens + ' ' + xfin + ' ' + yfin + ' Z'\r\n  p.setAttribute('d', path)\r\n  const op = parseFloat(this.opacite / 100)\r\n  const style = 'stroke:' + this.couleur + ';stroke-width:' + this.epaisseur + ';' + 'fill:' + this.couleurFond + ';fill-opacity:' + op + ';'\r\n  p.setAttribute('style', style)\r\n  g.appendChild(p)\r\n  g.setAttribute('transform', 'translate(' + this.x + ',' + this.y + ') rotate(' + this.angle + ')')\r\n  // g.setAttribute(\"id\",this.id);\r\n  g.setAttribute('visibility', 'hidden')\r\n  this.g = g\r\n}\r\n\r\nGabarit.prototype.donneRayon = function (ray) {\r\n  this.ray = ray\r\n  this.updateg()\r\n  this.setPosition(this.x, this.y, this.angle)\r\n}\r\n\r\nGabarit.prototype.setPosition = function (x, y, angle) {\r\n  this.x = x\r\n  this.y = y\r\n  this.angle = angle\r\n  this.g.setAttribute('transform', 'translate(' + x + ',' + y + ') rotate(' + angle + ')')\r\n}\r\n\r\nGabarit.prototype.lanceAnimationModificationRayon = function (rayFin, pix10) {\r\n  this.rayFin = rayFin\r\n  this.rayInit = this.ray\r\n  const dif = rayFin - this.ray\r\n  this.dist = Math.abs(dif) // La distance entre la position actuelle et la position finale\r\n  this.dray = Math.sign(dif) * Math.abs(pix10 / 4) // Dans la version JavaScript on quadruple la fréquence;\r\n  // en divisant le pas par 4\r\n  // (en fait par deux car la rapidité semble double de celle annoncée dans le mode d'emploi)\r\n  // Cas où l'objet est déjà à la bonne position\r\n  if (this.dist === 0) return\r\n  // this.vect = v.vecteurColineaire(this.pix);\r\n  const t = this\r\n  this.timer = setInterval(function () { t.actionPourModificationRayon() }, 25)\r\n}\r\n\r\nGabarit.prototype.actionPourModificationRayon = function () {\r\n  const r = this.ray + this.dray\r\n  const d = Math.abs(r - this.rayInit)\r\n  if ((d > this.dist) || !this.doc.animationEnCours) {\r\n    this.donneRayon(this.rayFin)\r\n    clearInterval(this.timer)\r\n    this.doc.actionSuivante()\r\n  } else {\r\n    this.dist = d\r\n    this.donneRayon(r)\r\n  }\r\n}\r\n","/*\r\n * Visualiseur InstrumenPoche en Javascript et SVG\r\n * @Author Yves Biton (yves.biton@sesamath.net)\r\n * @License: GNU AGPLv3 https://www.gnu.org/licenses/agpl-3.0.html\r\n * Attention : Ne pas appeler cet objet Imag car entre en conflit avec l'objet Imag du JS\r\n */\r\nimport { svgns } from '../global/constantes'\r\nimport ObjetBase from '../objets/ObjetBase'\r\nimport ActionCreation from '../actions/ActionCreation'\r\nexport default Imag\r\n/**\r\n * Classe représentant une image incluse dans la figure InstrumenPoche\r\n * @extends ObjetBase\r\n * @constructor\r\n * @param {IepDoc} doc le document propriétaire\r\n * @param {string} id id de l'objet créé dans le fichier XML de la figure\r\n * @param {string} url l'url de la figure\r\n */\r\nfunction Imag (doc, id, url) {\r\n  this.doc = doc\r\n  this.id = id\r\n  this.url = url\r\n  this.x = 0\r\n  this.y = 0\r\n  this.angle = 0\r\n  this.objet = 'image'\r\n  this.zoomfactor = 1\r\n}\r\nImag.prototype = new ObjetBase()\r\n/** @inheritDoc */\r\nImag.prototype.initialisePosition = function () {\r\n  this.x = 0\r\n  this.y = 0\r\n  this.angle = 0\r\n  this.zoomfactor = 1\r\n  this.positionne()\r\n}\r\n/**\r\n * Fonction appelée dans iepDoc.creeActions\r\n * crée une image avec l'url url de façon à récupérer ses dimensions\r\n * Lorsque l'image est chargée, une fonction de callBack crée l'élément graphique\r\n * image dans le DOM du svg contenant la igure\r\n */\r\nImag.prototype.prepareAction = function () {\r\n  const img = new Image()\r\n  img.owner = this\r\n  this.action = new ActionCreation(this.doc, this.id, this)\r\n  this.action.isReady = false\r\n  this.doc.ajouteAction(this.action)\r\n  img.onload = function () {\r\n    const own = this.owner\r\n    own.width = this.width\r\n    own.height = this.height\r\n    own.action.isReady = true\r\n  }\r\n  img.src = this.url // Provoque le chargement de l'image\r\n}\r\n/**\r\n * Fonction mettant dans this.g l'élément graphique svg représentant l'objet dans\r\n * le DOM du svg de la figure\r\n */\r\nImag.prototype.creeg = function () {\r\n  const image = document.createElementNS(svgns, 'image')\r\n  image.setAttribute('width', this.width)\r\n  image.setAttribute('height', this.height)\r\n  image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', this.url)\r\n  image.setAttribute('x', this.x)\r\n  image.setAttribute('y', this.y)\r\n  image.setAttribute('visibility', 'hidden')\r\n  this.g = image\r\n  // image.setAttribute(\"id\",this.id);\r\n  this.setPosition(this.x, this.y, this.angle, this.zoomfactor)\r\n  this.doc.svg.appendChild(image)\r\n}\r\n/**\r\n * Fonction mettant l'image aux coordonnées (x,y) avec un angle angle et\r\n * un coefficient de zoom zoomfactor et modifiant la position du svg element qui\r\n * le représente dans le DOM du svg.\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {number} angle\r\n * @param {integer} zoomfactor\r\n * @returns {undefined}\r\n */\r\n\r\nImag.prototype.setPosition = function (x, y, angle, zoomfactor) {\r\n  this.x = x\r\n  this.y = y\r\n  this.angle = angle\r\n  this.zoomfactor = zoomfactor\r\n  if (this.g) {\r\n    this.g.setAttribute('transform', 'scale(' + zoomfactor + ') translate(' +\r\n      String(x / zoomfactor) + ',' + String(y / zoomfactor) + ') rotate(' + angle + ')')\r\n  } else {\r\n    console.error('Il faut appeler imag.creeg avant imag.setPosition')\r\n  }\r\n}\r\n/**\r\n * Fonction mettant à jour l'élément graphique image dans le DOM du svg de la figure\r\n */\r\nImag.prototype.positionne = function () {\r\n  this.setPosition(this.x, this.y, this.angle, this.zoomfactor)\r\n}\r\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport ObjetBase from '../objets/ObjetBase'\nexport default Ligne\n/**\n * Classe ancêtre de tous les objets de type ligne\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le document propriétaire de l'objet\n * @param {string} id l'id de l'objet dans le fichier XML de la figure\n * @param {string} couleur la couleur de l'objet\n * @param {string} epaisseur l'épaisseur de trait\n * @param {string} opacite l'opacité du trait\n * @param {string} styleTrait \"tiret\" pour avoir des pointillés\n */\nfunction Ligne (doc, id, couleur, epaisseur, opacite, styleTrait) {\n  ObjetBase.call(this, doc, id, couleur)\n  this.epaisseur = epaisseur\n  this.opacite = (arguments.length >= 5) ? opacite : '100'\n  this.styleTrait = (arguments.length >= 6) ? styleTrait : 'continu'\n  const op = parseFloat(this.opacite / 100)\n  this.style = 'stroke:' + couleur + ';stroke-width:' + epaisseur +\n          ';stroke-opacity:' + op + ';stroke-linecap:round;'\n  if (this.styleTrait === 'tiret') this.style += 'stroke-dasharray:10 8 10;' // Pointillés\n}\nLigne.prototype = new ObjetBase()\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport Ligne from '../objets/Ligne'\nexport default LigneContinue\n/**\n * Classe représentant une ligne continue de la figure\n * @extends ObjetBase\n * @constructor\n * @param {iepDoc} doc Le document propriétaire\n * @param {number} id L'id de l'objet dans le fichier XML de la figure\n * @param {string} abs Une chaîne contenant les abscisses séparées par des virgules\n * @param {string} ord Une chaîne contenant les ordonnées séparées par des virgules\n * @param{number} xdeb : abscisse de début (en fait l'abscisse actuelle du crayon)\n * @param{number} ydeb : ordonée de début (en fait l'ordonnée actuelle du crayon)\n * @param {string} couleur La couleur\n * @param {string} epaisseur L'épaisseur de trait\n * @param {string} opacite L'opacité du trait\n * @param {string} styleTrait tiret pour avoir des pointillés\n */\nfunction LigneContinue (doc, id, xdeb, ydeb, abs, ord, couleur, epaisseur, opacite, styleTrait) {\n  Ligne.call(this, doc, id, couleur, epaisseur, opacite, styleTrait)\n  this.xdeb = xdeb\n  this.ydeb = ydeb\n  this.abs = abs.split(',')\n  this.ord = ord.split(',')\n  this.objet = 'trait'\n}\nLigneContinue.prototype = new Ligne()\n\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nLigneContinue.prototype.creeg = function () {\n  let points, i\n  const p = document.createElementNS(svgns, 'polyline')\n  points = this.xdeb + ' ' + this.ydeb\n  for (i = 0; i < this.abs.length; i++) {\n    points += ' ' + this.abs[i] + ' ' + this.ord[i]\n  }\n  p.setAttribute('points', points)\n  p.setAttribute('style', this.style + 'fill:none;')\n  p.setAttribute('visibility', 'hidden')\n  // p.setAttribute(\"id\",this.id);\n  this.g = p\n}\n/** @inheritDoc */\nLigneContinue.prototype.creationAnimee = function () {\n  return true\n}\n/**\n * Fonction lançant l'animation de visualisation de la ligne continue\n * Utilise un timer et une fonction de callBack\n */\nLigneContinue.prototype.lanceAnimation = function () {\n  this.sauveabs = this.abs\n  this.sauveord = this.ord\n  this.abs = []\n  this.ord = []\n  this.ind = -1 // L'indice dans le tableau des coordonnées\n  const t = this\n  this.timer = setInterval(function () { t.actionPourAnimation() }, 25)\n}\n/**\n * Fonction de callBack appelée par un timer pour l'animation du tracé\n */\nLigneContinue.prototype.actionPourAnimation = function () {\n  this.ind++\n  const cray = this.doc.crayon\n  if (this.ind >= this.sauveabs.length) {\n    this.abs = this.sauveabs\n    this.ord = this.sauveord\n    this.updateg()\n    clearInterval(this.timer)\n    this.finAction()\n    this.doc.actionSuivante()\n  } else {\n    const x = this.sauveabs[this.ind]\n    const y = this.sauveord[this.ind]\n    this.abs.push(x)\n    this.ord.push(y)\n    this.updateg()\n    cray.setPosition(parseFloat(x), parseFloat(y), cray.angle)\n    this.updateg()\n  }\n}\n/**\n * extends iep.objetBase.prototype.finAction\n */\nLigneContinue.prototype.finAction = function () {\n  const len = this.abs.length\n  this.doc.crayon.translate(parseFloat(this.abs[len - 1]), parseFloat(this.ord[len - 1]))\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport Ligne from '../objets/Ligne'\nimport Vect from '../types/Vect'\nimport Segment from './Segment'\nexport default MarqueSeg\n/**\n * Objet représentant une marque de segment\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc Le document propriétaire\n * @param {string} id L'id de l'objet\n * @param {string} idSeg L'id du segment parnet\n * @param {string} couleur La couleur de tracé\n * @param {string} epaisseur L'épaisseur de tracé\n * @param {string} motif Donne le motif de la marque\n * @param {null|string} rayon Donne le rayon (demi-longueur de la marque). \"5\" si paramètre omis.\n */\nfunction MarqueSeg (doc, id, idSeg, couleur, epaisseur, motif, rayon) {\n  this.idSeg = idSeg\n  this.motif = motif\n  this.rayon = (rayon !== null) ? rayon : '5'\n  Ligne.call(this, doc, id, couleur, epaisseur, 100)\n  this.objet = 'marque'\n}\nMarqueSeg.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nMarqueSeg.prototype.creeg = function () {\n  let g, li, k\n  const seg = this.doc.getElement(this.idSeg, 'trait')\n  if (seg instanceof Segment) {\n    const demlong = this.rayon\n    const ec = 5 // demi écart horizontal entre deux traits\n    const dec = ec / 2\n    const diam = 5 // Diamètre du rond dans le cas où style == O\n    switch (this.motif) {\n      case '/' :\n        g = document.createElementNS(svgns, 'line')\n        g.setAttribute('x1', demlong)\n        g.setAttribute('y1', -demlong)\n        g.setAttribute('x2', -demlong)\n        g.setAttribute('y2', demlong)\n        g.setAttribute('style', this.style)\n        break\n      case '\\\\' :\n        g = document.createElementNS(svgns, 'line')\n        g.setAttribute('x1', -demlong)\n        g.setAttribute('y1', -demlong)\n        g.setAttribute('x2', demlong)\n        g.setAttribute('y2', demlong)\n        g.setAttribute('style', this.style)\n        break\n      case '//':\n        g = document.createElementNS(svgns, 'g')\n        for (k = -1; k <= 1; k += 2) {\n          li = document.createElementNS(svgns, 'line')\n          li.setAttribute('x1', k * dec + demlong)\n          li.setAttribute('y1', -demlong)\n          li.setAttribute('x2', k * dec - demlong)\n          li.setAttribute('y2', demlong)\n          li.setAttribute('style', this.style)\n          g.appendChild(li)\n        }\n        break\n      case '///':\n        g = document.createElementNS(svgns, 'g')\n        for (k = -1; k <= 1; k++) {\n          li = document.createElementNS(svgns, 'line')\n          li.setAttribute('x1', k * ec + demlong)\n          li.setAttribute('y1', -demlong)\n          li.setAttribute('x2', k * ec - demlong)\n          li.setAttribute('y2', demlong)\n          li.setAttribute('style', this.style)\n          g.appendChild(li)\n        }\n        break\n      case '\\\\\\\\':\n        g = document.createElementNS(svgns, 'g')\n        for (k = -1; k <= 1; k += 2) {\n          li = document.createElementNS(svgns, 'line')\n          li.setAttribute('x1', k * dec - demlong)\n          li.setAttribute('y1', -demlong)\n          li.setAttribute('x2', k * dec + demlong)\n          li.setAttribute('y2', demlong)\n          li.setAttribute('style', this.style)\n          g.appendChild(li)\n        }\n        break\n      case '\\\\\\\\\\\\':\n        g = document.createElementNS(svgns, 'g')\n        for (k = -1; k <= 1; k++) {\n          li = document.createElementNS(svgns, 'line')\n          li.setAttribute('x1', k * ec - demlong)\n          li.setAttribute('y1', -demlong)\n          li.setAttribute('x2', k * ec + demlong)\n          li.setAttribute('y2', demlong)\n          li.setAttribute('style', this.style)\n          g.appendChild(li)\n        }\n        break\n      case 'X': // Croix\n        g = document.createElementNS(svgns, 'g')\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', -demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', -demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n        break\n      case 'O': // Rond\n        g = document.createElementNS(svgns, 'circle')\n        g.setAttribute('cx', 0)\n        g.setAttribute('cy', 0)\n        g.setAttribute('r', diam)\n        g.setAttribute('style', this.style + 'fill:none;')\n        break\n      default :\n        g = document.createElementNS(svgns, 'g') // Vide en cas d'erreur\n    }\n  } else {\n    console.log('Maque de segment non associée à un objet segment')\n    g = document.createElementNS(svgns, 'g')\n  }\n  this.g = g\n}\n\n/** @inheritDoc */\nMarqueSeg.prototype.positionne = function () {\n  const seg = this.doc.getElement(this.idSeg, 'trait')\n  const vect = new Vect(seg.x1, seg.y1, seg.x2, seg.y2)\n  const xmil = (seg.x1 + seg.x2) / 2\n  const ymil = (seg.y1 + seg.y2) / 2\n  const ang = -vect.angle()\n  this.g.setAttribute('transform', 'translate(' + xmil + ',' + ymil + ') rotate(' + ang + ') ')\n}\n\n/** @inheritDoc */\nMarqueSeg.prototype.translate = function (x, y) {\n  this.x = x\n  this.y = y\n  this.positionne()\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport Ligne from '../objets/Ligne'\nexport default MarqueSegment\n/**\n * Objet représentant une marque de segment\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc Le document propriétaire\n * @param {string} id L'id de l'objet\n * @param {string} x L'abscisse\n * @param {string} y L'ordonnée\n * @param {string} couleur La couleur de tracé\n * @param {string} epaisseur L'épaisseur de tracé\n * @param {string} motif Donne le motif de la marque\n */\nfunction MarqueSegment (doc, id, x, y, couleur, epaisseur, motif) {\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  this.motif = motif\n  Ligne.call(this, doc, id, couleur, epaisseur, 100)\n  this.objet = 'longueur'\n}\nMarqueSegment.prototype = new Ligne()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nMarqueSegment.prototype.creeg = function () {\n  let g, li, k\n  const demlong = 5\n  const ec = 5 // demi écart horizontal entre deux traits\n  const dec = ec / 2\n  const diam = 5 // Diamètre du rond dans le cas où style == O\n  switch (this.motif) {\n    case '/' :\n      g = document.createElementNS(svgns, 'line')\n      g.setAttribute('x1', demlong)\n      g.setAttribute('y1', -demlong)\n      g.setAttribute('x2', -demlong)\n      g.setAttribute('y2', demlong)\n      g.setAttribute('style', this.style)\n      break\n    case '\\\\' :\n      g = document.createElementNS(svgns, 'line')\n      g.setAttribute('x1', -demlong)\n      g.setAttribute('y1', -demlong)\n      g.setAttribute('x2', demlong)\n      g.setAttribute('y2', demlong)\n      g.setAttribute('style', this.style)\n      break\n    case '//':\n      g = document.createElementNS(svgns, 'g')\n      for (k = -1; k <= 1; k += 2) {\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', k * dec + demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', k * dec - demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n      }\n      break\n    case '///':\n      g = document.createElementNS(svgns, 'g')\n      for (k = -1; k <= 1; k++) {\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', k * ec + demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', k * ec - demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n      }\n      break\n    case '\\\\\\\\':\n      g = document.createElementNS(svgns, 'g')\n      for (k = -1; k <= 1; k += 2) {\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', k * dec - demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', k * dec + demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n      }\n      break\n    case '\\\\\\\\\\\\':\n      g = document.createElementNS(svgns, 'g')\n      for (k = -1; k <= 1; k++) {\n        li = document.createElementNS(svgns, 'line')\n        li.setAttribute('x1', k * ec - demlong)\n        li.setAttribute('y1', -demlong)\n        li.setAttribute('x2', k * ec + demlong)\n        li.setAttribute('y2', demlong)\n        li.setAttribute('style', this.style)\n        g.appendChild(li)\n      }\n      break\n    case 'X': // Croix\n      g = document.createElementNS(svgns, 'g')\n      li = document.createElementNS(svgns, 'line')\n      li.setAttribute('x1', -demlong)\n      li.setAttribute('y1', -demlong)\n      li.setAttribute('x2', demlong)\n      li.setAttribute('y2', demlong)\n      li.setAttribute('style', this.style)\n      g.appendChild(li)\n      li = document.createElementNS(svgns, 'line')\n      li.setAttribute('x1', demlong)\n      li.setAttribute('y1', -demlong)\n      li.setAttribute('x2', -demlong)\n      li.setAttribute('y2', demlong)\n      li.setAttribute('style', this.style)\n      g.appendChild(li)\n      break\n    case 'O': // Rond\n      g = document.createElementNS(svgns, 'circle')\n      g.setAttribute('cx', 0)\n      g.setAttribute('cy', 0)\n      g.setAttribute('r', diam)\n      g.setAttribute('style', this.style + 'fill:none;')\n      break\n    default :\n      g = document.createElementNS(svgns, 'g') // Vide en cas d'erreur\n  }\n  this.g = g\n}\n/** @inheritDoc */\nMarqueSegment.prototype.positionne = function () {\n  this.g.setAttribute('transform', 'translate(' + this.x + ',' + this.y + ')')\n}\n/** @inheritDoc */\nMarqueSegment.prototype.translate = function (x, y) {\n  this.x = x\n  this.y = y\n  this.positionne()\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { analyseExposantOuIndice, getMathsForName, getTaille, indiceFinBalise, necessiteLatex, remplaceBalises, remplaceCarSpe, traiteBalise } from '../global'\nimport { svgns } from '../global/constantes'\nimport InfoBalise from '../global/InfoBalise'\nimport ObjetBase from '../objets/ObjetBase'\nimport { setStyles } from 'sesajstools/dom'\nexport default NomPoint\n/**\n * Objet servant à nommer un point\n * @extends ObjetBase\n * @constructor\n * @param {iepDoc} doc le document propriétaire\n * @param {string} id l'id du point auquel le nom est attribué\n * @param {string} dx le décalage en abscisses du nom par rapport au point (haut-gauche de la matrice du nom)\n * @param {string} dy le décalage en ordonnées du nom par rapport au point (haut-gauche de la matrice du nom)\n * @param {string} couleur la couleur du nom\n */\nfunction NomPoint (doc, id, dx, dy, nom, couleur) {\n  ObjetBase.call(this, doc, id, couleur)\n  this.dx = (dx == null) ? 2 : parseFloat(dx)\n  this.dy = (dy == null) ? 4 : parseFloat(dy)\n  // Traitement des accents plus nécessaire avec la version MathJax 3\n  // this.nom = kernel.remplaceAccentsHtml(kernel.remplaceBalises(kernel.remplaceCarSpe(nom)))\n  this.nom = remplaceBalises(remplaceCarSpe(nom))\n  this.taille = 20\n  this.point = this.doc.getElement(this.id, 'point')\n  this.objet = 'point'\n  this.nom = this.nom.replace(/\\*/g, '×')\n  if (necessiteLatex(nom)) {\n    this.nom = '$' + this.traiteMaths(this.nom) + '$'\n    this.estLatex = true\n  } else {\n    // this.nom = traiteAccents(this.nom) PLus utile version MathJax 3\n    this.estLatex = false\n  }\n}\nNomPoint.prototype = new ObjetBase()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nNomPoint.prototype.creeg = function () {\n  let indbalise, tspan, ch, ch2, style, txt, ind, indexp, indind, mini, bexp, tailleind, stylespan,\n    y, sp, i, debutLigne, an\n  let dy = 0 // Le baselineshift de chaque tspan\n  const inf = '<' // Equivalent du symbole <\n  const debexp = '£e('\n  const debind = '£i('\n  const g = document.createElementNS(svgns, 'g')\n  const taille = getTaille(this)\n  const hautlig = taille + 2\n  let decblp = 0 // Décalage vers le bas de la ligne précédente\n  const decalage = taille * 0.4 // Décalage vers le bas ou le haut en cas d'indice ou d'exposant\n\n  if (this.nom.length !== 0) {\n    txt = document.createElementNS(svgns, 'text')\n    txt.setAttribute('pointer-events', 'none')\n    txt.setAttribute('x', 0)\n    txt.setAttribute('y', 0)\n    style = 'text-anchor:left;font-size:' + taille + 'px;' + 'fill:' + this.couleur + ';'\n    txt.setAttribute('style', style)\n    // On remplace les espaces par des espaces insécables\n    ch2 = this.nom.replace(/ /g, '\\u00A0')\n    // Affecter une longueur ne peut être efficace que pour du texte simpel sans balise\n    if ((this.nom.indexOf(inf) === -1) && (this.nom.indexOf(debexp) === -1) && (this.nom.indexOf(debind) === -1) &&\n      (this.nom.indexOf('<br>') === -1)) {\n      txt.appendChild(document.createTextNode(ch2))\n    } else {\n      sp = ch2.split(/<br>/gi)\n      y = -hautlig\n      for (i = 0; i < sp.length; i++) {\n        debutLigne = true\n        ch = sp[i]\n        while (ch.length !== 0) {\n          indbalise = ch.indexOf(inf)\n          indexp = ch.indexOf(debexp)\n          indind = ch.indexOf(debind)\n          if (debutLigne) y += hautlig + decblp\n          if (indexp !== -1) y += decalage\n          if ((indbalise === -1) && (indexp === -1) && (indind === -1)) {\n            tspan = document.createElementNS(svgns, 'tspan')\n            tspan.setAttribute('pointer-events', 'none')\n            tspan.setAttribute('dy', dy)\n            if (debutLigne) {\n              tspan.setAttribute('x', 0)\n              tspan.setAttribute('y', y)\n              debutLigne = false\n            }\n            dy = 0 // On est revenu au niveau 0\n            tspan.appendChild(document.createTextNode(ch))\n            txt.appendChild(tspan)\n            break\n          } else {\n            while ((ch.indexOf(inf) !== -1) || (ch.indexOf(debexp) !== -1) ||\n                    (ch.indexOf(debind) !== -1)) {\n              indbalise = ch.indexOf(inf)\n              indexp = ch.indexOf(debexp)\n              indind = ch.indexOf(debind)\n              if (indbalise === -1) {\n                if (indexp === -1) mini = indind\n                else mini = (indind === -1) ? indexp : Math.min(indind, indexp)\n              } else {\n                if (indexp === -1) mini = (indind === -1) ? indbalise : Math.min(indbalise, indind)\n                else {\n                  if (indind === -1) mini = Math.min(indbalise, indexp)\n                  else mini = Math.min(indbalise, indind, indexp)\n                }\n              }\n              if (mini > 0) { // Il y a du texte avant les balises\n                tspan = document.createElementNS(svgns, 'tspan')\n                tspan.setAttribute('pointer-events', 'none')\n                tspan.setAttribute('dy', dy)\n                if (debutLigne) {\n                  tspan.setAttribute('x', 0)\n                  tspan.setAttribute('y', y)\n                  debutLigne = false\n                }\n                dy = 0 // On est revenu au niveau 0\n                tspan.appendChild(document.createTextNode(ch.substring(0, mini)))\n                txt.appendChild(tspan)\n                ch = ch.substring(mini)\n              } else {\n                if (indbalise === 0) {\n                  const infoBalise = new InfoBalise(false, false, false, this.couleur, '', taille)\n                  ind = indiceFinBalise(ch)\n                  if (ind === -1) traiteBalise(ch, infoBalise, txt, debutLigne, y)\n                  else traiteBalise(ch.substring(0, ind), infoBalise, txt, debutLigne, y)\n                  debutLigne = false\n                  if (ind !== -1) ch = ch.substring(ind); else ch = ''\n                  dy = 0 // On est revenu au niveau 0\n                } else { // mini est égal à 0\n                  bexp = mini === indexp\n                  an = analyseExposantOuIndice(ch)\n                  tspan = document.createElementNS(svgns, 'tspan')\n                  tspan.setAttribute('pointer-events', 'none')\n                  tspan.setAttribute('dy', dy + 'px')\n                  if (debutLigne) {\n                    tspan.setAttribute('x', 0)\n                    tspan.setAttribute('y', y)\n                    debutLigne = false\n                  }\n                  if (an.erreur) tspan.appendChild(document.createTextNode(ch))\n                  else {\n                    tspan.appendChild(document.createTextNode(an.operande))\n                    txt.appendChild(tspan)\n                    tspan = document.createElementNS(svgns, 'tspan')\n                    tspan.setAttribute('pointer-events', 'none')\n                    tspan.appendChild(document.createTextNode(an.exposant))\n                    dy = decalage\n                    if (bexp) dy = -dy\n                    else decblp = dy\n                    tspan.setAttribute('dy', dy + 'px')\n                    tailleind = taille * 0.6\n                    stylespan = 'font-size:' + tailleind + 'px;'\n                    tspan.setAttribute('style', stylespan)\n                    txt.appendChild(tspan)\n                    dy = -dy // Car sinon la suite sera décalée aussi en hauteur\n                  }\n                  ch = an.texte\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    g.appendChild(txt)\n    this.g = g\n  }\n  g.setAttribute('visibility', 'hidden')\n  // g.setAttribute(\"id\",this.id);\n}\n/*\nNomPoint.prototype.creegLatex = function () {\n  let w, h, ratio\n  try {\n    const g = document.createElementNS(svgns, 'g')\n    const c1 = this.div.childNodes[1]\n    if (c1 === undefined) return document.createElementNS(svgns, 'g')\n    const c2 = c1.childNodes[0]\n    if (c2 === undefined) return document.createElementNS(svgns, 'g')\n    let s = c2.childNodes[0]\n    if (s === undefined) return document.createElementNS(svgns, 'g')\n    // Pour gérer Chrome\n    while (s.tagName === 'SPAN') s = s.childNodes[0]\n    // Le test suivant est du à la compatibilité avec l'explorer\n    if ((s.clientWidth !== 0) && (s.clientHeight !== 0)) {\n      w = s.clientWidth\n      h = s.clientHeight\n    } else {\n      const b = s.getBBox()\n      ratio = b.height / b.width\n      w = this.div.clientWidth\n      h = w * ratio\n    }\n    const t = this.taille\n    if (h < t) h = t\n    s.setAttribute('x', '0')\n    s.setAttribute('y', String(-this.taille)) // Différent de MathGraph32\n    s.setAttribute('width', w + 'px')\n    s.setAttribute('height', h + 'px')\n    g.appendChild(s.parentNode.removeChild(s))\n    document.body.removeChild(this.div)\n    g.setAttribute('visibility', 'hidden')\n    // g.setAttribute(\"id\",this.id);\n    this.g = g\n  } catch (e) {\n    if (this.div != null) document.body.removeChild(this.div)\n    this.g = document.createElementNS(svgns, 'g') // Crée un g vide en cas de problème\n  }\n}\n*/\n/**\n * Fonction appelée par prepare() qui récupère l'élement svg graphique représentant\n * la formule dans this.html (créé par MathJax.tex2svgPromise), le modifie pour lui\n * donner les bons attributs et l'affecte à this.g\n * Rajoute les éléments graphiques correspondant à un cadre si une couleur de fond\n * et un cadre ont été demandés\n */\nNomPoint.prototype.creegLatex = function () {\n  try {\n    const g = document.createElementNS(svgns, 'g')\n    // on récupère le svg de creeg mis dans this.html (éventuellement par MathJax.tex2svgPromise)\n    const s = this.html.firstChild\n    const svg = s.cloneNode(true)\n    g.appendChild(svg)\n    // le svg de MathJax a ces attributs\n    const w = parseFloat(s.getAttribute('width')) * this.ex\n    const h = parseFloat(s.getAttribute('height')) * this.ex\n    const svgVa = svg.style['vertical-align']\n    const va = (svgVa ? parseFloat(svgVa) || 1 : 1) * this.ex\n    svg.setAttribute('width', w + 'px')\n    svg.setAttribute('height', h + 'px')\n    setStyles(svg, 'vertical-align', va + 'px')\n\n    svg.setAttribute('x', '0')\n    const taille = getTaille(this)\n    svg.setAttribute('y', String(-taille)) // Différent de MathGraph32\n    svg.setAttribute('visibility', 'hidden')\n    // g.setAttribute(\"id\",this.id);\n    this.g = g\n  } catch (error) {\n    console.error(error, 'on remplace par un <g> vide')\n    this.g = document.createElementNS(svgns, 'g') // Crée un g vide en cas de problème\n  }\n}\n\n/** @inheritDoc */\nNomPoint.prototype.positionne = function () {\n  // Il arrive que des gens aient mis l'action de nommer le point avant la création du point lui-même\n  // d'où le test suivant :\n  if (this.point === null) this.point = this.doc.getElement(this.id, 'point')\n  const xp = this.point.x\n  const yp = this.point.y\n  const taille = getTaille(this)\n  this.g.setAttribute('transform', 'translate(' + String(xp + this.dx) + ',' + String(yp + this.dy + taille) + ')')\n}\n\n/**\n * Fonction traitant la chaîne ch pour la transcrire en code LaTeX\n * Renvoie la chaîne LaTeX correspondante.\n * Si la chaîne contient des balises <br>, un tableau LaTeX est utilisé pour rendre le contenu\n * @param {string} ch la chaîne à traiter\n * @returns {string} la chaîne LaTeX correpondante une fois ch traduite\n */\nNomPoint.prototype.traiteMaths = function (ch) {\n  // Modifié version MathJax 3\n  // return traiteAccents(getMathsForName(ch, true)) // True pour mode texte\n  return getMathsForName(ch, true)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport Vect from '../types/Vect'\nimport * as kernel from '../global'\nexport default ObjetBase\n/**\n * Objet ancêtre de tous les objets graphiques\n * Le prototype de chaque descendant de cet objet devra comprendre une fonction creeg qui créera\n * le svg élément associé et l'affectera à this.g\n * @constructor\n * @param {IepDoc} doc Le document propriétaire de l'objet\n * @param {string} id Le numéro de l'objet dans le document\n */\nfunction ObjetBase (doc, id, couleur) {\n  this.doc = doc\n  this.id = id\n  this.couleur = couleur\n  this.zoomfactor = 1 // Pour les images\n  this.visible = false\n  this.objet = 'trait' // Ne sera redéfini que pour les points, textes, les angles et le gabarits\n}\n/**\n * Cette fonction est appelée lors de la création d'objets.\n * par défaut elle ne fait rien;\n * Elle sera redéfinie pour les objets qui peuvent être translatés : points, marques de segments, textes, images\n */\nObjetBase.prototype.positionne = function () {\n}\n/**\n * Fonction qui réinitialisera la psoition des objets lorsqu'on retrace la figure\n * Ne sera redéfinie que pour les objets dont la position peut être modifiee par translation, rotation ou zoom\n */\nObjetBase.prototype.initialisePosition = function () {\n}\n/**\n * Fonction translatant l'objet aux coordonnées (ab)\n * @param {number} a\n * @param {number} b\n */\nObjetBase.prototype.translate = function (a, b) {\n  this.setPosition(a, b, this.angle, this.zoomfactor)\n}\n/**\n * Fonction donnant au membre angle de l'objet la valeur ang\n * @param {number} ang\n */\nObjetBase.prototype.tourne = function (ang) {\n  this.setPosition(this.x, this.y, ang, this.zoomfactor)\n}\n/**\n * Fonction donnant au membre zoom de l'objet la valeur rap\n * @param {number} zoomfactor\n */\nObjetBase.prototype.zoom = function (zoomfactor) {\n  this.zoomfactor = zoomfactor\n  this.setPosition(this.x, this.y, this.angle, zoomfactor)\n}\n/**\n * Fonction rendant l'objet visible ou invisible suivant la valeur de bvisible\n * Modifie en consequence la valeur de bvisible\n * @param {boolean} bvisible\n */\nObjetBase.prototype.montre = function (bvisible) {\n  this.visible = bvisible\n  if (this.g) this.g.setAttribute('visibility', bvisible ? 'visible' : 'hidden')\n}\n\n// Les fonctions suivantes ne serviront que pour les points, marques de segment et affichages de texte\n// et d'images\n// Ces objets doivent posséder une fonction setPosition(x,y)\n/**\n * Fonction ne servant que pour les points, marques de segment, affichages de texte et images\n * Lance une aniamtion de translation de l'objet via un timer et une fonction de callBack\n * Ces objets doivent posséder une fonction setPosition(x,y)\n * @param {number} xfin abscisse de la position finale de l'objet\n * @param {number} yfin ordonnée de la position finale de l'objet\n * @param {number} pix10 Nombre de pixels pour le déplacement par dixième de seconde\n */\nObjetBase.prototype.lanceAnimationTranslation = function (xfin, yfin, pix10) {\n  // this.g.setAttribute(\"visibility\",\"visible\");\n  this.xfin = xfin\n  this.yfin = yfin\n  this.pix = Math.abs(pix10 / 4) // Dans la version JavaScript on quadruple la fréquence\n  // en divisant le pas par 4\n  // (en fait par deux car la rapidité semble double de celle annoncée dans le mode d'emploi)\n  const v = new Vect(this.x, this.y, xfin, yfin)\n  this.dist = v.norme() // La distance entre la position actuelle et la position finale\n  // Cas où l'objet est déjà à la bonne position\n  if (this.dist === 0) {\n    this.translate(this.xfin, this.yfin)\n    this.doc.actionSuivante()\n    return\n  }\n  this.vect = v.vecteurColineaire(this.pix)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourTranslation() }, 25)\n}\n/**\n * Fonction de callBack appelée par un timer lors de l'animation de translation\n * On poursuit l'animation tant que la distance entre la position actuelle et la psoition de fin\n * est inférieure à la distance précédente\n */\nObjetBase.prototype.actionPourTranslation = function () {\n  const x = this.x + this.vect.x\n  const y = this.y + this.vect.y\n  const u = new Vect(x, y, this.xfin, this.yfin)\n  const d = u.norme()\n  if ((d > this.dist) || !this.doc.animationEnCours) {\n    this.translate(this.xfin, this.yfin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.dist = d\n    this.translate(x, y)\n  }\n}\n/**\n * Fonction ne servant que pour les points, marques de segment, affichages de texte et images\n * Lance une animation de rotation de l'objet via un timer et une fonction de callBack\n * Ces objets doivent posséder une fonction setPosition(x,y)\n * @param {number} angfin l'angle de fin de l'objet\n * @param {number} deg10 le nombre de degrés dont on tourne par dixième de seconde\n */\nObjetBase.prototype.lanceAnimationRotation = function (angfin, deg10) {\n  // Il faut choisir le déplacement \"le plus court\"\n  const ang1 = kernel.mesurePrincDeg(this.angle)\n  let ang2 = kernel.mesurePrincDeg(angfin)\n  if (Math.abs(ang2 - ang1) > 180) {\n    if (ang2 > ang1) ang2 = ang2 - 360\n    else ang2 = ang2 + 360\n  }\n  this.anglefin = ang2\n  this.angle = ang1\n\n  this.pasdeg = deg10 * 2 / 3 // Dans la version JavaScript on quadruple la fréquence\n  // en divisant le pas par 4\n  // (en fait on corrige par *2/3 car la rapidité semble double de celle annoncée dans le mode d'emploi)\n  this.pasdeg *= (angfin >= this.angle) ? 1 : -1 // 1 pour le sens direct svg;\n  this.distang = Math.abs(angfin - this.angle)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourRotation() }, 25)\n}\n/**\n * Fonction de callBack appelée par un timer lors de l'animation de rotation\n */\nObjetBase.prototype.actionPourRotation = function () {\n  const ang = parseFloat(this.angle) + parseFloat(this.pasdeg)\n  const dis = Math.abs(ang - this.anglefin)\n  if ((dis > this.distang) || !this.doc.animationEnCours) {\n    this.tourne(this.anglefin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  } else {\n    this.distang = dis\n    this.tourne(ang)\n  }\n}\n/**\n * Fonction ne servant que pour les affichages de texte et images\n * Lance une aniamtion de zoom de l'objet via un timer et une fonction de callBack\n * @param {number} zoomfin la valeur de fin du zoomfactor de l'objet\n * @param {number} vitesse pour la vitesse d'animation\n */\nObjetBase.prototype.lanceAnimationZoom = function (zoomfin, vitesse) {\n  this.zoomfin = zoomfin\n  this.vitesse = parseInt(vitesse)\n  this.pas = this.vitesse * 0.05 * (this.zoomfin - this.zoomfactor) // On augmente\n  // par défaut de 5% de vitesse tous les dixièmes de seconde\n  this.senspos = (this.pas >= 0)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourZoom() }, 100)\n}\n/**\n * Fonction de callBack appelée par un timer lors de l'animation de zoom\n */\nObjetBase.prototype.actionPourZoom = function () {\n  const z = this.zoomfactor + this.pas\n  if (this.doc.animationEnCours && ((this.senspos && (z < this.zoomfin)) || (!this.senspos && (z > this.zoomfin)))) { this.zoom(z) } else {\n    this.zoom(this.zoomfin)\n    clearInterval(this.timer)\n    this.doc.actionSuivante()\n  }\n}\n/**\n * Fonction qui devra être appelée pour remettre à jour le g élément représentant\n * l'objet dans le DOM du svg de la figure\n * Appelé quand on recalcule la figure ou lors des animations\n * Par défaut on reconstruit le svg élément pour mettre à jour l'objet\n * Pour certains objets (point par exemple) ce sera inutile\n * @retursn {undefined}\n */\nObjetBase.prototype.updateg = function () {\n  const oldg = this.g\n  this.creeg()\n  this.doc.svg.replaceChild(this.g, oldg)\n  this.doc.setElement(this.id, this)\n  this.g.setAttribute('visibility', 'visible')\n}\n/**\n * Fonction qui renverra true lorsque la création de l'objet donne lieu à une animation\n * par exemple pour les segments, droites. Sera donc redéfini dans droiteAncetre\n * Dans ce cas, l'objet devra avoir deux fonctions : lanceAnimation et actionPourAnimation\n * @returns {boolean}\n */\nObjetBase.prototype.creationAnimee = function () {\n  return false\n}\n/**\n * Fonction qui devra être redéfinie pour les objets créés avec une animation\n * appelée à la fin d'une animation ou lors de la visualisation immédiate de l'objet\n * lors du click sur une icône stepNext ou stepPrev\n */\nObjetBase.prototype.finAction = function () {\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport Ligne from '../objets/Ligne'\nimport ObjetBase from '../objets/ObjetBase'\nexport default Point\n/**\n * Classe représentant un objet de type point\n * A noter que point possèdera deux champs supplémentaires xcons et ycons\n * qui contiendront les coordonées du point au cours de la construction des autres objets\n * xcons et ycons seront modifiés lors d'une action de translation du point\n * pour que les objets l'utilisant comme cible soient correctement initialisés.\n * @extends ObjetBase\n * @constructor\n * @param {iepDoc} doc le document propriétaire\n * @param {string} id L'id de l'objet\n * @param {string} x l'abscisse initiale\n * @param {string} y l'ordonnée initiale\n * @param {string} couleur\n * @param {string} epaisseur\n */\nfunction Point (doc, id, x, y, couleur, epaisseur) {\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  // Les deux variables suivantes servent à rétablir la figure dans son état initial quand on revien au début de la figure\n  this.xinit = this.x\n  this.yinit = this.y\n  //\n  this.xcons = this.x\n  this.ycons = this.y\n  Ligne.call(this, doc, id, couleur, epaisseur)\n  this.style += 'stroke-linecap:round;' // Des bouts de croix arrondis\n  this.nom = null // Un nom peut être affecté ultérieurement par une action nommer\n  this.objet = 'point'\n}\nPoint.prototype = new Ligne()\n/** @inheritDoc */\nPoint.prototype.initialisePosition = function () {\n  this.x = this.xinit\n  this.y = this.yinit\n  this.positionne()\n}\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nPoint.prototype.creeg = function () {\n  const lon = 5 // Longuueur en pixels d'un demi-trait\n  const g = document.createElementNS(svgns, 'g')\n  let li\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', -lon)\n  li.setAttribute('y1', lon)\n  li.setAttribute('x2', lon)\n  li.setAttribute('y2', -lon)\n  li.setAttribute('style', this.style)\n  g.appendChild(li)\n  li = document.createElementNS(svgns, 'line')\n  li.setAttribute('x1', -lon)\n  li.setAttribute('y1', -lon)\n  li.setAttribute('x2', lon)\n  li.setAttribute('y2', lon)\n  li.setAttribute('style', this.style)\n  g.appendChild(li)\n  // g.setAttribute(\"id\",this.id);\n  this.g = g\n}\n/** @inheritDoc */\nPoint.prototype.positionne = function () {\n  this.g.setAttribute('transform', 'translate(' + this.x + ',' + this.y + ')')\n}\n/** @inheritDoc */\nPoint.prototype.translate = function (x, y) {\n  this.x = x\n  this.y = y\n  this.positionne()\n  if (this.nom !== null) this.nom.positionne()\n}\n/** @inheritDoc */\nPoint.prototype.updateg = function () {\n  this.setPosition(this.x, this.y)\n}\n// Nécessaire de redéfinir montre car il peut y avoir un nom attaché au point\nPoint.prototype.montre = function (bvisible) {\n  ObjetBase.prototype.montre.call(this, bvisible)\n  if (this.nom !== null) if (this.nom.g) this.nom.montre(bvisible)\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport ObjetBase from '../objets/ObjetBase'\nimport Vect from '../types/Vect'\nexport default Polygone\n/**\n * Classe représentant un polygone de la figure\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le document propriétaire\n * @param {string} id l'id de l'objet dans le fichier XML de la figure\n * @param {string[]} abs un tableau contenant les abscisses des sommets\n * @param {string[]} ord : un tableau contenant les ordonnées des sommets\n * @param {string} couleur la couleur du polygone\n * @param {number} epaisseur l'épaisseur du tracé\n * @param {string} couleurFond la couelur de onc de l'intérieur du polygone\n * @param {string} opacite l'opacité du remplissage (de 0 à 100)\n */\nfunction Polygone (doc, id, abs, ord, couleur, epaisseur, couleurFond, opacite) {\n  ObjetBase.call(this, doc, id, couleur)\n  this.abs = abs.split(',')\n  this.ord = ord.split(',')\n  this.sauveabs = this.abs\n  this.sauveord = this.ord\n  this.epaisseur = epaisseur\n  this.opacite = (opacite == null) ? '60' : opacite\n  const op = parseFloat(this.opacite / 100)\n  if (couleurFond == null) this.couleurFond = this.couleur; else this.couleurFond = couleurFond\n  this.style = 'stroke:' + couleur + ';stroke-width:' + epaisseur +\n          ';fill:' + this.couleurFond + ';'\n  this.style += 'fill-opacity:' + op + ';'\n  this.objet = 'trait'\n}\nPolygone.prototype = new ObjetBase()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nPolygone.prototype.creeg = function () {\n  let points, i\n  const p = document.createElementNS(svgns, 'polygon')\n  points = ''\n  for (i = 0; i < this.abs.length; i++) {\n    points += ' ' + this.abs[i] + ' ' + this.ord[i]\n  }\n  p.setAttribute('points', points)\n  p.setAttribute('style', this.style)\n  p.setAttribute('visibility', 'hidden')\n  // p.setAttribute(\"id\",this.id);\n  this.g = p\n}\n/** @inheritDoc */\nPolygone.prototype.creationAnimee = function () {\n  return true\n}\n/**\n * Fonction lançant l'animation de visualisation de la ligne continue\n * Utilise un timer et une fonction de callBack\n * Vitesse est le nombre de pixels à parcourir à chaque dixième de seconde\n * @param {number} vitesse\n */\nPolygone.prototype.lanceAnimation = function (vitesse) {\n  // Dans la version flash, la vitesse n'est pas le nombre de pixels par dixième de seconde\n  // mais le nombre de pixlels par seconde semble le double\n  this.pix = parseFloat(vitesse / 2)\n  this.abs = []\n  this.abs[0] = this.sauveabs[0]\n  this.ord = []\n  this.ord[0] = this.sauveord[0]\n  this.ind = 0 // L'indice du sommet en cours dans le tableau des coordonnées\n  this.n = 0 // L'indice du pas sur le segment en cours\n  const cray = this.doc.crayon\n  const v = new Vect(parseFloat(this.sauveabs[0]), parseFloat(this.sauveord[0]),\n    parseFloat(this.sauveabs[1]), parseFloat(this.sauveord[1]))\n  this.longcote = v.norme() // Longueur du côté en cours\n  this.vect = v.vecteurColineaire(this.pix)\n  cray.setPosition(parseFloat(this.abs[0]), parseFloat(this.ord[0]), cray.angle)\n  const t = this\n  this.timer = setInterval(function () { t.actionPourAnimation() }, 25)\n}\n/**\n * Fonction de callBack appelée par un timer pour l'animation du tracé\n */\nPolygone.prototype.actionPourAnimation = function () {\n  const cray = this.doc.crayon\n  let ind = this.ind\n  const x = parseFloat(this.abs[ind])\n  const y = parseFloat(this.ord[ind])\n  this.n++\n  if (this.doc.animationEnCours) {\n    if (this.n * this.pix <= this.longcote) {\n      const x1 = x + this.n * this.vect.x\n      const y1 = y + this.n * this.vect.y\n      this.abs[ind + 1] = String(x1)\n      this.ord[ind + 1] = String(y1)\n      cray.translate(x1, y1)\n      this.updateg()\n    } else {\n      this.ind++\n      ind++\n      if (ind === this.sauveabs.length - 1) {\n        clearInterval(this.timer)\n        this.finAction()\n        this.doc.actionSuivante()\n      } else { // On passe au côté suivant\n        this.abs[ind] = this.sauveabs[ind]\n        this.ord[ind] = this.sauveord[ind]\n        cray.translate(parseFloat(this.abs[ind]), parseFloat(this.ord[ind]))\n        const v = new Vect(parseFloat(this.sauveabs[ind]), parseFloat(this.sauveord[ind]),\n          parseFloat(this.sauveabs[ind + 1]), parseFloat(this.sauveord[ind + 1]))\n        this.longcote = v.norme() // Longueur du côté en cours\n        this.vect = v.vecteurColineaire(this.pix)\n        this.n = 0\n      }\n    }\n  } else {\n    clearInterval(this.timer)\n    this.finAction()\n    this.doc.actionSuivante()\n  }\n}\n/**\n * extends iep.objetBase.prototype.finAction\n */\nPolygone.prototype.finAction = function () {\n  this.abs = this.sauveabs\n  this.ord = this.sauveord\n  const len = this.abs.length\n  this.updateg()\n  this.doc.crayon.translate(parseFloat(this.abs[len - 1]), parseFloat(this.ord[len - 1]))\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { svgns } from '../global/constantes'\nimport ObjetBase from '../objets/ObjetBase'\nexport default Quadrillage\n/**\n * Classe représentant un quadrillage de la figure\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc Le document propriétaire\n * @param {string} type Le type de quadrillage : \"quadrillage\",\"seyes\",\"5x5\",\"10x10\",\"millimetre\"\n * @param {string} hauteur La hauteur du cadre en cm (1 cm = 30 pixels)\n * @param {string} largeur La largeur du cadre en cm (1 cm = 30 pixels)\n * @param {string} haut La position en ordonnées du cadre dans la fenêtre\n * @param {string} gauche La position en abscisses du cadre dans la fenêtre\n * @param {string} couleur La couleur du quadrillage\n * Attention : Un quadrillage n'a pas d'id et il ne peut y en avoir qu'un dans une figure.\n */\nfunction Quadrillage (doc, type, hauteur, largeur, haut, gauche, couleur) {\n  ObjetBase.call(this, doc, 'quadrillageIEP', couleur) // Le repère aura pour Id quadrillageIEP\n  this.hauteur = parseFloat(hauteur)\n  this.largeur = parseFloat(largeur)\n  this.haut = (haut == null) ? 0 : parseFloat(haut)\n  this.gauche = (gauche == null) ? 0 : parseFloat(gauche)\n  this.type = type\n  this.cadre = {}\n  this.cadre.gauche = this.gauche * 30 // 30 px pour 1 cm\n  this.cadre.haut = this.haut * 30\n  this.cadre.droite = this.cadre.gauche + this.largeur * 30\n  this.cadre.bas = this.cadre.haut + this.hauteur * 30\n  this.objet = 'quadrillage'\n}\n\nQuadrillage.prototype = new ObjetBase()\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nQuadrillage.prototype.creeg = function () {\n  const gauche = this.cadre.gauche\n  const droite = this.cadre.droite\n  const haut = this.cadre.haut\n  const bas = this.cadre.bas\n  const couleur = this.couleur\n  this.g = document.createElementNS(svgns, 'g')\n  // Un seul quadrillage sur une figure.\n  const oldg = this.doc.svg.getElementById('quadrillageIEP')\n  if (oldg != null) this.doc.svg.removeChild(oldg)\n  switch (this.type) {\n    case 'seyes':\n      this.tracer_grille(couleur, 24, 6, gauche, haut, droite, bas, false, 1) // 1 est l'opacité\n      this.tracer_grille(couleur, 24, 24, gauche, haut, droite, bas, false, 1)\n      break\n    case 'millimetre':\n      this.tracer_grille(couleur, 3, 3, gauche, haut, droite, bas, false, 0.6)\n      this.tracer_grille(couleur, 30, 30, gauche, haut, droite, bas, false, 0.8)\n      this.tracer_grille(couleur, 150, 150, gauche, haut, droite, bas, false, 1)\n      break\n    case '10x10':\n    case '10x':\n      this.tracer_grille(couleur, 30, 30, gauche, haut, droite, bas, false, 1)\n      break\n    case '5x5':\n    case '5x':\n    default:\n      this.tracer_grille(couleur, 15, 15, gauche, haut, droite, bas, false, 1)\n      break\n  }\n}\n/**\n * Fonction reprise à partir du code de la version Flash\n * @param {string} epaisseur\n * @param {string} couleur\n * @param {number} ecart_x\n * @param {number} ecart_y\n * @param {number} debut_x\n * @param {number} debut_y\n * @param {number} fin_x\n * @param {number} fin_y\n * @param {number} pointille\n * @param {number} alpha\n */\nQuadrillage.prototype.tracer_grille = function (couleur, ecart_x, ecart_y, debut_x, debut_y, fin_x, fin_y, pointille, alpha) {\n  let li, i\n  const style = 'stroke:' + couleur + ';stroke-width:0.5;' + 'stroke-opacity:' + alpha + ';'\n  if (pointille) this.style += 'stroke-dasharray:2 2;' // Pointillés\n  let nb = Math.ceil(Math.abs(fin_x - debut_x) / ecart_x)\n  for (i = 0; i < nb; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', debut_x + i * ecart_x)\n    li.setAttribute('y1', debut_y)\n    li.setAttribute('x2', debut_x + i * ecart_x)\n    li.setAttribute('y2', fin_y)\n    li.setAttribute('style', style)\n    this.g.appendChild(li)\n  }\n  nb = Math.ceil(Math.abs(fin_y - debut_y) / ecart_y)\n  for (i = 0; i < nb; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', debut_x)\n    li.setAttribute('y1', debut_y + i * ecart_y)\n    li.setAttribute('x2', fin_x)\n    li.setAttribute('y2', debut_y + i * ecart_y)\n    li.setAttribute('style', style)\n    this.g.appendChild(li)\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport * as kernel from '../global'\nimport { svgns } from '../global/constantes'\nimport ObjetBase from '../objets/ObjetBase'\nexport default Repere\n/**\n * Classe représentant un repère de la figure\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc le docmument propriétaire\n * @param {string} hauteur Hauteur du cadre contenant le repère, exprimées en centimètres\n * @param {string} largeur Largeur du cadre contenant le repère, exprimées en centimètres\n * @param {string} haut abscisse de ce cadre relativement au bord haut et au\n * bord gauche de la zone de dessin, en centimètres\n * @param {string} gauche Ordonnée de ce cadre relativement au bord haut et\n * au bord gauche de la zone de dessin, en centimètres\n * @param {string} xgrad donne les unités de graduations : si Xgrad est égal à 5,\n *  le repère va être gradué de 5 en 5\n * @param {string} ygrad donne les unités de graduations : si Ygrad est égal à 5, le repère va être gradué de 5 en 5\n * @param {string} xmin valeur mini des abscisses dans le repère\n * @param {string} xmax valeur maxi des abscisses dans le repère\n * @param {string} ymin valeur mini des ordonnées dans le repère\n * @param {string} ymax valeur maxi des ordonnées dans le repère\n * @param {SvgColor} couleur Couleur du tracé\n * @param {string} grille \"invisible” si on souhaite que le quadrillage soit masqué\n * @param {string} axes “invisible” si on souhaite que les axes soient masqué\n * @param {string} etiquettes “invisible” si on souhaite que les étiquettes des axes soient masquées\n */\nfunction Repere (doc, hauteur, largeur, haut, gauche, xgrad, ygrad, xmin, xmax,\n  ymin, ymax, couleur, grille, axes, etiquettes) {\n  ObjetBase.call(this, doc, 'repereIEP', couleur) // Le repère aura pour Id repereIEP\n  this.hauteur = hauteur\n  this.largeur = largeur\n  this.haut = (haut == null) ? 0 : parseFloat(haut)\n  this.gauche = (gauche == null) ? 0 : parseFloat(gauche)\n  this.xgrad = parseFloat(xgrad)\n  this.ygrad = parseFloat(ygrad)\n  this.xmin = parseFloat(xmin)\n  this.xmax = parseFloat(xmax)\n  this.ymin = parseFloat(ymin)\n  this.ymax = parseFloat(ymax)\n  this.grille = (grille == null) ? 'visible' : grille\n  this.axes = (axes == null) ? 'visible' : axes\n  this.etiquettes = (etiquettes == null) ? 'visible' : etiquettes\n  this.cadre = {}\n  this.cadre.gauche = this.gauche * 30 // 30 px pour 1 cm\n  this.cadre.haut = this.haut * 30\n  this.cadre.droite = this.cadre.gauche + this.largeur * 30\n  this.cadre.bas = this.cadre.haut + this.hauteur * 30\n}\nRepere.prototype = new ObjetBase()\n/**\n *\n * @param {number} nbr\n * @returns {number}\n */\nRepere.prototype.mettre_x_en_pixels = function (nbr) {\n  return kernel.mettre_en_pixels(nbr, this.xmin, this.xmax, this.cadre.gauche, this.cadre.droite)\n}\n/**\n * Fonction utilisée dans l'objet repere. Repris du code Flash\n */\nRepere.prototype.mettre_y_en_pixels = function (nbr) {\n  return kernel.mettre_en_pixels(nbr, this.ymax, this.ymin, this.cadre.haut, this.cadre.bas)\n}\n/**\n *\n * @param {number} debut_trace_x\n * @param {number} unite_x\n * @param {number} nb_grad_x\n * @param {number} ordo_etiquettes\n * @param {number} haut\n * @param {number} bas\n */\nRepere.prototype.tracer_abscisses = function (debut_trace_x, unite_x, nb_grad_x, ordo_etiquettes, haut, bas) {\n  let li, txt, abscisse, i\n  const tailleEtiquettes = 12 // Taille de la police utilisée pour les étiquettes\n  const style = 'stroke:black;stroke-width:0.5;'\n\n  if (this.grille === 'invisible' && this.axes !== 'invisible') {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', this.cadre.gauche)\n    li.setAttribute('y1', ordo_etiquettes)\n    li.setAttribute('x2', this.cadre.droite)\n    li.setAttribute('y2', ordo_etiquettes)\n    this.g.appendChild(li)\n  }\n  for (i = 0; i <= nb_grad_x; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    abscisse = this.mettre_x_en_pixels(debut_trace_x + i * unite_x)\n    if (this.grille === 'invisible') {\n      if (this.axes !== 'invisible') {\n        li.setAttribute('x1', abscisse)\n        li.setAttribute('y1', String(ordo_etiquettes - 5))\n        li.setAttribute('x2', abscisse)\n        li.setAttribute('y2', String(ordo_etiquettes + 5))\n        this.g.appendChild(li)\n      }\n    } else {\n      li.setAttribute('x1', abscisse)\n      li.setAttribute('y1', haut)\n      li.setAttribute('x2', abscisse)\n      li.setAttribute('y2', bas)\n      this.g.appendChild(li)\n    }\n    if (this.etiquettes !== 'invisible' && this.axes !== 'invisible') {\n      txt = document.createElementNS(svgns, 'text')\n      txt.setAttribute('x', abscisse + 2)\n      txt.setAttribute('y', ordo_etiquettes + tailleEtiquettes)\n      const stylet = 'text-anchor:left;font-size:' + tailleEtiquettes + 'px;' + 'fill:' + this.couleur + ';'\n      txt.setAttribute('style', stylet)\n      txt.appendChild(document.createTextNode(String(debut_trace_x + i * unite_x)))\n      this.g.appendChild(txt)\n    }\n  }\n}\n/**\n *\n * @param {number} debut_trace_y\n * @param {number} unite_y\n * @param {number} nb_grad_y\n * @param {number} abs_etiquettes\n * @param {number} gauche\n * @param {number} droite\n */\nRepere.prototype.tracer_ordonnees = function (debut_trace_y, unite_y, nb_grad_y, abs_etiquettes, gauche, droite) {\n  let li, txt, ordonnee, i\n  const tailleEtiquettes = 12 // Taille de la police utilisée pour les étiquettes\n  const style = 'stroke:black;stroke-width:0.5;'\n  if (this.grille === 'invisible' && this.axes !== 'invisible') {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    li.setAttribute('x1', abs_etiquettes)\n    li.setAttribute('y1', this.cadre.haut)\n    li.setAttribute('x2', abs_etiquettes)\n    li.setAttribute('y2', this.cadre.bas)\n    this.g.appendChild(li)\n  }\n  for (i = 0; i <= nb_grad_y; i++) {\n    li = document.createElementNS(svgns, 'line')\n    li.setAttribute('style', style)\n    ordonnee = this.mettre_y_en_pixels(debut_trace_y + i * unite_y)\n    if (this.grille === 'invisible') {\n      if (this.axes !== 'invisible') {\n        li.setAttribute('x1', String(abs_etiquettes - 5))\n        li.setAttribute('y1', ordonnee)\n        li.setAttribute('x2', String(abs_etiquettes + 5))\n        li.setAttribute('y2', ordonnee)\n        this.g.appendChild(li)\n      }\n    } else {\n      li.setAttribute('x1', gauche)\n      li.setAttribute('y1', ordonnee)\n      li.setAttribute('x2', droite)\n      li.setAttribute('y2', ordonnee)\n      this.g.appendChild(li)\n    }\n    if (this.etiquettes !== 'invisible' && this.axes !== 'invisible') {\n      txt = document.createElementNS(svgns, 'text')\n      txt.setAttribute('x', abs_etiquettes + 2)\n      txt.setAttribute('y', ordonnee + tailleEtiquettes)\n      const stylet = 'text-anchor:left;font-size:' + tailleEtiquettes + 'px;' + 'fill:' + this.couleur + ';'\n      txt.setAttribute('style', stylet)\n      txt.appendChild(document.createTextNode(String(debut_trace_y + i * unite_y)))\n      this.g.appendChild(txt)\n    }\n  }\n}\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nRepere.prototype.creeg = function () {\n  const width = this.cadre.droite - this.cadre.gauche\n  const height = this.cadre.bas - this.cadre.haut\n  this.g = document.createElementNS(svgns, 'g')\n  const defs = document.createElementNS(svgns, 'defs')\n  const clip = document.createElementNS(svgns, 'clipPath')\n  clip.setAttribute('id', 'clipRepere')\n  const style = 'stroke:' + this.couleur + ';stroke-width:1;fill:none;'\n  const rect = document.createElementNS(svgns, 'rect')\n  rect.setAttribute('style', style)\n  rect.setAttribute('x', this.cadre.gauche)\n  rect.setAttribute('y', this.cadre.haut)\n  rect.setAttribute('width', width)\n  rect.setAttribute('height', height)\n  clip.appendChild(rect)\n  defs.appendChild(clip)\n  this.g.appendChild(defs)\n  this.g.setAttribute('style', 'clip-path:url(#clipRepere)')\n\n  // Si besoin, on trace des graduations pour les abscisses\n  if ((this.xmax - this.xmin) > this.xgrad) {\n    // nombre de graduations qui appraitront\n    const nb_grad_x = Math.floor((this.xmax - this.xmin) / this.xgrad)\n    /*\n     determination de l'ordonnée des étiquettes pour les abscisses\n     */\n    let ordo_etiquettes\n    if (this.ymax * this.ymin < 0) {\n      ordo_etiquettes = this.mettre_y_en_pixels(0)\n    } else if (this.ymax < 0) {\n      ordo_etiquettes = this.cadre.haut\n    } else {\n      ordo_etiquettes = this.cadre.bas\n    }\n    /*\n     FIN ETIQUETTES\n     */\n\n    /*\n     DETERMINATION ABSCISSES\n     */\n    const debut_trace_x = kernel.determiner_graduations(this.xmin, this.xmax, this.xgrad)\n    this.tracer_abscisses(debut_trace_x, this.xgrad, nb_grad_x, ordo_etiquettes, this.cadre.haut, this.cadre.bas)\n    /*\n     FIN ABSCISSES\n     */\n  }\n  if ((this.ymax - this.ymin) > this.ygrad) {\n    const nb_grad_y = Math.floor((this.ymax - this.ymin) / this.ygrad)\n    /*\n     determination de l'abscisse des étiquettes pour les ordonnées\n     */\n    let abs_etiquettes\n    if (this.xmax * this.xmin < 0) {\n      abs_etiquettes = this.mettre_x_en_pixels(0)\n    } else if (this.xmax < 0) {\n      abs_etiquettes = this.cadre.droite\n    } else {\n      abs_etiquettes = this.cadre.gauche\n    }\n    const debut_trace_y = kernel.determiner_graduations(this.ymin, this.ymax, this.ygrad)\n    this.tracer_ordonnees(debut_trace_y, this.ygrad, nb_grad_y, abs_etiquettes, this.cadre.gauche, this.cadre.droite)\n  }\n  // tracer_les_fonctions();\n  const rect2 = document.createElementNS(svgns, 'rect')\n  rect2.setAttribute('style', style)\n  rect2.setAttribute('x', this.cadre.gauche)\n  rect2.setAttribute('y', this.cadre.haut)\n  rect2.setAttribute('width', width)\n  rect2.setAttribute('height', height)\n  this.g.appendChild(rect2)\n  this.g.setAttribute('visibility', 'hidden')\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { cos30, sin30, svgns } from '../global/constantes'\nimport DroiteAncetre from '../objets/DroiteAncetre'\nimport Vect from '../types/Vect'\nexport default Segment\n\n/**\n * Classe représentant un segment qui peut être affublé d'une flèche\n * @extends ObjetBase\n * @constructor\n * @param {number} x1 Abscisse de l'origine\n * @param {integre} y1 Ordonnée de l'origine\n * @param {number} x2 Abscisse de l'extrémité\n * @param {interger} y2 Ordonnée de l'extrémité\n * @param {string} couleur couleur\n * @param {number} epaisseur épaiseur du trait\n * @param {string} opacite transparence du trait (de 0 à 100)\n * @param {string} styleTrait Si \"tiret\" pointillés sinon trait continu\n * @param {boolean} vecteur Si true on rajoute une flcèce\n */\nfunction Segment (doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait, stylefleche) {\n  DroiteAncetre.call(this, doc, id, x1, y1, x2, y2, couleur, epaisseur, opacite, styleTrait)\n  this.stylefleche = stylefleche\n}\n\nSegment.prototype = new DroiteAncetre()\n\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n * Si le segment est en fait un vecteur on crée d'abord le svg élément du segment\n * et on lui rajoute une flèche\n */\nSegment.prototype.creeg = function () {\n  DroiteAncetre.prototype.creeg.call(this)\n  if (this.stylefleche === 'vecteur') {\n    const longFleche = 12\n    const x1 = this.x1\n    const x2 = this.x2\n    const y1 = this.y1\n    const y2 = this.y2\n    const u0 = new Vect(x2, y2, x1, y1)\n    const u1 = u0.vecteurColineaire(longFleche)\n    const u2 = new Vect(u1.x * cos30 - u1.y * sin30,\n      u1.x * sin30 + u1.y * cos30)\n    const u3 = new Vect(u1.x * cos30 + u1.y * sin30,\n      -u1.x * sin30 + u1.y * cos30)\n    const points = String(x2 + u2.x) + ' ' + String(y2 + u2.y) +\n      ',' + x2 + ' ' + y2 + ',' + String(x2 + u3.x) + ' ' + String(y2 + u3.y)\n    const g = document.createElementNS(svgns, 'polyline')\n    g.setAttribute('points', points)\n    const style = 'stroke:' + this.couleur + ';stroke-width:' + this.epaisseur +\n          ';stroke-opacity:' + this.opacite + ';fill:none'\n    g.setAttribute('style', style)\n    this.g.appendChild(g)\n  }\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\nimport { getTaille } from '../global'\nimport { svgns } from '../global/constantes'\nimport ObjetBase from '../objets/ObjetBase'\nexport default Texte\n/**\n * Classe représentant un texte.\n * L'écriture dans le texte se fait via des actionEcrireTexte\n * @extends ObjetBase\n * @constructor\n * @param {IepDoc} doc Le docmument propriétaire\n * @param {string} id L'id du texte\n * @param {string} x L'asbsisse d'affichage\n * @param {string} y L'ordonnée d'affichage\n */\nfunction Texte (doc, id, x, y) {\n  ObjetBase.call(this, doc, id, 'black')\n  this.x = parseFloat(x)\n  this.y = parseFloat(y)\n  // Il faut mémoriser la position initiale du texte car il peut avoir été traslaté ar l'animation\n  // et quand on la relance il doit remprendre sa place initiale\n  this.xinit = this.x\n  this.yinit = this.y\n\n  this.taille = 20\n  this.angle = 0 // Possibilité de tourner un etxte (pas donnée avec la version Flash)\n  this.texte = ''\n  this.objet = 'texte'\n}\nTexte.prototype = new ObjetBase()\n\n// Attention : POur un affichage de texte, il faut décaler vers le bas de la hauteur de la police pour\n// garder la compatibilité avec le flash\nTexte.prototype.positionne = function () {\n  // var y = this.y + parseFloat(this.taille);\n  // this.g.setAttribute(\"transform\",\"translate(\" + this.x + \",\" + y + \")\");\n  this.setPosition(this.x, this.y, this.angle, this.zoomfactor)\n}\nTexte.prototype.translate = function (x, y) {\n  this.x = x\n  this.y = y\n  this.positionne()\n}\n/** @inheritDoc */\nTexte.prototype.updateg = function (g) {\n  const oldg = this.g\n  if (!oldg) return console.error('Il faut appeler creeg avant updateg')\n  this.doc.svg.replaceChild(g, oldg)\n  this.g = g\n  g.setAttribute('visibility', 'visible')\n}\n/**\n * Fonction mettant dans this.g l'élément graphique représentant l'objet dans\n * le DOM du svg de la figure\n */\nTexte.prototype.creeg = function () {\n  this.g = document.createElementNS(svgns, 'g')\n}\n/**\n * Fonction mettant le texte aux coordonnées (x,y) avec un angle angle et\n * un coefficient de zoom zoomfactor et modifiant la spoition du svg element qui\n * le représente dans le DOM du svg.\n * @param {number} x\n * @param {number} y\n * @param {number} angle\n * @param {integer} zoomfactor\n * @returns {undefined}\n */\nTexte.prototype.setPosition = function (x, y, angle, zoomfactor) {\n  this.x = x\n  this.y = y\n  this.angle = angle\n  this.zoomfactor = zoomfactor\n  const taille = getTaille(this)\n  const y2 = y + taille\n  this.g.setAttribute('transform', 'scale(' + zoomfactor + ') translate(' +\n    String(x / zoomfactor) + ',' + String(y2 / zoomfactor) + ') rotate(' + angle + ')')\n}\n","/*\n * Visualiseur InstrumenPoche en Javascript et SVG\n * @author Yves Biton <yves.biton@sesamath.net>\n * @licence AGPL-3.0-or-later\n */\n\nimport { zero } from '../global'\nimport { convDegRad, convRadDeg } from '../global/constantes'\nexport default Vect\n\n/**\n * Classe vecteur\n * Peut être initialisé par les coordonnées de l'origine et de l'extrémité ou\n * par deux coordonnées\n * @constructor\n * @param {number} x1 Abscisse de l'origine ou première coordonnée si deux paramètres\n * @param {number} y1 Ordonnée de l'origine ou première coordonnée si deux paramètres\n * @param {number} x2 Abscisse de l'extrémité si quatre paramètres\n * @param {number} y2 Ordonnée de l'extrémité si quatre paramètres\n */\nfunction Vect (x1, y1, x2, y2) {\n  if (arguments.length > 2) {\n    this.x = x2 - x1\n    this.y = y2 - y1\n  } else {\n    this.x = x1\n    this.y = y1\n  }\n}\n/**\n * Retourne true si la norme du vecteur est inférieur oue égale à 10^-9\n * @returns {boolean}\n */\nVect.prototype.presqueNul = function () {\n  return zero(this.x) && zero(this.y)\n}\n/**\n * Retourne la norme du vecteur\n * @returns {number}\n */\nVect.prototype.norme = function () {\n  return Math.sqrt(this.x * this.x + this.y * this.y)\n}\n/**\n * Renvoie un vecteur de norme norme, colinéaire à v et de même sens\n * @param {number} normeSouhaitee  la norme du vecteur renvoyé\n * @returns {Vect}\n */\nVect.prototype.vecteurColineaire = function (normeSouhaitee) {\n  const norm = this.norme()\n  return new Vect(this.x / norm * normeSouhaitee, this.y / norm * normeSouhaitee)\n}\n/**\n * Fonction faisiant tourner un vecteur de l'angle ang et renvoyant un nouveua vecteur\n * correspondant à cette transformation\n * @param {number} angle L'ange de rotation en degrés\n */\nVect.prototype.tourne = function (angle) {\n  const kc = Math.cos(angle * convDegRad)\n  const ks = Math.sin(angle * convDegRad)\n  return new Vect(kc * this.x - ks * this.y, kc * this.y + ks * this.x)\n}\n/**\n * Renvoie la mesure en degrés de l'angle polaire d'un vecteur non nul\n * Le nombre renvoyé est entre 0 et 380 (exclu)\n * @returns {number}\n */\nVect.prototype.angle = function () {\n  let angle\n  if ((this.x === 0) && (this.y === 0)) return 0\n  else {\n    if (this.x === 0) {\n      if (this.y > 0) { angle = 3 * Math.PI / 2 } else angle = Math.PI / 2\n    } else {\n      if (this.x >= 0) { angle = Math.atan(-this.y / this.x) } else {\n        angle = Math.PI - Math.atan(this.y / this.x)\n      }\n      if (angle < 0) angle = angle + 2 * Math.PI\n    }\n  }\n  return angle * convRadDeg\n}\n","/**\n * This file is part of Sesatheque.\n *   Copyright 2014-2015, Association Sésamath\n *\n * Sesatheque is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License version 3\n * as published by the Free Software Foundation.\n *\n * Sesatheque is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Sesatheque (LICENCE.txt).\n * @see http://www.gnu.org/licenses/agpl.txt\n *\n *\n * Ce fichier fait partie de l'application Sésathèque, créée par l'association Sésamath.\n *\n * Sésathèque est un logiciel libre ; vous pouvez le redistribuer ou le modifier suivant\n * les termes de la GNU Affero General Public License version 3 telle que publiée par la\n * Free Software Foundation.\n * Sésathèque est distribué dans l'espoir qu'il sera utile, mais SANS AUCUNE GARANTIE,\n * sans même la garantie tacite de QUALITÉ MARCHANDE ou d'ADÉQUATION à UN BUT PARTICULIER.\n * Consultez la GNU Affero General Public License pour plus de détails.\n * Vous devez avoir reçu une copie de la GNU General Public License en même temps que Sésathèque\n * (cf LICENCE.txt et http://vvlibri.org/fr/Analyse/gnu-affero-general-public-license-v3-analyse\n * pour une explication en français)\n */\n'use strict'\n\nvar log = require('../utils/log')\nvar hasProp = require('../index').hasProp\n\n/**\n * Ajoute une css dans le <head> de la page\n *\n * Déclaré par init (dès son chargement)\n * @param {string}  file Chemin du fichier css (mis dans href tel quel)\n */\nfunction addCss (file) {\n  var head = window.document.getElementsByTagName('head')[0]\n  var links = head.getElementsByTagName('link')\n  var dejala = false\n  for (var i = 0; i < links.length; i++) {\n    if (links[i].href === file) {\n      dejala = true\n      break\n    }\n  }\n\n  if (dejala) {\n    log(file + \" était déjà présent, on ne l'ajoute pas\")\n  } else {\n    var elt = window.document.createElement('link')\n    elt.rel = 'stylesheet'\n    elt.type = 'text/css'\n    elt.href = file\n    head.appendChild(elt)\n  }\n}\n\n/**\n * Ajoute un js à la fin du body et appelle la callback quand il est chargé\n * @param {string}  file Chemin du fichier jss (mis dans src tel quel)\n */\nfunction addJs (file, cb) {\n  function callCb () {\n    cb()\n    elt.removeEventListener('load', callCb)\n  }\n  /**\n   * @private\n   * @type {HTMLElement}\n   */\n  var body = window.document.getElementsByTagName('body')[0]\n  var elt = window.document.createElement('script')\n  elt.type = 'text/javascript'\n  // pour que ça marche mieux partout, il vaut mieux mettre le listener onload après avoir mis l'élément dans le dom\n  body.appendChild(elt)\n  elt.addEventListener('load', callCb)\n  // et ensuite indiquer le fichier à charger\n  elt.src = file\n}\n\n/**\n * Ajoute un élément html de type tag à parent\n * @param {HTMLElement} parent\n * @param {string} tag\n * @param {Object=} attrs Les attributs\n * @param {string=} content\n * @returns {HTMLElement} L'élément ajouté\n */\nfunction addElement (parent, tag, attrs, content) {\n  var elt = getElement(tag, attrs, content)\n  parent.appendChild(elt)\n\n  return elt\n}\n\n/**\n * Ajoute un élément html juste après element\n * @param {HTMLElement} element\n * @param {string} tag\n * @param {Object=} attrs Les attributs\n * @param {string=} content\n * @returns {HTMLElement} L'élément ajouté\n */\nfunction addElementAfter (element, tag, attrs, content) {\n  var newElt = getElement(tag, attrs, content)\n  var parent = element.parentNode\n  // pas de insertAfter, si nextSibling est null ça le mettra à la fin, cf https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore\n  if (parent) parent.insertBefore(newElt, element.nextSibling)\n  else log.error(new Error(\"Navigateur incompatible (pas de parentNode), impossible d'ajouter l'élément\"))\n\n  return newElt\n}\n\n/**\n * Ajoute un élément html juste avant element\n * @param {HTMLElement} element\n * @param {string} tag\n * @param {Object=} attrs Les attributs\n * @param {string=} content\n * @returns {HTMLElement} L'élément ajouté\n */\nfunction addElementBefore (element, tag, attrs, content) {\n  var newElt = getElement(tag, attrs, content)\n  var parent = element.parentNode\n  if (parent) parent.insertBefore(newElt, element)\n  else log.error(new Error(\"Navigateur incompatible (pas de parentNode), impossible d'insérer l'élément\"))\n\n  return newElt\n}\n\n/**\n * Ajoute un élément html comme premier enfant de parent\n * @param {HTMLElement} parent\n * @param {string} tag\n * @param {Object=} attrs Les attributs\n * @param {string=} content\n * @returns {HTMLElement} L'élément ajouté\n */\nfunction addElementFirstChild (parent, tag, attrs, content) {\n  var newElt = getElement(tag, attrs, content)\n  parent.insertBefore(newElt, parent.firstChild)\n\n  return newElt\n}\n\n/**\n * Ajoute un élément html comme frère aîné de elementRef\n * @param {HTMLElement} elementRef\n * @param {string} tag\n * @param {Object=} attrs Les attributs\n * @param {string=} content\n * @returns {HTMLElement} L'élément ajouté\n */\nfunction addElementFirstSibling (elementRef, tag, attrs, content) {\n  var newElt = getElement(tag, attrs, content)\n  elementRef.parentNode.insertBefore(newElt, elementRef.parentNode.firstChild)\n\n  return newElt\n}\n\n/**\n * Ajoute du texte dans un élément\n *\n * Déclaré par init (dès son chargement)\n * @param {HTMLElement} elt\n * @param {string} text\n */\nfunction addText (elt, text) {\n  elt.appendChild(window.document.createTextNode(text))\n}\n\n/**\n * Vide un élément html de tous ses enfants\n *\n * Déclaré par init (dès son chargement)\n * @param {HTMLElement} element\n */\nfunction empty (element) {\n  if (element && element.firstChild) {\n    while (element.firstChild) element.removeChild(element.firstChild)\n  }\n}\n\n/**\n * Retourne un élément html de type tag (non inséré dans le dom)\n *\n * Déclaré par init (dès son chargement)\n * @param {string} tag\n * @param {Object=} attrs Les attributs\n * @param {string=} txtContent\n */\nfunction getElement (tag, attrs, txtContent) {\n  var elt = window.document.createElement(tag)\n  var attr\n  try {\n    if (attrs) {\n      for (attr in attrs) {\n        if (hasProp(attrs, attr)) {\n          if (attr === 'class') elt.className = attrs.class\n          else if (attr === 'className') elt.className = attrs.className\n          else if (attr === 'style') setStyles(elt, attrs.style)\n          else elt.setAttribute(attr, attrs[attr])\n        }\n      }\n    }\n  } catch (error) {\n    log('plantage dans getElement ' + tag + ' avec les attributs ', attrs, error)\n  }\n\n  if (txtContent) addText(elt, txtContent)\n\n  return elt\n}\n\n/**\n * Retourne la taille de la fenêtre\n * @returns {{width: number, height: number}}\n */\nfunction getSize () {\n  // suivant que l'on est en mode standard ou quirk faut prendre l'un ou l'autre\n  var body = (window.document.compatMode === 'CSS1Compat') ? window.document.documentElement : window.document.body\n  // en cas de zoom, window.innerWidth est plus petit, et c'est la bonne valeur\n  return {\n    width: Math.floor(Math.min(body.clientWidth, window.innerWidth)),\n    height: Math.floor(Math.min(body.clientHeight, window.innerHeight))\n  }\n}\n\n/**\n * Retourne un id qui n'existe pas encore dans le dom (mais ne le créé pas)\n */\nvar getNewId = (function () {\n  // au dela de 10000 id dans un dom y'a un pb !\n  var max = 10000\n  // une closure pour conserver la valeur de cette variable privée entre 2 appels\n  var lastId = 0\n  var id = 'sesa' + lastId\n  return function getNewId () {\n    while (window.document.getElementById(id) && lastId < max) {\n      lastId++\n      id = 'sesa' + lastId\n    }\n    if (lastId === max) throw Error('Max de ' + max + ' id générés atteint')\n\n    return id\n  }\n})()\n\n/**\n * Affecte des styles à un élément html (on peut pas affecter elt.style directement car read only, faut faire du elt.style.foo = bar)\n * sans planter en cas de pb (on le signale juste en console)\n *\n * Déclaré par init (dès son chargement)\n * @param {HTMLElement} elt\n * @param {string|object} styles\n */\nfunction setStyles (elt, styles) {\n  try {\n    if (elt && elt.style) {\n      if (typeof styles === 'string') {\n        styles = styles.split(';')\n        styles.forEach(function (paire) {\n          paire = /([\\w]+):(.+)/.exec(paire)\n          if (paire && paire.length === 3) {\n            var key = paire[1]\n            elt.style[key] = paire[2]\n          }\n        })\n      } else if (typeof styles === 'object') {\n        for (var prop in styles) {\n          if (hasProp(styles, prop)) {\n            elt.style[prop] = styles[prop]\n          }\n        }\n      }\n    }\n  } catch (error) {\n    log.error(error)\n  }\n}\n\n/**\n * Fonctions génériques pour manipuler le dom\n * @service sesajstools/dom\n */\nmodule.exports = {\n  // faut rester en es5 :-/ (uglifyJs aime pas si on répète pas `prop: prop`)\n  addCss: addCss,\n  addJs: addJs,\n  addElement: addElement,\n  addElementAfter: addElementAfter,\n  addElementBefore: addElementBefore,\n  addElementFirstChild: addElementFirstChild,\n  addElementFirstSibling: addElementFirstSibling,\n  addText: addText,\n  empty: empty,\n  getElement: getElement,\n  getSize: getSize,\n  getNewId: getNewId,\n  setStyles: setStyles\n}\n","/**\n * This file is part of Sesatheque.\n *   Copyright 2014-2015, Association Sésamath\n *\n * Sesatheque is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License version 3\n * as published by the Free Software Foundation.\n *\n * Sesatheque is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Sesatheque (LICENCE.txt).\n * @see http://www.gnu.org/licenses/agpl.txt\n *\n *\n * Ce fichier fait partie de l'application Sésathèque, créée par l'association Sésamath.\n *\n * Sésathèque est un logiciel libre ; vous pouvez le redistribuer ou le modifier suivant\n * les termes de la GNU Affero General Public License version 3 telle que publiée par la\n * Free Software Foundation.\n * Sésathèque est distribué dans l'espoir qu'il sera utile, mais SANS AUCUNE GARANTIE,\n * sans même la garantie tacite de QUALITÉ MARCHANDE ou d'ADÉQUATION à UN BUT PARTICULIER.\n * Consultez la GNU Affero General Public License pour plus de détails.\n * Vous devez avoir reçu une copie de la GNU General Public License en même temps que Sésathèque\n * (cf LICENCE.txt et http://vvlibri.org/fr/Analyse/gnu-affero-general-public-license-v3-analyse\n * pour une explication en français)\n */\n'use strict'\n\n// ajoute du forEach sur les Array si le navigateur connait pas ça\nif (!Array.prototype.forEach) {\n  Array.prototype.forEach = function (fn) { // eslint-disable-line no-extend-native\n    for (var i = 0; i < this.length; i++) {\n      // on passe en argument (eltDuTableau, index, tableau)\n      fn(this[i], i, this)\n    }\n  }\n}\n\nvar specialHtmlChars = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#039;'\n}\n\n/**\n * Retourne le nb de slash dans la string\n * @param {sting} str\n * @return {number} le nombre de slashes dans str\n * @throws {TypeError} Si str n'était pas une string\n */\nfunction countSlash (str) {\n  if (typeof str !== 'string') throw new TypeError('countSlash n’accepte qu’une string en paramètre')\n  return str.replace(/[^/]+/g, '').length\n}\n\n/**\n * Échappe les caractères spéciaux en les remplaçant par leur équivalent html\n * Merci à jbo5112 https://stackoverflow.com/a/4835406\n * cf https://jsperf.com/escape-html-special-chars/11\n * @param {string} str\n * @param {boolean} [all] passer true pour remplacer les 5 caractères \"&<>' (sinon ça ne remplace que <), attention dans ce cas ce n'est plus invariant (il ne faut pas rappeler la fct sur une chaîne qui y serait déjà passée)\n * @return {void|string|*}\n */\nfunction escapeForHtml (str, all) {\n  if (!all) return str.replace(/</g, '&lt;')\n  return str.replace(/[&<>\"']/g, function (char) { return specialHtmlChars[char] })\n}\n\n/**\n * Formate une date, en retournant format avec les %x interprétés (si x est connu, laissé tel quel sinon).\n * Attention, pas la même syntaxe que an-format-date (©arNuméral).\n *\n * Formats gérés comme la commande unix date\n * - %% symbole %\n * - %F YYYY-mm-dd\n * - %T HH:MM:SS\n * - %d jour du mois (01 à 31)\n * - %m n° du mois (01 à 12)\n * - %Y année sur 4 chiffres\n * - %y année sur 2 chiffres\n * - %H heure (00 à 23)/\n * - %M minutes (00 à 59)\n * - %S secondes (00 à 59)\n * - %s timestamp (secondes depuis 01/01/1970/)\n * Formats ajoutés (o était la seule lettre dispo)\n * - %o millisecondes (000 à 999)\n * - %O heure avec ms (idem %T.%o ou %H:%M:%S.%o)\n * @param {string} format\n * @param {Date} [date] La date à formater (now si non fourni)\n * @return {string}\n */\nfunction formatDate (format, date) {\n  function pad0 (val, nb) {\n    return pad(val, '0', nb)\n  }\n  if (!date) date = new Date()\n  else if (!(date instanceof Date)) throw new TypeError('date is not a Date')\n  if (typeof format !== 'string') throw new TypeError('format is not a string')\n  return format.replace(/%(.)/g, function (capture, formatChar) {\n    switch (formatChar) {\n      case 'd': return pad0(date.getDate())\n      case 'F': return String(date.getFullYear()) + '-' + pad0(date.getMonth() + 1) + '-' + pad0(date.getDate()) // '%Y-%m-%d'\n      case 'H': return pad0(date.getHours())\n      case 'm': return pad0(date.getMonth() + 1)\n      case 'M': return pad0(date.getMinutes())\n      case 'o': return pad0(date.getMilliseconds(), 3)\n      case 'O': return pad0(date.getHours()) + ':' + pad0(date.getMinutes()) + ':' + pad0(date.getSeconds()) + '.' + pad0(date.getMilliseconds(), 3) // '%H:%M:%S.%o'\n      case 's': return pad0(Math.round(date.getTime() / 1000))\n      case 'S': return pad0(date.getSeconds())\n      case 'T': return pad0(date.getHours()) + ':' + pad0(date.getMinutes()) + ':' + pad0(date.getSeconds()) // '%H:%M:%S'\n      case 'y': return String(date.getFullYear()).substr(2)\n      case 'Y': return date.getFullYear()\n      case '%': return '%' // pour remplacer %% par %\n      // On change rien si on connait pas le format demandé\n      default: return '%' + formatChar\n    }\n  })\n}\n\n/**\n * Renvoie un token aléatoire de 22 caractères\n * Pas aussi random ni unique que l'usage de crypto ou d'un module uuid\n * mais suffisant dans pas mal de cas (utiliser an-uuid sinon)\n * @returns {string}\n */\nfunction getToken () {\n  return Math.random().toString(36).substr(2) + Math.random().toString(36).substr(2)\n}\n\n/**\n * Retourne true si object est un objet avec la propriété prop\n * @param object\n * @param prop\n * @return {boolean}\n */\nfunction hasProp (object, prop) {\n  if (typeof object === 'object') return Object.prototype.hasOwnProperty.call(object, prop)\n  return false\n}\n\n/**\n * @param {*} arg\n * @returns {boolean}\n */\nfunction isArray (arg) {\n  return Array.isArray(arg)\n}\n\n/**\n * true si value est un array vide (mais false s'il contient un élément false|undefined)\n * @param value\n * @returns {boolean}\n */\nfunction isArrayEmpty (value) {\n  return Boolean(Array.isArray(value) && value.length === 0)\n}\n\n/**\n * true si value est un array non vide (même s'il contient un seul élément false|undefined|null|'')\n * @param value\n * @returns {boolean}\n */\nfunction isArrayNotEmpty (value) {\n  return Boolean(Array.isArray(value) && value.length)\n}\n\n/**\n * @param arg\n * @returns {boolean}\n */\nfunction isDate (arg) {\n  return typeof arg === 'object' && Object.prototype.toString.call(arg) === '[object Date]'\n}\n\n/**\n * Thanks to bugsnag-js\n * @param {*} value\n * @return {boolean}\n */\nfunction isError (value) {\n  switch (Object.prototype.toString.call(value)) {\n    case '[object Error]':\n      return true\n    case '[object Exception]':\n      return true\n    case '[object DOMException]':\n      return true\n    default:\n      return value instanceof Error\n  }\n}\n\n/**\n * Retourne true si l'argument est une fonction\n * cf https://github.com/lodash/lodash/blob/4.11.2/lodash.js#L10826\n * cette implémentation plus simple sur typeof bug dans phandomJs 1.9 qui retourne function pour typeof NodeList\n * @param {*} arg\n * @returns {boolean}\n */\nfunction isFunction (arg) {\n  return (typeof arg === 'function')\n}\n\n/**\n * Indique si un array contient un élément\n * @param {Array} ar  Le tableau dans lequel chercher\n * @param {*}     elt L'élément à chercher (type natif, marche pas si c'est un objet littéral)\n * @returns {boolean}\n * @throws {Error} si on lui passe pas un Array en 1er argument\n */\nfunction isInArray (ar, elt) {\n  if (!Array.isArray(ar)) throw new Error('isInArray veut un tableau en 1er argument')\n  return ar.indexOf(elt) !== -1\n}\n\n/**\n * Retourne true si c'est un entier (utiliser Number.isInteger si c'est dispo)\n * @param arg\n * @param {boolean} [isStringAllowed=false] Passer true pour accepter les strings comme \"42\"\n * @returns {boolean}\n */\nfunction isInt (arg, isStringAllowed) {\n  switch (typeof arg) {\n    case 'number':\n      return Math.floor(arg) === arg\n    case 'string':\n      return Boolean(isStringAllowed && arg && Math.floor(arg) == arg) // eslint-disable-line eqeqeq\n    default:\n      return false\n  }\n}\n\n/**\n * Retourne true pour un entier (number) positif\n * @param arg\n * @param {boolean} [strict=false] passer true pour que 0 renvoie false\n * @param {boolean} [isStringAllowed=false] Passer true pour accepter les strings comme \"42\"\n * @returns {boolean}\n */\nfunction isIntPos (arg, strict, isStringAllowed) {\n  return isInt(arg, isStringAllowed) && (strict ? arg > 0 : arg >= 0)\n}\n\n/**\n * Retourne true sur un objet (donc aussi une fonction, mais pas null)\n * Piqué à lodash (https://github.com/lodash/lodash/blob/4.11.2/lodash.js#L10921)\n * @param {*} arg\n * @returns {boolean}\n */\nfunction isObject (arg) {\n  var type = typeof arg\n  return !!arg && (type === 'object' || type === 'function')\n}\n\n/**\n * Retourne true pour les objets qui n'ont pas d'autre constructeur qu'object (ni null, ni fonction ni regexp ni date ni array…)\n * @param {*} arg\n * @returns {boolean}\n */\nfunction isObjectPlain (arg) {\n  return !!arg && typeof arg === 'object' && Object.prototype.toString.call(arg) === '[object Object]'\n}\n\n/**\n * Retourne true pour les RegExp\n * @param arg\n * @returns {boolean}\n */\nfunction isRegExp (arg) {\n  return !!arg && typeof arg === 'object' && Object.prototype.toString.call(arg) === '[object RegExp]'\n}\n\n/**\n * Retourne true si l'argument est une string\n * @param {*} arg\n * @returns {boolean}\n */\nfunction isString (arg) {\n  return (typeof arg === 'string')\n}\n\n/**\n * @param arg\n * @returns {boolean}\n */\nfunction isUndefined (arg) {\n  return typeof arg === 'undefined'\n}\n\n/**\n * Retourne true si l'argument est une url absolue\n * @param {*} arg\n * @returns {boolean}\n */\nfunction isUrlAbsolute (arg) {\n  return (typeof arg === 'string' && /^https?:\\/\\/[a-z0-9\\-._]+(:[0-9]+)?(\\/|$)/.test(arg))\n}\n\n/**\n * Complete la valeur avec des caractères initiaux pour atteindre la longueur voulue\n * @param {number|string} value\n * @param {string} [char=0| ] Le caractère à ajouter au début (par défaut 0 si value est un nombre, espace sinon)\n * @param {number) [nb=2] Nb de caractères finaux voulus\n * @return {string} padded value\n */\nfunction pad (value, char, nb) {\n  // check char\n  if (char) {\n    if (typeof char !== 'string') char = String(char)\n    if (char.length !== 1) {\n      console.error(new Error('char invalide ' + char))\n      char = undefined\n    }\n  }\n  // init char\n  if (!char) {\n    char = typeof value === 'number' ? '0' : ' '\n  }\n  // cast value\n  if (typeof value !== 'string') value = String(value)\n  // default nb\n  if (!nb) nb = 2\n  // padding\n  while (value.length < nb) value = char + value\n  return value\n}\n\n/**\n * Idem JSON.parse mais renvoie undefined en cas de plantage\n * @param jsonString La string à parser\n * @return {Object}\n */\nfunction parse (jsonString) {\n  var obj\n  if (typeof jsonString === 'string') {\n    try {\n      obj = JSON.parse(jsonString)\n    } catch (e) {\n      if (!isUndefined(console) && console.error) console.error(e)\n    }\n  }\n  return obj\n}\n\n/**\n * split une chaine et fait un trim sur chaque élément\n * @param str\n * @param {string|RegExp} [delim=/[,;\\s]+/] Délimiteur, par défaut  virgule, point virgule ou n'importe quel espace (incluant tab, \\n & co)\n * @returns {*}\n */\nfunction splitAndTrim (str, delim) {\n  if (typeof str === 'string') {\n    if (!delim) delim = /[,;\\s]+/\n    // split + trim + filter au cas où il y aurait un délimiteur au début ou à la fin\n    // serait plus lisible en es6 mais on peut être utilisé par qqun sans babel…\n    return str.split(delim).map(function (elt) { return elt.trim() }).filter(function (elt) { return elt })\n  }\n  return []\n}\n\n/**\n * Idem JSON.stringify mais sans planter, en cas de ref circulaire sur une propriété on renvoie quand même les autres\n * (avec le message d'erreur de JSON.stringify sur la propriété à pb)\n * @param obj\n * @param {number} [indent]  Le nb d'espaces d'indentation\n * @returns {string}\n */\nfunction stringify (obj, indent) {\n  var buffer\n  try {\n    // ça peut planter en cas de ref circulaire\n    buffer = indent ? JSON.stringify(obj, null, indent) : JSON.stringify(obj)\n  } catch (error) {\n    // on a un objet avec ref circulaire\n    var key\n    var value\n    var pile = []\n    for (key in obj) {\n      // on veut le même comportement que JSON.stringify qui omet les valeurs undefined et les fct\n      // et met du {} pour regexp et function\n      if (hasProp(obj, key) && !isUndefined(obj[key]) && !isFunction(obj[key])) {\n        value = obj[key]\n        buffer = '\"' + key + '\":'\n        try {\n          buffer += indent ? JSON.stringify(value, null, indent) : JSON.stringify(value)\n        } catch (error) {\n          buffer += '\"' + error.toString() + '\"'\n        }\n        pile.push(buffer)\n      }\n    }\n    var sep = ','\n    buffer = '{'\n    if (indent) {\n      var sepSup = '\\n' + ' '.repeat(indent)\n      sep += sepSup\n      buffer += sepSup\n    }\n    buffer += pile.join(sep)\n    if (indent) buffer += '\\n'\n    buffer += '}'\n  }\n  return buffer\n}\n\n/**\n * Retire les accents d'une chaîne\n * @param {string} string\n * @return {string} la même désaccentuée\n */\nfunction toAscii (string) {\n  function reducer (acc, r) {\n    return acc.replace(r[0], r[1])\n  }\n  if (typeof string === 'string') {\n    // si c'est déjà sans accent on retourne\n    if (/^[\\w]*$/.test(string)) return string\n    // faut inspecter\n    var toReplace = [\n      [/[áàâäãå]/g, 'a'],\n      [/[ÁÀÂÄÃÅ]/g, 'A'],\n      ['ç', 'c'],\n      ['Ç', 'C'],\n      [/[éèêë]/g, 'e'],\n      [/[ÉÈÊË]/g, 'E'],\n      [/[íìîï]/g, 'i'],\n      [/[ÍÌÎÏ]/g, 'I'],\n      ['ñ', 'n'],\n      ['Ñ', 'N'],\n      [/[óòôöõ]/g, 'o'],\n      [/[ÓÒÔÖÕ]/g, 'O'],\n      [/[úùûü]/g, 'u'],\n      [/[ÚÙÛÜ]/g, 'U'],\n      [/[ýÿ]/g, 'y'],\n      [/[ÝŸ]/g, 'Y'],\n      ['æ', 'ae'],\n      ['Æ', 'AE'],\n      ['œ', 'oe'],\n      ['Œ', 'OE']\n    ]\n    return toReplace.reduce(reducer, string)\n  }\n  console.error(new TypeError('not a string'), string)\n  return ''\n}\n\n/**\n * Quasi alias de Math.round, cast en entier mais retourne NaN pour tout ce qui\n * ne ressemble pas à un nombre (chaine vide, boolean, null) là ou round retourne 0 (ou 1 pour true)\n * @param arg\n * @returns {number}\n */\nfunction toInt (arg) {\n  switch (typeof arg) {\n    case 'number':\n      return Math.round(arg)\n    case 'string':\n      if (arg === '') return NaN\n      else return Math.round(arg)\n    default:\n      return NaN\n  }\n}\n\n/**\n * Notre module pour toutes nos fonctions génériques\n * (cf aussi les extensions sesajstools/http/xhr, sesajstools/dom, etc.)\n * @module sesajstools\n */\nmodule.exports = {\n  countSlash: countSlash,\n  escapeForHtml: escapeForHtml,\n  formatDate: formatDate,\n  getToken: getToken,\n  hasProp: hasProp,\n  isArray: isArray,\n  isArrayEmpty: isArrayEmpty,\n  isArrayNotEmpty: isArrayNotEmpty,\n  isDate: isDate,\n  isError: isError,\n  isFunction: isFunction,\n  isInArray: isInArray,\n  isInt: isInt,\n  isIntPos: isIntPos,\n  isObject: isObject,\n  isObjectPlain: isObjectPlain,\n  isRegExp: isRegExp,\n  isString: isString,\n  isUndefined: isUndefined,\n  isUrlAbsolute: isUrlAbsolute,\n  pad: pad,\n  parse: parse,\n  splitAndTrim: splitAndTrim,\n  stringify: stringify,\n  toAscii: toAscii,\n  toInt: toInt\n}\n","/**\n * This file is part of SesaJsTools.\n *   Copyright 2014-2015, Association Sésamath\n *\n * SesaJsTools is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License version 3\n * as published by the Free Software Foundation.\n *\n * SesaJsTools is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with SesaJsTools (LICENCE.txt).\n * @see http://www.gnu.org/licenses/agpl.txt\n *\n *\n * Ce fichier fait partie de l'application Sésathèque, créée par l'association Sésamath.\n *\n * Sésathèque est un logiciel libre ; vous pouvez le redistribuer ou le modifier suivant\n * les termes de la GNU Affero General Public License version 3 telle que publiée par la\n * Free Software Foundation.\n * Sésathèque est distribué dans l'espoir qu'il sera utile, mais SANS AUCUNE GARANTIE,\n * sans même la garantie tacite de QUALITÉ MARCHANDE ou d'ADÉQUATION à UN BUT PARTICULIER.\n * Consultez la GNU Affero General Public License pour plus de détails.\n * Vous devez avoir reçu une copie de la GNU General Public License en même temps que Sésathèque\n * (cf LICENCE.txt et http://vvlibri.org/fr/Analyse/gnu-affero-general-public-license-v3-analyse\n * pour une explication en français)\n */\n\n'use strict'\n\nvar tools = require('../index')\nvar hasProp = tools.hasProp\n\n/**\n * dump un objet de manière plus complète qu'un stringify\n * @param obj\n * @param indent\n * @returns {*}\n */\nmodule.exports = function dump (obj, indent) {\n  // on traite déjà null\n  if (obj === null) return 'null'\n  // puis les types natifs basiques\n  var type = typeof obj\n  switch (type) {\n    case 'undefined':\n      return obj\n    case 'number':\n    case 'boolean':\n      return String(obj)\n    case 'string':\n      return '\"' + obj.replace('\"', '\\\\\"') + '\"'\n    case 'symbol':\n      return '[Symbol ' + obj.toString() + ']'\n\n    default:\n      if (!indent) indent = 0\n      // decalage de base\n      var prefix = (' ').repeat(indent)\n      indent += 2\n      var innerPrefix = prefix + '  '\n      var pile = []\n      var buffer\n      // object et symbol\n      // on regarde d'abord si on a une méthode toSource toute prête qui existe sur cet objet\n      // (sauf pour les date qui posent pb sous node)\n      if (tools.isDate(obj)) {\n        return JSON.stringify(obj)\n      } else if (tools.isArray(obj)) {\n        buffer = '[\\n'\n        obj.forEach(function (elt, index) {\n          buffer += innerPrefix + dump(elt, indent) + (index === obj.length - 1 ? '\\n' : ',\\n')\n        })\n        if (obj.length) buffer += prefix + ']'\n        else buffer += ']'\n        return buffer\n      } else if (tools.isRegExp(obj) || tools.isFunction(obj)) {\n        // dans un navigateur toSource existe pour eux, mais pas dans node\n        return (typeof obj.toSource === 'function') ? obj.toSource() : obj.toString()\n      } else if (tools.isObject(obj)) {\n        var nbp = 0\n        for (var p in obj) {\n          if (hasProp(obj, p)) {\n            nbp++\n            // pour détecter les refs circulaires, on regarde si JSON.stringify plante,\n            // pas génial mais évite de lancer une récursion infinie, à pas si cher (et dump est vraiment rarement utilisé en prod)\n            try {\n              JSON.stringify(obj[p])\n              pile.push(p + ': ' + dump(obj[p], indent))\n            } catch (error) {\n              pile.push(p + ': \"' + error.toString().replace('\"', '\\\\\"') + '\"')\n            }\n          }\n        }\n        if (nbp) return '{\\n' + innerPrefix + pile.join(',\\n' + innerPrefix) + '\\n' + prefix + '}'\n        else if (tools.isObjectPlain(obj)) return prefix + '{}'\n        else return prefix + obj.toString()\n      } else {\n        console.error('dump est tombé sur un truc qui ne ressemble à rien de connu', obj)\n        return tools.stringify(obj, 2)\n      }\n  }\n}\n","/**\n * This file is part of Sesatheque.\n *   Copyright 2014-2015, Association Sésamath\n *\n * Sesatheque is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License version 3\n * as published by the Free Software Foundation.\n *\n * Sesatheque is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Sesatheque (LICENCE.txt).\n * @see http://www.gnu.org/licenses/agpl.txt\n *\n *\n * Ce fichier fait partie de l'application Sésathèque, créée par l'association Sésamath.\n *\n * Sésathèque est un logiciel libre ; vous pouvez le redistribuer ou le modifier suivant\n * les termes de la GNU Affero General Public License version 3 telle que publiée par la\n * Free Software Foundation.\n * Sésathèque est distribué dans l'espoir qu'il sera utile, mais SANS AUCUNE GARANTIE\n * sans même la garantie tacite de QUALITÉ MARCHANDE ou d'ADÉQUATION à UN BUT PARTICULIER.\n * Consultez la GNU Affero General Public License pour plus de détails.\n * Vous devez avoir reçu une copie de la GNU General Public License en même temps que Sésathèque\n * (cf LICENCE.txt et http://vvlibri.org/fr/Analyse/gnu-affero-general-public-license-v3-analyse\n * pour une explication en français)\n */\n'use strict'\n\nvar dump = require('./dump')\nvar tools = require('../index')\nvar formatDate = tools.formatDate\nvar hasProp = tools.hasProp\n\n// attention, on duplique plus bas pour l'export\nvar levels = {\n  debug: 0,\n  info: 1,\n  notice: 1,\n  warn: 2,\n  warning: 2,\n  error: 3,\n  alert: 4,\n  critical: 4\n}\nvar prefixes = [\n  '[debug]',\n  '[info]',\n  '[warning]',\n  '[error]',\n  '[CRITICAL]'\n]\nvar loggers = [\n  console.info || console.log, // 0 => debug\n  console.log, // 1 => info|notice\n  console.warn || console.error || console.log, // 2 => warning\n  console.error || console.log, // 3 => error\n  console.error || console.log // 4 => critical|alert\n]\n\n// valeurs par défaut\n/**\n * Niveau minimum requis pour affichage (un niveau 2 affiche warning, error et critical)\n * @private\n * @type {number}\n */\nvar logLevel = levels.info\n// on peut tourner sous node comme dans un navigateur\nvar isNode = typeof process !== 'undefined' && process.env\nvar isCluster = isNode && hasProp(process.env, 'NODE_APP_INSTANCE')\n/**\n * Flag pour savoir s'il faut ajouter la date en préfixe (false par défaut dans un navigateur et true ailleurs)\n * @private\n * @type {boolean}\n */\nvar hasDatePrefix = isNode && !isCluster // en mode cluster c'est pm2 qui met le préfixe de date\nvar datePrefix = '[%O]'\n\n// idem pour le process\nvar hasProcessPrefix = isCluster\n// NODE_APP_INSTANCE est une string, donc '0' ne sera pas falsy\nvar processPrefix = (isCluster && process.env.NODE_APP_INSTANCE) || 'N/A'\n\n/**\n * Écrit en console en ajoutant les préfixes\n * @param {Array} args arguments d'une autre fct (pseudo Array)\n * @param {number} level\n * @private\n */\nfunction _log (args, level) {\n  try {\n    var logger = loggers[level] || console.log\n    var prefix = ''\n    // date en 1er\n    if (hasDatePrefix) prefix = formatDate(datePrefix)\n    // puis processId\n    if (hasProcessPrefix) {\n      if (prefix) prefix += ' '\n      prefix += '[' + processPrefix + ']'\n    }\n    // puis logLevel\n    if (prefix) prefix += ' '\n    prefix += prefixes[level]\n    // avec le 1er argument sur la même ligne, mais on râle si y’en a pas (pour avoir la trace et retrouver l'appelant)\n    if (args.length < 1) args = [Error('fonction de log appelée sans contenu')]\n    logger(prefix, args[0])\n    // puis les autres sans préfixe\n    if (args.length > 1) for (var i = 1; i < args.length; i++) logger(args[i])\n  } catch (e) {\n    // rien, fallait un environnement décent avec console...\n  }\n}\n\n/**\n * Un console.log qui plante pas sur les anciens IE (ou d'autres navigateurs qui n'auraient pas de console.log)\n * @param {...*} arguments Nombre variable d'arguments, chacun sera passé à console.log ou console.error si c'est une erreur\n * @service sesajstools/utils/log\n */\nfunction log () {\n  if (logLevel < levels.warning) {\n    _log(arguments, levels.info)\n  }\n}\n// les logger des ≠ niveaux\nlog.debug = function debug () {\n  if (logLevel < levels.info) {\n    _log(arguments, levels.debug)\n  }\n}\nlog.info = function info () {\n  if (logLevel < levels.warning) {\n    _log(arguments, levels.info)\n  }\n}\nlog.warn = function warn () {\n  if (logLevel < levels.error) {\n    _log(arguments, levels.warning)\n  }\n}\nlog.ifError = function error () {\n  if (error && logLevel < levels.critical) {\n    _log(arguments, levels.error)\n  }\n}\nlog.error = function error () {\n  if (logLevel < levels.critical) {\n    _log(arguments, levels.error)\n  }\n}\nlog.critical = function critical () {\n  _log(arguments, levels.critical)\n}\n\n/**\n * Passe logLevel au niveau error (désactive donc seulement les infos et warnings…)\n * Pour comptatibilité ascendante, à remplacer par log.setLevel(log.levels.error)\n * @deprecated\n */\nlog.disable = function disable () {\n  logLevel = levels.error\n}\n/**\n * Supprime le préfixe de date\n */\nlog.disableDatePrefix = function disableDatePrefix () {\n  hasDatePrefix = false\n}\n/**\n * Supprime le préfixe de process\n */\nlog.disableProcessPrefix = function disableProcessPrefix () {\n  hasProcessPrefix = false\n}\n/**\n * Dump un objet en console si le niveau de log est <= à celui indiqué\n * @param {string} message affiché avant le dump\n * @param {*} objToDump peut être n'importe quoi\n * @param {object} [options]\n * @param {string|number} [options.max=1000] le nb max de caractères affichés du dump\n * @param {string|number} [options.level=debug] le niveau d'affichage souhaité\n */\nlog.dump = function (message, objToDump, options) {\n  if (typeof options !== 'object') options = {}\n  var level = options.level || levels.debug\n  if (typeof level === 'string') level = levels[level] || levels.debug\n  var dumped = dump(objToDump)\n  var max = options.max || 1000\n  if (dumped.length > max) dumped = dumped.substr(0, max) + '…'\n  if (logLevel <= level) _log([message, dumped], level)\n}\n/**\n * Passe logLevel au niveau info (qui le rend plus bavard)\n * Pour comptatibilité ascendante, à remplacer par log.setLevel(log.levels.info)\n * @deprecated\n */\nlog.enable = function enable () {\n  logLevel = levels.info\n}\n/**\n * Active le préfixe de date\n */\nlog.enableDatePrefix = function enableDatePrefix () {\n  hasDatePrefix = true\n}\n/**\n * Active le préfixe de process\n */\nlog.enableProcessPrefix = function enableProcessPrefix () {\n  if (typeof process === 'undefined') console.error('process not available')\n  else hasProcessPrefix = true\n}\n/**\n * Modifie le préfixe de date (cf formats gérés par formatDate)\n * @param prefix\n */\nlog.setDatePrefix = function setDatePrefix (prefix) {\n  if (typeof prefix === 'string') datePrefix = prefix\n  else log.error(new Error('Le préfixe de log doit être une string'))\n}\n/**\n * Modifie le niveau de log\n * @param {number|string} level\n */\nlog.setLogLevel = function setLogLevel (level) {\n  switch (level) {\n    case 0:\n    case '0':\n    case 'debug':\n      logLevel = levels.debug\n      break\n    case 1:\n    case '1':\n    case 'info':\n    case 'notice':\n      logLevel = levels.notice\n      break\n    case 2:\n    case '2':\n    case 'warn':\n    case 'warning':\n      logLevel = levels.warning\n      break\n    case 3:\n    case '3':\n    case 'err':\n    case 'error':\n      logLevel = levels.error\n      break\n    case 4:\n    case '4':\n    case 'alert':\n    case 'crit':\n    case 'critical':\n      logLevel = levels.critical\n      break\n    default:\n      log.error('niveau d’erreur ' + level)\n  }\n}\n// et on ajoute les levels, mais sans ref pour empêcher de modifier nos constantes locale de l'extérieur\nlog.levels = {\n  debug: 0,\n  info: 1,\n  notice: 1,\n  warn: 2,\n  warning: 2,\n  error: 3,\n  alert: 4,\n  critical: 4\n}\n// ce serait plus élégant de cloner (quoi que, en es5 ça reste moche) mais ça empêche l'autocompletion\n\nmodule.exports = log\n"],"sourceRoot":""}