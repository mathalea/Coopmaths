<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>mathalea.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Arete3d.html">Arete3d</a></li><li><a href="Cube3d.html">Cube3d</a></li><li><a href="Droite3d.html">Droite3d</a></li><li><a href="Fraction.html">Fraction</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Fraction.html#ajouteEntier">ajouteEntier</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#differenceFraction">differenceFraction</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#diviseEntier">diviseEntier</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#entierDivise">entierDivise</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#entierDiviseIrred">entierDiviseIrred</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#entierMoinsFraction">entierMoinsFraction</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#fractionDecimale">fractionDecimale</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#fractionEgale">fractionEgale</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#inverse">inverse</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#inverseIrrred">inverseIrrred</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#multiplieEntier">multiplieEntier</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#multiplieEntierIrred">multiplieEntierIrred</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#oppose">oppose</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#opposeIrred">opposeIrred</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#produitFraction">produitFraction</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#produitFractions">produitFractions</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#puissanceFraction">puissanceFraction</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#representation">representation</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#representationIrred">representationIrred</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#sommeFraction">sommeFraction</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#sommeFractions">sommeFractions</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#superieurstrict">superieurstrict</a></li><li data-type='method' style='display: none;'><a href="Fraction.html#texProduitFraction">texProduitFraction</a></li></ul></li><li><a href="ListeFraction.html">ListeFraction</a></li><li><a href="ListeFractionbis.html">ListeFractionbis</a></li><li><a href="NoteLaCouleur.html">NoteLaCouleur</a><ul class='methods'><li data-type='method' style='display: none;'><a href="NoteLaCouleur.html#testBoucle">testBoucle</a></li><li data-type='method' style='display: none;'><a href="NoteLaCouleur.html#testInstruction">testInstruction</a></li><li data-type='method' style='display: none;'><a href="NoteLaCouleur.html#testSequence">testSequence</a></li></ul></li><li><a href="Pave3d.html">Pave3d</a></li><li><a href="Personne.html">Personne</a></li><li><a href="Point3d.html">Point3d</a></li><li><a href="Polygone3d.html">Polygone3d</a></li><li><a href="Prisme3d.html">Prisme3d</a></li><li><a href="Relatif.html">Relatif</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Relatif.html#~getCardNegatifs">getCardNegatifs</a></li><li data-type='method' style='display: none;'><a href="Relatif.html#~getSigneNumber">getSigneNumber</a></li><li data-type='method' style='display: none;'><a href="Relatif.html#~getSigneProduitNumber">getSigneProduitNumber</a></li><li data-type='method' style='display: none;'><a href="Relatif.html#~getSigneProduitString">getSigneProduitString</a></li><li data-type='method' style='display: none;'><a href="Relatif.html#~getSigneString">getSigneString</a></li><li data-type='method' style='display: none;'><a href="Relatif.html#~orthographeFacteursNegatifs">orthographeFacteursNegatifs</a></li><li data-type='method' style='display: none;'><a href="Relatif.html#~setRegleSigneProduit">setRegleSigneProduit</a></li><li data-type='method' style='display: none;'><a href="Relatif.html#~setRegleSigneQuotient">setRegleSigneQuotient</a></li></ul></li><li><a href="Syracuse.html">Syracuse</a></li><li><a href="Triangles.html">Triangles</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Triangles.html#~getAngles">getAngles</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~getAnglesValeurs">getAnglesValeurs</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~getCotes">getCotes</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~getLongueurs">getLongueurs</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~getLongueursValeurs">getLongueursValeurs</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~getNom">getNom</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~getPerimetre">getPerimetre</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~getSommets">getSommets</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~isPlatTriangleAngles">isPlatTriangleAngles</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~isPlatTriangleLongueurs">isPlatTriangleLongueurs</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~isTrueTriangleAngles">isTrueTriangleAngles</a></li><li data-type='method' style='display: none;'><a href="Triangles.html#~isTrueTriangleLongueurs">isTrueTriangleLongueurs</a></li></ul></li><li><a href="Vecteur3d.html">Vecteur3d</a></li></ul><h3>Modules</h3><ul><li><a href="module-modules_dom.html">modules/dom</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-modules_dom.html#.addElement">addElement</a></li><li data-type='method' style='display: none;'><a href="module-modules_dom.html#.addText">addText</a></li><li data-type='method' style='display: none;'><a href="module-modules_dom.html#.create">create</a></li><li data-type='method' style='display: none;'><a href="module-modules_dom.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="module-modules_dom.html#~hasProp">hasProp</a></li><li data-type='method' style='display: none;'><a href="module-modules_dom.html#~setStyles">setStyles</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#abs">abs</a></li><li><a href="global.html#acos">acos</a></li><li><a href="global.html#addFeedback">addFeedback</a></li><li><a href="global.html#AfficheCoteSegment">AfficheCoteSegment</a></li><li><a href="global.html#AfficheLongueurSegment">AfficheLongueurSegment</a></li><li><a href="global.html#AfficheMesureAngle">AfficheMesureAngle</a></li><li><a href="global.html#AfficherCrayon">AfficherCrayon</a></li><li><a href="global.html#afficherTempo">afficherTempo</a></li><li><a href="global.html#afficherTempoId">afficherTempoId</a></li><li><a href="global.html#afficherUnParUn">afficherUnParUn</a></li><li><a href="global.html#affiniteOrtho">affiniteOrtho</a></li><li><a href="global.html#aireTriangle">aireTriangle</a></li><li><a href="global.html#ajouterAx">ajouterAx</a></li><li><a href="global.html#ajouterAy">ajouterAy</a></li><li><a href="global.html#allerA">allerA</a></li><li><a href="global.html#angle">angle</a></li><li><a href="global.html#angleCodage">angleCodage</a></li><li><a href="global.html#angleCodageMasquer">angleCodageMasquer</a></li><li><a href="global.html#angleCodageMontrer">angleCodageMontrer</a></li><li><a href="global.html#angleModulo">angleModulo</a></li><li><a href="global.html#angleOriente">angleOriente</a></li><li><a href="global.html#angleradian">angleradian</a></li><li><a href="global.html#angleScratchTo2d">angleScratchTo2d</a></li><li><a href="global.html#appartientSegment">appartientSegment</a></li><li><a href="global.html#apps">apps</a></li><li><a href="global.html#Arc">Arc</a></li><li><a href="global.html#ArcMainLevee">ArcMainLevee</a></li><li><a href="global.html#ArcPointPointAngle">ArcPointPointAngle</a></li><li><a href="global.html#arrondi">arrondi</a></li><li><a href="global.html#arrondiVirgule">arrondiVirgule</a></li><li><a href="global.html#asin">asin</a></li><li><a href="global.html#atan">atan</a></li><li><a href="global.html#attendre">attendre</a></li><li><a href="global.html#autoCorrection">autoCorrection</a></li><li><a href="global.html#avance">avance</a></li><li><a href="global.html#Axes">Axes</a></li><li><a href="global.html#baisseCrayon">baisseCrayon</a></li><li><a href="global.html#barycentre">barycentre</a></li><li><a href="global.html#bissectrice">bissectrice</a></li><li><a href="global.html#bissectriceAuCompas">bissectriceAuCompas</a></li><li><a href="global.html#cacherParDiv">cacherParDiv</a></li><li><a href="global.html#calcul">calcul</a></li><li><a href="global.html#calculAligne">calculAligne</a></li><li><a href="global.html#carre">carre</a></li><li><a href="global.html#carre1point1longueur">carre1point1longueur</a></li><li><a href="global.html#carreIndirect">carreIndirect</a></li><li><a href="global.html#centreCercleCirconscrit">centreCercleCirconscrit</a></li><li><a href="global.html#centreGraviteTriangle">centreGraviteTriangle</a></li><li><a href="global.html#Cercle">Cercle</a></li><li><a href="global.html#cercle3d">cercle3d</a></li><li><a href="global.html#CercleCentrePoint">CercleCentrePoint</a></li><li><a href="global.html#cercleCirconscrit">cercleCirconscrit</a></li><li><a href="global.html#CercleMainLevee">CercleMainLevee</a></li><li><a href="global.html#changementDeBaseOrthoTri">changementDeBaseOrthoTri</a></li><li><a href="global.html#changementDeBaseTriOrtho">changementDeBaseTriOrtho</a></li><li><a href="global.html#chercheMinMaxFonction">chercheMinMaxFonction</a></li><li><a href="global.html#cherchePolynomeDegre3aExtremaFixes">cherchePolynomeDegre3aExtremaFixes</a></li><li><a href="global.html#choice">choice</a></li><li><a href="global.html#choisitLettresDifferentes">choisitLettresDifferentes</a></li><li><a href="global.html#choisitNombresEntreMetN">choisitNombresEntreMetN</a></li><li><a href="global.html#CibleCarree">CibleCarree</a></li><li><a href="global.html#CibleCouronne">CibleCouronne</a></li><li><a href="global.html#CibleRonde">CibleRonde</a></li><li><a href="global.html#clone">clone</a></li><li><a href="global.html#CodageAngleDroit">CodageAngleDroit</a></li><li><a href="global.html#codageAngleDroit">codageAngleDroit</a></li><li><a href="global.html#codageAngleDroitMasquer">codageAngleDroitMasquer</a></li><li><a href="global.html#CodageBissectrice">CodageBissectrice</a></li><li><a href="global.html#CodageMediatrice">CodageMediatrice</a></li><li><a href="global.html#CodageMilieu">CodageMilieu</a></li><li><a href="global.html#CodeAngle">CodeAngle</a></li><li><a href="global.html#CodeSegment">CodeSegment</a></li><li><a href="global.html#CodeSegments">CodeSegments</a></li><li><a href="global.html#codeTikz">codeTikz</a></li><li><a href="global.html#compareFractions">compareFractions</a></li><li><a href="global.html#compareNombres">compareNombres</a></li><li><a href="global.html#compasCercleCentrePoint">compasCercleCentrePoint</a></li><li><a href="global.html#compasCoucher">compasCoucher</a></li><li><a href="global.html#compasDeplacer">compasDeplacer</a></li><li><a href="global.html#compasEcarter">compasEcarter</a></li><li><a href="global.html#compasEcarter2Points">compasEcarter2Points</a></li><li><a href="global.html#compasEcarterAvecRegle">compasEcarterAvecRegle</a></li><li><a href="global.html#compasLever">compasLever</a></li><li><a href="global.html#compasMasquer">compasMasquer</a></li><li><a href="global.html#compasMontrer">compasMontrer</a></li><li><a href="global.html#compasRetourner">compasRetourner</a></li><li><a href="global.html#compasRotation">compasRotation</a></li><li><a href="global.html#compasTracerArc2Angles">compasTracerArc2Angles</a></li><li><a href="global.html#compasTracerArcCentrePoint">compasTracerArcCentrePoint</a></li><li><a href="global.html#compasZoom">compasZoom</a></li><li><a href="global.html#compteOccurences">compteOccurences</a></li><li><a href="global.html#Cone3d">Cone3d</a></li><li><a href="global.html#ConstructionBissectrice">ConstructionBissectrice</a></li><li><a href="global.html#ConstructionMediatrice">ConstructionMediatrice</a></li><li><a href="global.html#cos">cos</a></li><li><a href="global.html#cosineInterpolate">cosineInterpolate</a></li><li><a href="global.html#couleurAleatoire">couleurAleatoire</a></li><li><a href="global.html#Courbe">Courbe</a></li><li><a href="global.html#Courbe2">Courbe2</a></li><li><a href="global.html#courbeInterpolee">courbeInterpolee</a></li><li><a href="global.html#crayonDeplacer">crayonDeplacer</a></li><li><a href="global.html#crayonMasquer">crayonMasquer</a></li><li><a href="global.html#crayonMontrer">crayonMontrer</a></li><li><a href="global.html#crayonRotation">crayonRotation</a></li><li><a href="global.html#creeIdPourComparaison">creeIdPourComparaison</a></li><li><a href="global.html#creerBoutonMathalea2d">creerBoutonMathalea2d</a></li><li><a href="global.html#creerCouples">creerCouples</a></li><li><a href="global.html#creerDocumentAmc">creerDocumentAmc</a></li><li><a href="global.html#creerLutin">creerLutin</a></li><li><a href="global.html#creerModal">creerModal</a></li><li><a href="global.html#creerNomDePolygone">creerNomDePolygone</a></li><li><a href="global.html#cribleEratostheneN">cribleEratostheneN</a></li><li><a href="global.html#criblePolynomeEntier">criblePolynomeEntier</a></li><li><a href="global.html#Cylindre3d">Cylindre3d</a></li><li><a href="global.html#dansLaCibleCarree">dansLaCibleCarree</a></li><li><a href="global.html#dansLaCibleRonde">dansLaCibleRonde</a></li><li><a href="global.html#decomposition_facteurs_premiers">decomposition_facteurs_premiers</a></li><li><a href="global.html#decompositionFacteursPremiersArray">decompositionFacteursPremiersArray</a></li><li><a href="global.html#degres">degres</a></li><li><a href="global.html#demicercle3d">demicercle3d</a></li><li><a href="global.html#demiDroite">demiDroite</a></li><li><a href="global.html#demiDroiteAvecExtremite">demiDroiteAvecExtremite</a></li><li><a href="global.html#demiTourPoint">demiTourPoint</a></li><li><a href="global.html#demiTourPolygone">demiTourPolygone</a></li><li><a href="global.html#denominateurs_amis">denominateurs_amis</a></li><li><a href="global.html#deplaceLabel">deplaceLabel</a></li><li><a href="global.html#deplacer">deplacer</a></li><li><a href="global.html#detectSafariChromeBrowser">detectSafariChromeBrowser</a></li><li><a href="global.html#deuxColonnes">deuxColonnes</a></li><li><a href="global.html#distancePointDroite">distancePointDroite</a></li><li><a href="global.html#Droite">Droite</a></li><li><a href="global.html#DroiteGraduee">DroiteGraduee</a></li><li><a href="global.html#DroiteGraduee2">DroiteGraduee2</a></li><li><a href="global.html#droiteHorizontaleParPoint">droiteHorizontaleParPoint</a></li><li><a href="global.html#DroiteMainLevee">DroiteMainLevee</a></li><li><a href="global.html#droiteParPointEtParallele">droiteParPointEtParallele</a></li><li><a href="global.html#droiteParPointEtPente">droiteParPointEtPente</a></li><li><a href="global.html#droiteParPointEtPerpendiculaire">droiteParPointEtPerpendiculaire</a></li><li><a href="global.html#droiteParPointEtVecteur">droiteParPointEtVecteur</a></li><li><a href="global.html#droiteVerticaleParPoint">droiteVerticaleParPoint</a></li><li><a href="global.html#eclatePuissance">eclatePuissance</a></li><li><a href="global.html#ecritureAlgebrique">ecritureAlgebrique</a></li><li><a href="global.html#ecritureAlgebriquec">ecritureAlgebriquec</a></li><li><a href="global.html#ecritureAlgebriqueSauf1">ecritureAlgebriqueSauf1</a></li><li><a href="global.html#ecritureNombreRelatif">ecritureNombreRelatif</a></li><li><a href="global.html#ecritureNombreRelatifc">ecritureNombreRelatifc</a></li><li><a href="global.html#ecritureParentheseSiMoins">ecritureParentheseSiMoins</a></li><li><a href="global.html#ecritureParentheseSiNegatif">ecritureParentheseSiNegatif</a></li><li><a href="global.html#elimineDoublons">elimineDoublons</a></li><li><a href="global.html#Ellipse">Ellipse</a></li><li><a href="global.html#enleveElement">enleveElement</a></li><li><a href="global.html#enleveElementBis">enleveElementBis</a></li><li><a href="global.html#enleveElementNo">enleveElementNo</a></li><li><a href="global.html#enleveElementNoBis">enleveElementNoBis</a></li><li><a href="global.html#enumerate">enumerate</a></li><li><a href="global.html#enumerateSansPuceSansNumero">enumerateSansPuceSansNumero</a></li><li><a href="global.html#epsilon">epsilon</a></li><li><a href="global.html#equerreDeplacer">equerreDeplacer</a></li><li><a href="global.html#equerreMasquer">equerreMasquer</a></li><li><a href="global.html#equerreMontrer">equerreMontrer</a></li><li><a href="global.html#equerreRotation">equerreRotation</a></li><li><a href="global.html#equerreZoom">equerreZoom</a></li><li><a href="global.html#exerciceQcm">exerciceQcm</a></li><li><a href="global.html#exportQcmAmc">exportQcmAmc</a></li><li><a href="global.html#exposant">exposant</a></li><li><a href="global.html#extraireRacineCarree">extraireRacineCarree</a></li><li><a href="global.html#factorisation">factorisation</a></li><li><a href="global.html#Fond_ecran">Fond_ecran</a></li><li><a href="global.html#fraction">fraction</a></li><li><a href="global.html#FractionParPosition">FractionParPosition</a></li><li><a href="global.html#fractionSimplifiee">fractionSimplifiee</a></li><li><a href="global.html#gestionModules">gestionModules</a></li><li><a href="global.html#graphiqueInterpole">graphiqueInterpole</a></li><li><a href="global.html#Grille">Grille</a></li><li><a href="global.html#grille">grille</a></li><li><a href="global.html#GrilleHorizontale">GrilleHorizontale</a></li><li><a href="global.html#grilleHorizontale">grilleHorizontale</a></li><li><a href="global.html#grilleVerticale">grilleVerticale</a></li><li><a href="global.html#hauteur">hauteur</a></li><li><a href="global.html#hauteurTriangle">hauteurTriangle</a></li><li><a href="global.html#homothetie">homothetie</a></li><li><a href="global.html#HomothetieAnimee">HomothetieAnimee</a></li><li><a href="global.html#homothetiePoint">homothetiePoint</a></li><li><a href="global.html#homothetiePolygone">homothetiePolygone</a></li><li><a href="global.html#href">href</a></li><li><a href="global.html#html">html</a></li><li><a href="global.html#htmlBouton">htmlBouton</a></li><li><a href="global.html#htmlConsigne">htmlConsigne</a></li><li><a href="global.html#htmlEnumerate">htmlEnumerate</a></li><li><a href="global.html#htmlLigne">htmlLigne</a></li><li><a href="global.html#htmlParagraphe">htmlParagraphe</a></li><li><a href="global.html#image">image</a></li><li><a href="global.html#imagePointParTransformation">imagePointParTransformation</a></li><li><a href="global.html#infoMessage">infoMessage</a></li><li><a href="global.html#introLatex">introLatex</a></li><li><a href="global.html#introLatexCoop">introLatexCoop</a></li><li><a href="global.html#item_to_contenu">item_to_contenu</a></li><li><a href="global.html#itemize">itemize</a></li><li><a href="global.html#jour">jour</a></li><li><a href="global.html#jours_par_mois">jours_par_mois</a></li><li><a href="global.html#katexPopup">katexPopup</a></li><li><a href="global.html#katexPopup2">katexPopup2</a></li><li><a href="global.html#LabelPoint">LabelPoint</a></li><li><a href="global.html#labelX">labelX</a></li><li><a href="global.html#LabelY">LabelY</a></li><li><a href="global.html#labelY">labelY</a></li><li><a href="global.html#Labyrinthe">Labyrinthe</a></li><li><a href="global.html#lampeMessage">lampeMessage</a></li><li><a href="global.html#Latex_reperage_sur_un_axe">Latex_reperage_sur_un_axe</a></li><li><a href="global.html#Latex_repere">Latex_repere</a></li><li><a href="global.html#Latex_Tracer_droite">Latex_Tracer_droite</a></li><li><a href="global.html#latexParPoint">latexParPoint</a></li><li><a href="global.html#lettre_minuscule_depuis_chiffre">lettre_minuscule_depuis_chiffre</a></li><li><a href="global.html#lettreDepuisChiffre">lettreDepuisChiffre</a></li><li><a href="global.html#leveCrayon">leveCrayon</a></li><li><a href="global.html#liste_de_notes">liste_de_notes</a></li><li><a href="global.html#liste_des_diviseurs">liste_des_diviseurs</a></li><li><a href="global.html#listeDiviseurs">listeDiviseurs</a></li><li><a href="global.html#listeNombresPremiersStrictJusqua">listeNombresPremiersStrictJusqua</a></li><li><a href="global.html#listeQuestionsToContenuSansNumero">listeQuestionsToContenuSansNumero</a></li><li><a href="global.html#listeQuestionsToContenuSansNumeroEtSansConsigne">listeQuestionsToContenuSansNumeroEtSansConsigne</a></li><li><a href="global.html#loadGiac">loadGiac</a></li><li><a href="global.html#loadIep">loadIep</a></li><li><a href="global.html#loadMG32">loadMG32</a></li><li><a href="global.html#loadPrism">loadPrism</a></li><li><a href="global.html#loadScratchblocks">loadScratchblocks</a></li><li><a href="global.html#longueur">longueur</a></li><li><a href="global.html#machineMathsVideo">machineMathsVideo</a></li><li><a href="global.html#masquer">masquer</a></li><li><a href="global.html#mathalea2d">mathalea2d</a></li><li><a href="global.html#MatriceCarree">MatriceCarree</a></li><li><a href="global.html#matriceCarree">matriceCarree</a></li><li><a href="global.html#mediane">mediane</a></li><li><a href="global.html#medianeTriangle">medianeTriangle</a></li><li><a href="global.html#mediatrice">mediatrice</a></li><li><a href="global.html#mediatriceAuCompas">mediatriceAuCompas</a></li><li><a href="global.html#mediatriceRegleEquerre">mediatriceRegleEquerre</a></li><li><a href="global.html#messageFeedback">messageFeedback</a></li><li><a href="global.html#messageUtilisateur">messageUtilisateur</a></li><li><a href="global.html#mettrexA">mettrexA</a></li><li><a href="global.html#mettreyA">mettreyA</a></li><li><a href="global.html#mg32DisplayAll">mg32DisplayAll</a></li><li><a href="global.html#milieu">milieu</a></li><li><a href="global.html#minToHoraire">minToHoraire</a></li><li><a href="global.html#minToHour">minToHour</a></li><li><a href="global.html#mise_a_jour_de_la_liste_des_exercices">mise_a_jour_de_la_liste_des_exercices</a></li><li><a href="global.html#miseAJourDeLaListeDesExercices">miseAJourDeLaListeDesExercices</a></li><li><a href="global.html#miseEnEvidence">miseEnEvidence</a></li><li><a href="global.html#modal_url">modal_url</a></li><li><a href="global.html#modalImage">modalImage</a></li><li><a href="global.html#modalPdf">modalPdf</a></li><li><a href="global.html#modalTexteCourt">modalTexteCourt</a></li><li><a href="global.html#modalTexteLong">modalTexteLong</a></li><li><a href="global.html#modalVideo">modalVideo</a></li><li><a href="global.html#modalYoutube">modalYoutube</a></li><li><a href="global.html#montrer">montrer</a></li><li><a href="global.html#montrerParDiv">montrerParDiv</a></li><li><a href="global.html#my_svg_font">my_svg_font</a></li><li><a href="global.html#nom_du_jour">nom_du_jour</a></li><li><a href="global.html#nom_du_mois">nom_du_mois</a></li><li><a href="global.html#nombre_avec_espace">nombre_avec_espace</a></li><li><a href="global.html#nombreDeChiffresDansLaPartieDecimale">nombreDeChiffresDansLaPartieDecimale</a></li><li><a href="global.html#nombreDecimal">nombreDecimal</a></li><li><a href="global.html#NommePolygone">NommePolygone</a></li><li><a href="global.html#nomsPossibles">nomsPossibles</a></li><li><a href="global.html#NomVecteurParPosition">NomVecteurParPosition</a></li><li><a href="global.html#norme">norme</a></li><li><a href="global.html#numAlpha">numAlpha</a></li><li><a href="global.html#numTrie">numTrie</a></li><li><a href="global.html#objet">objet</a></li><li><a href="global.html#objetF">objetF</a></li><li><a href="global.html#objetM">objetM</a></li><li><a href="global.html#obtenir_liste_fractions_irreductibles">obtenir_liste_fractions_irreductibles</a></li><li><a href="global.html#obtenirListeFacteursPremiers">obtenirListeFacteursPremiers</a></li><li><a href="global.html#obtenirListeFractionsIrreductiblesFaciles">obtenirListeFractionsIrreductiblesFaciles</a></li><li><a href="global.html#obtenirListeNombresPremiers">obtenirListeNombresPremiers</a></li><li><a href="global.html#onError">onError</a></li><li><a href="global.html#ordreDeGrandeur">ordreDeGrandeur</a></li><li><a href="global.html#orienter">orienter</a></li><li><a href="global.html#orthoCentre">orthoCentre</a></li><li><a href="global.html#paralleleRegleEquerre2points3epoint">paralleleRegleEquerre2points3epoint</a></li><li><a href="global.html#parallelogramme2points1hauteur">parallelogramme2points1hauteur</a></li><li><a href="global.html#parallelogramme2sommetsConsecutifsCentre">parallelogramme2sommetsConsecutifsCentre</a></li><li><a href="global.html#parallelogramme3points">parallelogramme3points</a></li><li><a href="global.html#parallelogramme3sommetsConsecutifs">parallelogramme3sommetsConsecutifs</a></li><li><a href="global.html#parallelogrammeAngleCentre">parallelogrammeAngleCentre</a></li><li><a href="global.html#partieEntiereEnLettres">partieEntiereEnLettres</a></li><li><a href="global.html#pause">pause</a></li><li><a href="global.html#Pavage">Pavage</a></li><li><a href="global.html#Pave">Pave</a></li><li><a href="global.html#perpendiculaireRegleEquerre2points3epoint">perpendiculaireRegleEquerre2points3epoint</a></li><li><a href="global.html#personne">personne</a></li><li><a href="global.html#personnes">personnes</a></li><li><a href="global.html#pgcd">pgcd</a></li><li><a href="global.html#Point">Point</a></li><li><a href="global.html#pointAdistance">pointAdistance</a></li><li><a href="global.html#pointCreer">pointCreer</a></li><li><a href="global.html#pointDansRepere">pointDansRepere</a></li><li><a href="global.html#pointDeplacer">pointDeplacer</a></li><li><a href="global.html#pointIntersectionCC">pointIntersectionCC</a></li><li><a href="global.html#pointIntersectionDD">pointIntersectionDD</a></li><li><a href="global.html#pointIntersectionLC">pointIntersectionLC</a></li><li><a href="global.html#pointMasquer">pointMasquer</a></li><li><a href="global.html#pointMontrer">pointMontrer</a></li><li><a href="global.html#pointNommer">pointNommer</a></li><li><a href="global.html#pointsCreer">pointsCreer</a></li><li><a href="global.html#pointSurCercle">pointSurCercle</a></li><li><a href="global.html#pointSurDroite">pointSurDroite</a></li><li><a href="global.html#pointSurSegment">pointSurSegment</a></li><li><a href="global.html#Polygone">Polygone</a></li><li><a href="global.html#polygoneAvecNom">polygoneAvecNom</a></li><li><a href="global.html#PolygoneMainLevee">PolygoneMainLevee</a></li><li><a href="global.html#polygoneRapide">polygoneRapide</a></li><li><a href="global.html#polygoneRegulier">polygoneRegulier</a></li><li><a href="global.html#polygoneRegulierIndirect">polygoneRegulierIndirect</a></li><li><a href="global.html#polygoneRegulierParCentreEtRayon">polygoneRegulierParCentreEtRayon</a></li><li><a href="global.html#polygoneTracer">polygoneTracer</a></li><li><a href="global.html#Polyline">Polyline</a></li><li><a href="global.html#possedeUnCaractereInterdit">possedeUnCaractereInterdit</a></li><li><a href="global.html#ppcm">ppcm</a></li><li><a href="global.html#premiereLettreEnMajuscule">premiereLettreEnMajuscule</a></li><li><a href="global.html#premierMultipleSuperieur">premierMultipleSuperieur</a></li><li><a href="global.html#premiersEntreBornes">premiersEntreBornes</a></li><li><a href="global.html#prenom">prenom</a></li><li><a href="global.html#prenomF">prenomF</a></li><li><a href="global.html#prenomM">prenomM</a></li><li><a href="global.html#prenomPronom">prenomPronom</a></li><li><a href="global.html#printlatex">printlatex</a></li><li><a href="global.html#produitDeDeuxFractions">produitDeDeuxFractions</a></li><li><a href="global.html#produitMatriceMatrice3x3">produitMatriceMatrice3x3</a></li><li><a href="global.html#produitMatriceVecteur3x3">produitMatriceVecteur3x3</a></li><li><a href="global.html#produitsEnCroix">produitsEnCroix</a></li><li><a href="global.html#projectionOrtho">projectionOrtho</a></li><li><a href="global.html#propositionsQcm">propositionsQcm</a></li><li><a href="global.html#puissance">puissance</a></li><li><a href="global.html#puissanceEnProduit">puissanceEnProduit</a></li><li><a href="global.html#qcmDisponible">qcmDisponible</a></li><li><a href="global.html#quatriemeProportionnelle">quatriemeProportionnelle</a></li><li><a href="global.html#question_achat">question_achat</a></li><li><a href="global.html#questionNumerique">questionNumerique</a></li><li><a href="global.html#randint">randint</a></li><li><a href="global.html#range">range</a></li><li><a href="global.html#range1">range1</a></li><li><a href="global.html#rangeMinMax">rangeMinMax</a></li><li><a href="global.html#rapporteurCrayonMarqueAngle">rapporteurCrayonMarqueAngle</a></li><li><a href="global.html#rapporteurDeplacer">rapporteurDeplacer</a></li><li><a href="global.html#rapporteurDeplacerRotation2Points">rapporteurDeplacerRotation2Points</a></li><li><a href="global.html#rapporteurMasquer">rapporteurMasquer</a></li><li><a href="global.html#rapporteurMasquerGraduationsExterieures">rapporteurMasquerGraduationsExterieures</a></li><li><a href="global.html#rapporteurMasquerGraduationsInterieures">rapporteurMasquerGraduationsInterieures</a></li><li><a href="global.html#rapporteurMontrer">rapporteurMontrer</a></li><li><a href="global.html#rapporteurMontrerGraduationsExterieures">rapporteurMontrerGraduationsExterieures</a></li><li><a href="global.html#rapporteurMontrerGraduationsInterieures">rapporteurMontrerGraduationsInterieures</a></li><li><a href="global.html#rapporteurRotation">rapporteurRotation</a></li><li><a href="global.html#rapporteurTracerDemiDroiteAngle">rapporteurTracerDemiDroiteAngle</a></li><li><a href="global.html#rapporteurZoom">rapporteurZoom</a></li><li><a href="global.html#reduireAxPlusB">reduireAxPlusB</a></li><li><a href="global.html#reduirePolynomeDegre3">reduirePolynomeDegre3</a></li><li><a href="global.html#regleDemiDroiteOriginePoint">regleDemiDroiteOriginePoint</a></li><li><a href="global.html#regleDeplacer">regleDeplacer</a></li><li><a href="global.html#regleDroite">regleDroite</a></li><li><a href="global.html#regleMasquer">regleMasquer</a></li><li><a href="global.html#regleMasquerGraduations">regleMasquerGraduations</a></li><li><a href="global.html#regleModifierLongueur">regleModifierLongueur</a></li><li><a href="global.html#regleMontrer">regleMontrer</a></li><li><a href="global.html#regleMontrerGraduations">regleMontrerGraduations</a></li><li><a href="global.html#regleProlongerSegment">regleProlongerSegment</a></li><li><a href="global.html#regleRotation">regleRotation</a></li><li><a href="global.html#regleSegment">regleSegment</a></li><li><a href="global.html#regleZoom">regleZoom</a></li><li><a href="global.html#renommePolygone">renommePolygone</a></li><li><a href="global.html#reorganiseProduitPuissance">reorganiseProduitPuissance</a></li><li><a href="global.html#requerreDeplacer">requerreDeplacer</a></li><li><a href="global.html#requerreGlisserEquerre">requerreGlisserEquerre</a></li><li><a href="global.html#requerreMasquer">requerreMasquer</a></li><li><a href="global.html#requerreMontrer">requerreMontrer</a></li><li><a href="global.html#requerreRotation">requerreRotation</a></li><li><a href="global.html#requerreZoom">requerreZoom</a></li><li><a href="global.html#resolutionSystemeLineaire2x2">resolutionSystemeLineaire2x2</a></li><li><a href="global.html#resolutionSystemeLineaire3x3">resolutionSystemeLineaire3x3</a></li><li><a href="global.html#rienSi1">rienSi1</a></li><li><a href="global.html#rotation">rotation</a></li><li><a href="global.html#rotation3d">rotation3d</a></li><li><a href="global.html#RotationAnimee">RotationAnimee</a></li><li><a href="global.html#rotationPoint">rotationPoint</a></li><li><a href="global.html#rotationPolygone">rotationPolygone</a></li><li><a href="global.html#rotationV3d">rotationV3d</a></li><li><a href="global.html#scratchblock">scratchblock</a></li><li><a href="global.html#scratchTraductionFr">scratchTraductionFr</a></li><li><a href="global.html#script">script</a></li><li><a href="global.html#Segment">Segment</a></li><li><a href="global.html#segmentAvecExtremites">segmentAvecExtremites</a></li><li><a href="global.html#segmentCodage">segmentCodage</a></li><li><a href="global.html#segmentCodageMasquer">segmentCodageMasquer</a></li><li><a href="global.html#segmentCodageMontrer">segmentCodageMontrer</a></li><li><a href="global.html#SegmentMainLevee">SegmentMainLevee</a></li><li><a href="global.html#SensDeRotation">SensDeRotation</a></li><li><a href="global.html#setReponse">setReponse</a></li><li><a href="global.html#seyes">seyes</a></li><li><a href="global.html#signe">signe</a></li><li><a href="global.html#similitude">similitude</a></li><li><a href="global.html#simpExp">simpExp</a></li><li><a href="global.html#simplificationDeFractionAvecEtapes">simplificationDeFractionAvecEtapes</a></li><li><a href="global.html#simpNotPuissance">simpNotPuissance</a></li><li><a href="global.html#sin">sin</a></li><li><a href="global.html#sommeDesChiffres">sommeDesChiffres</a></li><li><a href="global.html#sommeDesTermesParSigne">sommeDesTermesParSigne</a></li><li><a href="global.html#sp">sp</a></li><li><a href="global.html#Sphere3d">Sphere3d</a></li><li><a href="global.html#stringNombre">stringNombre</a></li><li><a href="global.html#strRandom">strRandom</a></li><li><a href="global.html#SVG_Axe_horizontal">SVG_Axe_horizontal</a></li><li><a href="global.html#SVG_Axe_vertical">SVG_Axe_vertical</a></li><li><a href="global.html#SVG_chemin">SVG_chemin</a></li><li><a href="global.html#SVG_engrenages">SVG_engrenages</a></li><li><a href="global.html#SVG_fleche_machine_maths">SVG_fleche_machine_maths</a></li><li><a href="global.html#SVG_fraction">SVG_fraction</a></li><li><a href="global.html#SVG_graduation">SVG_graduation</a></li><li><a href="global.html#SVG_grille">SVG_grille</a></li><li><a href="global.html#SVG_label">SVG_label</a></li><li><a href="global.html#SVG_machine_diag_3F1_act_mono">SVG_machine_diag_3F1_act_mono</a></li><li><a href="global.html#SVG_machine_diag_3F12">SVG_machine_diag_3F12</a></li><li><a href="global.html#SVG_machine_maths">SVG_machine_maths</a></li><li><a href="global.html#SVG_reperage_sur_un_axe">SVG_reperage_sur_un_axe</a></li><li><a href="global.html#SVG_repere">SVG_repere</a></li><li><a href="global.html#SVG_Tracer_droite">SVG_Tracer_droite</a></li><li><a href="global.html#SVG_tracer_droite_flecheH">SVG_tracer_droite_flecheH</a></li><li><a href="global.html#SVG_tracer_droite_flecheV">SVG_tracer_droite_flecheV</a></li><li><a href="global.html#SVG_tracer_flecheH">SVG_tracer_flecheH</a></li><li><a href="global.html#SVG_tracer_flecheV">SVG_tracer_flecheV</a></li><li><a href="global.html#SVG_tracer_point">SVG_tracer_point</a></li><li><a href="global.html#SymetrieAnimee">SymetrieAnimee</a></li><li><a href="global.html#symetrieAxiale">symetrieAxiale</a></li><li><a href="global.html#symetrieAxialePoint">symetrieAxialePoint</a></li><li><a href="global.html#symetrieAxialePolygone">symetrieAxialePolygone</a></li><li><a href="global.html#Tableau_de_variation">Tableau_de_variation</a></li><li><a href="global.html#tableauColonneLigne">tableauColonneLigne</a></li><li><a href="global.html#tan">tan</a></li><li><a href="global.html#tex_graphique">tex_graphique</a></li><li><a href="global.html#tex_prix">tex_prix</a></li><li><a href="global.html#tex_texte">tex_texte</a></li><li><a href="global.html#texCadreParOrange">texCadreParOrange</a></li><li><a href="global.html#texConsigne">texConsigne</a></li><li><a href="global.html#texEnumerate">texEnumerate</a></li><li><a href="global.html#texEnumerateSansNumero">texEnumerateSansNumero</a></li><li><a href="global.html#texFraction">texFraction</a></li><li><a href="global.html#texFraction_parentheses">texFraction_parentheses</a></li><li><a href="global.html#texFractionReduite">texFractionReduite</a></li><li><a href="global.html#texFractionSigne">texFractionSigne</a></li><li><a href="global.html#texIntroduction">texIntroduction</a></li><li><a href="global.html#texMulticols">texMulticols</a></li><li><a href="global.html#texNombre">texNombre</a></li><li><a href="global.html#texNombre2">texNombre2</a></li><li><a href="global.html#texNombrec">texNombrec</a></li><li><a href="global.html#texNombreCoul">texNombreCoul</a></li><li><a href="global.html#texParagraphe">texParagraphe</a></li><li><a href="global.html#texRacineCarree">texRacineCarree</a></li><li><a href="global.html#textarea_to_array">textarea_to_array</a></li><li><a href="global.html#texteDeplacer">texteDeplacer</a></li><li><a href="global.html#texteEnCouleur">texteEnCouleur</a></li><li><a href="global.html#texteEnCouleurEtGras">texteEnCouleurEtGras</a></li><li><a href="global.html#texteGras">texteGras</a></li><li><a href="global.html#texteMasquer">texteMasquer</a></li><li><a href="global.html#texteOuPas">texteOuPas</a></li><li><a href="global.html#TexteParPoint">TexteParPoint</a></li><li><a href="global.html#texteParPosition">texteParPosition</a></li><li><a href="global.html#textePoint">textePoint</a></li><li><a href="global.html#textePosition">textePosition</a></li><li><a href="global.html#TexteSurSegment">TexteSurSegment</a></li><li><a href="global.html#tikzMachineDiag">tikzMachineDiag</a></li><li><a href="global.html#tikzMachineMaths">tikzMachineMaths</a></li><li><a href="global.html#tirer_les_des">tirer_les_des</a></li><li><a href="global.html#tournerD">tournerD</a></li><li><a href="global.html#tournerG">tournerG</a></li><li><a href="global.html#TraceBarre">TraceBarre</a></li><li><a href="global.html#TraceBarreHorizontale">TraceBarreHorizontale</a></li><li><a href="global.html#traceCompas">traceCompas</a></li><li><a href="global.html#TraceGraphiqueCartesien">TraceGraphiqueCartesien</a></li><li><a href="global.html#TracePoint">TracePoint</a></li><li><a href="global.html#TracePointSurDroite">TracePointSurDroite</a></li><li><a href="global.html#tracer">tracer</a></li><li><a href="global.html#trait">trait</a></li><li><a href="global.html#traitMasquer">traitMasquer</a></li><li><a href="global.html#traitRapide">traitRapide</a></li><li><a href="global.html#translation">translation</a></li><li><a href="global.html#translation2Points">translation2Points</a></li><li><a href="global.html#translation3d">translation3d</a></li><li><a href="global.html#TranslationAnimee">TranslationAnimee</a></li><li><a href="global.html#translationPoint">translationPoint</a></li><li><a href="global.html#translationPolygone">translationPolygone</a></li><li><a href="global.html#triangle1longueur2angles">triangle1longueur2angles</a></li><li><a href="global.html#triangle2longueurs1angle">triangle2longueurs1angle</a></li><li><a href="global.html#triangle2points1angle1longueur">triangle2points1angle1longueur</a></li><li><a href="global.html#triangle2points1angle1longueurOppose">triangle2points1angle1longueurOppose</a></li><li><a href="global.html#triangle2points1hauteur">triangle2points1hauteur</a></li><li><a href="global.html#triangle2points2angles">triangle2points2angles</a></li><li><a href="global.html#triangle2points2longueurs">triangle2points2longueurs</a></li><li><a href="global.html#triangle3longueurs">triangle3longueurs</a></li><li><a href="global.html#triangleEquilateral">triangleEquilateral</a></li><li><a href="global.html#triangleEquilateral2Sommets">triangleEquilateral2Sommets</a></li><li><a href="global.html#triangleRectangle2Cotes">triangleRectangle2Cotes</a></li><li><a href="global.html#triangleRectangleCoteHypotenuse">triangleRectangleCoteHypotenuse</a></li><li><a href="global.html#triePositifsNegatifs">triePositifsNegatifs</a></li><li><a href="global.html#troncature">troncature</a></li><li><a href="global.html#TrouverSolutionMathador">TrouverSolutionMathador</a></li><li><a href="global.html#txt_to_objet_parametres_exercice">txt_to_objet_parametres_exercice</a></li><li><a href="global.html#unMoisDeTemperature">unMoisDeTemperature</a></li><li><a href="global.html#unSiPositifMoinsUnSinon">unSiPositifMoinsUnSinon</a></li><li><a href="global.html#updateMessageErreur">updateMessageErreur</a></li><li><a href="global.html#valeurBase">valeurBase</a></li><li><a href="global.html#Vecteur">Vecteur</a></li><li><a href="global.html#waitFor">waitFor</a></li><li><a href="global.html#waitForGiac">waitForGiac</a></li><li><a href="global.html#warnMessage">warnMessage</a></li><li><a href="global.html#xcas">xcas</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">mathalea.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* global $ fetch event Event */
import { strRandom, telechargeFichier, introLatex, introLatexCoop, scratchTraductionFr, modalYoutube } from './modules/outils.js'
import { getUrlVars, getFilterFromUrl } from './modules/getUrlVars.js'
import { menuDesExercicesDisponibles, dictionnaireDesExercices, apparenceExerciceActif, supprimerExo } from './modules/menuDesExercicesDisponibles.js'
import { loadIep, loadPrism, loadGiac } from './modules/loaders'
import { waitFor } from './modules/outilsDom'
import { mg32DisplayAll } from './modules/mathgraph'
import { messageUtilisateur } from './modules/messages.js'
import { exerciceInteractif } from './modules/gestionInteractif.js'
import Clipboard from 'clipboard'
import QRCode from 'qrcode'
import seedrandom from 'seedrandom'

// @todo importer katex à la demande
// import katex from 'katex'
import renderMathInElement from 'katex/dist/contrib/auto-render.js'
import 'katex/dist/katex.min.css'

import '../css/style_mathalea.css'
import { context, setOutputDiaporama, setOutputLatex } from './modules/context.js'

// "3" isNumeric (pour gérer le sup venant de l'URL)
function isNumeric(n) {
  return !isNaN(parseFloat(n)) &amp;&amp; isFinite(n);
}

// Pour le menu du haut
document.addEventListener('DOMContentLoaded', (event) => {
  $('.ui.dropdown').dropdown()
})

if (document.location.href.indexOf('mathalealatex.html') > 0) {
  setOutputLatex()
}
if (document.location.href.indexOf('cm.html') > 0) {
  setOutputDiaporama()
}

let listeObjetsExercice = [] // Liste des objets listeObjetsExercices
let listeDesExercices = [] // Liste des identifiants des exercices
let codeLatex = ''
let listePackages = new Set()
// création des figures MG32 (géométrie dynamique)
window.listeScriptsIep = {} // Dictionnaire de tous les scripts xml IEP
window.listeAnimationsIepACharger = [] // Liste des id des scripts qui doivent être chargés une fois le code HTML mis à jour
menuDesExercicesDisponibles()

// gestion des filtres :
//  au chargement de la page on vérifie s'il y a un filtre dans l'url si c'est le cas on selectionne le filtre dans la page html.
//  gestion d'evenement sur le "select" filtre. Au changement on place la valeur dans l'url et on relance le calcul des exercices à afficher.
if (document.getElementById('filtre')) {
  const filtre = getFilterFromUrl()
  if (filtre) {
    document.getElementById('filtre').value = filtre
  }
  document.getElementById('filtre').addEventListener('change', function () { // gestion du changement du select.
    const regex = new RegExp('([?;&amp;])filtre[^&amp;;]*[;&amp;]?')
    const query = window.location.search.replace(regex, '$1').replace(/&amp;$/, '')
    const filtre = document.getElementById('filtre').value
    const url = (query.length > 2 ? query + '&amp;' : '?') + (filtre !== 'tous' ? 'filtre=' + filtre : '')
    let modeTableauActif = false // Gestion pour le mode tableau particulière pour gérer l'activation de "datatable"
    window.history.pushState('', '', url)
    if ($('#mode_choix_liste').is(':visible')) {
      $('#mode_choix_liste').trigger('click')
      modeTableauActif = true
    }
    menuDesExercicesDisponibles() // Calcul de la liste des exercices à afficher.
    if (modeTableauActif) {
      $('#mode_choix_tableau').trigger('click')
    }
    $('.ui.dropdown').dropdown() // Pour le menu des exercices, mise à jour des "accordion"
    $('.ui.accordion').accordion('refresh')
    $('.ui.checkbox').checkbox()
  })
}

// fonctions de gestion de la liste des exercices cg 04-2021 ****
// fonctions : copierVersExerciceForm ; selectionnerCode ; ajoutHandlersEtiquetteExo ; gestionSpanChoixExercice ; copierExercicesFormVersAffichage

function copierVersExerciceForm () {
  // envoie des informations depuis les étiquettes vers le formulaire et déclenchement de l'evt change.
  // utilisé lorsque l'utilisateur valide/supprime ou déplace une étiquette exercices.
  let i, texteCode
  const listeTag = $('.choix_exercices.valide')
  const listeTagLength = listeTag.length
  texteCode = ''
  for (i = 0; i &lt; listeTagLength; i++) {
    if (i === 0) {
      texteCode += listeTag[i].textContent
    } else {
      texteCode += ',' + listeTag[i].textContent
    }
  }
  document.getElementById('choix_des_exercices').value = texteCode
  const evenement = new Event('change')
  document.getElementById('choix_des_exercices').dispatchEvent(evenement)
}

function selectionnerCode (elem) {
  // Fonction permettant de sélectionner tout le texte de l'étiquette lors du click sur cette dernière.
  const range = document.createRange()
  range.selectNodeContents(elem)
  const sel = window.getSelection()
  sel.removeAllRanges()
  sel.addRange(range)
}

// Gestionnaire d'evenement sur les étiquettes d'exercice.
function ajoutHandlersEtiquetteExo () {
  $('.choix_exercices').off('input').on('input', function (e) { // On détecte le changement de la valeur de l'étiquette.
    gestionSpanChoixExercice(event.target)
  })
  $('.choix_exercices').off('keyup').on('keyup', function (e) {
    if (e.which === 9 || e.which === 13) { // validation de l'étiquette sur tab ou entrée.
      copierVersExerciceForm()
      $('.choix_exercices:last').focus()
    }
    if ((e.which === 8 || e.which === 46) &amp;&amp; (e.target.innerText === '' || e.target.innerText === '\n')) { // suppression de l'étiquette.
      copierVersExerciceForm()
      $('.choix_exercices:last').focus()
    }
  })
  $('#choix_exercices_div').sortable({ cancel: 'i', placeholder: 'sortableplaceholder', update: function () { copierVersExerciceForm() } })
  $('.choix_exercices').off('mousedown').on('mousedown', function () {
  // nécessaire car le sortable ne permet plus la sélection des contenteditable une fois activé
    this.focus()
    selectionnerCode(this)
  })
}

function gestionSpanChoixExercice (elem) {
  // quand on donne le code d'un exercice existant, le style change et on créé un autre span à suivre.
  const listeCodesExercices = Object.keys(dictionnaireDesExercices)
  if (listeCodesExercices.indexOf($(event.target).text()) >= 0 &amp;&amp; !$(event.target).hasClass('valide')) {
    $(event.target).addClass('valide')
    if ($('.choix_exercices:last').hasClass('valide')) { // si le dernier élément n'est pas valide on n'en créé pas un nouveau.
      $(event.target.parentElement.parentElement).append('&lt;div class="choix_exo sortable">&lt;span contenteditable="true" class="choix_exercices">&lt;br/>&lt;/span>&lt;/div>')
    }
    ajoutHandlersEtiquetteExo() // On ajoute la gestion des evenements sur l'étiquette créée.
    // sur la perte de focus, si le span est valide alors on met à jour la liste des exercices (maj du champ texte + event change)
  } else if (listeCodesExercices.indexOf($(event.target).text()) &lt; 0 &amp;&amp; $(event.target).hasClass('valide')) {
    // si on change le contenteditable et que l'exercice n'est plus un code valide
    $(event.target).removeClass('valide')
  }
}

// pour ne pas déclencher la gestion des evenemet sur les pages qui n'ont pas la div choix d'exercice.
if (document.getElementById('choix_exercices_div')) {
  ajoutHandlersEtiquetteExo()
}

function copierExercicesFormVersAffichage (exliste) {
// fonction déclenchée à chaque mise à jour du formulaire (ajout, suppression, déplacement d'un exercice via les icones)
// pour mettre à jour l'affichage des étiquettes.
// (on créé les étiquettes à partir du formulaire)
  let tagexercices, i
  const listeLength = exliste.length
  tagexercices = ''
  const divExercice = document.getElementById('choix_exercices_div')
  if (listeLength > 0 &amp;&amp; divExercice) {
    for (i = 0; i &lt; listeLength; i++) { // création d'une étiquette pour chaque exercice trouvé dans le formulaire.
      tagexercices += `&lt;div class="choix_exo sortable">&lt;span contenteditable="true" class="choix_exercices valide">${exliste[i]}&lt;/span>&lt;/div>`
    }
  }
  tagexercices += '&lt;div class="choix_exo sortable">&lt;span contenteditable="true" class="choix_exercices">&lt;br>&lt;/span>&lt;/div>' // ajout du &lt;br> pour alignement dans firefox
  if (divExercice) {
    divExercice.innerHTML = tagexercices
    ajoutHandlersEtiquetteExo()
  }
}

// Mise à jour du formulaire (gestion de l'evenement "change" du formulaire de la liste des exercices activé lors :
//  * du chargement
//  * de l'ajout d'un exercice (click sur le lien)
//  * du déplacement, suppression d'un exercice (manipulation des étiquettes et ou utilisation des icones.
// A la fin appel de la fonction miseAJourDeLaListeDesExercices() => pour l'affichage des exercices choisis.
const formChoixDesExercices = document.getElementById('choix_des_exercices')
formChoixDesExercices.addEventListener('change', function (e) {
  // Changement du texte
  if (e.target.value === '') {
    listeDesExercices = []
    listeObjetsExercice = []
  } else {
    listeDesExercices = []
    listeObjetsExercice = []
    listeDesExercices = e.target.value.replace(/\s/g, '').replace(';', ',').split(',') // Récupère  la saisie de l'utilisateur
    // en supprimant les espaces et en remplaçant les points-virgules par des virgules.
  }
  if (document.getElementById('affichageErreur')) {
    document.getElementById('affichageErreur').remove()
  }
  copierExercicesFormVersAffichage(listeDesExercices)
  miseAJourDeLaListeDesExercices()
})

if (document.getElementById('choix_exercices_div')) { // On cache le formulaire pour les feuilles qui ont les étiquettes.
  $('#choix_des_exercices').parent().hide()
}

//* ************

/**
 * Gère le chargement des différents modules, appelé après "création" des exercices, pour gérer leur affichage
 * ATTENTION, fct async, elle retourne une promesse de chargement, faut attendre que la promesse
 * soit résolue avant d'utiliser ce qui est chargé (et gérer l'éventuel pb de chargement)
 * @param isdiaporama
 * @param listeObjetsExercice
 * @return {Promise}
 */
async function gestionModules (isdiaporama, listeObjetsExercice) { // besoin katex, mg32, iep, scratch
  // appelée dès lors que l'on affiche le code html des exercices : depuis "miseAJourDuCode" en mode html (diaporama et !diaporama) et pour le preview.
  renderMathInElement(document.body, {
    delimiters: [
      { left: '\\[', right: '\\]', display: true },
      { left: '$', right: '$', display: false }
    ],
    throwOnError: true,
    errorColor: '#CC0000',
    strict: 'warn',
    trust: false
  })
  $('.katexPopup').popup({
    popup: '.special.popup',
    on: 'hover',
    variation: 'inverted',
    inline: true
  })
  const exosMg32 = listeObjetsExercice.filter(exo => exo.typeExercice === 'MG32')
  if (exosMg32.length) {
  // faut charger mathgraph et lui filer ces figures
    try {
    // faut attendre que le div soit créé
    // @todo ce code devrait plutôt être exécuté après la création du div
    // (et ce serait même mieux d'ajouter les conteneurs comme propriétés des exos passés à mg32DisplayAll
    // => il n'y aurait plus de couplage sur le préfixe MG32div)
      await waitFor('MG32div0')
      await mg32DisplayAll(exosMg32)
    } catch (error) {
    // On traite l'erreur
      console.log(error)
      messageUtilisateur({ code: 'mg32load' })
    }
  }
  try {
    const besoinScratch = listeObjetsExercice.some(exo => exo.typeExercice === 'Scratch')
    if (besoinScratch) {
      await scratchTraductionFr()
      /* global scratchblocks */
      scratchblocks.renderMatching('pre.blocks', {
        style: 'scratch3',
        languages: ['fr']
      })
      scratchblocks.renderMatching('code.b', {
        inline: true,
        style: 'scratch3',
        languages: ['fr']
      })
    }
  } catch (error) {
    // On traite l'erreur
    console.log(error)
    messageUtilisateur({ code: 'scratchLoad' })
  }
  const besoinIEP = listeObjetsExercice.some(exo => exo.typeExercice === 'IEP')
  if (besoinIEP) {
    for (const id of window.listeAnimationsIepACharger) {
      const element = document.getElementById(`IEPContainer${id}`)
      if (!element) {
        console.error(Error(`Pas d’élément IEPContainer${id} dans le dom, chargement instrumenpoche ignoré`))
        continue
      }
      element.style.marginTop = '30px'
      const xml = window.listeScriptsIep[id]
      await loadIep(element, xml)
    }
  }
}

function contenuExerciceHtml (obj, numeroExercice, isdiaporama) {
// appelée dès lors que l'on affiche le code html des exercices : depuis "miseAJourDuCode" en mode html (diaporama et !diaporama) et pour le preview.
// fonction construisant le html pour l'affichage d'un exercice :
// * mise en page du titre,
// * icones
// * boutons
// * formulaires
// renvoie un objet : { contenu_un_exercice: le html de l'exercice  ,contenu_une_correction: le html de la correction }
  let contenuUnExercice = ''
  let contenuUneCorrection = ''
  let paramTooltip = ''
  let iconeInteractif = ''
  if (isdiaporama) {
    contenuUnExercice += '&lt;section class="slider single-item" id="diaporama">'
    for (const question of obj.listeQuestions) {
      contenuUnExercice += `\n&lt;div id="question_diap" style="font-size:${obj.tailleDiaporama}px">&lt;span>` + question.replace(/\\dotfill/g, '...').replace(/\\not=/g, '≠').replace(/\\ldots/g, '....') + '&lt;/span>&lt;/div>' // .replace(/~/g,' ') pour enlever les ~ mais je voulais les garder dans les formules LaTeX donc abandonné
    }
    contenuUnExercice += '&lt;div id="question_diap" style="font-size:100px">&lt;span>$\\text{Terminé !}$&lt;/span>&lt;/div>&lt;/section>'
    if (obj.typeExercice === 'MG32') {
      contenuUnExercice += `&lt;div id="MG32div${numeroExercice - 1}" class="MG32">&lt;/div>`
    }
    contenuUneCorrection += obj.contenuCorrection
    if (obj.typeExercice === 'MG32' &amp;&amp; obj.MG32codeBase64corr) {
      contenuUneCorrection += `&lt;div id="MG32divcorr${numeroExercice - 1}" class="MG32">&lt;/div>`
    }
  }
  if (!isdiaporama) {
    if (obj.typeExercice === 'dnb') {
      contenuUnExercice += ` Exercice ${numeroExercice} − DNB ${obj.mois} ${obj.annee} - ${obj.lieu} (ex ${obj.numeroExercice})&lt;/h3>`
      contenuUnExercice += `&lt;img width="90%" src="${obj.png}">`
      contenuUneCorrection += `&lt;h3 class="ui dividing header">Exercice ${numeroExercice} − DNB ${obj.mois} ${obj.annee} - ${obj.lieu} (ex ${obj.numeroExercice},'${numeroExercice - 1}')&lt;/h3>`
      contenuUneCorrection += `&lt;img width="90%" src="${obj.pngcor}">`
      obj.video = false
    } else {
      try {
        obj.nouvelleVersion(numeroExercice - 1)
      } catch (error) {
        console.log(error)
      }
      if (obj.interactifReady &amp;&amp; obj.interactif &amp;&amp; !obj.interactifObligatoire) {
        iconeInteractif = `&lt;span data-tooltip="Auto-correction en ligne">&lt;i id="boutonInteractif${numeroExercice - 1}" data-num="${numeroExercice - 1}" class="keyboard icon iconeInteractif">&lt;/i>&lt;span>`
      } else if (obj.interactifReady &amp;&amp; !obj.interactifObligatoire) {
        iconeInteractif = `&lt;span data-tooltip="Auto-correction en ligne">&lt;i id="boutonInteractif${numeroExercice - 1}" data-num="${numeroExercice - 1}" class="keyboard outline icon iconeInteractif">&lt;/i>&lt;span>`
      }
      if (obj.interactif || obj.interactifObligatoire) {
        exerciceInteractif(obj)
      }
      if ((!obj.nbQuestionsModifiable &amp;&amp; !obj.besoinFormulaireNumerique &amp;&amp; !obj.besoinFormulaireTexte &amp;&amp; !obj.interactifReady) || (!$('#liste_des_exercices').is(':visible') &amp;&amp; !$('#exercices_disponibles').is(':visible') &amp;&amp; !$('#exo_plein_ecran').is(':visible'))) { // Dans exercice.html et exo.html on ne mets pas les raccourcis vers interactif et paramètres.
        contenuUnExercice += `Exercice ${numeroExercice} − ${obj.id} &lt;/h3>`
      } else {
        if (obj.besoinFormulaireNumerique &amp;&amp; obj.besoinFormulaireNumerique[2]) {
          paramTooltip += (obj.besoinFormulaireNumerique[0] + ': \n' + obj.besoinFormulaireNumerique[2]) + '\n'
        }
        if (obj.besoinFormulaire2Numerique &amp;&amp; obj.besoinFormulaire2Numerique[2]) {
          paramTooltip += (obj.besoinFormulaire2Numerique[0] + ': \n' + obj.besoinFormulaire2Numerique[2])
        }
        paramTooltip = paramTooltip ? `data-tooltip="${paramTooltip}" data-position="right center"` : ''
        contenuUnExercice += `&lt;span ${paramTooltip}> Exercice ${numeroExercice} − ${obj.id} &lt;i class="cog icon icone_param">&lt;/i>&lt;/span>${iconeInteractif}&lt;/h3>`
      }
      if (obj.video.length > 3) {
        contenuUnExercice += `&lt;div id=video${numeroExercice - 1}>` + modalYoutube(numeroExercice - 1, obj.video, '', 'Aide', 'youtube') + '&lt;/div>'
      }
      if (obj.boutonAide) {
        contenuUnExercice += `&lt;div id=aide${numeroExercice - 1}> ${obj.boutonAide}&lt;/div>`
      }
      contenuUnExercice += obj.contenu
      if (obj.typeExercice === 'MG32') {
        contenuUnExercice += `&lt;div id="MG32div${numeroExercice - 1}" class="MG32">&lt;/div>`
      }
      contenuUneCorrection += `&lt;h3 class="ui dividing header">Exercice ${numeroExercice}&lt;/h3>`
      contenuUneCorrection += obj.contenuCorrection
      if (obj.typeExercice === 'MG32' &amp;&amp; obj.MG32codeBase64corr) {
        contenuUneCorrection += `&lt;div id="MG32divcorr${numeroExercice - 1}" class="MG32">&lt;/div>`
      }
    }
  }
  return {
    contenu_un_exercice: contenuUnExercice,
    contenu_une_correction: contenuUneCorrection
  }
}

function miseAJourDuCode () {
// fonction permettant de mettre à jour la liste des exercices affichées.
// puis gère les gestionnaires d'évènements sur les éléments en provenance des exercices (icones pour supprimer/déplacer...)
// Appelée dès lors que l'on a une modification sur l'affichage d'un ou plusieurs exercices
//    suppression d'un exercice, nouvelle donnée, changement de paramètre...)
// C'est dans cette fonction que l'on va executer les this.nouvelleVersion des exercices.
  window.MG32_tableau_de_figures = []
  window.listeScriptsIep = {} // Dictionnaire de tous les scripts xml IEP
  window.listeAnimationsIepACharger = [] // Liste des id des scripts qui doivent être chargés une fois le code HTML mis à jour
  // Fixe la graine pour les fonctions aléatoires
  if (!context.graine) {
    context.graine = strRandom({
      includeUpperCase: true,
      includeNumbers: true,
      length: 4,
      startsWithLowerCase: false
    })
    // Saisi le numéro de série dans le formulaire
    if (document.getElementById('form_serie')) { // pas de formulaire existant si premier preview
      document.getElementById('form_serie').value = context.graine
    }
  }
  // Contrôle l'aléatoire grâce à SeedRandom
  seedrandom(context.graine, { global: true });
  // ajout des paramètres des exercices dans l'URL et pour le bouton "copier l'url"
  (function gestionURL () {
    if (listeDesExercices.length > 0) {
      let finUrl = ''
      if (context.isHtml &amp;&amp; !context.isDiaporama &amp;&amp; window.location.pathname.indexOf('exo.html') &lt; 0) {
        finUrl += 'exercice.html'
      }
      finUrl += `?ex=${listeDesExercices[0]}`
      if (typeof listeObjetsExercice[0].sup !== 'undefined') {
        finUrl += `,sup=${listeObjetsExercice[0].sup}`
      }
      if (typeof listeObjetsExercice[0].sup2 !== 'undefined') {
        finUrl += `,sup2=${listeObjetsExercice[0].sup2}`
      }
      if (typeof listeObjetsExercice[0].sup3 !== 'undefined') {
        finUrl += `,sup3=${listeObjetsExercice[0].sup3}`
      }
      if (listeObjetsExercice[0].nbQuestionsModifiable) {
        finUrl += `,nbQuestions=${listeObjetsExercice[0].nbQuestions}`
      }
      if (listeObjetsExercice[0].video.length > 1) {
        finUrl += `,video=${encodeURIComponent(listeObjetsExercice[0].video)}`
      }
      if (listeObjetsExercice[0].interactif &amp;&amp; !context.isDiaporama) {
        finUrl += ',interactif=1'
      }
      listeObjetsExercice[0].numeroExercice = 0
      for (let i = 1; i &lt; listeDesExercices.length; i++) {
        finUrl += `&amp;ex=${listeDesExercices[i]}`
        if (typeof listeObjetsExercice[i].sup !== 'undefined') {
          finUrl += `,sup=${listeObjetsExercice[i].sup}`
        }
        if (typeof listeObjetsExercice[i].sup2 !== 'undefined') {
          finUrl += `,sup2=${listeObjetsExercice[i].sup2}`
        }
        if (typeof listeObjetsExercice[i].sup3 !== 'undefined') {
          finUrl += `,sup3=${listeObjetsExercice[i].sup3}`
        }
        if (listeObjetsExercice[i].nbQuestionsModifiable) {
          finUrl += `,nbQuestions=${listeObjetsExercice[i].nbQuestions}`
        }
        if (listeObjetsExercice[i].video.length > 1) {
          finUrl += `,video=${encodeURIComponent(listeObjetsExercice[i].video)}`
        }
        if (listeObjetsExercice[i].interactif &amp;&amp; !context.isDiaporama) {
          finUrl += ',interactif=1'
        }
        listeObjetsExercice[i].numeroExercice = i
      }
      if (typeof context.duree !== 'undefined' &amp;&amp; context.isDiaporama) {
        finUrl += `&amp;duree=${context.duree}`
      }
      finUrl += `&amp;serie=${context.graine}`
      window.history.pushState('', '', finUrl)
      const url = window.location.href.split('&amp;serie')[0] // met l'URL dans le bouton de copie de l'URL sans garder le numéro de la série
      const clipboardURL = new Clipboard('#btnCopieURL', { text: () => url })
      clipboardURL.on('success', function (e) {
        console.info(e.text + ' copié dans le presse-papier.')
      })
      const btnCopieURL = document.getElementById('btnCopieURL')
      if (btnCopieURL) {
        btnCopieURL.classList.remove('disabled')
      }
    }
  })()
  apparenceExerciceActif() // mise en évidence des exercices sélectionnés : mise en gras + ajout de l'icone - et du nombre si plus de 2 éléments
  renderMathInElement(document.body, {
    delimiters: [
      { left: '\\[', right: '\\]', display: true },
      { left: '$', right: '$', display: false }
    ],
    throwOnError: true,
    errorColor: '#CC0000',
    strict: 'warn',
    trust: false
  })
  let contenu, contenuDesExercices, contenuDesCorrections
  // Dans la suite test selon les affichages :
  // 1/ context.isHtml &amp;&amp; diaporama => cm.html pour le calcul mental.
  // 2/ context.isHtml &amp;&amp; !diaporama => pour mathalea.html ; exercice.html ; exo.html
  // 3/ !context.isHtml => pour mathalealatex.html
  if (context.isHtml &amp;&amp; context.isDiaporama) {
    if (listeDesExercices.length > 0) { // Pour les diaporamas tout cacher quand un exercice est choisi
      $('#exercices_disponibles').hide()
      $('#icones').show() // on affiche les boutons du diaporama uniquement quand un exercice est choisi.
      $('#corrections_et_parametres').show()
      $('#parametres_generaux').show()
    } else {
      $('#exercices_disponibles').show()
      $('h3').show()
      $('#formulaire_choix_de_la_duree').show()
    }
    document.getElementById('exercices').innerHTML = ''
    document.getElementById('corrections').innerHTML = ''
    if (listeDesExercices.length > 0) {
      for (let i = 0; i &lt; listeDesExercices.length; i++) {
        listeObjetsExercice[i].id = listeDesExercices[i]
        listeObjetsExercice[i].interactif = false
        try {
          listeObjetsExercice[i].nouvelleVersion(i)
        } catch (error) {
          console.log(error)
        }
        contenu = contenuExerciceHtml(listeObjetsExercice[i], i + 1, true)
      }
      contenuDesExercices = contenu.contenu_un_exercice
      contenuDesCorrections = `&lt;ol>\n${contenu.contenu_une_correction}\n&lt;/ol>`
      $('#message_liste_exercice_vide').hide()
      $('#cache').dimmer('hide')
    } else {
      $('#message_liste_exercice_vide').show() // Message au dessus de la liste des exercices
      $('#cache').dimmer('show') // Cache au dessus du code LaTeX
    }
    document.getElementById('exercices').innerHTML = contenuDesExercices
    document.getElementById('corrections').innerHTML = contenuDesCorrections
    gestionModules(true, listeObjetsExercice)
  }

  // Ajoute le contenu dans les div #exercices et #corrections
  if (context.isHtml &amp;&amp; !context.isDiaporama) {
    let scrollLevel
    // récupération du scrollLevel pour ne pas avoir un comportement "bizarre"
    //    lors des modification sur les exercices via les paramètres et/ou icones dans la colonne de droite d'affichage des exercices.
    if (document.getElementById('right')) {
      scrollLevel = document.getElementById('right').scrollTop
    }
    document.getElementById('exercices').innerHTML = ''
    document.getElementById('corrections').innerHTML = ''
    let contenuDesExercices = ''
    let contenuDesCorrections = ''
    if (listeDesExercices.length > 0) {
      for (let i = 0; i &lt; listeDesExercices.length; i++) {
        // const contenu_un_exercice = ''; const contenu_une_correction = ''
        listeObjetsExercice[i].id = listeDesExercices[i]
        contenu = contenuExerciceHtml(listeObjetsExercice[i], i + 1, false)
        if ($('#liste_des_exercices').is(':visible') || $('#exercices_disponibles').is(':visible') || $('#exo_plein_ecran').is(':visible')) { // si on n'a plus la liste des exercices il ne faut plus pouvoir en supprimer (pour exercice.html et exo.html)
          if (listeDesExercices.length === 1) { // si on a q'un seul exercice, uniquement l'icone poubelle
            contenuDesExercices += `&lt;div id="exercice${i}"> &lt;h3 class="ui dividing header">&lt;i id="${i}" class="trash alternate icon icone_moins">&lt;/i>${contenu.contenu_un_exercice} &lt;/div>`
          } else if (i === 0) { // si c'est le premier exercice icone poubelle plus fleche vers le bas
            contenuDesExercices += `&lt;div id="exercice${i}"> &lt;h3 class="ui dividing header">&lt;i id="${i}" class="trash alternate icon icone_moins">&lt;/i>&lt;i id="${i}" class="arrow circle down icon icone_down">&lt;/i>${contenu.contenu_un_exercice} &lt;/div>`
          } else if (i === listeDesExercices.length - 1) { // Pour le dernier exercice pas de fleche vers le bas
            contenuDesExercices += `&lt;div id="exercice${i}"> &lt;h3 class="ui dividing header">&lt;i id="${i}" class="trash alternate icon icone_moins">&lt;/i>&lt;i id="${i}" class="arrow circle up icon icone_up">&lt;/i>${contenu.contenu_un_exercice} &lt;/div>`
          } else { // pour les autres exercices affichage de l'icone poubelle et des deux flèches (haut et bas)
            contenuDesExercices += `&lt;div id="exercice${i}"> &lt;h3 class="ui dividing header">&lt;i id="${i}" class="trash alternate icon icone_moins">&lt;/i>&lt;i id="${i}" class="arrow circle down icon icone_down">&lt;/i>&lt;i id="${i}" class="arrow circle up icon icone_up">&lt;/i>${contenu.contenu_un_exercice} &lt;/div>`
          }
        } else {
          contenuDesExercices += `&lt;div id="exercice${i}" class="titreExercice"> &lt;h3 class="ui dividing header">${contenu.contenu_un_exercice} &lt;/div>`
        }
        contenuDesCorrections += `&lt;div id="divexcorr${i}" class="titreExercice"> ${contenu.contenu_une_correction} &lt;/div>`
      }
      contenuDesExercices = `&lt;ol>\n${contenuDesExercices}\n&lt;/ol>`
      contenuDesCorrections = `&lt;ol>\n${contenuDesCorrections}\n&lt;/ol>`
      $('#message_liste_exercice_vide').hide()
      $('#cache').dimmer('hide')
    } else {
      $('#message_liste_exercice_vide').show() // Message au dessus de la liste des exercices
      $('#cache').dimmer('show') // Cache au dessus du code LaTeX
    }
    $('#popup_preview .icone_param').remove() // dans l'aperçu pas d'engrenage pour les paramètres.
    $('#popup_preview .iconeInteractif').remove() // dans l'aperçu pas d'icone interactif.
    document.getElementById('exercices').innerHTML = contenuDesExercices
    if (scrollLevel) {
      document.getElementById('right').scrollTop = scrollLevel
    }
    document.getElementById('corrections').innerHTML = contenuDesCorrections
    gestionModules(false, listeObjetsExercice)
    const exercicesAffiches = new Event('exercicesAffiches', { bubbles: true })
    document.dispatchEvent(exercicesAffiches)
    // En cas de clic sur la correction, on désactive les exercices interactifs
    const bntCorrection = document.getElementById('btnCorrection')
    if (bntCorrection) {
      bntCorrection.addEventListener('click', () => {
        // Le bouton "Vérifier les réponses" devient inactif
        const boutonsCheck = document.querySelectorAll('.checkReponses')
        boutonsCheck.forEach(function (bouton) {
          bouton.classList.add('disabled')
        })
        // On ne peut plus cliquer dans les checkboxs
        const checkboxs = document.querySelectorAll('.monQcm')
        checkboxs.forEach(function (checkbox) {
          checkbox.classList.add('read-only')
        })
      })
    }
  }
  if (!context.isHtml) {
    // Sortie LaTeX
    // code pour la sortie LaTeX
    let codeEnonces = ''
    let codeCorrections = ''
    const listeExercicesLength = listeDesExercices.length
    codeLatex = ''
    listePackages = new Set()
    if (listeExercicesLength > 0) {
      for (let i = 0; i &lt; listeExercicesLength; i++) {
        listeObjetsExercice[i].id = listeDesExercices[i] // Pour récupérer l'id qui a appelé l'exercice
        if (listeObjetsExercice[i].typeExercice === 'dnb') {
          listePackages.add('dnb')
          codeEnonces += '\n\n\\exo{}\n\n'
          codeEnonces += listeObjetsExercice[i].contenu
          codeEnonces += '\n\n'
          codeCorrections += '\n\n\\exo{}\n\n'
          codeCorrections += listeObjetsExercice[i].contenuCorrection
          codeCorrections += '\n\n'
        } else {
          listeObjetsExercice[i].nouvelleVersion()
          codeEnonces += listeObjetsExercice[i].contenu
          codeEnonces += '\n\n'
          codeCorrections += listeObjetsExercice[i].contenuCorrection
          codeCorrections += '\n\n'
          if (typeof listeObjetsExercice[i].listePackages === 'string') {
            listePackages.add(listeObjetsExercice[i].listePackages)
          } else {
            // si c'est un tableau
            listeObjetsExercice[i].listePackages.forEach(listePackages.add, listePackages)
          }
        }
      }
      if ($('#supprimer_correction:checked').val()) {
        codeLatex = codeEnonces
      } else {
        codeLatex =
                        codeEnonces + '\n\n%%%%%%%%%%%%%%%%%%%%%%\n%%%   CORRECTION   %%%\n%%%%%%%%%%%%%%%%%%%%%%\n\n\\newpage\n\\begin{correction}\n\n' + codeCorrections + '\\end{correction}'
      }
      $('#message_liste_exercice_vide').hide()
      copierExercicesFormVersAffichage(listeDesExercices)
      $('#cache').show()

      // Gestion du nombre de versions
      if ($('#nombre_de_versions').val() > 1) {
        codeLatex = ''
        let codeExercices = ''
        let codeCorrection = ''
        for (let v = 0; v &lt; $('#nombre_de_versions').val(); v++) {
          codeExercices += '\\version{' + (v + 1) + '}\n\n'
          codeCorrection += '\n\n\\newpage\n\\version{' + (v + 1) + '}\n\\begin{correction}'
          for (let i = 0; i &lt; listeDesExercices.length; i++) {
            listeObjetsExercice[i].nouvelleVersion()
            codeExercices += listeObjetsExercice[i].contenu
            codeExercices += '\n\n'
            codeCorrection += listeObjetsExercice[i].contenuCorrection
            codeCorrection += '\n\n'
          }
          if (v &lt; $('#nombre_de_versions').val() - 1) {
            if ($('#style_classique:checked').val()) {
              codeExercices += '\n\\newpage\n\\setcounter{exo}{0}\n'
            } else {
              codeExercices += '\n\\newpage\n\\setcounter{section}{0}\n'
            }
          }
          codeCorrection += '\n\\end{correction}'
        }
        codeLatex = codeExercices + codeCorrection
      }
      div.innerHTML = '&lt;pre>&lt;code class="language-latex">' + codeLatex + '&lt;/code>&lt;/pre>'
      loadPrism().then(() => {
        /* global Prism */
        Prism.highlightAllUnder(div) // Met à jour la coloration syntaxique
      }).catch(error => console.error(error))
      const clipboardURL = new Clipboard('#btnCopieLatex', { text: () => codeLatex })
      clipboardURL.on('success', function (e) {
        console.info('Code LaTeX copié dans le presse-papier.')
      })
    } else {
      codeLatex = ''
      $('#message_liste_exercice_vide').show() // Message au dessus de la liste des exercices
      $('#cache').hide() // Cache au dessus du code LaTeX
      div.innerHTML = ''
    }
    $('.icone_param').remove() // dans mathalealatex pas d'engrenage pour les paramètres.
    $('.iconeInteractif').remove() // dans l'aperçu pas d'icone QCM.
  }
  if (!context.isHtml) {
    // Gestion du téléchargement
    $('#btn_telechargement').off('click').on('click', function () {
      // Gestion du style pour l'entête du fichier
      let contenuFichier = `
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % Document généré avec MathALEA sous licence CC-BY-SA
    %
    % ${window.location.href}
    %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    `

      if ($('#style_classique:checked').val()) {
        if ($('#entete_du_fichier').val() === '') {
          $('#entete_du_fichier').val('Exercices')
        }
        contenuFichier += '\\documentclass[a4paper,11pt,fleqn]{article}\n'
        contenuFichier += `\\input{preambule}\n\\pagestyle{fancy}\n\\renewcommand{\\headrulewidth}{1pt}\n\\fancyhead[C]{${$('#entete_du_fichier').val()}}\n\\fancyhead[L]{}`
        contenuFichier += '\\fancyhead[R]{}\n\\renewcommand{\\footrulewidth}{1pt}\n\\fancyfoot[C]{}\n\\fancyfoot[L]{}\n\\fancyfoot[R]{}\n\n'
        contenuFichier += '\\begin{document}\n\n' + codeLatex + '\n\n\\end{document}'
      } else {
        contenuFichier += '\\documentclass[a4paper,11pt,fleqn]{article}\n\\input{preambule_coop}\n'
        contenuFichier += '\\theme{' + $('input[name=theme]:checked').val() + '}{' + $('#entete_du_fichier').val() + '}'
        contenuFichier += '{' + $('#items').val() + '}{' + $('#domaine').val() + '}\n\\begin{document}\n\n' + codeLatex
        contenuFichier += '\n\n\\end{document}'
      }

      if ($('#nom_du_fichier').val()) {
        telechargeFichier(contenuFichier, $('#nom_du_fichier').val() + '.tex')
      } else {
        telechargeFichier(contenuFichier, 'mathalea.tex')
      }
    })

    $('#btn_overleaf').off('click').on('click', function () {
      // Gestion du style pour l'entête du fichier

      let contenuFichier = `
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % Document généré avec MathALEA sous licence CC-BY-SA
    %
    % ${window.location.href}
    %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    
    `

      if ($('#style_classique:checked').val()) {
        contenuFichier += introLatex($('#entete_du_fichier').val(), listePackages) + codeLatex + '\n\n\\end{document}'
      } else {
        contenuFichier += introLatexCoop(listePackages)
        contenuFichier += '\n\n\\theme{' + $('input[name=theme]:checked').val() + '}{' + $('#entete_du_fichier').val() + '}'
        contenuFichier += '{' + $('#items').val() + '}{' + $('#domaine').val() + '}\n\\begin{document}\n\n' + codeLatex
        contenuFichier += '\n\n\\end{document}'
      }

      // Gestion du LaTeX statique

      // Envoi à Overleaf.com en modifiant la valeur dans le formulaire

      $('input[name=encoded_snip]').val(encodeURIComponent(contenuFichier))
      if (listePackages.has('dnb')) { // Force le passage à xelatex sur Overleaf pour les exercices de DNB
        $('input[name=engine]').val('xelatex')
      }
      if ($('#nom_du_fichier').val()) {
        $('input[name=snip_name]').val($('#nom_du_fichier').val()) // nomme le projet sur Overleaf
      }
    })

    // Gestion des paramètres du fichier LaTeX

    $('#options_style_CoopMaths').show() // par défaut le style coop
    $('a.lien_images').show()
    $(function () {
      $("input:radio[name='style']").change(function () {
        if ($('#style_classique:checked').val()) {
          $('#options_style_CoopMaths').hide()
          $('a.lien_preambule').attr('href', 'fichiers/preambule.tex')
          $('a.lien_images').hide()
        } else {
          $('a.lien_images').show()
          $('#options_style_CoopMaths').show()
          $('a.lien_preambule').attr('href', 'fichiers/preambule_coop.tex')
        }
      })
    })
  }

  //* ******* Gestion des évènements sur les éléments liés aux exercices ********

  $('.iconeInteractif').off('click').on('click', function (e) {
  // Au click sur l'icone interactif on coche le mode interactif de l'exercice dans les paramètres et on relance la mise à jour des exercices.
    $('#accordeon_parametres >div').addClass('active')
    const numeroExerciceExercice = $(event.target).attr('data-num')
    const checkElem = $(`#formInteractif${numeroExerciceExercice}`)
    if (checkElem.prop('checked')) {
      $(`#formInteractif${numeroExerciceExercice}`).prop('checked', false).trigger('change')
      listeObjetsExercice[numeroExerciceExercice].interactif = false
      miseAJourDuCode()
    } else {
      $(`#formInteractif${numeroExerciceExercice}`).prop('checked', true).trigger('change')
      listeObjetsExercice[numeroExerciceExercice].interactif = true
      miseAJourDuCode()
      $(`#boutonInteractif${numeroExerciceExercice}`).removeClass('outline')
    }
  })

  // icone_paramètres fait le focus sur les parmètres correspondant à l'exercice
  $('.icone_param').off('click').on('click', function (e) {
    $('#accordeon_parametres >div').addClass('active')
    const numeroExercice = event.target.parentElement.parentElement.parentElement.id
    $(`.${numeroExercice} + div :input`).focus()
  })

  // ******** possibilité de manipuler la liste des exercices via les exercices. ******

  function monterExo (num) {
  // remonte un exercice d'un cran dans la liste (déclenché sur l'icone fleche vers le haut au niveau du titre d'un exercice.
  // récupère la liste des exercices dans le formulaire, la réordonne et relance la fonction miseAJourDeLaListeDesExercices()
    const formChoixDesExercices = document.getElementById('choix_des_exercices')
    listeDesExercices = formChoixDesExercices.value.replace(/\s/g, '').replace(';', ',').split(',')
    num = parseInt(num)
    if (num !== 0) {
      [listeDesExercices[num - 1], listeDesExercices[num]] = [listeDesExercices[num], listeDesExercices[num - 1]]
      formChoixDesExercices.value = listeDesExercices.toString()
      copierExercicesFormVersAffichage(listeDesExercices)
      miseAJourDeLaListeDesExercices()
    }
  }

  function descendreExo (num) {
  // descend un exercice d'un cran dans la liste (déclenché sur l'icone fleche vers le bas au niveau du titre d'un exercice.
  // récupère la liste des exercices dans le formulaire, la réordonne et relance la fonction miseAJourDeLaListeDesExercices()
    const formChoixDesExercices = document.getElementById('choix_des_exercices')
    listeDesExercices = formChoixDesExercices.value.replace(/\s/g, '').replace(';', ',').split(',')
    num = parseInt(num)
    if (num !== listeDesExercices.length - 1) {
      [listeDesExercices[num], listeDesExercices[num + 1]] = [listeDesExercices[num + 1], listeDesExercices[num]]
      formChoixDesExercices.value = listeDesExercices.toString()
      copierExercicesFormVersAffichage(listeDesExercices)
      miseAJourDeLaListeDesExercices()
    }
  }

  // gestion des évènements sur les click sur les icones liés aux titres des exercices :

  $('.icone_moins').off('click').on('click', function (e) {
    supprimerExo(event.target.id) // fonction présente dans menuDesExercicesDisponibles car utilisée aussi avec le petit icone - dans l'apparence de la ligne exercice
  })

  $('.icone_up').off('click').on('click', function (e) {
    monterExo(event.target.id)
  })

  $('.icone_down').off('click').on('click', function (e) {
    descendreExo(event.target.id)
  })
  //* ***************
}

/**
     * Fonction à lancer une fois que la liste des exercices a été mise à jour.
     * Elle va importer les différents exercices depuis ./exercices/id.js et remplir listeObjetsExercice.
     * Une fois que tout est importé, elle créé les formulaires pour les paramètres des exercices.
     * Ensuite, elle regarde dans l'URL si il y a des paramètres à récupérer et à saisir dans le formulaire.
     * Enfin, elle délègue à mise_a_jour du code l'affichage
     *
     * cg 04-2021 ajout de l'argument preview (facultatif (un code exercice)) permettant l'affichage dans une popup
     * sans l'ajouter à la liste
     *
     */
function miseAJourDeLaListeDesExercices (preview) {
  let besoinXCas = false
  const promises = []
  const listeExercices = listeDesExercices
  if (preview) {
    listeExercices.push(preview)
  }
  listeObjetsExercice = []
  for (let i = 0, id; i &lt; listeExercices.length; i++) {
    id = listeExercices[i]
    let url
    try {
      url = dictionnaireDesExercices[id].url
    } catch (error) {
      console.log(error)
      console.log(`Exercice ${id} non disponible`)
      throw ({
        code: 'codeExerciceInconnu',
        exercice: id
      })
    }
    if (dictionnaireDesExercices[id].typeExercice === 'dnb') {
      listeObjetsExercice[i] = dictionnaireDesExercices[id]
      promises.push(
        fetch(url)
          .then(response => response.text())
          .then(data => {
            listeObjetsExercice[i].nbQuestionsModifiable = false
            listeObjetsExercice[i].video = ''
            listeObjetsExercice[i].titre = id
            listeObjetsExercice[i].contenu = data
          })
      )
      promises.push(
        fetch(dictionnaireDesExercices[id].urlcor)
          .then(response => response.text())
          .then(data => {
            listeObjetsExercice[i].contenuCorrection = data
          })
      )
    } else {
      // avec webpack on ne peut pas faire de import(url), car il faut lui indiquer quels fichiers sont susceptibles d'être chargés
      // ici il ne peut s'agir que de js contenus dans exercices (dnb déjà traité dans le if au dessus)
      const chunks = /^\/exercices\/(.*)/.exec(url)
      if (!chunks) throw Error(`url non prévue : ${url}`)
      const path = chunks[1]
      promises.push(
        // cf https://webpack.js.org/api/module-methods/#magic-comments
        import(/* webpackMode: "lazy" */ './exercices/' + path)
          .catch((error) => {
            console.log(error)
            listeObjetsExercice[i] = { titre: "Cet exercice n'existe pas", contenu: '', contenuCorrection: '' } // Un exercice vide pour l'exercice qui n'existe pas
          })
          .then((module) => {
            if (module) {
              listeObjetsExercice[i] = new module.default() // Ajoute l'objet dans la liste des
              if (dictionnaireDesExercices[id].sup !== undefined) {
                listeObjetsExercice[i].sup = dictionnaireDesExercices[id].sup
              }
              if (dictionnaireDesExercices[id].sup2 !== undefined) {
                listeObjetsExercice[i].sup2 = dictionnaireDesExercices[id].sup2
              }
              if (dictionnaireDesExercices[id].sup3 !== undefined) {
                listeObjetsExercice[i].sup3 = dictionnaireDesExercices[id].sup3
              }
              if (dictionnaireDesExercices[id].nbQuestions !== undefined) {
                listeObjetsExercice[i].nbQuestions = dictionnaireDesExercices[id].nbQuestions
              }
              if (listeObjetsExercice[i].typeExercice === 'XCas') {
                besoinXCas = true
              }
            }
          })
      )
    }
  }
  Promise.all(promises)
    .then(() => {
      if (!preview) {
        parametresExercice(listeObjetsExercice)
      }
    })
    .then(() => {
      if (!preview) {
        // Récupère les paramètres passés dans l'URL
        const urlVars = getUrlVars()
        // trier et mettre de côté les urlvars qui ne sont plus dans la liste des exercices
        // => évite les erreurs lors de la suppression de question dans la liste.
        if (urlVars.length &lt; listeObjetsExercice.length &amp;&amp; document.getElementById('filtre') &amp;&amp; document.getElementById('filtre').value === 'interactif') {
          listeObjetsExercice[listeObjetsExercice.length - 1].interactif = true
          if (formInteractif[listeObjetsExercice.length - 1]) {
            formInteractif[listeObjetsExercice.length - 1].checked = true
          }
        }
        if (urlVars.length &lt; 0 &amp;&amp; document.getElementById('filtre').value === 'interactif') {
          listeObjetsExercice[0].interactif = true
          formInteractif[0].checked = true
        }
        for (let i = 0; i &lt; urlVars.length; i++) {
          if (urlVars[i].id !== listeExercices[i]) {
            urlVars.splice(i, 1)
          }
        }
        for (let i = 0; i &lt; urlVars.length; i++) {
          // récupère les éventuels paramètres dans l'URL
          // et les recopie dans les formulaires des paramètres
          if (urlVars[i].nbQuestions &amp;&amp; listeObjetsExercice[i].nbQuestionsModifiable) {
            listeObjetsExercice[i].nbQuestions = parseInt(urlVars[i].nbQuestions)
            formNbQuestions[i].value = listeObjetsExercice[i].nbQuestions
          }
          if (urlVars[i].video &amp;&amp; context.isHtml &amp;&amp; !context.isDiaporama) {
            listeObjetsExercice[i].video = decodeURIComponent(urlVars[i].video)
            formVideo[i].value = listeObjetsExercice[i].video
          }
          if (urlVars[i].interactif) {
            listeObjetsExercice[i].interactif = true
            if (formInteractif[i]) {
              formInteractif[i].checked = true
            }
          }
          if (typeof urlVars[i].sup !== 'undefined') {
            // Si le string peut être convertit en int alors on le fait
            if (isNumeric(urlVars[i].sup)) {
              listeObjetsExercice[i].sup = parseInt(urlVars[i].sup)
            } else {
              listeObjetsExercice[i].sup = urlVars[i].sup
            }
            // Un exercice avec un this.sup mais pas de formulaire pouvait poser problème
            try {
              formSup[i].value = listeObjetsExercice[i].sup
            } catch {
            }
          }
          if (typeof urlVars[i].sup2 !== 'undefined') {
            if (isNumeric(urlVars[i].sup2)) {
              listeObjetsExercice[i].sup2 = parseInt(urlVars[i].sup2)
            } else {
              listeObjetsExercice[i].sup2 = urlVars[i].sup2
            }
            try {
              formSup2[i].value = listeObjetsExercice[i].sup2
            } catch (error) {
            }
          }
          if (typeof urlVars[i].sup3 !== 'undefined') {
            if (isNumeric(urlVars[i].sup3)) {
              listeObjetsExercice[i].sup3 = parseInt(urlVars[i].sup3)
            } else {
              listeObjetsExercice[i].sup3 = urlVars[i].sup3
            }
            try {
              formSup3[i].value = listeObjetsExercice[i].sup3
            } catch (error) {

            }
          }
        }
      }
    })
    .then(() => {
      if (besoinXCas) {
        // On charge le javascript de XCas
        let div // le div dans lequel on fera apparaitre le cercle de chargement
        if (context.isHtml) {
          div = document.getElementById('exercices')
        } else {
          div = document.getElementById('div_codeLatex')
        }
        div.innerHTML = `&lt;div class="profile-main-loader">
                    &lt;div class="loader">
                      &lt;svg class="circular-loader"viewBox="25 25 50 50" >
                        &lt;circle class="loader-path" cx="50" cy="50" r="20" fill="none" stroke="#70c542" stroke-width="2" />
                      &lt;/svg>
                    &lt;/div>
                  &lt;/div>`
        return loadGiac()
      }
    })
    .then(() => {
      if (preview) {
      // gestion de l'affichage des exercices
        const output = context.isHtml
        context.isHtml = true // pour que l'aperçu fonctionne dans mathalealatex besoin d'avoir l'exercice en mode html
        if (typeof listeObjetsExercice[listeExercices.length - 1].nouvelleVersion === 'function') {
          try {
            listeObjetsExercice[listeExercices.length - 1].nouvelleVersion(0)
          } catch (error) {
            console.log(error)
          }
        }
        listeObjetsExercice[listeExercices.length - 1].id = listeExercices[listeExercices.length - 1]
        const contenu = contenuExerciceHtml(listeObjetsExercice[listeExercices.length - 1], listeExercices.length, false)
        $('#popup_preview').html(contenu.contenu_un_exercice)
        $('.popup').addClass('show')
        if (document.getElementById('left')) {
          $('.popuptext').css({ top: document.getElementById('left').scrollTop - 10 })
          $('.popuptext').css({ left: document.getElementById('left').offsetLeft + 5 })
          if (window.innerWidth &lt; 765) {
            $('.popuptext').css({ left: document.getElementById('left').offsetLeft + 25 })
            $('.popup').css({ left: document.getElementById('left').offsetLeft + 25 })
          }
        } else {
          $('.popuptext').css({ top: document.documentElement.scrollTop - 10 })
        }
        $('.popuptext').show()
        listeDesExercices.pop()
        if (!output) {
          gestionModules(false, listeObjetsExercice)
        }
        context.isHtml = output
        miseAJourDuCode() // permet de gérer les popup avec module.
      } else {
        miseAJourDuCode()
      }
    })
}

// Gestion des paramètres
const div = document.getElementById('div_codeLatex') // Récupère le div dans lequel le code va être affiché
// const div_overleaf = document.getElementById('overleaf') // Récupère le div dans lequel le code va être affiché
const divParametresGeneraux = document.getElementById('parametres_generaux') // Récupère le div dans lequel seront inscrit les paramètres
const formConsigne = []
const formNbQuestions = []
const formVideo = []
const formCorrectionDetaillee = []
const formNbCols = []
const formNbColsCorr = []
const formSpacing = []
const formSpacingCorr = []
const formSup = []
const formSup2 = []
const formSup3 = []
const formInteractif = [] // Création de tableaux qui recevront les éléments HTML de chaque formulaires

function parametresExercice (exercice) {
  /* Pour l'exercice i, on rajoute un formulaire avec 5 inputs :
        nombre de questions, nombre de colonnes,nombre de colonnes dans le corrigé,
        espacement et espacement dans le corrigé.
        Les réponses modifient les caractéristiques de l'exercice puis le code LaTeX est mis à jour
        */
  divParametresGeneraux.innerHTML = '' // Vide le div parametres_generaux
  if (exercice.length > 0) {
    divParametresGeneraux.innerHTML += '&lt;div class="ui hidden divider">&lt;/div>'

    divParametresGeneraux.innerHTML += `&lt;div>&lt;label for="form_serie">Clé de la série d'exercice : &lt;/label> &lt;input id="form_serie" type="text" style="padding: 5px;
  border: 1px solid #ccc;border-radius: 4px;">&lt;/div>`
  }

  for (let i = 0; i &lt; exercice.length; i++) {
    if (context.isHtml) {
      divParametresGeneraux.innerHTML += '&lt;h4 class="ui dividing header exercice' + i + '">Exercice n°' + (i + 1) + ' : ' + exercice[i].titre + ' − ' + listeDesExercices[i] + '&lt;/h4>'
      if (exercice[i].pasDeVersionLatex) {
        divParametresGeneraux.innerHTML += "&lt;p>&lt;em>Cet exercice n'a pas de version LaTeX et ne peut donc pas être exporté en PDF.&lt;/em>&lt;/p>"
      }
      if (exercice[i].nbQuestionsModifiable) {
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="form_nbQuestions' + i + '">Nombre de questions : &lt;/label> &lt;input id="form_nbQuestions' + i + '" type="number"  min="1" max="99">&lt;/div>'
      }
      if (!context.isDiaporama) {
        divParametresGeneraux.innerHTML += '&lt;div>&lt;label for="form_video' + i + '" data-tooltip="URL, code iframe, identifiant YouTube" data-inverted="" >Vidéo ou complément numérique : &lt;input id="form_video' + i + '" type="texte" size="20"  >&lt;/label>&lt;/div>'
      }
      if (exercice[i].correctionDetailleeDisponible) {
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="form_correctionDetaillee' + i + '">Correction détaillée : &lt;/label> &lt;input id="form_correctionDetaillee' + i + '" type="checkbox" >&lt;/div>'
      }
      if (exercice[i].interactifReady &amp;&amp; !exercice[i].interactifObligatoire &amp;&amp; !context.isDiaporama) {
          divParametresGeneraux.innerHTML += '&lt;div>&lt;label for="formInteractif' + i + '">Exercice interactif : &lt;/label> &lt;input id="formInteractif' + i + '" type="checkbox" >&lt;/div>'
      }

      if (!exercice[i].nbQuestionsModifiable &amp;&amp; !exercice[i].correctionDetailleeDisponible &amp;&amp; !exercice[i].besoinFormulaireNumerique &amp;&amp; !exercice[i].besoinFormulaireTexte &amp;&amp; !exercice[i].interactif) {
        divParametresGeneraux.innerHTML += '&lt;p>&lt;em>Cet exercice ne peut pas être paramétré.&lt;/em>&lt;/p>'
      }
    } else {
      divParametresGeneraux.innerHTML += '&lt;h4 class="ui dividing header">Exercice n°' + (i + 1) + ' : ' + exercice[i].titre + '&lt;/h4>'

      if (exercice[i].consigneModifiable) {
        divParametresGeneraux.innerHTML += '&lt;div>&lt;label for="form_consigne' + i + '">Consigne : &lt;/label> &lt;input id="form_consigne' + i + '" type="texte" size="20">&lt;/div>'
      }
      if (exercice[i].nbQuestionsModifiable) {
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="form_nbQuestions' + i + '">Nombre de questions : &lt;/label> &lt;input id="form_nbQuestions' + i + '" type="number"  min="1" max="99">&lt;/div>'
      }
      if (exercice[i].correctionDetailleeDisponible) {
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="form_correctionDetaillee' + i + '">Correction détaillée : &lt;/label> &lt;input id="form_correctionDetaillee' + i + '" type="checkbox" >&lt;/div>'
      }
      if (exercice[i].interactifReady &amp;&amp; (exercice[i].amcType === 1 || exercice[i].amcType === 2)) { // En LaTeX les seuls exercices interactifs sont les QCM
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="formInteractif' + i + '">QCM : &lt;/label> &lt;input id="formInteractif' + i + '" type="checkbox" >&lt;/div>'
      }
      if (exercice[i].nbColsModifiable) {
        divParametresGeneraux.innerHTML += '&lt;div>&lt;label for="form_nbCols' + i + '">Nombre de colonnes : &lt;/label>&lt;input id="form_nbCols' + i + '" type="number" min="1" max="99">&lt;/div>'
      }
      if (exercice[i].nbColsCorrModifiable) {
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="form_nbColsCorr' + i + '">Nombre de colonnes dans la correction : &lt;/label>&lt;input id="form_nbColsCorr' + i + '" type="number" min="1" max="99">&lt;/div>'
      }
      if (exercice[i].spacingModifiable) {
        divParametresGeneraux.innerHTML += '&lt;div>&lt;label for="form_nbColsCorr' + i + '">Espacement : &lt;/label>&lt;input id="form_spacing' + i + '" type="number" min="1" max="99">&lt;/div>'
      }
      if (exercice[i].spacingCorrModifiable) {
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="form_nbColsCorr' + i + '">Espacement dans la correction : &lt;/label>&lt;input id="form_spacingCorr' + i + '" type="number" min="1" max="99">&lt;/div>'
      }

      // Si le nombre de versions changent
      $('#nombre_de_versions').change(function () {
        miseAJourDuCode()
      })
    }

    // Si un formulaire supplémentaire est défini dans l'exercice alors on l'ajoute
    if (exercice[i].besoinFormulaireNumerique || exercice[i].besoinFormulaireTexte) {
      // Ajout du titre pour les réglages supplémentaires
      divParametresGeneraux.innerHTML += "&lt;h4 class='ui dividing header'>&lt;/h4>"
    }

    if (exercice[i].besoinFormulaireNumerique) {
      // Création d'un formulaire numérique
      if (exercice[i].besoinFormulaireNumerique[2]) {
        // Si un tooltip est défini
        divParametresGeneraux.innerHTML +=
                        '&lt;div data-tooltip="' +
                        exercice[i].besoinFormulaireNumerique[2] +
                        '"" data-inverted="" data-position="top left">&lt;label for="form_sup' +
                        i +
                        '">' +
                        exercice[i].besoinFormulaireNumerique[0] +
                        ' : &lt;/label>&lt;input id="form_sup' +
                        i +
                        '" type="number"  min="1" max="' +
                        exercice[i].besoinFormulaireNumerique[1] +
                        '">&lt;/div>'
      } else {
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="form_sup' +
                        i +
                        '">' +
                        exercice[i].besoinFormulaireNumerique[0] +
                        ' : &lt;/label>&lt;input id="form_sup' +
                        i +
                        '" type="number"  min="1" max="' +
                        exercice[i].besoinFormulaireNumerique[1] +
                        '">&lt;/div>'
      }
    }

    if (exercice[i].besoinFormulaireTexte) {
      // Création d'un formulaire texte
      const paramTooltip = exercice[i].besoinFormulaireTexte[1] ? `data-tooltip="${exercice[i].besoinFormulaireTexte[1]}"` : ''
      divParametresGeneraux.innerHTML +=
                    `&lt;div style='display: inline'>&lt;label for='form_sup${i}'> ${exercice[i].besoinFormulaireTexte[0]} : &lt;/label>
                    &lt;div style='display: inline' ${paramTooltip} data-inverted=''>
                    &lt;input id='form_sup${i}' type='text' size='20' >&lt;/div>&lt;/div>`
    }

    if (exercice[i].besoin_formulaire_long_texte) {
      // Création d'un long formulaire de texte
      divParametresGeneraux.innerHTML +=
                    "&lt;label for='form_sup" +
                    i +
                    "'>" +
                    exercice[i].besoin_formulaire_long_texte[0] +
                    " : &lt;/label> &lt;div style='display: inline' data-tooltip='" +
                    exercice[i].besoin_formulaire_long_texte[1] +
                    "' data-inverted=''>&lt;textarea id='form_sup" +
                    i +
                    "'>&lt;/textarea>&lt;/div>"
      divParametresGeneraux.innerHTML += `&lt;div class="ui form">
&lt;div class="field">
&lt;label>Text&lt;/label>
&lt;textarea>&lt;/textarea>
&lt;/div>
&lt;/div>`
    }

    if (exercice[i].besoinFormulaireCaseACocher) {
      // Création d'un formulaire texte
      divParametresGeneraux.innerHTML +=
                    "&lt;div style='display: inline'>&lt;label for='form_sup" +
                    i +
                    "'>" +
                    exercice[i].besoinFormulaireCaseACocher[0] +
                    " : &lt;/label>&lt;input id='form_sup" +
                    i +
                    "' type='checkbox'  >&lt;/div>"
    }

    if (exercice[i].besoinFormulaire2CaseACocher) {
      // Création d'un formulaire texte
      divParametresGeneraux.innerHTML +=
                    "&lt;div style='display: inline'>&lt;label for='form_sup2" +
                    i +
                    "'>" +
                    exercice[i].besoinFormulaire2CaseACocher[0] +
                    " : &lt;/label>&lt;input id='form_sup2" +
                    i +
                    "' type='checkbox'  >&lt;/div>"
    }

    if (exercice[i].besoinFormulaire2Numerique) {
      // Création d'un formulaire numérique
      if (exercice[i].besoinFormulaire2Numerique[2]) {
        // Si un tooltip est défini
        divParametresGeneraux.innerHTML +=
                        '&lt;div data-tooltip="' +
                        exercice[i].besoinFormulaire2Numerique[2] +
                        '"" data-inverted="" data-position="top left">&lt;label for="form_sup2' +
                        i +
                        '">' +
                        exercice[i].besoinFormulaire2Numerique[0] +
                        ' : &lt;/label>&lt;input id="form_sup2' +
                        i +
                        '" type="number"  min="1" max="' +
                        exercice[i].besoinFormulaire2Numerique[1] +
                        '">&lt;/div>'
      } else {
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="form_sup2' +
                        i +
                        '">' +
                        exercice[i].besoinFormulaire2Numerique[0] +
                        ' : &lt;/label>&lt;input id="form_sup2' +
                        i +
                        '" type="number"  min="1" max="' +
                        exercice[i].besoinFormulaire2Numerique[1] +
                        '">&lt;/div>'
      }
    }

    if (exercice[i].besoinFormulaire2Texte) {
      // Création d'un formulaire texte
      const paramTooltip = exercice[i].besoinFormulaire2Texte[1] ? `data-tooltip="${exercice[i].besoinFormulaire2Texte[1]}"` : ''
      divParametresGeneraux.innerHTML +=
                    `&lt;div style='display: inline'>&lt;label for='form_sup2${i}'> ${exercice[i].besoinFormulaire2Texte[0]} : &lt;/label>
                    &lt;div style='display: inline' ${paramTooltip} data-inverted=''>
                    &lt;input id='form_sup2${i}' type='text' size='20' >&lt;/div>&lt;/div>`
    }

    if (exercice[i].besoinFormulairei3CaseACocher) {
      // Création d'un formulaire texte
      divParametresGeneraux.innerHTML +=
                    "&lt;div style='display: inline'>&lt;label for='form_sup3" +
                    i +
                    "'>" +
                    exercice[i].besoinFormulairei3CaseACocher[0] +
                    " : &lt;/label>&lt;input id='form_sup3" +
                    i +
                    "' type='checkbox'  >&lt;/div>"
    }

    if (exercice[i].besoinFormulaire3Numerique) {
      // Création d'un formulaire numérique
      if (exercice[i].besoinFormulaire3Numerique[2]) {
        // Si un tooltip est défini
        divParametresGeneraux.innerHTML +=
                        '&lt;div data-tooltip="' +
                        exercice[i].besoinFormulaire3Numerique[2] +
                        '"" data-inverted="" data-position="top left">&lt;label for="form_sup3' +
                        i +
                        '">' +
                        exercice[i].besoinFormulaire3Numerique[0] +
                        ' : &lt;/label>&lt;input id="form_sup3' +
                        i +
                        '" type="number"  min="1" max="' +
                        exercice[i].besoinFormulaire3Numerique[1] +
                        '">&lt;/div>'
      } else {
        divParametresGeneraux.innerHTML +=
                        '&lt;div>&lt;label for="form_sup3' +
                        i +
                        '">' +
                        exercice[i].besoinFormulaire3Numerique[0] +
                        ' : &lt;/label>&lt;input id="form_sup3' +
                        i +
                        '" type="number"  min="1" max="' +
                        exercice[i].besoinFormulaire3Numerique[1] +
                        '">&lt;/div>'
      }
    }

    if (exercice[i].besoinFormulaire3Texte) {
      // Création d'un formulaire texte
      divParametresGeneraux.innerHTML +=
                    "&lt;p>&lt;/p>&lt;div style='display: inline'>&lt;label for='form_sup3" +
                    i +
                    "'>" +
                    exercice[i].besoinFormulaire3Texte[0] +
                    " : &lt;/label>&lt;div style='display: inline' data-tooltip='" +
                    exercice[i].besoinFormulaire3Texte[1] +
                    "' data-inverted=''>&lt;input id='form_sup3" +
                    i +
                    "' type='text' size='20' >&lt;/div>&lt;/div>"
    }
  }

  for (let i = 0; i &lt; exercice.length; i++) {
    if (!context.isHtml) {
      // Les paramètres à ne gérer que pour la version LaTeX
      // Gestion de la consigne
      if (exercice[i].consigneModifiable) {
        formConsigne[i] = document.getElementById('form_consigne' + i)
        formConsigne[i].value = exercice[i].consigne // Rempli le formulaire avec la consigne
        formConsigne[i].addEventListener('change', function (e) {
          // Dès que le texte change, on met à jour
          exercice[i].consigne = e.target.value
          miseAJourDuCode()
        })
      }

      // Gestion du nombre de la correction détaillée
      if (exercice[i].correctionDetailleeDisponible) {
        formCorrectionDetaillee[i] = document.getElementById('form_correctionDetaillee' + i)
        formCorrectionDetaillee[i].checked = exercice[i].correctionDetaillee // Rempli le formulaire avec la valeur par défaut
        formCorrectionDetaillee[i].addEventListener('change', function (e) {
          // Dès que le statut change, on met à jour
          exercice[i].correctionDetaillee = e.target.checked
          miseAJourDuCode()
        })
      }

      // Gestion du nombre de colones
      if (exercice[i].nbColsModifiable) {
        formNbCols[i] = document.getElementById('form_nbCols' + i)
        formNbCols[i].value = exercice[i].nbCols // Rempli le formulaire avec le nombre de colonnes
        formNbCols[i].addEventListener('change', function (e) {
          // Dès que le nombre change, on met à jour
          exercice[i].nbCols = e.target.value
          miseAJourDuCode()
        })
      }

      // Gestion du nombre de colones dans la correction
      if (exercice[i].nbColsCorrModifiable) {
        formNbColsCorr[i] = document.getElementById('form_nbColsCorr' + i)
        formNbColsCorr[i].value = exercice[i].nbColsCorr // Rempli le formulaire avec le nombre de colonnes de la correction
        formNbColsCorr[i].addEventListener('change', function (e) {
          // Dès que le nombre change, on met à jour
          exercice[i].nbColsCorr = e.target.value
          miseAJourDuCode()
        })
      }

      // Gestion de l'espacement
      if (exercice[i].spacingModifiable) {
        formSpacing[i] = document.getElementById('form_spacing' + i)
        formSpacing[i].value = exercice[i].spacing // Rempli le formulaire avec le nombre de colonnes de la correction
        formSpacing[i].addEventListener('change', function (e) {
          // Dès que le nombre change, on met à jour
          exercice[i].spacing = e.target.value
          miseAJourDuCode()
        })
      }

      // Gestion de l'espacement dans la correction
      if (exercice[i].spacingCorrModifiable) {
        formSpacingCorr[i] = document.getElementById('form_spacingCorr' + i)
        formSpacingCorr[i].value = exercice[i].spacingCorr // Rempli le formulaire avec le nombre de colonnes de la correction
        formSpacingCorr[i].addEventListener('change', function (e) {
          // Dès que le nombre change, on met à jour
          exercice[i].spacingCorr = e.target.value
          miseAJourDuCode()
        })
      }

      // Gestion de la suppression de la correction
      const formCorrectionAffichee = document.getElementById('supprimer_correction')
      formCorrectionAffichee.addEventListener('change', function (e) {
        // Dès que le statut change, on met à jour
        miseAJourDuCode()
      })

      // Gestion du mode N&amp;B pour les remplissages
      const formModeNB = document.getElementById('ModeNB')
      formModeNB.addEventListener('change', function (e) {
        // Dès que le statut change, on met à jour
        if ($('#ModeNB:checked').val()) {
          context.sortieNB = true
        } else {
          context.sortieNB = false
        }
        miseAJourDuCode()
      })

      // Gestion de la suppression des identifiants
      const formSupprimerReference = document.getElementById('supprimer_reference')
      formSupprimerReference.addEventListener('change', function (e) {
        // Dès que le statut change, on met à jour
        // nouvelles_donnees();
        miseAJourDuCode()
      })

      // Gestion du changement de style
      const btnRadioStyleClassique = document.getElementById('style_classique')
      btnRadioStyleClassique.addEventListener('change', miseAJourDuCode)
      const btnRadioStyleCoopMaths = document.getElementById('style_CoopMaths')
      btnRadioStyleCoopMaths.addEventListener('change', miseAJourDuCode)
    }

    // Gestion du nombre de questions
    if (exercice[i].nbQuestionsModifiable) {
      formNbQuestions[i] = document.getElementById('form_nbQuestions' + i)
      formNbQuestions[i].value = exercice[i].nbQuestions // Rempli le formulaire avec le nombre de questions
      formNbQuestions[i].addEventListener('change', function (e) {
        // Dès que le nombre change, on met à jour
        exercice[i].nbQuestions = e.target.value
        miseAJourDuCode()
      })
    }

    // Gestion de la vidéo
    if (context.isHtml &amp;&amp; !context.isDiaporama) {
      formVideo[i] = document.getElementById('form_video' + i)
      formVideo[i].value = exercice[i].video // Rempli le formulaire
      formVideo[i].addEventListener('change', function (e) {
        // Dès que ça change, on met à jour
        exercice[i].video = e.target.value
        miseAJourDuCode()
      })
    }

    // Gestion de la correction détaillée
    if (exercice[i].correctionDetailleeDisponible) {
      formCorrectionDetaillee[i] = document.getElementById('form_correctionDetaillee' + i)
      formCorrectionDetaillee[i].checked = exercice[i].correctionDetaillee // Rempli le formulaire avec la valeur par défaut
      formCorrectionDetaillee[i].addEventListener('change', function (e) {
        // Dès que le statut change, on met à jour
        exercice[i].correctionDetaillee = e.target.checked
        miseAJourDuCode()
      })
    }

    // Gestion du mode interactif
    if (exercice[i].interactifReady &amp;&amp; !exercice[i].interactifObligatoire) { // Pour un exercice qui n'a que la version QCM, pas de menu
      formInteractif[i] = document.getElementById('formInteractif' + i)
      if (formInteractif[i]) {
        formInteractif[i].checked = exercice[i].interactif // Rempli le formulaire avec la valeur par défaut
        formInteractif[i].addEventListener('change', function (e) {
          // Dès que le statut change, on met à jour
          exercice[i].interactif = e.target.checked
          miseAJourDuCode()
        })
      }
    }
    // Gestion de l'identifiant de la série
    if (exercice.length > 0) {
      const formSerie = document.getElementById('form_serie')
      formSerie.value = context.graine // Rempli le formulaire avec la graine
      formSerie.addEventListener('change', function (e) {
        // Dès que le statut change, on met à jour
        context.graine = e.target.value
        miseAJourDuCode()
      })
    }

    // Gestion des paramètres supplémentaires s'ils existent

    if (exercice[i].besoinFormulaireTexte) {
      formSup[i] = document.getElementById('form_sup' + i)
      formSup[i].addEventListener('keydown', function (e) {
        // Appui sur la touche entrée
        if (e.keyCode === 13) {
          exercice[i].sup = e.target.value // Récupère  la saisie de l'utilisateur
          miseAJourDuCode()
        }
      })

      formSup[i].addEventListener('blur', function (e) {
        // Perte du focus
        exercice[i].sup = e.target.value
        miseAJourDuCode()
      })
    }

    if (exercice[i].besoin_formulaire_long_texte) {
      formSup[i] = document.getElementById('form_sup' + i)
      formSup[i].addEventListener('keydown', function (e) {
        // Appui sur la touche entrée
        if (e.keyCode === 13) {
          exercice[i].sup = e.target.value // Récupère  la saisie de l'utilisateur
          miseAJourDuCode()
        }
      })

      formSup[i].addEventListener('blur', function (e) {
        // Perte du focus
        exercice[i].sup = e.target.value
        miseAJourDuCode()
      })
    }

    if (exercice[i].besoinFormulaireNumerique) {
      formSup[i] = document.getElementById('form_sup' + i)
      formSup[i].value = exercice[i].sup // Rempli le formulaire avec le paramètre supplémentaire
      formSup[i].addEventListener('change', function (e) {
        // Dès que le nombre change, on met à jour
        exercice[i].sup = e.target.value
        miseAJourDuCode()
      })
    }

    if (exercice[i].besoinFormulaireCaseACocher) {
      formSup[i] = document.getElementById('form_sup' + i)
      formSup[i].checked = exercice[i].sup // Rempli le formulaire avec le paramètre supplémentaire
      formSup[i].addEventListener('change', function (e) {
        //
        exercice[i].sup = e.target.checked
        miseAJourDuCode()
      })
    }

    if (exercice[i].besoinFormulaire2CaseACocher) {
      formSup2[i] = document.getElementById('form_sup2' + i)
      formSup2[i].checked = exercice[i].sup2 // Rempli le formulaire avec le paramètre supplémentaire
      formSup2[i].addEventListener('change', function (e) {
        //
        exercice[i].sup2 = e.target.checked
        miseAJourDuCode()
      })
    }

    if (exercice[i].besoinFormulaire2Numerique) {
      formSup2[i] = document.getElementById('form_sup2' + i)
      formSup2[i].value = exercice[i].sup2 // Rempli le formulaire avec le paramètre supplémentaire
      formSup2[i].addEventListener('change', function (e) {
        // Dès que le nombre change, on met à jour
        exercice[i].sup2 = e.target.value
        miseAJourDuCode()
      })
    }

    if (exercice[i].besoinFormulaire2Texte) {
      formSup2[i] = document.getElementById('form_sup2' + i)
      formSup2[i].addEventListener('keydown', function (e) {
        // Appui sur la touche entrée
        if (e.keyCode === 13) {
          exercice[i].sup2 = e.target.value // Récupère  la saisie de l'utilisateur
          miseAJourDuCode()
        }
      })

      formSup2[i].addEventListener('blur', function (e) {
        // Perte du focus
        exercice[i].sup2 = e.target.value
        miseAJourDuCode()
      })
    }

    if (exercice[i].besoinFormulairei3CaseACocher) {
      formSup3[i] = document.getElementById('form_sup3' + i)
      formSup3[i].checked = exercice[i].sup3 // Rempli le formulaire avec le paramètre supplémentaire
      formSup3[i].addEventListener('change', function (e) {
        //
        exercice[i].sup3 = e.target.checked
        miseAJourDuCode()
      })
    }

    if (exercice[i].besoinFormulaire3Numerique) {
      formSup3[i] = document.getElementById('form_sup3' + i)
      formSup3[i].value = exercice[i].sup3 // Rempli le formulaire avec le paramètre supplémentaire
      formSup3[i].addEventListener('change', function (e) {
        // Dès que le nombre change, on met à jour
        exercice[i].sup3 = e.target.value
        miseAJourDuCode()
      })
    }

    if (exercice[i].besoinFormulaire3Texte) {
      formSup3[i] = document.getElementById('form_sup3' + i)
      formSup3[i].addEventListener('keydown', function (e) {
        // Appui sur la touche entrée
        if (e.keyCode === 13) {
          exercice[i].sup3 = e.target.value // Récupère  la saisie de l'utilisateur
          miseAJourDuCode()
        }
      })

      formSup3[i].addEventListener('blur', function (e) {
        // Perte du focus
        exercice[i].sup3 = e.target.value
        miseAJourDuCode()
      })
    }
  }
}

// Initialisation de la page
window.addEventListener('DOMContentLoaded', () => {
  $('.ui.dropdown').dropdown() // Pour le menu des exercices
  $('.ui.accordion').accordion('refresh')
  $('.ui.checkbox').checkbox()
  // Gestion du bouton de copie
  $('.ui.button.toggle').state() // initialise le bouton

  // Gestion du bouton « Nouvelles données »
  const btnMiseAJourCode = document.getElementById('btn_mise_a_jour_code')
  if (btnMiseAJourCode) {
    btnMiseAJourCode.addEventListener('click', nouvellesDonnees)
  }
  function nouvellesDonnees () {
    context.graine = strRandom({
      includeUpperCase: true,
      includeNumbers: true,
      length: 4,
      startsWithLowerCase: false
    })
    if (document.getElementById('form_serie')) {
      document.getElementById('form_serie').value = context.graine // mise à jour du formulaire
    }
    miseAJourDuCode()
  }

  if (context.isHtml &amp;&amp; !context.isDiaporama) {
    // gestion du bouton de zoom
    let taille = parseInt($('#affichage_exercices').css('font-size'))
    let lineHeight = parseInt($('#affichage_exercices').css('line-height'))
    $('#btn_zoom_plus').click(function () {
      taille *= 1.2
      lineHeight *= 1.2
      $('#affichage_exercices').css('font-size', `${taille}px`)
      $('.monQcm').css('font-size', `${taille}px`)
      $('#affichage_exercices').css('line-height', `${lineHeight}px`)
      $('.monQcm').css('line-height', `${lineHeight}px`)
      $('#affichage_exercices').find('h3').css('font-size', `${taille}px`)
      $('#affichage_exercices').find('h4').css('font-size', `${taille}px`)
      $('.mathalea2d').css('width', parseFloat($('.mathalea2d').css('width')) * 1.2)
      $('.mathalea2d').css('height', parseFloat($('.mathalea2d').css('height')) * 1.2)
    })
    $('#btn_zoom_moins').click(function () {
      if (parseInt(taille) > 10) {
        taille *= 0.8
        lineHeight *= 0.8
      }
      $('#affichage_exercices').css('font-size', `${taille}px`)
      $('#affichage_exercices').css('line-height', `${lineHeight}px`)
      $('.monQcm').css('font-size', `${taille}px`)
      $('.monQcm').css('line-height', `${lineHeight}px`)
      $('#affichage_exercices').find('h3').css('font-size', `${taille}px`)
      $('#affichage_exercices').find('h4').css('font-size', `${taille}px`)
      $('.mathalea2d').css('width', parseFloat($('.mathalea2d').css('width')) * 0.8)
      $('.mathalea2d').css('height', parseFloat($('.mathalea2d').css('height')) * 0.8)
    })
  }

  // Gestion de la redirection vers MathaleaLaTeX
  $('#btnLaTeX').click(function () {
    window.location.href = window.location.href.replace('exercice.html', 'mathalealatex.html')
  })

  // handlers pour la prévisualisation des exercices cg 04-20201
  function afficherPopup () {
    // lors du clic sur l'oeil, si la popup est affichée on la cache, sinon on ouvre la prévisulisation.
    if ($('.popuptext').is(':visible')) {
      $('.popuptext').empty()
      $('.popuptext').hide()
    } else {
      miseAJourDeLaListeDesExercices(event.target.id)
    }
  }

  $('.popup').off('click').on('click', function (e) {
    event.stopPropagation()
    afficherPopup()
  })

  $(document).click(function (event) {
    // On ferme la popup si au clic partout sur la feuille.
    if ($('.popuptext').is(':visible') || !$(event.target).hasClass('poppup') || !$(event.target).hasClass('icone_ppreview')) {
      $('.popuptext').hide()
      $('.popuptext').empty()
      $('.icone_preview').off('click').on('click', function (e) {
        $('.popup').trigger('click')
      })
    }
  })

  // Gestion de l'évènement sur le click sur les flèches pour basculer les exercices en plein écran.
  $('#exo_plein_ecran').click(function (event) {
    if ($('#exo_plein_ecran').hasClass('left')) {
      $('#left').hide()
      $('#right').removeClass('column')
      $('#right').css('width', '100%')
      $('#exo_plein_ecran').removeClass('left')
      $('#exo_plein_ecran').addClass('right')
    } else {
      $('#left').show()
      $('#right').addClass('column')
      $('#right').css('width', $('#left').css('width'))
      $('#exo_plein_ecran').removeClass('right')
      $('#exo_plein_ecran').addClass('left')
    }
  })

  window.addEventListener('resize', function (e) {
  // Pour gérer un problème de dimension de la colonne de droite si on change la taille de fenêtre après un passage en mode plein écran des exercices.
    if ($('#exo_plein_ecran').hasClass('left')) {
      $('#right').css('width', $('#left').css('width'))
    }
  })

  // Gestion des boutons QRcode et copie du lien
  if (document.getElementById('btnQRcode')) {
    document.getElementById('btnQRcode').addEventListener('click', function () {
      $('#ModalQRcode').html('&lt;canvas width="800" height="800" id="canvasQRCode">&lt;/canvas>')
      const canvas = document.getElementById('canvasQRCode')
      QRCode.toCanvas(canvas, window.location.href, { width: Math.min(window.innerHeight, window.innerWidth) * 0.9, height: Math.min(window.innerHeight, window.innerWidth) * 0.9 })
      $('#ModalQRcode').modal('show')
    })
  }
  if (document.getElementById('btnEmbed')) {
    document.getElementById('btnEmbed').addEventListener('click', function () {
      $('#ModalEmbed').html(`&lt;div class="content">&lt;p>&lt;pre>&lt;code>&amp;lt;iframe width="660"
        height="315" 
        src="${window.location.href.replace('exercice.html', 'exo.html')}"
        frameborder="0" >
&amp;lt;/iframe>&lt;/code>&lt;pre>&lt;/p>
        &lt;button id="btnEmbedCode" style="margin:10px" class="btn ui toggle button labeled icon url"
        data-clipboard-action="copy" data-clipboard-text=url_courant()>&lt;i class="copy icon">&lt;/i>Copier le code HTML&lt;/button>&lt;/div>`)
      const clipboard = new Clipboard('#btnEmbedCode', { text: () => `&lt;iframe\n\t width="660" height="315"\n\t src="${window.location.href.replace('exercice.html', 'exo.html')}"\n\tframeborder="0" >\n&lt;/iframe>` })
      clipboard.on('success', function (e) {
        console.info(e.text + ' copié dans le presse-papier.')
      })
      $('.ui.button.toggle').state() // initialise le bouton
      $('#ModalEmbed').modal('show')
    })
  }

  // Récupère la graine pour l'aléatoire dans l'URL
  const params = new URL(document.location).searchParams
  const serie = params.get('serie')
  if (serie) {
    context.graine = serie
  }
  if (params.get('duree')) {
    context.duree = params.get('duree')
  }
  const urlVars = getUrlVars()
  if (urlVars.length > 0) {
    for (let i = 0; i &lt; urlVars.length; i++) {
      listeDesExercices.push(urlVars[i].id)
    }
    formChoixDesExercices.value = listeDesExercices.join(',')
    copierExercicesFormVersAffichage(listeDesExercices)
    try {
      miseAJourDeLaListeDesExercices()
    } catch (err) {
      messageUtilisateur(err)
    }
  }
})
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Wed May 19 2021 18:52:13 GMT+0200 (heure d’été d’Europe centrale) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
